<!doctype html><title>Convo IRL</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><style>*{width:100%;height:100%;margin:0;padding:0;image-rendering:pixelated;image-rendering:optimizeSpeed;overflow:hidden}</style><canvas id="game"></canvas><script>!function(){var t={};Object.defineProperty(t,"__esModule",{value:!0});t.TS=8;t.MS=1/60;t.LS=8;t.TT=120;t.LH=5;t.LT="*LISTEN*";var e={h:3*t.LH+2*t.LS,w:12*t.LH};t.BS=e;var i={};function s(t,e,i){return(1-i)*t+i*e}Object.defineProperty(i,"__esModule",{value:!0});var a=s;function n(t,e,i){return Math.max(Math.min(t,i),e)}i.lerp=a;var o=n;i.clamp=o;var h=function(t,e,i,a,o){return n(s(t,e,o),i,a)};i.clerp=h;var r=function(t){return[].concat.apply([],t)};i.flatten=r;var l=function(t){return Math.floor(Math.random()*t.length)};i.randomIndex=l;var u=function(t,e){var i=e.indexOf(t);return i>-1&&(e.splice(i,1),!0)};i.removeElement=u;var c=function(t,e){var i;return function(){var s=arguments;i||(t.apply(this,s),i=!0,setTimeout(function(){return i=!1},e))}};i.throttle=c;var p={};Object.defineProperty(p,"__esModule",{value:!0});p.default=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];var d={},f=d&&d.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(d,"__esModule",{value:!0});var g=f(p),m=function(){function t(t){this.size={w:1,h:1},this.pos={x:0,y:0},this.color=g.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=h(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=h(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.dSize.w*e/2,-this.dSize.h*e/2,this.dSize.w*e,this.dSize.h*e)},t}();d.default=m;var v={},y=v&&v.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(v,"__esModule",{value:!0});var w=y(d),x=2,b=1,S=4,T=1,z=4,k=6,M=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],_=function(){function e(e){var i=this;this.pos={x:0,y:0},this.size={h:t.TS,w:t.TS},this.visible=!0,this.skills=[],this.a={},this.tileIndex={x:0,y:0},this.energy=1,this.talking=!1,this.lastConvo=0,this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.game=e,this.a.blinking={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},this.a.lookAway={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},this.stop(),this.color=M[l(M)],this.dusts=Array.from(Array(50).keys()).map(function(){return new w.default(i.game)}),this.dSize={h:t.TS*this.game.ss,w:t.TS*this.game.ss},this.squareSize=this.game.ss,this.rando=100*Math.random()}return Object.defineProperty(e.prototype,"walking",{get:function(){return this.a.walking.running},enumerable:!0,configurable:!0}),e.prototype.copy=function(){var t=new e(this.game);return t.move(this.pos),t.color=this.color,t.skills=this.skills,t},e.prototype.setConvoMode=function(e,i){this.inConvoMode=e,this.rot=Math.PI,this.squareSize=this.game.ss,this.size.w=t.TS,this.size.h=t.TS,this.dSize.w=this.size.w*this.game.ss,this.dSize.h=this.size.h*this.game.ss,e?(this.squareSize*=2,this.size.w*=2,this.size.h*=2,this.dSize.w*=2,this.dSize.h*=2,this.a.walking.tw=0):this.talking=!1,this.convoLookRight="right"===i},e.prototype.stop=function(){this.a.walking={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:-1,y:-1},startTime:0,t:0,tw:0}},e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.tileIndex.x=Math.round(this.pos.x/t.TS),this.tileIndex.y=Math.round(this.pos.y/t.TS)},e.prototype.look=function(t){this.walk(t,!0)},e.prototype.walk=function(e,i){void 0===i&&(i=!1);var s=this.pos,a=s.x,n=s.y;switch(e){case"left":this.rot=-Math.PI/2,a-=t.TS;break;case"right":this.rot=Math.PI/2,a+=t.TS;break;case"down":this.rot=Math.PI,n+=t.TS;break;case"up":this.rot=0,n-=t.TS}if(!i&&!this.walking){var o={x:this.pos.x,y:this.pos.y},h={x:a,y:n};return!!function(e){var i=this.game.cl,s=e.x>=0&&e.x<=i.size.w-this.size.w&&e.y>=0&&e.y<i.size.h,a=e.x,n=e.y;return a/=t.TS,n/=t.TS,s&&i.tiles[this.game.cl.size.w/t.TS*n+a].wable}.call(this,h)&&(this.configureWalkingAnimation(o,h),!0)}},e.prototype.configureWalkingAnimation=function(t,e){var i=this.a.walking;i.startTime=this.game.tstamp,i.endPos=e,i.startPos=t,i.running=!0,i.t=0},e.prototype.update=function(e){if(this.autoWalkDirection&&this.walk(this.autoWalkDirection),-1!==this.a.walking.startPos.x){var i=(e-this.a.walking.startTime)/this.a.walking.duration,s=a(this.a.walking.startPos.x,this.a.walking.endPos.x,i),n=a(this.a.walking.startPos.y,this.a.walking.endPos.y,i);this.a.walking.t=i,i>=1?(s=this.a.walking.endPos.x,n=this.a.walking.endPos.y,this.a.walking.running=!1,this.a.walking.t=0,this.a.walking.tw=Math.max(this.a.walking.tw-100*t.MS,0)):this.a.walking.tw=Math.min(this.a.walking.tw+100*t.MS,this.a.walking.duration),this.move({x:s,y:n})}},e.prototype.draw=function(t,e){t.translate(this.dSize.w/2,this.dSize.h/2),t.rotate(this.rot),t.translate(-this.dSize.w/2,-this.dSize.h/2),t.fillStyle=this.color,t.fillRect(0,0,this.dSize.w,this.dSize.h);var i=this.a.walking.tw/this.a.walking.duration,s=t.createLinearGradient(0,this.dSize.h,0,1.5*this.dSize.h);if(s.addColorStop(0,this.color),s.addColorStop(i,"rgba(150, 192, 131, 0)"),t.fillStyle=s,t.fillRect(0,0,this.dSize.w,1.5*this.dSize.h),function(t){var e=this.a,i=e.blinking,s=e.lookAway;L(i,t)&&(i.running=!0,i.startTime=t),L(s,t)&&(s.running=!0,s.startTime=t),function(t,e){var i=(e-t.startTime)/t.duration;t.openness=function(t,e,i,s){void 0===s&&(s=!1);var a=i,n=e;if(s&&(a=e,n=i),t>=.5){var o=(t-.5)/.5;return h(a,n,e,i,o)}return h(n,a,e,i,o=t/.5)}(i,0,1,!0),i>=1&&(t.running=!1)}.call(this,i,t),function(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)}.call(this,s)}.call(this,e),A.call(this,t,"left",this.a.blinking.openness,this.a.lookAway.offset),A.call(this,t,"right",this.a.blinking.openness,this.a.lookAway.offset),this.talking){t.fillStyle="#000";var a=Math.sin(e/80+this.rando)+1;t.fillRect((this.convoLookRight?1:5)*this.squareSize,this.squareSize+a/4,2*this.squareSize+a,2*this.squareSize*a/2)}if(this.walking&&e-this.lastDustAt>30){var n=this.dusts.find(function(t){return!t.visible});if(n){var o=this.size.w/2*Math.random()+this.size.w/4,r=this.size.h/2*Math.random()+this.size.h/4,l=this.pos.x+o,u=this.pos.y+r;n.reJuice(e,l,u),this.lastDustAt=e}}},e}();function A(t,e,i,s){var a="left"===e?0:S*this.squareSize;t.fillStyle="#000";var n=T,o=0;this.inConvoMode&&(n=z),this.inConvoMode&&this.convoLookRight&&(o=k*this.squareSize);var h=n*this.squareSize,r=x*this.squareSize,l=b*this.squareSize;t.fillRect(h+a-o,h,r,r*i),t.fillStyle="#fff",t.fillRect(h+a+s*this.squareSize-o,h,l,l*i)}function L(t,e){if(t.running)return!1;var i=e-t.startTime>t.minTimeDelta,s=t.percentChance>Math.random();return i&&s}v.default=_;var P,O,I={};Object.defineProperty(I,"__esModule",{value:!0});var D=function(){function t(t){this.pos={x:0,y:0},this.size={w:0,h:0},P=t,this.size={w:P.canvas.width,h:P.canvas.height},O={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(t.prototype,"offset",{get:function(){return{x:O.pos.x+this.pos.x,y:O.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y},t.prototype.moveToPlayer=function(t){this.pos.x=P.canvas.width/2-t.pos.x*P.ss-t.dSize.w/2,this.pos.y=P.canvas.height/2-t.pos.y*P.ss-t.dSize.h/2;var e=-1*(P.cl.dSize.w-this.size.w),i=-1*(P.cl.dSize.h-this.size.h);this.pos.x>0&&(this.pos.x=0),this.pos.x<e&&(this.pos.x=e),this.pos.y>0&&(this.pos.y=0),this.pos.y<i&&(this.pos.y=i)},t.prototype.shakeScreen=function(){O.pos={x:0,y:0},O.amplitude=10*P.ss,O.dir.x=C(),O.dir.y=C()},t.prototype.updateShake=function(t){O.amplitude*=.9;var e=O.amplitude,i=O.dir;Math.abs(e)<=.01?(O.pos.x=0,O.pos.y=0):(O.pos.x=Math.sin(t/50)*e*i.x,O.pos.y=Math.sin(t/50)*e*i.y)},t}();function C(){return 2*Math.round(Math.random())-1}I.default=D;var q={};Object.defineProperty(q,"__esModule",{value:!0});var E=null,j={cloud:{cMatrix:[[E,E,E,E,E,E,E,E],[E,E,E,E,E,E,E,E],[E,E,E,E,E,E,E,E],[E,E,E,1,1,E,E,E],[E,E,1,1,1,1,E,E],[E,E,1,1,1,1,1,E],[E,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],canvas:null},door:{cMatrix:R(0),canvas:null,interactable:!0},flowers:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},grass:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},green:{cMatrix:R(2),canvas:null},house:{cMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],canvas:null,tileLength:3*t.TS},sky:{cMatrix:R(9),canvas:null},tree:{cMatrix:[[E,E,E,E,E,E,E,E],[E,E,7,7,7,7,E,E],[E,7,7,7,7,7,7,E],[E,7,7,7,7,7,7,E],[E,E,7,7,7,7,E,E],[E,E,E,6,6,E,E,E],[E,E,E,6,6,E,E,E],[E,E,6,6,6,6,E,E]],canvas:null,wable:!1},unwalkable:{canvas:null,visible:!1,wable:!1}};function R(e){return new Array(t.TS).fill(null).map(function(){return new Array(t.TS).fill(e)})}q.default=j;var W={},F=W&&W.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(W,"__esModule",{value:!0});var B=F(p),N=F(q),G=function(){function e(e,i,s,a){this.dSize={w:t.TS,h:t.TS},this.pos={x:0,y:0},this.size={w:t.TS,h:t.TS},this.wable=!0,this.visible=!0,this.alpha=1,this.tileLength=t.TS,this.game=e,this.pos={x:s*t.TS,y:a*t.TS},this.tileIndex={x:s,y:a},this.name=i,this.cMatrix=N.default[i].cMatrix,this.wable=N.default[i].hasOwnProperty("wable")?N.default[i].wable:this.wable,this.visible=N.default[i].hasOwnProperty("visible")?N.default[i].visible:this.visible,this.tileLength=N.default[i].hasOwnProperty("tileLength")?N.default[i].tileLength:this.tileLength,this.dSize={h:this.tileLength*this.game.ss,w:this.tileLength*this.game.ss},this.cacheOffscreenContext()}return e.prototype.draw=function(t){t.globalAlpha=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,t.drawImage(N.default[this.name].canvas,0,0)},e.prototype.moveleft=function(){this.pos.x=this.pos.x+this.size.w<0?this.lWidth:this.pos.x-.008*this.speed},e.prototype.cacheOffscreenContext=function(){var t=this,e=document.createElement("canvas");e.width=this.dSize.w,e.height=this.dSize.h;var i=e.getContext("2d");r(this.cMatrix).map(function(t){return B.default[t]}).forEach(function(e,s){if(e){i.fillStyle=e;var a=t.game.ss*(s%t.tileLength),n=t.game.ss*Math.floor(s/t.tileLength);i.fillRect(a,n,t.game.ss,t.game.ss)}}),N.default[this.name].canvas=e},e}();W.default=G;var V={},U=V&&V.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(V,"__esModule",{value:!0});var H=U(p),Y=U(W),K=function(){function e(t){this.tiles=[],this.bgColor=H.default[2],this.clouds=[],this.game=t}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(t){this.uables.forEach(function(e){return e.update(t)}),this.clouds.forEach(function(t){return t.moveleft()})},e.prototype.configViz=function(){this.dables=new Array(4).fill(null).map(function(){return(new Array).fill(null)}),this.odables=[],this.uables=[]},e.prototype.configClouds=function(t,e,i){this.clouds=[];for(var s=0;s<20;s++){var a=new Y.default(this.game,"cloud",0,0);a.pos.x=X(0,t),a.pos.y=X(0,e),a.speed=X(.2,1),a.alpha=i,a.lWidth=this.size.w,this.clouds.push(a)}},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*t.TS,i=this.tileIndexes.length*t.TS;this.size={w:e,h:i},this.dSize={w:e*this.game.ss,h:i*this.game.ss};for(var s=0;s<this.tileIndexes.length;s++)for(var a=0;a<this.tileIndexes[s].length;a++){var n=this.tileTypeMap[this.tileIndexes[s][a]||0];this.tiles.push(new Y.default(this.game,n,a,s))}},e.prototype.addDables=function(t,e){var i;(i=this.dables[e]).push.apply(i,t)},e.prototype.addOdables=function(t){var e;(e=this.odables).push.apply(e,t)},e.prototype.addUables=function(t){var e;(e=this.uables).push.apply(e,t)},e}();function X(t,e){return Math.random()*(e-t)+t}V.default=K;var J={};Object.defineProperty(J,"__esModule",{value:!0});J.default={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]],"*":[[,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1]]};var Q={},Z=Q&&Q.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Q,"__esModule",{value:!0});var $=Z(p),tt=Z(J),et=function(){function e(e,i,s,a){void 0===i&&(i=""),void 0===s&&(s=$.default[1]),void 0===a&&(a={x:0,y:0}),this.words="",this.dSize={w:0,h:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.buddy=null,this.a={},this.upToIndex=null,this.game=e,this.words=i.toUpperCase(),this.upToIndex=this.words.length,this.color=s,this.move(a),this.pixelLetters=this.words.split("").map(function(t){return tt.default[t]});var n=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,e){return t+e},0)+this.pixelLetters.length-1;this.size={w:n,h:t.LH},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss},this.a.floatText={duration:3e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0}}return e.prototype.draw=function(t,e){var i=this.pos.x,s=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,a=Math.floor(this.game.ss/2);t.globalAlpha=s;for(var n=0;n<this.upToIndex;n++){for(var o=this.pos.y,h=0,r=this.pixelLetters[n],l=0;l<r.length;l++){for(var u=r[l],c=0;c<u.length;c++)u[c]&&(this.shadow&&(t.fillStyle=$.default[0],t.fillRect(i+c*this.game.ss+a,o+a,this.game.ss,this.game.ss)),t.fillStyle=this.color,t.fillRect(i+c*this.game.ss,o,this.game.ss,this.game.ss));h=Math.max(h,u.length*this.game.ss),o=this.game.ss*(l+1)+this.pos.y}i+=this.game.ss+h}it.call(this,e)},e.prototype.touched=function(){},e.prototype.move=function(t){this.pos.x=Math.floor(t.x),this.pos.y=Math.floor(t.y)},e.prototype.showUpToIndex=function(t){this.upToIndex=t},e.prototype.startFloat=function(t,e){this.a.floatText.startTime=this.game.tstamp,this.a.floatText.startPos={x:t.x,y:t.y-this.size.h},this.a.floatText.endPos={x:e.x,y:e.y},this.a.floatText.running=!0,this.move(this.a.floatText.startPos)},e.prototype.update=function(t){it.call(this,t)},e}();function it(e){var i=this.a.floatText;if(i.running){var s=(e-i.startTime)/i.duration,n=a(i.startPos.x,i.endPos.x,s);this.words!==t.LT&&(n+=10*Math.sin(6*s*Math.PI));var o=a(i.startPos.y,i.endPos.y,s);s>=1&&(i.running=!1),this.alpha=1-s,this.move({x:n,y:o})}}Q.default=et;var st={},at=st&&st.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(st,"__esModule",{value:!0});var nt=at(p),ot=at(Q),ht=function(){function t(t,e,i,s){void 0===s&&(s=nt.default[8]),this.visible=!0,this.alpha=1,this.ani=!1,this.texts=[],this.startTime=null,this.game=t,this.pos=e,this.strokePos=e,this.color=s,this.updateSize(i),this.move(e)}return t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,rt.call(this)},t.prototype.updateSize=function(t){this.size={h:t.h,w:t.w},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}},t.prototype.draw=function(t,e){var i=this,s=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha;t.globalAlpha=s,t.fillStyle=this.color,this.color&&t.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),t.strokeStyle=nt.default[1],t.fillStyle=nt.default[1],t.lineWidth=this.game.ss,t.strokeRect(this.strokePos.x,this.strokePos.y,this.dSize.w,this.dSize.h);var a=new Array(this.texts.length).fill(0);if(this.startTime){var n=this.texts.reduce(function(t,e){return t+e.words.length},0),o=Math.min(Math.floor((e-this.startTime)/50),n);n===o&&(this.ani=!1),a=this.texts.map(function(t,e){var s=i.texts.slice(0,e).reduce(function(t,e){return e.words.length+t},0);return Math.min(o-s,t.words.length)})}this.texts.forEach(function(i,s){i.showUpToIndex(a[s]),i.draw(t,e)})},t.prototype.setWords=function(t){var e=this;this.texts=t.map(function(t){return new ot.default(e.game,t)}),rt.call(this)},t.prototype.aniText=function(t){this.startTime=t,this.ani=!0},t}();function rt(){var e=this;if(this.texts.length){var i=t.LS*this.game.ss,s=t.LH*this.game.ss,a=this.texts.length,n=a*s+(a-2)*i;this.texts.forEach(function(t,s){var a=e.pos.x+e.game.ss*(e.size.w-t.size.w)/2,o=e.pos.y+(e.dSize.h-n)/2+i*s;t.move({x:a,y:o})})}}st.default=ht;var lt={},ut=lt&&lt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(lt,"__esModule",{value:!0});var ct=ut(st),pt=ut(p),dt=ut(Q),ft=function(){function t(t,e,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.a={},this.game=t,this.energyText=new dt.default(this.game,i,pt.default[1]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.dSize={h:(this.size.h+2)*this.game.ss,w:(this.size.w+2)*this.game.ss};var s={h:this.size.h+2,w:this.size.w+2};this.box=new ct.default(t,e,s,null),this.a.level={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},this.move(e)}return Object.defineProperty(t.prototype,"animating",{get:function(){var t=this;return!!Object.keys(this.a).map(function(e){return t.a[e]}).find(function(t){return t.running})},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.box.move(this.pos),this.energyText.move({x:t.x+this.game.ss/2+2.5,y:t.y+this.game.ss/2+2.5})},t.prototype.draw=function(t,e){(function(t){if(this.a.level.running){var e=(t-this.a.level.startTime)/this.a.level.duration,i=a(this.a.level.startLevel,this.a.level.endLevel,e);e>=1&&(i=this.a.level.endLevel,this.a.level.running=!1),this.percentFull=i}}).call(this,e),t.globalAlpha=this.game.inTr()?this.game.nextAlpha:1,t.fillStyle=pt.default[10],t.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),t.fillStyle=pt.default[7],t.fillRect(Math.ceil(this.pos.x+1),Math.ceil(this.pos.y+1),Math.floor(Math.max(this.dSize.w*this.percentFull-2,0)),Math.floor(this.dSize.h-2)),this.box.draw(t,e),this.energyText.draw(t,e)},t.prototype.animateToLevel=function(t){this.a.level.startTime=this.game.tstamp,this.a.level.startLevel=this.percentFull,this.a.level.endLevel=t,this.a.level.running=!0},t}();lt.default=ft;var gt={},mt=gt&&gt.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),vt=gt&&gt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(gt,"__esModule",{value:!0});var yt,wt,xt,bt,St,Tt,zt,kt,Mt,_t=vt(V),At=vt(st),Lt=vt(p),Pt=vt(lt),Ot=vt(Q),It=2,Dt=3,Ct=.5,qt=0,Et=0,jt=!1,Rt=1,Wt=null,Ft=null,Bt=null,Nt=[],Gt=function(e){function i(i){var s=e.call(this,i)||this;s.bgColor=Lt.default[9],s.tileTypeMap=["green","flowers","sky","tree"],zt=new Pt.default(s.game,{x:s.game.ss,y:s.game.ss},"ENERGY"),bt=new Pt.default(s.game,{x:s.game.ss,y:s.game.ss},"CONVO"),yt=new At.default(s.game,{x:0,y:0},{h:0,w:0}),Mt=new Ot.default(s.game,"^"),Tt=new Ot.default(s.game,"_");var a=c(s.handleInput.bind(s),t.TT);return s.handleInput=a,Mt.touched=function(){return s.handleInput("ArrowUp")},Tt.touched=function(){return s.handleInput("ArrowDown")},s}return mt(i,e),Object.defineProperty(i.prototype,"boxPosY",{get:function(){return yt.pos.y/this.game.ss-this.game.p.size.h-4},enumerable:!0,configurable:!0}),i.prototype.handleInput=function(e){switch(e){case"ArrowUp":Vt.call(this,1);break;case"ArrowDown":Vt.call(this,-1);break;case"Enter":(function(){var e=this;if(!jt){jt=!0;var i=Et;Kt.call(this,this.game.p,i),Ft=setTimeout(function(){return function(e){var i=this.game.p.skills[e];Ft=null,1===this.game.p.skills.length?Ut.call(this,-.1,.5):i===t.LT&&2===this.game.p.skills.length?Ut.call(this,-.1,.5):i===t.LT?(Ht.call(this,-.1,.25),this.game.pa("good")):Wt===i?function(t,e){var i=this,s=function(){return Yt.call(i,xt,"totally!",Lt.default[2])};s(),window.setTimeout(s,500),window.setTimeout(s,1e3),Ht.call(this,t,e),this.game.pa("good",3)}.call(this,-.15,.5):xt.skills.includes(i)?Ut.call(this,-.1,.34):function(t){Yt.call(this,xt,"oh...",Lt.default[10]),Ht.call(this,t,0),this.game.c.shakeScreen(),this.game.pa("bad")}.call(this,-.2),bt.animateToLevel(St),zt.animateToLevel(this.game.p.energy)}.call(e,i)},2e3);var s=xt.skills.indexOf(t.LT);1!==this.game.p.skills.length&&(s=l(xt.skills)),Bt=setTimeout(function(){return Kt.call(e,xt,s)},4500)}}).call(this)}},i.prototype.handleTouch=function(t){var e=this,i=20*this.game.sf,s=Nt.find(function(s){var a=Object.assign({},s.dSize),n=Object.assign({},s.pos);return a.w*=e.game.sf,a.h*=e.game.sf,n.x*=e.game.sf,n.y*=e.game.sf,t.clientX+i>=n.x&&t.clientX-i<=n.x+a.w&&t.clientY+i>=n.y&&t.clientY-i<=n.y+a.h&&s.visible});s&&s.touched()},i.prototype.levelWillStart=function(){var t=this;(xt=this.game.levels.world.currentBuddy.copy()).setConvoMode(!0,"left"),jt=!1,this.game.p.setConvoMode(!0,"right"),St=0,this.usedTopics=[],Wt=null,wt=[this.game.p,xt],xt.skills.length>2&&(Rt=.35),(kt=this.game.p.skills.map(function(e){return new Ot.default(t.game,e)})).forEach(function(e){return e.touched=function(){kt[Et]===e&&t.handleInput("Enter")}})},i.prototype.levelStarted=function(){bt.animateToLevel(St),zt.animateToLevel(this.game.p.energy)},i.prototype.resize=function(){this.configViz()},i.prototype.update=function(i){if(e.prototype.update.call(this,i),this.game.c.move({x:qt,y:0}),Xt.call(this),function(){var e=Jt(this.odables);wt.forEach(function(i){return i.talking=!!e.find(function(e){return e.words!==t.LT&&e.buddy===i})});for(var i=e.length-1;i>=0;i--){var s=e[i];if(!s)break;s.a.floatText.running||(u(s,this.odables),this.uables.splice(i,1))}}.call(this),jt=Jt(this.odables).length>0||this.game.inTr()||!!Bt||!!Ft,function(t){return!bt.animating&&0===Jt(t).length}(this.odables))if(St>=1){var s=1===this.game.p.skills.length?"post-listen":"post-convo";s=xt.skills.length>2?"win":s,this.game.qLevel(this.game.levels.world,s)}else this.game.p.energy<=0&&this.game.qLevel(this.game.levels.world,"nap")},i.prototype.configViz=function(){e.prototype.configViz.call(this),Nt=[];var i=this.game.sizeInTiles();qt=-i.w*t.TS*this.game.ss/2,Xt.call(this),function(){var e=this.game.canvas.height-t.BS.h*this.game.ss-2*this.game.ss;yt.move({x:this.game.boxPos().x,y:e}),yt.updateSize(t.BS);var i=zt.dSize.w+bt.dSize.w+Dt*this.game.ss,s=(this.game.canvas.width-i)/2;zt.move({x:s,y:zt.pos.y});var a=zt.pos.x+zt.dSize.w+Dt*this.game.ss;bt.move({x:a,y:bt.pos.y});var n=this.game.boxPos().x/this.game.ss-xt.size.w/2-qt/this.game.ss,o=n+yt.dSize.w/this.game.ss-xt.size.w/2,h={x:n+this.game.p.size.w/2,y:this.boxPosY};this.game.p.move(h),xt.move({x:o,y:h.y})}.call(this),Vt.call(this,0),this.tileIndexes=function(t){for(var e=Math.min(t.p.tileIndex.y+1,t.sizeInTiles().h),i=t.sizeInTiles(),s=new Array(2*i.h).fill(null).map(function(){return new Array(2*i.w).fill(null).map(function(){return l([0,1])})}),a=0;a<e;a++)s[a]=s[a].map(function(){return 2});var n=s[e-1];return n&&(s[e-1]=n.map(function(){return 3})),s}(this.game),this.generateTiles(),this.addDables(this.tiles,0),this.addDables(wt,1),this.addOdables([yt,Mt,Tt,zt,bt].concat(kt)),Nt.push.apply(Nt,[Mt,Tt].concat(kt)),this.configClouds(this.size.w,this.game.p.pos.y-t.TS,.6),this.addDables(this.clouds,0)},i}(_t.default);function Vt(t){if(!jt){var e=kt[Et+t]||kt[Et];Et=kt.indexOf(e),kt.forEach(function(t){return t.alpha=Ct}),this.game.pa("walk")}}function Ut(t,e){Yt.call(this,xt,"cool!",Lt.default[2]),Ht.call(this,t,e),this.game.pa("good")}function Ht(t,e){(function(t,e){t.energy=o(Math.round(100*(t.energy+e))/100,0,1)})(this.game.p,t),function(t){St=o(Math.round(100*(St+t))/100,0,1)}(e*Rt)}function Yt(e,i,s){var a=new Ot.default(this.game,i,s);a.buddy=e;var n=this.boxPosY*this.game.ss+this.game.p.dSize.h/2,o={x:yt.pos.x+this.game.p.dSize.w/2,y:n},h={x:this.game.canvas.width,y:-t.LH};e!==this.game.p&&(o.x+=yt.dSize.w-a.dSize.w-this.game.p.dSize.w,h.x=0),i===t.LT&&(h.x=o.x),a.startFloat(o,h),this.addOdables([a]),this.addUables([a])}function Kt(e,i){if(e===xt&&(Bt=null),!(St>=1||this.game.p.energy<=0)){var s=e.skills[i],a=s===t.LT?Lt.default[9]:Lt.default[1];Yt.call(this,e,s,a),e===xt&&(Wt=s,this.usedTopics.includes(s)||this.usedTopics.push(s)),s!==t.LT&&this.game.pa("walk",5)}}function Xt(){var e=this,i=It*this.game.ss,s=yt.pos.x+yt.dSize.w-Mt.dSize.w-i,a=yt.pos.y+yt.dSize.h/2-Mt.dSize.h/2,n=yt.pos.x+i,o=a;Mt.move({x:s,y:a}),Tt.move({x:n,y:o}),Tt.alpha=0===Et||jt?Ct:1,Mt.alpha=Et===kt.length-1||jt?Ct:1,kt.forEach(function(i,s){var a=Et-s;i.alpha=0!==a||jt?Ct:1;var n=yt.pos.x+yt.dSize.w/2-i.dSize.w/2,o=yt.pos.y+yt.dSize.h/2-i.dSize.h/2+a*t.LS*e.game.ss;i.move({x:n,y:o}),i.visible=!(Math.abs(a)>1)})}function Jt(t){return t.filter(function(t){return t instanceof Ot.default&&t.buddy})}gt.default=Gt;var Qt={},Zt=Qt&&Qt.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),$t=Qt&&Qt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Qt,"__esModule",{value:!0});var te=$t(st),ee=1,ie=function(e){function i(t){var i=e.call(this,t)||this;return i.tileTypeMap=["green","flowers","grass","tree"],i.box=new te.default(i.game,{x:0,y:0},{h:0,w:0}),i.box.setWords(["CONVO IRL","","TAP TO PLAY"]),i}return Zt(i,e),i.prototype.resize=function(){this.configViz()},i.prototype.update=function(t){e.prototype.update.call(this,t),this.game.c.pos.x-=.05*ee,this.game.c.pos.x<-this.game.canvas.width&&(ee=-1),this.game.c.pos.x>0&&(ee=1)},i.prototype.configViz=function(){e.prototype.configViz.call(this),this.tileIndexes=function(t,e){return new Array(2*t.h).fill(null).map(function(){return new Array(2*t.w).fill(null).map(function(){return l(e)})})}(this.game.sizeInTiles(),this.tileTypeMap),this.generateTiles(),this.box.move(this.game.boxPos()),this.box.updateSize(t.BS),this.addDables(this.tiles,0),this.addOdables([this.box]),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3)},i.prototype.levelStarted=function(){var t=this;window.setTimeout(function(){return t.box.aniText(t.game.tstamp)},200)},i.prototype.handleInput=function(){this.game.inTr()||this.box.ani||this.game.qLevel(this.game.levels.world)},i.prototype.handleTouch=function(){this.handleInput()},i}($t(V).default);Qt.default=ie;var se={},ae=se&&se.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),ne=se&&se.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(se,"__esModule",{value:!0});var oe,he,re,le,ue,ce,pe,de,fe,ge=ne(p),me=ne(V),ve=ne(st),ye=ne(v),we=ne(lt),xe=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],be=[["keep at it","and make","new friends!"],["if you are","low on energy","take a nap!"]],Se=[["well done!","you made a","new friend!"],["maybe you","will become","best buds!"],["be kind to","your friends","because"],["every quest","is better","with friends!"]],Te={x:18*t.TS,y:7*t.TS},ze={x:4*t.TS,y:5*t.TS},ke=["BAKING","FRANCE","SPORTS","ANIME","BOOKS","MATH","CATS"],Me=ke.slice(),_e={x:4*t.TS,y:6*t.TS},Ae={pressedAt:0,key:null},Le=0,Pe=[],Oe=function(e){function i(i){var s=e.call(this,i)||this;s.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],s.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,3,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,3,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,3,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,3,,2,,3,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],oe=function(){return Ce.call(s,xe)},he=function(){return Ce.call(s,be)},re=function(){return Ce.call(s,Se)},s.state="intro";var a=c(s.handleTouch.bind(s),t.TT),n=c(s.handleInput.bind(s),t.TT);return s.handleTouch=a,s.handleInput=n,s.generateTiles(),fe=new we.default(s.game,{x:0,y:i.ss},"ENERGY"),ue=new ve.default(s.game,s.game.boxPos(),t.BS),function(){var e;(pe=new ye.default(this.game)).move({x:7*t.TS,y:10*t.TS}),pe.skills.push(t.LT,ke[6]),pe.look("up");var i=new ye.default(this.game);i.move({x:8*t.TS,y:1*t.TS}),i.skills.push(ke[0],je(ke[0]));var s=new ye.default(this.game);s.move({x:18*t.TS,y:3*t.TS}),s.skills.push(ke[1],je(ke[1]));var a=new ye.default(this.game);a.move({x:25*t.TS,y:2*t.TS}),a.skills.push(ke[2],je(ke[2]));var n=new ye.default(this.game);n.move({x:15*t.TS,y:18*t.TS}),n.skills.push(ke[3],je(ke[3])),n.look("up");var o=new ye.default(this.game);o.move({x:26*t.TS,y:8*t.TS}),o.skills.push(ke[4],je(ke[4])),o.look("left"),(ce=new ye.default(this.game)).autoWalkDirection="left",ce.skills.push(ke[5],je(ke[5])),ce.a.walking.duration=600,(de=new ye.default(this.game)).move({x:23*t.TS,y:18*t.TS}),de.look("left"),(e=de.skills).push.apply(e,ke),le=[pe,i,s,a,de,n,o,ce]}.call(s),s}return ae(i,e),i.prototype.handleInput=function(t){this.game.inTr()||De.call(this)||(Ae={pressedAt:this.game.tstamp,key:t})},i.prototype.handleTouch=function(e){if(!this.game.inTr()&&!this.game.p.walking&&!De.call(this)){var i=this.game.c,s=i.size,a=s.h,n=s.w,o=i.offset,h=e.clientX*n/window.innerWidth-o.x,r=e.clientY*a/window.innerHeight-o.y,l=h-this.game.p.pos.x*this.game.ss,u=r-this.game.p.pos.y*this.game.ss,c=Math.abs(l),p=Math.abs(u),d=this.game.ss*t.TS/2;c<d&&p<d||(c>p?l>0?this.handleInput("ArrowRight"):this.handleInput("ArrowLeft"):u<0?this.handleInput("ArrowUp"):this.handleInput("ArrowDown"))}},i.prototype.resize=function(){var e=(this.game.canvas.width-fe.dSize.w)/2;fe.move({x:e,y:fe.pos.y}),ue.move(this.game.boxPos()),ue.updateSize(t.BS)},i.prototype.update=function(i){e.prototype.update.call(this,i),function(){if(this.game.tstamp-Ae.pressedAt>220)return!1;if(this.game.p.walking)return!1;var e=Object.assign({},this.game.p.tileIndex),i=null;switch(Ae.key){case"ArrowUp":i="up",e.y-=1;break;case"ArrowDown":i="down",e.y+=1;break;case"ArrowLeft":i="left",e.x-=1;break;case"ArrowRight":i="right",e.x+=1;break;default:return}return qe.call(this,e)?void 0:(e.x===ze.x/t.TS&&e.y===ze.y/t.TS&&Ee.call(this),this.game.p.walk(i)&&this.game.pa("walk"),!0)}.call(this),qe.call(this,this.game.p.tileIndex),this.game.c.moveToPlayer(this.game.p),ce.pos.x<=Te.x-5*t.TS&&(ce.autoWalkDirection="right"),ce.pos.x>=Te.x+5*t.TS&&(ce.autoWalkDirection="left")},i.prototype.configViz=function(){e.prototype.configViz.call(this),Pe=[],this.addDables(this.tiles,0),this.addDables(this.game.p.dusts,1),this.addDables(ce.dusts,1),this.addDables([this.game.p],2),this.addDables(le,2),this.addOdables([fe,ue]),Pe.push.apply(Pe,le),this.addUables(this.game.p.dusts.concat([this.game.p,ce],ce.dusts,[pe])),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3),this.resize()},i.prototype.levelStarted=function(){switch(fe.animateToLevel(this.game.p.energy),ce.move(Te),this.game.p.move(_e),this.game.p.stop(),this.game.p.setConvoMode(!1),this.state){case"intro":oe(),this.game.pa("good");break;case"nap":this.game.p.move(ze),Ee.call(this);break;case"win":this.game.p.energy=1,this.game.pa("good"),re();break;case"post-listen":case"post-convo":this.game.pa("good"),function(){var t=this;if(this.currentBuddy){var e=this.game.levels.convo.usedTopics.filter(function(e){return!t.game.p.skills.includes(e)}),i=e.length>0?e[l(e)]:null;ue.visible=!0,i?(ue.setWords(["nice convo!","you learned",i+"!"]),this.game.p.skills.push(i)):ue.setWords(["nice convo!","that was a","good time!"]),ue.aniText(this.game.tstamp)}}.call(this),this.game.p.lastConvo=this.game.tstamp}},i}(me.default);function Ie(){ue.visible=!1}function De(){if("play"===this.state)return!1;if(ue.ani)return!0;switch(this.state){case"sleeping":Ie.call(this),this.state="play",this.handleInput("ArrowDown"),this.game.pa("good");break;case"post-convo":Ie.call(this),this.state="play",this.currentBuddy.lastConvo=this.game.tstamp;break;case"post-listen":he()&&(this.state="play",pe.walk("right"),pe.look("left"));break;case"intro":oe()&&(this.state="play");break;case"win":re(),0===Se.length&&(this.state="game-over",Le=this.game.tstamp,Re.game=this.game,Re.size=Object.assign({},this.size),Re.dSize=Object.assign({},this.dSize),this.addDables([Re],3),this.game.pa("good"),fe.animateToLevel(1))}return this.game.pa("walk"),!0}function Ce(t){var e=t[0];return e?(ue.visible=!0,ue.setWords(e),ue.aniText(this.game.tstamp),t.shift(),!1):(ue.visible=!1,!0)}function qe(t){var e=Pe.find(function(e){return e.tileIndex.x===t.x&&e.tileIndex.y===t.y});return e&&this.game.tstamp-e.lastConvo>1e3&&!ue.visible?(this.currentBuddy=e,_e.x=this.game.p.pos.x,_e.y=this.game.p.pos.y,this.game.qLevel(this.game.levels.convo),!0):!!e}function Ee(){this.game.p.energy=1,fe.animateToLevel(this.game.p.energy),ue.setWords(["","zzzzzz...",""]),ue.aniText(this.game.tstamp),ue.visible=!0,this.state="sleeping"}function je(t){var e=Me.find(function(e){return e!==t});return u(e,Me),e}se.default=Oe;var Re={alpha:0,dSize:{w:0,h:0},draw:function(t){t.fillStyle=ge.default[0],t.globalAlpha=Math.min((this.game.tstamp-Le)/2e3,.8),t.fillRect(0,0,this.dSize.w,this.dSize.h)},game:null,pos:{x:0,y:0},size:{w:0,h:0},visible:!0},We={};!function(t,e){e("object"==typeof We&&"string"!=typeof We.nodeName?We:We.TinyMusic={})}(0,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),i=/^[0-9.]+$/,s=/\s+/,a=/(\d+)/,n={};function o(t){var e=t.split(s);this.frequency=o.getFrequency(e[0])||0,this.duration=o.getDuration(e[1])||0}function h(t,e,i){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,i||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),o.getFrequency=function(t){var i=t.split(a),s=n[i[0]],o=(i[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),s)*Math.pow(2,o)},o.getDuration=function(t){return i.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},h.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,i){(i=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",i.frequency.value=e[1],t.connect(t=i)}.bind(this)),t.connect(this.ac.destination),this},h.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof o?t:new o(t))}.bind(this)),this},h.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},h.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},h.prototype.scheduleNote=function(t,e){var i=60/this.tempo*this.notes[t].duration,s=i*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,s),this.setFrequency(0,e+s),e+i},h.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},h.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},h.prototype.slide=function(t,e,i){var s=this.getNextNote(t),a=this.getSlideStartDelay(i);return this.setFrequency(this.notes[t].frequency,e+a),this.rampFrequency(s.frequency,e+i),this},h.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},h.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},h.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,i){t=this.scheduleNote(i,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},h.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=o,t.Sequence=h});var Fe={},Be=Fe&&Fe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Fe,"__esModule",{value:!0});var Ne,Ge,Ve,Ue=Be(v),He=Be(I),Ye=Be(gt),Ke=Be(Qt),Xe=Be(se),Je=Be(We),Qe=5,Ze=16*t.TS*Qe,$e=new(window.AudioContext||window.webkitAudioContext),ti={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},ei=!1,ii=null,si=null,ai=function(){function e(t){this.tstamp=0,this.ss=Qe,this.sf=1,this.nextAlpha=1,this.p=new Ue.default(this),this.p.skills.push("WEATHER"),this.canvas=t,(Ve=t.getContext("2d",{alpha:!1})).mozImageSmoothingEnabled=!1,Ve.webkitImageSmoothingEnabled=!1,this.levels={convo:new Ye.default(this),startScreen:new Ke.default(this),world:new Xe.default(this)},this.c=new He.default(this)}return e.prototype.boxPos=function(){return{x:(this.canvas.width-t.BS.w*this.ss)/2,y:(this.canvas.height-t.BS.h*this.ss)/2}},e.prototype.inTr=function(){return ti.running},e.prototype.update=function(t){if(ei||(this.tstamp=t,this.switchLevel(this.levels.startScreen),this.resize(),ei=!0),this.tstamp=t,this.cl.update(t),this.inTr()){var e=(t-ti.startTime)/ti.duration;ti.prevLevelScale=h(1,5,1,5,e),ti.prevLevelAlpha=h(1,0,0,1,e),ti.nextLevelAlpha=h(0,1,0,1,e),this.nextAlpha=ti.nextLevelAlpha,e>=1&&(ti.running=!1,si=null)}},e.prototype.draw=function(t){var e=this;if(Ve&&this.c){this.c.updateShake(t),this.inTr()&&(Ve.globalAlpha=ti.nextLevelAlpha),Ve.fillStyle=this.cl.bgColor,Ve.fillRect(0,0,this.canvas.width,this.canvas.height);var i=this.c.offset;if(this.cl.dables.forEach(function(s){s.forEach(function(s){if(s&&s.visible){var a=s.pos.x*e.ss+i.x,n=s.pos.y*e.ss+i.y;a+s.dSize.w<0||a>e.canvas.width||n+s.dSize.h<0||n>e.canvas.height||(Ve.translate(a+.5|0,n+.5|0),Ve.globalAlpha=e.inTr()?ti.nextLevelAlpha:1,s.draw(Ve,t),Ve.setTransform(1,0,0,1,0,0))}})}),Ve.globalAlpha=1,si){Ve.globalAlpha=ti.prevLevelAlpha;var s=ti.prevLevelScale,a=(this.canvas.width*s-this.canvas.width)/2,n=(this.canvas.height*s-this.canvas.height)/2;Ve.drawImage(si,-a,-n,this.canvas.width*s,this.canvas.height*s),Ve.globalAlpha=1}this.inTr()&&(Ve.globalAlpha=ti.nextLevelAlpha),this.cl.odables.forEach(function(e){e.visible&&e.draw(Ve,t)}),Ve.globalAlpha=1}},e.prototype.resize=function(){var t=window.innerWidth/window.innerHeight;t>=1?Ge=(Ne=Ze)/t:Ne=(Ge=Ze)*t,this.canvas.width=Ne,this.canvas.height=Ge,this.c.size={w:this.canvas.width,h:this.canvas.height},this.sf=window.innerWidth/this.canvas.width,this.cl&&this.cl.resize()},e.prototype.pa=function(t,e){void 0===e&&(e=1);var i={a:[["- e"],[]],bad:[["C2 e","C1 q"],["A3 e","A2 q"]],good:[["C2 e","- s","C2 e","C3 q"],["A3 e","- s","A3 e","A4 q"]],walk:[["C1 s"],["- e"]]};[r(new Array(e).fill(i[t][0])),r(new Array(e).fill(i[t][1]))].map(function(t){return new Je.default.Sequence($e,120,t)}).forEach(function(t){t.gain.gain.value=.01,t.loop=!1,t.play()})},e.prototype.qLevel=function(t,e){ii=t,e&&(ii.state=e),ti.startTime=this.tstamp,ti.running=!0,(si=new Image).src=this.canvas.toDataURL("png"),this.switchLevel(ii)},e.prototype.handleInput=function(t){this.cl.handleInput(t.key)},e.prototype.handleTouch=function(t){this.cl.handleTouch(t)},e.prototype.sizeInTiles=function(){return{w:Math.ceil(this.canvas.width/this.ss/t.TS),h:Math.ceil(this.canvas.height/this.ss/t.TS)}},e.prototype.switchLevel=function(t){this.cl=t,this.cl.levelWillStart(),this.cl.configViz(),this.cl.levelStarted()},e}();Fe.default=ai;var ni={};Object.defineProperty(ni,"__esModule",{value:!0});var oi=function(e,i,s){var a=0,n=0;return function(o){for(a+=Math.min(o-n,10*t.MS),n=o;a>=e;)i.call(s,o),a-=e}};ni.default=oi;var hi={},ri=hi&&hi.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(hi,"__esModule",{value:!0});var li=ri(Fe),ui=ri(ni),ci=document.getElementById("game"),pi=new li.default(ci),di=ui.default(t.MS,pi.update,pi),fi=null,gi=!1,mi=!1;function vi(t){mi||(pi.pa("a",1),mi=!0),yi(t),gi=!0}function yi(t){t.preventDefault();var e=t;t.touches&&(e=t.changedTouches[0]),fi=e}function wi(){fi=null,gi=!1}requestAnimationFrame(function t(e){fi&&gi&&pi.handleTouch(fi),di(e),pi.draw(e),requestAnimationFrame(t)}),window.onresize=pi.resize.bind(pi),window.onkeydown=pi.handleInput.bind(pi),window.onmousedown=vi,window.ontouchstart=vi,window.onmouseup=wi,window.ontouchend=wi,window.addEventListener("onmousemove",yi,{passive:!1}),window.addEventListener("touchmove",yi,{passive:!1}),"object"==typeof exports&&"undefined"!=typeof module?module.exports=hi:"function"==typeof define&&define.amd&&define(function(){return hi})}();</script>