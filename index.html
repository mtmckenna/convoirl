<html> <title>js13k sandbox</title> <head> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"> </head> <body> <canvas id="game"></canvas> <style>body,html{background-color:#96c083;margin:0;padding:0}#game,body,html{height:100%;width:100%}#game{-ms-interpolation-mode:nearest-neighbor;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:optimize-contrast;image-rendering:crisp-edges;image-rendering:pixelated;z-index:2}#game-background{z-index:1}</style> <script>parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"5ywg":[function(require,module,exports) {
"use strict";var t;exports.__esModule=!0,function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(t=exports.Direction||(exports.Direction={})),exports.TILE_SIZE=8,exports.HALF_TILE_SIZE=exports.TILE_SIZE/2,exports.SQUARE_SIZE=5,exports.MS_PER_UPDATE=1/60;
},{}],"eAYL":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var n=require("./common");function t(n,t,e){r(n,t,e)&&(n.pos=t)}function r(t,r,e){var o=r.x>=0&&r.x<=e.size.width-t.size.width&&r.y>=0&&r.y<e.size.height,i=r.x,a=r.y;i/=n.TILE_SIZE,a/=n.TILE_SIZE;var u=e.tilesGrid[a][i].walkable;return o&&u}function e(n,t){if(n.running)return!1;var r=t-n.startTime>n.minTimeDelta,e=n.percentChance>Math.random();return r&&e}function o(n,t,r){return(1-r)*n+r*t}function i(n,t,r){return Math.max(Math.min(n,r),t)}function a(n,t,r,e,a){return i(o(n,t,a),r,e)}function u(){return 2*Math.round(Math.random())-1}function s(n){return[].concat.apply([],n)}function c(n){return n[Math.floor(Math.random()*n.length)]}exports.moveThingToPositionIfPossible=t,exports.canThingMoveToPosition=r,exports.shouldDoAnimation=e,exports.lerp=o,exports.clerp=a,exports.oneOrMinusOne=u,exports.flatten=s,exports.randomElementFromArray=c;
},{"./common":"5ywg"}],"LnVe":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var s=require("./common"),i=require("./helpers"),t=.9,e=20,h=.01,a=function(){function a(s,i){this.pos={x:0,y:0},this.size={width:0,height:0},this.game=s,this.player=i,this.size={width:s.canvas.width,height:s.canvas.height},this.shake={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(a.prototype,"offset",{get:function(){return{x:this.shake.pos.x+this.pos.x,y:this.shake.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),a.prototype.move=function(){this.pos.x=this.game.canvas.width/2-this.player.pos.x*s.SQUARE_SIZE-this.player.drawingSize.width/2,this.pos.y=this.game.canvas.height/2-this.player.pos.y*s.SQUARE_SIZE-this.player.drawingSize.height/2;var i=-1*(this.game.currentLevel.drawingSize.width-this.size.width),t=-1*(this.game.currentLevel.drawingSize.height-this.size.height);this.pos.x>0&&(this.pos.x=0),this.pos.x<i&&(this.pos.x=i),this.pos.y>0&&(this.pos.y=0),this.pos.y<t&&(this.pos.y=t)},a.prototype.shakeScreen=function(){this.shake.pos={x:0,y:0},this.shake.amplitude=e,this.shake.dir.x=i.oneOrMinusOne(),this.shake.dir.y=i.oneOrMinusOne()},a.prototype.updateScreenShake=function(s){this.shake.amplitude*=t;var i=this.shake,e=i.amplitude,a=i.dir;Math.abs(e)<=h?(this.shake.pos.x=0,this.shake.pos.y=0):(this.shake.pos.x=Math.sin(s/50)*e*a.x,this.shake.pos.y=Math.sin(s/50)*e*a.y)},a}();exports.default=a;
},{"./common":"5ywg","./helpers":"eAYL"}],"uUjA":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var t=require("../common"),e=require("../helpers"),i=function(){function i(e,i){this.drawingSize={width:t.TILE_SIZE*t.SQUARE_SIZE,height:t.TILE_SIZE*t.SQUARE_SIZE},this.pos={x:0,y:0},this.size={width:t.TILE_SIZE,height:t.TILE_SIZE},this.walkable=!0,this.visible=!0,this.pos={x:e*t.TILE_SIZE,y:i*t.TILE_SIZE},this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.drawingSize.width,this.offscreenCanvas.height=this.drawingSize.height,this.offscreenContext=this.offscreenCanvas.getContext("2d")}return i.prototype.draw=function(t){t.drawImage(this.offscreenCanvas,0,0)},i.prototype.drawOnOffscreenContext=function(){var i=this;e.flatten(this.colorMatrix).map(function(t){return i.colorMap[t]}).forEach(function(e,n){i.offscreenContext.fillStyle=e;var s=t.SQUARE_SIZE*(n%t.TILE_SIZE),o=t.SQUARE_SIZE*Math.floor(n/t.TILE_SIZE);i.offscreenContext.fillRect(s,o,t.SQUARE_SIZE,t.SQUARE_SIZE)})},i}();exports.default=i;
},{"../common":"5ywg","../helpers":"eAYL"}],"A1jt":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var r=e(require("./tile")),o=function(e){function r(t,r){var o=e.call(this,t,r)||this;return o.colorMap=["#96c083","#5fa367","#eeeec7","#dec26d"],o.colorMatrix=[[0,0,0,0,0,0,0,0],[0,0,3,0,0,0,1,0],[0,3,2,3,0,0,0,0],[0,0,3,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,0]],o.drawOnOffscreenContext(),o}return t(r,e),r}(r.default);exports.default=o;
},{"./tile":"uUjA"}],"Y022":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var e=r(require("./tile")),o=function(r){function e(t,e){var o=r.call(this,t,e)||this;return o.colorMap=["#96c083","#5fa367"],o.colorMatrix=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,0]],o.drawOnOffscreenContext(),o}return t(e,r),e}(e.default);exports.default=o;
},{"./tile":"uUjA"}],"978g":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var e=r(require("./tile")),o=function(r){function e(t,e){var o=r.call(this,t,e)||this;return o.colorMap=["#96c083","#ff00ff"],o.colorMatrix=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],o.drawOnOffscreenContext(),o}return t(e,r),e}(e.default);exports.default=o;
},{"./tile":"uUjA"}],"liEn":[function(require,module,exports) {
"use strict";var t=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var r=e(require("./tile")),o=function(e){function r(t,r){var o=e.call(this,t,r)||this;return o.walkable=!1,o.colorMap=["#96c083","#6e4c49","#3e625e"],o.colorMatrix=[[0,0,0,0,0,0,0,0],[0,0,2,2,2,2,0,0],[0,2,2,2,2,2,2,0],[0,2,2,2,2,2,2,0],[0,0,2,2,2,2,0,0],[0,0,0,1,1,0,0,0],[0,0,0,1,1,0,0,0],[0,0,1,1,1,1,0,0]],o.drawOnOffscreenContext(),o}return t(r,e),r}(r.default);exports.default=o;
},{"./tile":"uUjA"}],"4p+D":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var t=require("./common"),i=require("./helpers"),r=e(require("./tiles/flowers")),s=e(require("./tiles/grass")),l=e(require("./tiles/green")),n=e(require("./tiles/tree")),u=function(){return function(){var e=this;this.tileTypeMap=[l.default,r.default,s.default,n.default],this.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,3],[3,0,0,0,1,0,0,0,0,2,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,1,0,0,0,0,0,0,0,2,0,0,0,2,0,3],[3,0,0,0,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,3],[3,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,3],[3,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,3],[3,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]];var u=this.tileIndexes[0].length*t.TILE_SIZE,h=this.tileIndexes.length*t.TILE_SIZE;this.size={width:u,height:h},this.drawingSize={width:u*t.SQUARE_SIZE,height:h*t.SQUARE_SIZE},this.tilesGrid=this.tileIndexes.map(function(t,i){return t.map(function(t,r){return new e.tileTypeMap[t](r,i)})}),this.tiles=i.flatten(this.tilesGrid)}}();exports.default=u;
},{"./common":"5ywg","./helpers":"eAYL","./tiles/flowers":"A1jt","./tiles/grass":"Y022","./tiles/green":"978g","./tiles/tree":"liEn"}],"VVJ9":[function(require,module,exports) {
"use strict";exports.__esModule=!0,exports.default={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]," ":[[,],[,],[,],[,],[,]]};
},{}],"27c9":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var i=require("./common"),e=t(require("./letters")),s=5,r=function(){function t(t,r,h){void 0===r&&(r="#ffffff"),void 0===h&&(h={x:0,y:0}),this.words="",this.visible=!0,this.words=t.toUpperCase(),this.color=r,this.pos=h,this.pixelLetters=this.words.split("").map(function(t){return e.default[t]}),this.size={width:s*this.pixelLetters.length,height:s},this.drawingSize={width:this.size.width*i.SQUARE_SIZE,height:this.size.height*i.SQUARE_SIZE}}return t.prototype.draw=function(t,e){var s=this;t.fillStyle=this.color;var r=this.pos.x;this.pixelLetters.forEach(function(e){for(var h=s.pos.y,o=0,l=0;l<e.length;l++){for(var f=e[l],n=0;n<f.length;n++)f[n]&&t.fillRect(r+n*i.SQUARE_SIZE,h,i.SQUARE_SIZE,i.SQUARE_SIZE);o=Math.max(o,f.length*i.SQUARE_SIZE),h=i.SQUARE_SIZE*(l+1)+s.pos.y}r+=i.SQUARE_SIZE+o})},t}();exports.default=r;
},{"./common":"5ywg","./letters":"VVJ9"}],"dgAm":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};exports.__esModule=!0;var e=require("./common"),a=t(require("./level")),r=t(require("./text")),s=function(){function t(t){var s;this.timestamp=0,this.tileSize=e.TILE_SIZE,this.drawables=[],this.overlayDrawables=[],this.canvas=t,this.context=t.getContext("2d"),this.levels=[new a.default],this.currentLevel=this.levels[0];var i=new r.default("HELLO","#000000",{x:5,y:5});(s=this.drawables).push.apply(s,this.currentLevel.tiles),this.overlayDrawables.push(i)}return t.prototype.draw=function(t){this.context&&this.camera&&(this.camera.updateScreenShake(t),this.clearCanvasContext(),this.drawDrawables(t),this.drawOverlayDrawables(t))},t.prototype.drawDrawables=function(t){var a=this,r=this.camera.offset;this.drawables.forEach(function(s){if(s.visible){var i=s.pos.x*e.SQUARE_SIZE+r.x,n=s.pos.y*e.SQUARE_SIZE+r.y;a.isOffScreen(i,n,s.drawingSize)||(a.context.translate(i+.5|0,n+.5|0),s.draw(a.context,t),a.context.setTransform(1,0,0,1,0,0))}})},t.prototype.isOffScreen=function(t,e,a){return t+a.width<0||t>this.canvas.width||e+a.height<0||e>this.canvas.height},t.prototype.drawOverlayDrawables=function(t){var e=this;this.overlayDrawables.forEach(function(a){a.draw(e.context,t)})},t.prototype.clearCanvasContext=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},t}();exports.default=s;
},{"./common":"5ywg","./level":"4p+D","./text":"27c9"}],"Qu5t":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var r=require("./common"),e=10*r.MS_PER_UPDATE;function t(r,t,o){var n=0,u=0;return function(a){for(n+=Math.min(a-u,e),u=a;n>=r;)t.call(o,a),n-=r}}exports.default=t;
},{"./common":"5ywg"}],"UQVz":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var i=require("./common"),t=require("./helpers"),e=750,h=1,s=3,r=.3,o=function(){function o(){this.size={width:1,height:1},this.pos={x:0,y:0},this.color="#ffffff",this.visible=!1,this.percentGrown=0,this.drawingSize={width:this.size.width*i.SQUARE_SIZE,height:this.size.height*i.SQUARE_SIZE}}return o.prototype.reJuice=function(i,t,e){this.pos.x=t,this.pos.y=e,this.percentGrown=0,this.startTime=i,this.visible=!0},o.prototype.update=function(i){this.visible&&(this.percentGrown=(i-this.startTime)/e,this.visible=!(this.percentGrown>=1))},o.prototype.draw=function(i,e){var o=t.clerp(h,s,h,s,this.percentGrown),n=t.clerp(r,0,0,r,this.percentGrown);i.globalAlpha=n,i.fillStyle=this.color,i.fillRect(-this.drawingSize.width*o/2,-this.drawingSize.height*o/2,this.drawingSize.width*o,this.drawingSize.height*o),i.globalAlpha=1},o}();exports.default=o;
},{"./common":"5ywg","./helpers":"eAYL"}],"oinf":[function(require,module,exports) {
"use strict";exports.__esModule=!0;var e={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0};exports.blinking=e;var n={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0};exports.lookAway=n;var t={duration:200,endPos:{x:0,y:0},running:!1,startTime:0};exports.walking=t;
},{}],"2rXh":[function(require,module,exports) {
"use strict";var i=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};exports.__esModule=!0;var t=i(require("./dust")),n=require("./helpers"),s=require("./common"),e=require("./animations"),a=2*s.SQUARE_SIZE,o=1*s.SQUARE_SIZE,r="rgb(255, 255, 255)",h="rgb(0, 0, 0)",l=4*s.SQUARE_SIZE,g=1*s.SQUARE_SIZE,u=100,m=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],f=function(){function i(i){var a;this.drawingSize={width:s.TILE_SIZE*s.SQUARE_SIZE,height:s.TILE_SIZE*s.SQUARE_SIZE},this.pos={x:48,y:48},this.size={width:s.TILE_SIZE,height:s.TILE_SIZE},this.visible=!0,this.animations={},this.rot=0,this.game=i,this.animations.blinking=Object.assign({},e.blinking),this.animations.walking=Object.assign({},e.walking,{endPos:this.pos}),this.animations.lookAway=Object.assign({},e.lookAway),this.color=n.randomElementFromArray(m),this.dusts=Array.from(Array(u).keys()).map(function(){return new t.default}),(a=this.game.drawables).push.apply(a,this.dusts)}return Object.defineProperty(i.prototype,"blinking",{get:function(){return this.animations.blinking.running},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"walking",{get:function(){return this.animations.walking.running},enumerable:!0,configurable:!0}),i.prototype.walk=function(i){if(!(this.game.timestamp<this.animations.walking.startTime+this.animations.walking.duration)){var t=this.animations.walking.endPos,e=t.x,a=t.y;i===s.Direction.Left?(this.rot=-Math.PI/2,e-=this.game.tileSize):i===s.Direction.Right?(this.rot=Math.PI/2,e+=this.game.tileSize):i===s.Direction.Down?(this.rot=Math.PI,a+=this.game.tileSize):i===s.Direction.Up&&(this.rot=0,a-=this.game.tileSize);var o={x:e,y:a};n.canThingMoveToPosition(this,o,this.game.currentLevel)&&this.configureWalkingAnimation(o)}},i.prototype.configureWalkingAnimation=function(i){this.animations.walking.startTime=this.game.timestamp,this.animations.walking.endPos=i,this.animations.walking.running=!0},i.prototype.updateWalkingPosition=function(i){if(this.walking){var t=(i-this.animations.walking.startTime)/this.animations.walking.duration;this.pos.x=n.lerp(this.pos.x,this.animations.walking.endPos.x,t),this.pos.y=n.lerp(this.pos.y,this.animations.walking.endPos.y,t),t>=1&&(this.pos.x=this.animations.walking.endPos.x,this.pos.y=this.animations.walking.endPos.y,this.animations.walking.running=!1)}},i.prototype.update=function(i){this.dusts.forEach(function(t){return t.update(i)})},i.prototype.draw=function(i,t){if(this.updateWalkingPosition(t),i.translate(this.drawingSize.width/2,this.drawingSize.height/2),i.rotate(this.rot),i.translate(-this.drawingSize.width/2,-this.drawingSize.height/2),i.fillStyle=this.color,i.fillRect(0,0,this.drawingSize.width,this.drawingSize.height),this.blink(t),c(this,i,"left",this.animations.blinking.openness,this.animations.lookAway.offset),c(this,i,"right",this.animations.blinking.openness,this.animations.lookAway.offset),this.walking){var n=this.dusts.find(function(i){return!i.visible});if(n){var s=this.size.width/2*Math.random()+this.size.width/4,e=this.size.height/2*Math.random()+this.size.height/4,a=this.pos.x+s,o=this.pos.y+e;n.reJuice(t,a,o)}}i.setTransform(1,0,0,1,0,0)},i.prototype.blink=function(i){var t=this.animations,s=t.blinking,e=t.lookAway;n.shouldDoAnimation(s,i)&&(s.running=!0,s.startTime=i),n.shouldDoAnimation(e,i)&&(e.running=!0,e.startTime=i),d(s,i),p(e,i)},i}();function d(i,t){var s=(t-i.startTime)/i.duration;if(i.running)if(s>=.5){var e=(s-.5)/.5;i.openness=n.clerp(0,1,0,1,e)}else{e=s/.5;i.openness=n.clerp(1,0,0,1,e)}s>=1&&(i.running=!1)}function p(i,t){i.running&&(i.offset=0===i.offset?s.SQUARE_SIZE:0,i.running=!1)}function c(i,t,n,s,e){var u="left"===n?0:l;t.fillStyle=h,t.fillRect(g+u,g,a,a*s),t.fillStyle=r,t.fillRect(g+u+e,g,o,o*s)}exports.default=f;
},{"./dust":"UQVz","./helpers":"eAYL","./common":"5ywg","./animations":"oinf"}],"9B6d":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};exports.__esModule=!0;var n=e(require("./camera")),t=e(require("./game")),i=e(require("./game-loop")),r=e(require("./player")),o=require("./common"),u=i.default(o.MS_PER_UPDATE,p,this),d=document.getElementById("game"),a=new t.default(d),w=new r.default(a),s=new n.default(a,w),c=128*o.SQUARE_SIZE,h=c,f=c,l=null,m=!1;a.camera=s,a.player=w,a.drawables.push(w);var v={ArrowDown:function(e){return e.walk(o.Direction.Down)},ArrowLeft:function(e){return e.walk(o.Direction.Left)},ArrowRight:function(e){return e.walk(o.Direction.Right)},ArrowUp:function(e){return e.walk(o.Direction.Up)},s:s.shakeScreen.bind(s)};function E(){var e=window.innerWidth/window.innerHeight;e>=1?f=(h=c)/e:h=(f=c)*e,d.width=h,d.height=f,s.size={width:d.width,height:d.height}}function p(e){s.move(),w.update(e)}function A(e){a.timestamp=e,l&&m&&S(l),u(e),a.draw(e),requestAnimationFrame(A)}function L(e){_(e),m=!0}function _(e){var n=e;e.touches&&(n=e.changedTouches[0]),l=n}function g(){l=null,m=!1}function S(e){var n=s.offset,t=e.clientX*h/window.innerWidth-n.x,i=e.clientY*f/window.innerHeight-n.y,r=t-w.pos.x*o.SQUARE_SIZE,u=i-w.pos.y*o.SQUARE_SIZE,d=Math.abs(r),a=Math.abs(u),c=o.SQUARE_SIZE*o.HALF_TILE_SIZE;d<c&&a<c||(d>a?r>0?v.ArrowRight(w):v.ArrowLeft(w):u>0?v.ArrowDown(w):v.ArrowUp(w))}E(),requestAnimationFrame(A),window.addEventListener("resize",function(){return E()}),window.addEventListener("keydown",function(e){var n=e.key;v[n]&&v[n](w)}),window.addEventListener("mousedown",L,!1),window.addEventListener("touchstart",L,!1),window.addEventListener("mouseup",g,!1),window.addEventListener("touchend",g,!1),window.addEventListener("mousemove",_,!1),window.addEventListener("touchmove",_,!1),document.body.addEventListener("touchmove",function(e){return e.preventDefault()},{passive:!1});
},{"./camera":"LnVe","./game":"dgAm","./game-loop":"Qu5t","./player":"2rXh","./common":"5ywg"}]},{},["9B6d"], null)</script> </body> </html>