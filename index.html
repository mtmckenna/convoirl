<html> <title>Convo IRL</title> <head> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"> </head> <body> <canvas id="game"></canvas> <style>body,html{margin:0;padding:0}#game,body,html{height:100%;width:100%}#game{-ms-interpolation-mode:nearest-neighbor;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:optimize-contrast;image-rendering:crisp-edges;image-rendering:pixelated;z-index:2}</style> <script>parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {var Uc,Za,Wc,Vc,b={};Object.defineProperty(b,"__esModule",{value:!0}),function($){$[$.Up=0]="Up",$[$.Down=1]="Down",$[$.Left=2]="Left",$[$.Right=3]="Right"}(Wc=b.Direction||(Uc={},b.Direction=Uc)),function($){$[$.Buddy=0]="Buddy",$[$.Tile=1]="Tile"}(Vc=b.InteractableType||(Za={},b.InteractableType=Za));var Tc=8;b.TILE_SIZE=Tc;var Rc=b.TILE_SIZE/2;b.HALF_TILE_SIZE=Rc;var Qc=5;b.SQUARE_SIZE=Qc;var Oc=1/60;b.MS_PER_UPDATE=Oc;var Lc=16;b.NUM_TILES_ON_LONG_SIDE=Lc;var Kc=750;b.BLINK_DURATION=Kc;var Jc=8;b.LINE_HEIGHT=Jc;var Ic=.5;b.DISABLED_ALPHA=Ic;var Cc=120;b.THROTTLE_TIME=Cc;var d={};Object.defineProperty(d,"__esModule",{value:!0});function Bc(r,e,$){var o=e.x>=0&&e.x<=$.size.width-r.size.width&&e.y>=0&&e.y<$.size.height,n=e.x,t=e.y;n/=b.TILE_SIZE,t/=b.TILE_SIZE;var a=$.tilesGrid[t][n].walkable;return o&&a}var X=Bc;function xc(r,e){if(r.running)return!1;var $=e-r.startTime>r.minTimeDelta,o=r.percentChance>Math.random();return $&&o}d.canThingMoveToPosition=X;var L=xc;function aa(r,e,$){return(1-$)*r+$*e}d.shouldDoAnimation=L;var D=aa;function uc(r,e,$){return Math.max(Math.min(r,$),e)}function Q(r,e,$,o,n){return uc(aa(r,e,n),$,o)}d.lerp=D;var s=Q;function oc(){return 2*Math.round(Math.random())-1}d.clerp=s;var G=oc;function nc(r){return[].concat.apply([],r)}d.oneOrMinusOne=G;var K=nc;function ec(r){return r[Math.floor(Math.random()*r.length)]}d.flatten=K;var ga=ec;function cc(r){return Math.floor(Math.random()*r.length)}d.randomElementFromArray=ga;var N=cc;function bc(r,e,$,o){void 0===o&&(o=!1);var n=$,t=e;return o&&(n=e,t=$),r>=.5?Q(n,t,e,$,(r-.5)/.5):Q(t,n,e,$,r/.5)}d.randomIndexFromArray=N;var qa=bc;function ac(r){return new Array(b.TILE_SIZE).fill(null).map(function(){return new Array(b.TILE_SIZE).fill(r)})}d.twoPhaseClerp=qa;var A=ac;function Zb(r,e){var $;return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var t=arguments;$||(r.apply(this,t),$=setTimeout(function(){return $=null},e))}}d.singleColorTileArray=A;var ca=Zb;d.throttle=ca;var V={};Object.defineProperty(V,"__esModule",{value:!0});var Vb=.9,Ub=10,Sb=.01,Qb=function(){function e(e){this.pos={x:0,y:0},this.size={width:0,height:0},this.game=e,this.player=e.player,this.size={width:e.canvas.width,height:e.canvas.height},this.shake={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:this.shake.pos.x+this.pos.x,y:this.shake.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=this.game.canvas.width/2-e.pos.x*this.game.squareSize-e.drawingSize.width/2,this.pos.y=this.game.canvas.height/2-e.pos.y*this.game.squareSize-e.drawingSize.height/2;var s=-1*(this.game.currentLevel.drawingSize.width-this.size.width),t=-1*(this.game.currentLevel.drawingSize.height-this.size.height);this.pos.x>0&&(this.pos.x=0),this.pos.x<s&&(this.pos.x=s),this.pos.y>0&&(this.pos.y=0),this.pos.y<t&&(this.pos.y=t)},e.prototype.shakeScreen=function(){this.shake.pos={x:0,y:0},this.shake.amplitude=Ub*this.game.squareSize,this.shake.dir.x=G(),this.shake.dir.y=G()},e.prototype.updateScreenShake=function(e){this.shake.amplitude*=Vb;var s=this.shake,t=s.amplitude,i=s.dir;Math.abs(t)<=Sb?(this.shake.pos.x=0,this.shake.pos.y=0):(this.shake.pos.x=Math.sin(e/50)*t*i.x,this.shake.pos.y=Math.sin(e/50)*t*i.y)},e}(),Ib=Qb;V.default=Ib;var r={};Object.defineProperty(r,"__esModule",{value:!0});var Gb={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},ra=Gb;r.blinking=ra;var Db={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},ua=Db;r.lookAway=ua;var Ab={duration:400,endPos:{x:0,y:0},running:!1,startTime:0},xa=Ab;r.walking=xa;var xb={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},$=xb;r.animateEnergy=$;var wb={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},J=wb;r.transition=J;var e={};Object.defineProperty(e,"__esModule",{value:!0});var rb=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff"];e.default=rb;var u={},pb=u&&u.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(u,"__esModule",{value:!0});var kb=pb(e),ib=1400,ha=1,ia=3,ja=.3,hb=function(){function t(t){this.size={width:1,height:1},this.pos={x:0,y:0},this.color=kb.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize}}return t.prototype.reJuice=function(t,e,r){this.pos.x=e,this.pos.y=r,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/ib,this.visible=!(this.percentGrown>=1),this.alpha=s(ja,0,0,ja,this.percentGrown))},t.prototype.draw=function(t,e){var r=s(ha,ia,ha,ia,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.drawingSize.width*r/2,-this.drawingSize.height*r/2,this.drawingSize.width*r,this.drawingSize.height*r)},t}(),eb=hb;u.default=eb;var o={},bb=o&&o.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});var ab=bb(u),_a=2,Wa=1,Ua="rgb(255, 255, 255)",Oa="rgb(0, 0, 0)",Na=4,Ka=1,Ia=4,Ha=6,Fa=50,Ea=30,Ba=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],za="left",Lb="right",Ca=function(){function t(t){var i=this;this.drawingSize={width:b.TILE_SIZE,height:b.TILE_SIZE},this.pos={x:b.TILE_SIZE,y:b.TILE_SIZE},this.size={width:b.TILE_SIZE,height:b.TILE_SIZE},this.visible=!0,this.skills=["weather","sports","pastries","france","cats"],this.tileIndex={x:0,y:0},this.interactableType=b.InteractableType.Buddy,this.energy=1,this.animations={},this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.squareSize=b.SQUARE_SIZE,this.game=t,this.animations.blinking=Object.assign({},ra),this.animations.walking=Object.assign({},xa,{endPos:this.pos}),this.animations.lookAway=Object.assign({},ua),this.color=ga(Ba),this.dusts=Array.from(Array(Fa).keys()).map(function(){return new ab.default(i.game)}),this.drawingSize.width=b.TILE_SIZE*this.game.squareSize,this.drawingSize.height=b.TILE_SIZE*this.game.squareSize,this.squareSize=this.game.squareSize}return Object.defineProperty(t.prototype,"blinking",{get:function(){return this.animations.blinking.running},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"walking",{get:function(){return this.animations.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i},t.prototype.setConvoMode=function(t){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.squareSize,this.size.width=b.TILE_SIZE,this.size.height=b.TILE_SIZE,this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize,t&&(this.squareSize*=2,this.size.width*=2,this.size.height*=2,this.drawingSize.width*=2,this.drawingSize.height*=2)},t.prototype.convoLook=function(t){t===b.Direction.Right?this.convoLookRight=!0:t===b.Direction.Left&&(this.convoLookRight=!1)},t.prototype.move=function(t,i){void 0===i&&(i=!0),this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.ceil(this.pos.x/b.TILE_SIZE),this.tileIndex.y=Math.ceil(this.pos.y/b.TILE_SIZE),i||(this.animations.walking.endPos.x=t.x,this.animations.walking.endPos.y=t.y)},t.prototype.walk=function(t){var i=this.pos,n=i.x,e=i.y;t===b.Direction.Left?(this.rot=-Math.PI/2,n-=this.game.tileSize):t===b.Direction.Right?(this.rot=Math.PI/2,n+=this.game.tileSize):t===b.Direction.Down?(this.rot=Math.PI,e+=this.game.tileSize):t===b.Direction.Up&&(this.rot=0,e-=this.game.tileSize);var a={x:n,y:e};X(this,a,this.game.currentLevel)&&this.configureWalkingAnimation(a)},t.prototype.configureWalkingAnimation=function(t){this.animations.walking.startTime=this.game.timestamp,this.animations.walking.endPos=t,this.animations.walking.running=!0},t.prototype.updateWalkingPosition=function(t){if(this.walking){var i=(t-this.animations.walking.startTime)/this.animations.walking.duration,n=D(this.pos.x,this.animations.walking.endPos.x,i),e=D(this.pos.y,this.animations.walking.endPos.y,i);i>=1&&(n=this.animations.walking.endPos.x,e=this.animations.walking.endPos.y,this.animations.walking.running=!1),this.move({x:n,y:e})}},t.prototype.draw=function(t,i){if(this.updateWalkingPosition(i),t.translate(this.drawingSize.width/2,this.drawingSize.height/2),t.rotate(this.rot),t.translate(-this.drawingSize.width/2,-this.drawingSize.height/2),t.fillStyle=this.color,t.fillRect(0,0,this.drawingSize.width,this.drawingSize.height),this.maybeDoEyeAnimations(i),this.drawEye(t,za,this.animations.blinking.openness,this.animations.lookAway.offset),this.drawEye(t,Lb,this.animations.blinking.openness,this.animations.lookAway.offset),this.walking&&i-this.lastDustAt>Ea){var n=this.dusts.find(function(t){return!t.visible});if(n){var e=this.size.width/2*Math.random()+this.size.width/4,a=this.size.height/2*Math.random()+this.size.height/4,o=this.pos.x+e,s=this.pos.y+a;n.reJuice(i,o,s),this.lastDustAt=i}}t.setTransform(1,0,0,1,0,0)},t.prototype.maybeDoEyeAnimations=function(t){var i=this.animations,n=i.blinking,e=i.lookAway;L(n,t)&&(n.running=!0,n.startTime=t),L(e,t)&&(e.running=!0,e.startTime=t),this.runBlinkingAnimation(n,t),this.runLookAwayAnimation(e)},t.prototype.runLookAwayAnimation=function(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)},t.prototype.runBlinkingAnimation=function(t,i){var n=(i-t.startTime)/t.duration;t.openness=qa(n,0,1,!0),n>=1&&(t.running=!1)},t.prototype.drawEye=function(t,i,n,e){var a=i===za?0:Na*this.squareSize;t.fillStyle=Oa;var o=Ka,s=0;this.inConvoMode&&(o=Ia),this.inConvoMode&&this.convoLookRight&&(s=Ha*this.squareSize);var r=o*this.squareSize,$=_a*this.squareSize,h=Wa*this.squareSize;t.fillRect(r+a-s,r,$,$*n),t.fillStyle=Ua,t.fillRect(r+a+e*this.squareSize-s,r,h,h*n)},t}(),Da=Ca;o.default=Da;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});var a=null,Ga={door:{canvas:null,colorMatrix:A(0),interactable:!0},flowers:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},grass:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},green:{canvas:null,colorMatrix:A(2)},house:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],tileLength:3*b.TILE_SIZE},sky:{canvas:null,colorMatrix:A(9)},tree:{canvas:null,colorMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],walkable:!1},unwalkable:{canvas:null,visible:!1,walkable:!1}};Z.default=Ga;var z={},va=z&&z.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(z,"__esModule",{value:!0});var Ja=va(e),f=va(Z),La=function(){function e(e,t,a,i){this.drawingSize={width:b.TILE_SIZE,height:b.TILE_SIZE},this.pos={x:0,y:0},this.alpha=1,this.size={width:b.TILE_SIZE,height:b.TILE_SIZE},this.walkable=!0,this.visible=!0,this.interactable=!1,this.interactableType=b.InteractableType.Tile,this.tileLength=b.TILE_SIZE,this.colorMatrix=[[]],this.game=e,this.pos={x:a*b.TILE_SIZE,y:i*b.TILE_SIZE},this.tileIndex={x:a,y:i},this.name=t,this.colorMatrix=f.default[t].colorMatrix,this.walkable=f.default[t].hasOwnProperty("walkable")?f.default[t].walkable:this.walkable,this.visible=f.default[t].hasOwnProperty("visible")?f.default[t].visible:this.visible,this.interactable=f.default[t].hasOwnProperty("interactable")?f.default[t].interactable:this.interactable,this.tileLength=f.default[t].hasOwnProperty("tileLength")?f.default[t].tileLength:this.tileLength,this.drawingSize={height:this.tileLength*this.game.squareSize,width:this.tileLength*this.game.squareSize},this.cacheOffscreenContext()}return Object.defineProperty(e.prototype,"offscreenCanvas",{get:function(){return f.default[this.name].canvas},enumerable:!0,configurable:!0}),e.prototype.draw=function(e){e.drawImage(this.offscreenCanvas,0,0)},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.drawingSize.width,t.height=this.drawingSize.height;var a=t.getContext("2d");K(this.colorMatrix).map(function(e){return Ja.default[e]}).forEach(function(t,i){if(t){a.fillStyle=t;var r=e.game.squareSize*(i%e.tileLength),$=e.game.squareSize*Math.floor(i/e.tileLength);a.fillRect(r,$,e.game.squareSize,e.game.squareSize)}}),f.default[this.name].canvas=t},e}(),Ma=La;z.default=Ma;var i={},sa=i&&i.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var Pa=sa(e),Qa=sa(z),Ra=5,Sa=function(){function e(e){this.overlayDrawables=[],this.updateables=[],this.interactables=[],this.backgroundColor=Pa.default[2],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.updateables.forEach(function(t){return t.update(e)})},e.prototype.configureDrawablesAndUpdateables=function(){this.clearDrawables(),this.clearOverlayDrawables(),this.clearUpdateables(),this.clearInteractables()},e.prototype.tileAtIndex=function(e){return this.tilesGrid[e.y][e.x]},e.prototype.generateTiles=function(){var e=this,t=this.tileIndexes[0].length*b.TILE_SIZE,r=this.tileIndexes.length*b.TILE_SIZE;this.size={width:t,height:r},this.drawingSize={width:t*this.game.squareSize,height:r*this.game.squareSize},this.tilesGrid=this.tileIndexes.map(function(t,r){return t.map(function(t,a){return new Qa.default(e.game,e.tileTypeMap[t],a,r)})}),this.tiles=K(this.tilesGrid)},e.prototype.addDrawables=function(e,t){var r;(r=this.drawables[t]).push.apply(r,e)},e.prototype.addOverlayDrawables=function(e){var t;(t=this.overlayDrawables).push.apply(t,e)},e.prototype.addUpdateables=function(e){var t;(t=this.updateables).push.apply(t,e)},e.prototype.addInteractables=function(e){var t;(t=this.interactables).push.apply(t,e)},e.prototype.clearDrawables=function(){this.drawables=new Array(Ra).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOverlayDrawables=function(){this.overlayDrawables=[]},e.prototype.clearUpdateables=function(){this.updateables=[]},e.prototype.clearInteractables=function(){this.interactables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return N(t.tileTypeMap)})})},e}(),Ta=Sa;i.default=Ta;var l={},Va=l&&l.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(l,"__esModule",{value:!0});var T=Va(e),Xa=function(){function i(i,t,e,o){void 0===o&&(o=T.default[8]),this.pos={x:0,y:0},this.size={height:b.SQUARE_SIZE,width:b.SQUARE_SIZE},this.visible=!0,this.alpha=1,this.strokePos={x:0,y:0},this.game=i,this.pos=t,this.size=e,this.color=o,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize},this.move(t)}return i.prototype.move=function(i){this.pos.x=i.x,this.pos.y=i.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5},i.prototype.updateSize=function(i){this.size.height=i.height,this.size.width=i.width,this.drawingSize.height=this.size.height*this.game.squareSize,this.drawingSize.width=this.size.width*this.game.squareSize},i.prototype.draw=function(i){var t=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;i.globalAlpha=t,i.fillStyle=this.color,i.fillRect(this.pos.x,this.pos.y,this.drawingSize.width,this.drawingSize.height),i.strokeStyle=T.default[1],i.fillStyle=T.default[1],i.lineWidth=this.game.squareSize,i.strokeRect(this.strokePos.x,this.strokePos.y,this.drawingSize.width,this.drawingSize.height)},i}(),Ya=Xa;l.default=Ya;var M={};Object.defineProperty(M,"__esModule",{value:!0});var $a={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]]};M.default=$a;var h={},oa=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(h,"__esModule",{value:!0});var na=oa(e),cb=oa(M),db=na.default[0],la=2,fb=function(){function e(e,t,i,r){void 0===i&&(i=na.default[1]),void 0===r&&(r={x:0,y:0}),this.words="",this.drawingSize={width:0,height:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.game=e,this.words=t.toUpperCase(),this.color=i,this.move(r),this.pixelLetters=this.words.split("").map(function(e){return cb.default[e]}),this.updateSize(),this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize}}return e.prototype.draw=function(e){var t=this,i=this.pos.x,r=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;e.globalAlpha=r,this.pixelLetters.forEach(function(r){for(var a=t.pos.y,s=0,h=0;h<r.length;h++){for(var o=r[h],$=0;$<o.length;$++)o[$]&&(t.shadow&&(e.fillStyle=db,e.fillRect(i+$*t.game.squareSize+la,a+la,t.game.squareSize,t.game.squareSize)),e.fillStyle=t.color,e.fillRect(i+$*t.game.squareSize,a,t.game.squareSize,t.game.squareSize));s=Math.max(s,o.length*t.game.squareSize),a=t.game.squareSize*(h+1)+t.pos.y}i+=t.game.squareSize+s})},e.prototype.touched=function(){},e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y},e.prototype.resize=function(){this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize},e.prototype.updateSize=function(){var e=this.pixelLetters.map(function(e){return Math.max.apply(Math,e.map(function(e){return e.length}))}).reduce(function(e,t){return e+t},0)+this.pixelLetters.length-1;this.size={width:e,height:this.game.squareSize}},e}(),gb=fb;h.default=gb;var t={},P=t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var jb=P(l),O=P(e),lb=P(h),mb=.2,nb=function(){function e(e,t,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=1,this.lastBlinkAt=0,this.alpha=1,this.animations={},this.game=e,this.energyText=new lb.default(this.game,i,O.default[7]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.drawingSize=Object.assign({},this.energyText.drawingSize),this.drawingSize.width=(this.size.width+1)*this.game.squareSize,this.drawingSize.height=(this.size.height+1)*this.game.squareSize;var a={height:this.size.height+1,width:this.size.width+1};this.box=new jb.default(e,t,a,O.default[7]),this.animations.level=Object.assign({},$),this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){return Object.values(this.animations).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:e.x+b.SQUARE_SIZE/2+.5,y:e.y+b.SQUARE_SIZE/2+.5})},e.prototype.draw=function(e,t){this.updateLevel(t),this.box.draw(e),e.fillStyle=O.default[1],e.fillRect(this.pos.x,this.pos.y,this.drawingSize.width*this.percentFull,this.drawingSize.height),this.energyText.draw(e)},e.prototype.animateToLevel=function(e){this.animations.level.startTime=this.game.timestamp,this.animations.level.startLevel=this.percentFull,this.animations.level.endLevel=e,this.animations.level.running=!0},e.prototype.update=function(e){this.percentFull>mb?this.visible=!0:e-this.lastBlinkAt>b.BLINK_DURATION&&(this.visible=!this.visible,this.lastBlinkAt=e)},e.prototype.updateLevel=function(e){if(this.animations.level.running){var t=(e-this.animations.level.startTime)/this.animations.level.duration,i=D(this.animations.level.startLevel,this.animations.level.endLevel,t);t>=1&&(i=this.animations.level.endLevel,this.animations.level.running=!1),this.percentFull=i}},e}(),ob=nb;t.default=ob;var p={},qb=p&&p.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),q=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});var sb=q(i),tb=q(l),ub=q(o),vb=q(e),_=q(t),I=q(h),yb=6,zb=4,wa=4*b.TILE_SIZE,Bb=2,Cb=2,ta=3,Eb=function(e){function t(t){var r=e.call(this,t)||this;r.backgroundColor=vb.default[9],r.tileTypeMap=["green","flowers","sky","tree"],r.tileIndexes=[[]],r.currentSkillIndex=0,r.touchables=[],r.convoLevel=0,r.convoPerTurn=.25,r.energyBar=new _.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"ENERGY"),r.convoBar=new _.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"CONVO"),r.box=new tb.default(r.game,{x:0,y:0},{height:0,width:0}),r.upArrow=new I.default(r.game,"^"),r.downArrow=new I.default(r.game,"_");var a=ca(r.handleInput.bind(r),b.THROTTLE_TIME);return r.handleInput=a,r.upArrow.touched=function(){return r.handleInput("ArrowUp")},r.downArrow.touched=function(){return r.handleInput("ArrowDown")},r}return qb(t,e),t.prototype.handleInput=function(e){switch(e){case"ArrowUp":this.moveSkillCursor(1);break;case"ArrowDown":this.moveSkillCursor(-1);break;case"Enter":this.useSelectedSkill();break;case"q":this.game.queueNextLevel(this.game.levels.world);}},t.prototype.handleTouch=function(e){var t=this,r=this.touchables.find(function(r){var a=Object.assign({},r.drawingSize),i=Object.assign({},r.pos);return a.width*=t.game.scaleFactor,a.height*=t.game.scaleFactor,i.x*=t.game.scaleFactor,i.y*=t.game.scaleFactor,e.clientX>=i.x&&e.clientX<=i.x+a.width&&e.clientY>=i.y&&e.clientY<=i.y+a.height});r?r.touched():this.handleInput(null)},t.prototype.setBuddy=function(e){this.buddy=e,this.buddy.setConvoMode(!0),this.buddy.convoLook(b.Direction.Left)},t.prototype.levelWillStart=function(){var e,t=this;this.buddy||this.setBuddy(new ub.default(this.game)),this.clearTouchables(),this.game.player.setConvoMode(!0),this.game.player.convoLook(b.Direction.Right),this.energyBar.animateToLevel(this.game.player.energy),this.convoLevel=0,this.convoBar.animateToLevel(this.convoLevel),this.buddies=[this.game.player,this.buddy],this.skills=this.game.player.skills.map(function(e){return new I.default(t.game,e)}),this.skills.forEach(function(e){return e.touched=function(){t.skills[t.currentSkillIndex]===e&&t.handleInput("Enter")}}),(e=this.touchables).push.apply(e,[this.upArrow,this.downArrow].concat(this.skills))},t.prototype.levelStarted=function(){this.moveBuddies()},t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.updateText(),this.convoLevel>=1&&!this.convoBar.animating&&this.game.queueNextLevel(this.game.levels.world)},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.updateBoxes(),this.updateText(),this.moveSkillCursor(0),this.moveBuddies(),this.generateTileIndexes(),this.generateTiles(),this.addDrawables(this.tiles,0),this.addDrawables(this.buddies,1),this.addOverlayDrawables([this.box,this.upArrow,this.downArrow,this.energyBar,this.convoBar].concat(this.skills))},t.prototype.generateTileIndexes=function(){var e=this.game.sizeInTiles(),t=this.game.player.tileIndex.y;this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return N([0,1])})});for(var r=0;r<t;r++)this.tileIndexes[r]=this.tileIndexes[r].map(function(){return 2});var a=this.tileIndexes[t-1];a&&(this.tileIndexes[t-1]=a.map(function(){return 3}))},t.prototype.clearTouchables=function(){this.touchables=[]},t.prototype.moveSkillCursor=function(e){var t=this.currentSkillIndex+e,r=this.skills[t];this.downArrow.alpha=1,this.upArrow.alpha=1,this.skills.forEach(function(e){return e.alpha=b.DISABLED_ALPHA}),r?(r.alpha=1,this.currentSkillIndex=t):this.skills[this.currentSkillIndex].alpha=1,0===this.currentSkillIndex&&(this.downArrow.alpha=b.DISABLED_ALPHA),this.currentSkillIndex===this.skills.length-1&&(this.upArrow.alpha=b.DISABLED_ALPHA)},t.prototype.useSelectedSkill=function(){this.game.player.energy<=0||this.convoLevel>=1||(this.convoLevel+=this.convoPerTurn,this.convoBar.animateToLevel(this.convoLevel))},t.prototype.moveBuddies=function(){var e=this.buddies[1],t=this.box.pos.x/this.game.squareSize,r=this.box.pos.y/this.game.squareSize-this.game.player.size.height-zb,a=this.game.gameSizeFromDrawingSize(this.box.drawingSize),i=this.game.player.size.width+wa+e.size.width,o={x:t+(a.width-i)/2,y:r},s=Object.assign({},o);s.x+=wa+this.game.player.size.width,this.game.player.move(o,!1),e.move(s,!1)},t.prototype.updateBoxes=function(){var e=Math.floor(this.game.canvas.width/this.game.squareSize-this.game.squareSize),t=this.game.squareSize*yb,r=this.game.canvas.height-t*this.game.squareSize-2*this.game.squareSize;this.box.move({x:this.game.squareSize*Bb,y:r}),this.box.updateSize({height:t,width:e});var a=this.energyBar.drawingSize.width+this.convoBar.drawingSize.width+ta*this.game.squareSize,i=(this.game.canvas.width-a)/2;this.energyBar.move({x:Math.floor(i),y:Math.floor(this.energyBar.pos.y)});var o=this.energyBar.pos.x+this.energyBar.drawingSize.width+ta*this.game.squareSize;this.convoBar.move({x:Math.floor(o),y:Math.floor(this.convoBar.pos.y)})},t.prototype.updateText=function(){var e=this,t=Cb*this.game.squareSize,r=this.box.pos.x+this.box.drawingSize.width-this.upArrow.drawingSize.width-t,a=Math.floor(this.box.pos.y+this.box.drawingSize.height/2-this.upArrow.drawingSize.height/2),i=this.box.pos.x+t,o=a;this.upArrow.move({x:r,y:a}),this.downArrow.move({x:i,y:o}),this.skills.forEach(function(t,r){var a=e.currentSkillIndex-r,i=Math.floor(e.box.pos.x+e.box.drawingSize.width/2-t.drawingSize.width/2),o=Math.floor(e.box.pos.y+e.box.drawingSize.height/2-t.drawingSize.height/2+a*b.LINE_HEIGHT*e.game.squareSize);t.move({x:i,y:o}),t.visible=!(Math.abs(a)>1)})},t}(sb.default),Fb=Eb;p.default=Fb;var m={},Hb=m&&m.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),Y=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var Jb=Y(e),Kb=Y(h),Aa=Y(i),Mb="zzzzzz...",Nb=1200,Ob=function(e){function t(t){var r=e.call(this,t)||this;return r.tileTypeMap=["door"],r.tileIndexes=[[]],r.startedSleepAt=null,r.text=new Kb.default(r.game,Mb,Jb.default[1]),r}return Hb(t,e),t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.generateTileIndexes(),this.generateTiles(),this.moveText(),this.addDrawables(this.tiles,0),this.addOverlayDrawables([this.text])},t.prototype.handleInput=function(){},t.prototype.handleTouch=function(){},t.prototype.levelStarted=function(){this.startedSleepAt=null,this.game.player.energy=1},t.prototype.update=function(e){this.startedSleepAt||(this.startedSleepAt=e),e-this.startedSleepAt>Nb&&this.game.queueNextLevel(this.game.levels.world)},t.prototype.moveText=function(){var e=this.game.canvas.width,t=this.game.canvas.height,r=Math.floor((e-this.text.drawingSize.width)/2),a=Math.floor((t-this.text.drawingSize.height)/2);this.text.move({x:r,y:a})},t}(Aa.default),Pb=Ob;m.default=Pb;var k={},Rb=k&&k.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),F=k&&k.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(k,"__esModule",{value:!0});var Tb=F(l),fa=F(e),ea=F(h),Wb=F(i),Xb="CONVO IRL",Yb="TAP TO PLAY",U=2,$b=function(t){function e(e){var r=t.call(this,e)||this;return r.panDirection=1,r.tileTypeMap=["green","flowers","grass","tree"],r.tileIndexes=[[]],r.lastBlinkAt=0,r.title=new ea.default(r.game,Xb,fa.default[1]),r.instructions=new ea.default(r.game,Yb,fa.default[1]),r.box=new Tb.default(r.game,{x:0,y:0},{height:0,width:0}),r}return Rb(e,t),e.prototype.resize=function(){this.configureDrawablesAndUpdateables()},e.prototype.configureDrawablesAndUpdateables=function(){t.prototype.configureDrawablesAndUpdateables.call(this);var e=this.game.sizeInTiles();e.width*=2,e.height*=2,this.generateTileIndexes(e),this.generateTiles(),this.moveText(),this.addDrawables(this.tiles,0),this.addOverlayDrawables([this.box,this.title,this.instructions])},e.prototype.handleInput=function(){this.game.transitioning||this.game.queueNextLevel(this.game.levels.world)},e.prototype.handleTouch=function(){this.handleInput()},e.prototype.update=function(t){t-this.lastBlinkAt>b.BLINK_DURATION&&(this.instructions.visible=!this.instructions.visible,this.lastBlinkAt=t)},e.prototype.moveText=function(){var t=this.game.canvas.width,e=this.game.canvas.height,r=this.game.squareSize,i=Math.max(this.title.size.width,this.instructions.size.width)+2+2*U,a=this.title.size.height+this.instructions.size.height+b.LINE_HEIGHT+2*U,l=r*i,$=r*a,o=Math.floor((t-l)/2),s=Math.floor((e-$)/2);this.box.move({x:o,y:s}),this.box.updateSize({height:a,width:i});var n=Math.floor(o+(l-this.title.drawingSize.width)/2),h=Math.floor(s+U*this.game.squareSize),u=Math.floor(o+(l-this.instructions.drawingSize.width)/2),p=h+a+b.LINE_HEIGHT*this.game.squareSize;this.title.move({x:n,y:h}),this.instructions.move({x:u,y:p})},e}(Wb.default),_b=$b;k.default=_b;var R,v={};!function(t,e){"function"==typeof R&&R.amd?R(["exports"],e):"object"==typeof v&&"string"!=typeof v.nodeName?e(v):e(t.TinyMusic={})}(v,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),s=/^[0-9.]+$/,i=/\s+/,o=/(\d+)/,n={};function r(t){var e=t.split(i);this.frequency=r.getFrequency(e[0])||0,this.duration=r.getDuration(e[1])||0}function c(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),r.getFrequency=function(t){var s=t.split(o),i=n[s[0]],r=(s[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,r)},r.getDuration=function(t){return s.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,s){(s=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",s.frequency.value=e[1],t.connect(t=s)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof r?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},c.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},c.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sequence=c});var j={},dc=j&&j.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),C=j&&j.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(j,"__esModule",{value:!0});var fc=C(i),gc=C(o),hc=C(t),ic=C(v),jc=100,kc={x:4*b.TILE_SIZE,y:6*b.TILE_SIZE},lc=function(e){function t(t){var r=e.call(this,t)||this;r.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],r.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,0,0,0,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,0,0,3,3,3,3,0,1,0,0,0,0,3,3,3,3,0,0,3,3],[3,3,3,4,5,5,3,0,0,2,0,3,3,3,0,0,0,0,0,0,3,3,3,0,0,0,3,3],[3,3,3,5,5,5,3,0,1,0,0,3,3,2,0,0,0,2,0,0,0,3,0,0,0,3,3,3],[3,3,3,5,6,5,3,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3],[3,3,3,1,1,1,1,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,1,1,1,1,3,3,3,3,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,3,0,0,0,0,3,3,3,3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,2,3,0,0,2,0,0,3,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,3],[3,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3],[3,1,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3,0,0,0,0,3],[3,0,0,3,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,3,0,0,0,3],[3,0,0,3,3,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,3,0,0,2,3,3,3,3],[3,0,0,3,0,0,0,0,0,0,1,3,3,0,0,0,0,0,0,0,3,3,0,0,4,5,5,3],[3,0,0,0,0,0,0,0,3,3,3,3,0,1,0,0,0,0,0,0,3,3,0,0,5,5,5,3],[3,0,0,3,3,3,0,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,0,0,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,0,0,0,0,0,3,3,3,3,3,0,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],r.playerSpawnPosition=kc,r.inputBuffer={pressedAt:0,key:null},r.generateTiles(),r.energyBar=new hc.default(r.game,{x:0,y:t.squareSize},"ENERGY"),r.game.player.energy=.6;var a=new gc.default(t);return a.move({x:10*b.TILE_SIZE,y:10*b.TILE_SIZE}),r.buddies=[a],r}return dc(t,e),t.prototype.handleInput=function(e){this.inputBuffer={pressedAt:this.game.timestamp,key:e}},t.prototype.handleTouch=function(e){if(!this.game.player.walking){var t=this.game.camera,r=t.size,a=r.height,i=r.width,o=t.offset,n=e.clientX*i/window.innerWidth-o.x,s=e.clientY*a/window.innerHeight-o.y,$=n-this.game.player.pos.x*this.game.squareSize,y=s-this.game.player.pos.y*this.game.squareSize,l=Math.abs($),p=Math.abs(y),c=this.game.squareSize*b.HALF_TILE_SIZE;if(!(l<c&&p<c))if(l>p)this.movePlayerHorizontally($)||this.movePlayerVertically(y);else this.movePlayerVertically(y)||this.movePlayerHorizontally($)}},t.prototype.resize=function(){var e=Math.floor((this.game.canvas.width-this.energyBar.drawingSize.width)/2);this.energyBar.move({x:e,y:this.energyBar.pos.y})},t.prototype.update=function(t){e.prototype.update.call(this,t),this.processInput()},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.addDrawables(this.tiles,0),this.addDrawables(this.game.player.dusts,1),this.addDrawables([this.game.player],2),this.addDrawables(this.buddies,2),this.addOverlayDrawables([this.energyBar]),this.addInteractables(this.buddies),this.addUpdateables(this.game.player.dusts.concat([this.energyBar])),this.resize()},t.prototype.levelStarted=function(){this.energyBar.animateToLevel(this.game.player.energy),this.game.player.move(this.playerSpawnPosition,!1),this.game.player.setConvoMode(!1);var e=new AudioContext,t=new ic.default.Sequence(e,120,["G2 q","G3 q","G4 q"]);t.loop=!1,t.play()},t.prototype.processInput=function(){if(!(this.game.timestamp-this.inputBuffer.pressedAt>jc))switch(this.inputBuffer.key){case"ArrowUp":this.walk(b.Direction.Up);break;case"ArrowDown":this.walk(b.Direction.Down);break;case"ArrowRight":this.walk(b.Direction.Right);break;case"ArrowLeft":this.walk(b.Direction.Left);}},t.prototype.walk=function(e){if(!this.game.player.walking){Object.assign({},this.game.player.tileIndex);var t=Object.assign({},this.game.player.tileIndex);switch(e){case b.Direction.Up:t.y-=1;break;case b.Direction.Down:t.y+=1;break;case b.Direction.Left:t.x-=1;break;case b.Direction.Right:t.x+=1;}var r=null,a=this.interactables.find(function(e){return e.tileIndex.x===t.x&&e.tileIndex.y===t.y});if(a&&(this.currentBuddy=a,r=this.game.levels.convo),this.tileAtIndex(t).interactable&&(r=this.game.levels.sleep),r)return this.playerSpawnPosition.x=this.game.player.pos.x,this.playerSpawnPosition.y=this.game.player.pos.y,void this.game.queueNextLevel(r);this.game.player.walk(e)}},t.prototype.movePlayerVertically=function(e){return e<0&&this.canThingMoveInDirection(this.game.player,b.Direction.Up)?(this.handleInput("ArrowUp"),!0):!!(e>0&&this.canThingMoveInDirection(this.game.player,b.Direction.Down))&&(this.handleInput("ArrowDown"),!0)},t.prototype.movePlayerHorizontally=function(e){return e>0&&this.canThingMoveInDirection(this.game.player,b.Direction.Right)?(this.handleInput("ArrowRight"),!0):!!(e<0&&this.canThingMoveInDirection(this.game.player,b.Direction.Left))&&(this.handleInput("ArrowLeft"),!0)},t.prototype.canThingMoveInDirection=function(e,t){var r=Object.assign({},e.pos);switch(t){case b.Direction.Up:r.y-=this.game.tileSize;break;case b.Direction.Down:r.y+=this.game.tileSize;break;case b.Direction.Left:r.x-=this.game.tileSize;break;case b.Direction.Right:r.x+=this.game.tileSize;}return r.x=r.x-r.x%this.game.tileSize,r.y=r.y-r.y%this.game.tileSize,X(e,r,this)},t}(fc.default),mc=lc;j.default=mc;var w={},x=w&&w.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(w,"__esModule",{value:!0});var pc=x(o),qc=x(p),rc=x(m),sc=x(k),tc=x(j),da=5,vc=function(){function t(t){this.timestamp=0,this.tileSize=b.TILE_SIZE,this.squareSize=b.SQUARE_SIZE,this.scaleFactor=1,this.nextLevel=null,this.imageOfPreviousLevel=null,this.player=new pc.default(this),this.canvas=t,this.setSize(),this.context=t.getContext("2d",{alpha:!1}),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.msImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1,this.levels={convo:new qc.default(this),sleep:new rc.default(this),startScreen:new sc.default(this),world:new tc.default(this)},this.transition=Object.assign({},J),this.switchLevel(this.levels.startScreen)}return Object.defineProperty(t.prototype,"transitioning",{get:function(){return this.transition.running},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this.timestamp=t,this.currentLevel.update(t),this.transitioning&&this.updateTransition(t)},t.prototype.draw=function(t){this.context&&this.camera&&(this.camera.updateScreenShake(t),this.clearCanvasContext(),this.drawDrawables(t),this.drawOverlayDrawables(t),this.transitioning&&this.updateTransition(t))},t.prototype.resize=function(){this.setSize(),this.currentLevel.resize()},t.prototype.queueNextLevel=function(t){if(t===this.levels.convo){var e=this.levels,i=e.convo,a=e.world;i.setBuddy(a.currentBuddy.copy())}this.nextLevel=t,this.startTransition()},t.prototype.handleInput=function(t){this.currentLevel.handleInput(t)},t.prototype.handleTouch=function(t){this.currentLevel.handleTouch(t)},t.prototype.gameCoordsFromDrawingCoords=function(t){var e=Object.assign({},t);return e.x=Math.floor(e.x/this.squareSize),e.y=Math.floor(e.y/this.squareSize),e},t.prototype.gameSizeFromDrawingSize=function(t){var e=Object.assign({},t);return e.width=Math.floor(e.width/this.squareSize),e.height=Math.floor(e.height/this.squareSize),e},t.prototype.sizeInTiles=function(){return{width:Math.ceil(this.canvas.width/this.squareSize/b.TILE_SIZE),height:Math.ceil(this.canvas.height/this.squareSize/b.TILE_SIZE)}},t.prototype.startTransition=function(){this.transition.startTime=this.timestamp,this.transition.running=!0,this.imageOfPreviousLevel=new Image,this.imageOfPreviousLevel.src=this.canvas.toDataURL("png"),this.switchLevel(this.nextLevel)},t.prototype.setSize=function(){this.size={height:this.canvas.height/this.squareSize,width:this.canvas.width/this.squareSize},this.drawingSize={height:this.canvas.height,width:this.canvas.width},this.scaleFactor=window.innerWidth/this.canvas.width},t.prototype.updateTransition=function(t){var e=(t-this.transition.startTime)/this.transition.duration;this.transition.prevLevelScale=s(1,da,1,da,e),this.transition.prevLevelAlpha=s(1,0,0,1,e),this.transition.nextLevelAlpha=s(0,1,0,1,e),e>=1&&(this.transition=Object.assign({},J),this.imageOfPreviousLevel=null)},t.prototype.switchLevel=function(t){this.currentLevel=t,t.levelWillStart(),t.configureDrawablesAndUpdateables(),t.levelStarted()},t.prototype.drawDrawables=function(t){var e=this,i=this.camera.offset;if(this.currentLevel.drawables.forEach(function(a){a.forEach(function(a){if(a.visible){var r=a.pos.x*e.squareSize+i.x,s=a.pos.y*e.squareSize+i.y;e.isOffScreen(r,s,a.drawingSize)||(e.context.translate(r+.5|0,s+.5|0),e.context.globalAlpha=e.transitioning?e.transition.nextLevelAlpha:1,a.draw(e.context,t),e.context.setTransform(1,0,0,1,0,0))}})}),this.context.globalAlpha=1,this.imageOfPreviousLevel){this.context.globalAlpha=this.transition.prevLevelAlpha;var a=this.transition.prevLevelScale,r=(this.canvas.width*a-this.canvas.width)/2,s=(this.canvas.height*a-this.canvas.height)/2;this.context.drawImage(this.imageOfPreviousLevel,-r,-s,this.canvas.width*a,this.canvas.height*a),this.context.globalAlpha=1}},t.prototype.isOffScreen=function(t,e,i){return t+i.width<0||t>this.canvas.width||e+i.height<0||e>this.canvas.height},t.prototype.drawOverlayDrawables=function(t){var e=this;this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.currentLevel.overlayDrawables.forEach(function(i){i.visible&&i.draw(e.context,t)}),this.context.globalAlpha=1},t.prototype.clearCanvasContext=function(){this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.context.fillStyle=this.currentLevel.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t}(),wc=vc;w.default=wc;var H={};Object.defineProperty(H,"__esModule",{value:!0});var yc=10*b.MS_PER_UPDATE;function zc($,t,r){var u=0,e=0;return function(a){for(u+=Math.min(a-e,yc),e=a;u>=$;)t.call(r,a),u-=$}}var Ac=zc;H.default=Ac;var n={},W=n&&n.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(n,"__esModule",{value:!0});var Dc=W(V),Ec=W(w),Fc=W(H),Gc=.05,Hc=Fc.default(b.MS_PER_UPDATE,Sc,n),y=document.getElementById("game"),c=new Ec.default(y),g=new Dc.default(c),E=b.NUM_TILES_ON_LONG_SIDE*b.TILE_SIZE*b.SQUARE_SIZE,Mc=E,Nc=E,ya=null,Pc=!1;c.camera=g;var B={s:g.shakeScreen.bind(g),t:function(){return c.queueNextLevel(c.levels.world)}};function ma(){var $=window.innerWidth/window.innerHeight;$>=1?Nc=(Mc=E)/$:Mc=(Nc=E)*$,y.width=Mc,y.height=Nc,g.size={width:y.width,height:y.height},c.resize()}function Sc($){if(c.update($),c.currentLevel===c.levels.startScreen){var a=c.levels.startScreen;g.pos.x-=a.panDirection*Gc,g.pos.x<-c.canvas.width&&(a.panDirection=-1),g.pos.x>0&&(a.panDirection=1)}else g.move(c.player)}function ka($){ya&&Pc&&c.handleTouch(ya),Hc($),c.draw($),requestAnimationFrame(ka)}function pa($){S($),Pc=!0}function S($){var a=$;$.touches&&(a=$.changedTouches[0]),ya=a}function ba(){ya=null,Pc=!1}ma(),requestAnimationFrame(ka),window.addEventListener("resize",function(){return ma()}),window.addEventListener("keydown",function($){var a=$.key;B[a]?B[a]():c.handleInput(a)}),window.addEventListener("keyup",function($){var a=$.key;B[a]?B[a]():c.handleInput(a)}),window.addEventListener("mousedown",pa,!1),window.addEventListener("touchstart",pa,!1),window.addEventListener("mouseup",ba,!1),window.addEventListener("touchend",ba,!1),window.addEventListener("mousemove",S,!1),window.addEventListener("touchmove",S,!1),document.body.addEventListener("touchmove",function($){return $.preventDefault()},{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=n}else if(typeof define==="function"&&define.amd){define(function(){return n})}return{"9B6d":n};});</script> </body> </html>