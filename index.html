<!doctype html><title>Convo IRL</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><style>*{width:100%;height:100%;margin:0;padding:0;image-rendering:pixelated;image-rendering:optimizeSpeed;overflow:hidden}</style><canvas id="game"></canvas><script>(function () {var b={};Object.defineProperty(b,"__esModule",{value:!0});var nb=8;b.TS=nb;var zd=1/60;b.MS=zd;var yd=8;b.LS=yd;var xd=120;b.TT=xd;var vd=5;b.LH=vd;var td="*LISTEN*";b.LT=td;var r={};function Ea(e,$,r){return(1-r)*e+r*$}Object.defineProperty(r,"__esModule",{value:!0});var K=Ea;function Ma(e,$,r){return Math.max(Math.min(e,r),$)}r.lerp=K;var la=Ma;function pd(e,$,r,t,o){return Ma(Ea(e,$,o),r,t)}r.clamp=la;var q=pd;function od(e){return[].concat.apply([],e)}r.clerp=q;var ha=od;function ld(e){return Math.floor(Math.random()*e.length)}r.flatten=ha;var J=ld;function gd(e,$){var r=$.indexOf(e);return r>-1&&($.splice(r,1),!0)}r.randomIndex=J;var ca=gd;function fd(e,$){var r;return function(){var t=arguments;r||(e.apply(this,t),r=!0,setTimeout(function(){return r=!1},$))}}r.removeElement=ca;var _=fd;r.throttle=_;var e={};Object.defineProperty(e,"__esModule",{value:!0});var ed=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];e.default=ed;var M={},ad=M&&M.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(M,"__esModule",{value:!0});var _c=ad(e),Zc=function(){function t(t){this.size={w:1,h:1},this.pos={x:0,y:0},this.color=_c.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=q(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=q(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.dSize.w*e/2,-this.dSize.h*e/2,this.dSize.w*e,this.dSize.h*e)},t}(),Vc=Zc;M.default=Vc;var G={},Uc=G&&G.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(G,"__esModule",{value:!0});var Nc=Uc(M),Kc=2,Jc=1,Ic=4,Hc=1,Gc=4,Dc=6,Ya=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],Ac=function(){function t(t){var i=this;this.pos={x:0,y:0},this.size={h:b.TS,w:b.TS},this.visible=!0,this.skills=[],this.a={},this.tileIndex={x:0,y:0},this.energy=1,this.talking=!1,this.lastConvo=0,this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.game=t;this.a.blinking={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},this.a.lookAway={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},this.stop(),this.color=Ya[J(Ya)],this.dusts=Array.from(Array(50).keys()).map(function(){return new Nc.default(i.game)}),this.dSize={h:b.TS*this.game.ss,w:b.TS*this.game.ss},this.squareSize=this.game.ss,this.rando=100*Math.random()}return Object.defineProperty(t.prototype,"walking",{get:function(){return this.a.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i.skills=this.skills,i},t.prototype.setConvoMode=function(t,i){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.ss,this.size.w=b.TS,this.size.h=b.TS,this.dSize.w=this.size.w*this.game.ss,this.dSize.h=this.size.h*this.game.ss,t?(this.squareSize*=2,this.size.w*=2,this.size.h*=2,this.dSize.w*=2,this.dSize.h*=2,this.a.walking.tw=0):this.talking=!1,this.convoLookRight="right"===i},t.prototype.stop=function(){this.a.walking={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:-1,y:-1},startTime:0,t:0,tw:0}},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.round(this.pos.x/b.TS),this.tileIndex.y=Math.round(this.pos.y/b.TS)},t.prototype.look=function(t){this.walk(t,!0)},t.prototype.walk=function(t,i){void 0===i&&(i=!1);var a=this.pos,s=a.x,e=a.y;switch(t){case"left":this.rot=-Math.PI/2,s-=b.TS;break;case"right":this.rot=Math.PI/2,s+=b.TS;break;case"down":this.rot=Math.PI,e+=b.TS;break;case"up":this.rot=0,e-=b.TS;}if(!i&&!this.walking){var n={x:this.pos.x,y:this.pos.y},r={x:s,y:e};return!!qc.call(this,r)&&(this.configureWalkingAnimation(n,r),!0)}},t.prototype.configureWalkingAnimation=function(t,i){var a=this.a.walking;a.startTime=this.game.tstamp,a.endPos=i,a.startPos=t,a.running=!0,a.t=0},t.prototype.update=function(t){if(this.autoWalkDirection&&this.walk(this.autoWalkDirection),-1!==this.a.walking.startPos.x){var i=(t-this.a.walking.startTime)/this.a.walking.duration,a=K(this.a.walking.startPos.x,this.a.walking.endPos.x,i),s=K(this.a.walking.startPos.y,this.a.walking.endPos.y,i);this.a.walking.t=i,i>=1?(a=this.a.walking.endPos.x,s=this.a.walking.endPos.y,this.a.walking.running=!1,this.a.walking.t=0,this.a.walking.tw=Math.max(this.a.walking.tw-100*b.MS,0)):this.a.walking.tw=Math.min(this.a.walking.tw+100*b.MS,this.a.walking.duration),this.move({x:a,y:s})}},t.prototype.draw=function(t,i){t.translate(this.dSize.w/2,this.dSize.h/2),t.rotate(this.rot),t.translate(-this.dSize.w/2,-this.dSize.h/2),t.fillStyle=this.color,t.fillRect(0,0,this.dSize.w,this.dSize.h);var a=this.a.walking.tw/this.a.walking.duration,s=t.createLinearGradient(0,this.dSize.h,0,1.5*this.dSize.h);if(s.addColorStop(0,this.color),s.addColorStop(a,"rgba(150, 192, 131, 0)"),t.fillStyle=s,t.fillRect(0,0,this.dSize.w,1.5*this.dSize.h),wc.call(this,i),fb.call(this,t,"left",this.a.blinking.openness,this.a.lookAway.offset),fb.call(this,t,"right",this.a.blinking.openness,this.a.lookAway.offset),this.talking){t.fillStyle="#000";var e=Math.sin(i/80+this.rando)+1;t.fillRect((this.convoLookRight?1:5)*this.squareSize,this.squareSize+e/4,2*this.squareSize+e,2*this.squareSize*e/2)}if(this.walking&&i-this.lastDustAt>30){var n=this.dusts.find(function(t){return!t.visible});if(n){var r=this.size.w/2*Math.random()+this.size.w/4,o=this.size.h/2*Math.random()+this.size.h/4,$=this.pos.x+r,h=this.pos.y+o;n.reJuice(i,$,h),this.lastDustAt=i}}},t}(),zc=Ac;function wc(t){var i=this.a,a=i.blinking,s=i.lookAway;wa(a,t)&&(a.running=!0,a.startTime=t),wa(s,t)&&(s.running=!0,s.startTime=t),uc.call(this,a,t),vc.call(this,s)}function vc(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)}function uc(t,i){var a=(i-t.startTime)/t.duration;t.openness=pc(a,0,1,!0),a>=1&&(t.running=!1)}function fb(t,i,a,s){var e="left"===i?0:Ic*this.squareSize;t.fillStyle="#000";var n=Hc,r=0;this.inConvoMode&&(n=Gc),this.inConvoMode&&this.convoLookRight&&(r=Dc*this.squareSize);var o=n*this.squareSize,$=Kc*this.squareSize,h=Jc*this.squareSize;t.fillRect(o+e-r,o,$,$*a),t.fillStyle="#fff",t.fillRect(o+e+s*this.squareSize-r,o,h,h*a)}function qc(t){var i=this.game.cl,a=t.x>=0&&t.x<=i.size.w-this.size.w&&t.y>=0&&t.y<i.size.h,s=t.x,e=t.y;return s/=b.TS,e/=b.TS,a&&i.tilesGrid[e][s].wable}function wa(t,i){if(t.running)return!1;var a=i-t.startTime>t.minTimeDelta,s=t.percentChance>Math.random();return a&&s}function pc(t,i,a,s){void 0===s&&(s=!1);var e=a,n=i;if(s&&(e=i,n=a),t>=.5){var r=(t-.5)/.5;return q(e,n,i,a,r)}r=t/.5;return q(n,e,i,a,r)}G.default=zc;var n,i,ja={};Object.defineProperty(ja,"__esModule",{value:!0});var oc=function(){function e(e){this.pos={x:0,y:0},this.size={w:0,h:0},n=e,this.size={w:n.canvas.width,h:n.canvas.height},i={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:i.pos.x+this.pos.x,y:i.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y},e.prototype.moveToPlayer=function(e){this.pos.x=n.canvas.width/2-e.pos.x*n.ss-e.dSize.w/2,this.pos.y=n.canvas.height/2-e.pos.y*n.ss-e.dSize.h/2;var $=-1*(n.cl.dSize.w-this.size.w),a=-1*(n.cl.dSize.h-this.size.h);this.pos.x>0&&(this.pos.x=0),this.pos.x<$&&(this.pos.x=$),this.pos.y>0&&(this.pos.y=0),this.pos.y<a&&(this.pos.y=a)},e.prototype.shakeScreen=function(){i.pos={x:0,y:0},i.amplitude=10*n.ss,i.dir.x=Ka(),i.dir.y=Ka()},e.prototype.updateShake=function(e){i.amplitude*=.9;var $=i.amplitude,a=i.dir;Math.abs($)<=.01?(i.pos.x=0,i.pos.y=0):(i.pos.x=Math.sin(e/50)*$*a.x,i.pos.y=Math.sin(e/50)*$*a.y)},e}(),nc=oc;function Ka(){return 2*Math.round(Math.random())-1}ja.default=nc;var ma={};Object.defineProperty(ma,"__esModule",{value:!0});var a=null,mc={cloud:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,1,1,a,a,a],[a,a,1,1,1,1,a,a],[a,a,1,1,1,1,1,a],[a,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],canvas:null},door:{cMatrix:ia(0),canvas:null,interactable:!0},flowers:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},grass:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},green:{cMatrix:ia(2),canvas:null},house:{cMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],canvas:null,tileLength:3*b.TS},sky:{cMatrix:ia(9),canvas:null},tree:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],canvas:null,wable:!1},unwalkable:{canvas:null,visible:!1,wable:!1}};function ia($){return new Array(b.TS).fill(null).map(function(){return new Array(b.TS).fill($)})}ma.default=mc;var O={},Sa=O&&O.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(O,"__esModule",{value:!0});var lc=Sa(e),l=Sa(ma),kc=function(){function e(e,t,i,$){this.dSize={w:b.TS,h:b.TS},this.pos={x:0,y:0},this.size={w:b.TS,h:b.TS},this.wable=!0,this.visible=!0,this.alpha=1,this.tileLength=b.TS,this.game=e,this.pos={x:i*b.TS,y:$*b.TS},this.tileIndex={x:i,y:$},this.name=t,this.cMatrix=l.default[t].cMatrix,this.wable=l.default[t].hasOwnProperty("wable")?l.default[t].wable:this.wable,this.visible=l.default[t].hasOwnProperty("visible")?l.default[t].visible:this.visible,this.tileLength=l.default[t].hasOwnProperty("tileLength")?l.default[t].tileLength:this.tileLength,this.dSize={h:this.tileLength*this.game.ss,w:this.tileLength*this.game.ss},this.cacheOffscreenContext()}return e.prototype.draw=function(e){e.globalAlpha=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,e.drawImage(l.default[this.name].canvas,0,0)},e.prototype.moveleft=function(){this.pos.x=this.pos.x+this.size.w<0?this.lWidth:this.pos.x-.008*this.speed},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.dSize.w,t.height=this.dSize.h;var i=t.getContext("2d");ha(this.cMatrix).map(function(e){return lc.default[e]}).forEach(function(t,$){if(t){i.fillStyle=t;var a=e.game.ss*($%e.tileLength),s=e.game.ss*Math.floor($/e.tileLength);i.fillRect(a,s,e.game.ss,e.game.ss)}}),l.default[this.name].canvas=t},e}(),gc=kc;O.default=gc;var C={},Za=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(C,"__esModule",{value:!0});var cc=Za(e),_a=Za(O),bc=function(){function e(e){this.tilesGrid=[],this.bgColor=cc.default[2],this.clouds=[],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.uables.forEach(function(t){return t.update(e)}),this.clouds.forEach(function(e){return e.moveleft()})},e.prototype.configViz=function(){this.clearDables(),this.clearOdables(),this.clearUables(),this.clearIables()},e.prototype.configClouds=function(e,t,r){this.clouds=[];for(var a=0;a<20;a++){var l=new _a.default(this.game,"cloud",0,0);l.pos.x=ea(0,e),l.pos.y=ea(0,t),l.speed=ea(.2,1),l.alpha=r,l.lWidth=e,this.clouds.push(l)}},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*b.TS,t=this.tileIndexes.length*b.TS;this.size={w:e,h:t},this.dSize={w:e*this.game.ss,h:t*this.game.ss};for(var r=0;r<this.tileIndexes.length;r++){this.tilesGrid.push(new Array(this.tileIndexes[r].length));for(var a=0;a<this.tileIndexes[r].length;a++){var l=this.tileTypeMap[this.tileIndexes[r][a]||0];this.tilesGrid[r][a]=new _a.default(this.game,l,a,r)}}this.tiles=ha(this.tilesGrid)},e.prototype.addDables=function(e,t){var r;(r=this.dables[t]).push.apply(r,e)},e.prototype.addOdables=function(e){var t;(t=this.odables).push.apply(t,e)},e.prototype.addUables=function(e){var t;(t=this.uables).push.apply(t,e)},e.prototype.addIables=function(e){var t;(t=this.iables).push.apply(t,e)},e.prototype.clearDables=function(){this.dables=new Array(4).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOdables=function(){this.odables=[]},e.prototype.clearUables=function(){this.uables=[]},e.prototype.clearIables=function(){this.iables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.h).fill(null).map(function(){return new Array(e.w).fill(null).map(function(){return J(t.tileTypeMap)})})},e}(),ac=bc;function ea(e,t){return Math.random()*(t-e)+e}C.default=ac;var fa={};Object.defineProperty(fa,"__esModule",{value:!0});var _b={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]],"*":[[,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1]]};fa.default=_b;var B={},ib=B&&B.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(B,"__esModule",{value:!0});var kb=ib(e),$b=ib(fa),Zb=function(){function t(t,s,e,a){void 0===s&&(s=""),void 0===e&&(e=kb.default[1]),void 0===a&&(a={x:0,y:0}),this.words="",this.dSize={w:0,h:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.buddy=null,this.a={},this.upToIndex=null,this.game=t,this.words=s.toUpperCase(),this.upToIndex=this.words.length,this.color=e,this.move(a),this.pixelLetters=this.words.split("").map(function(t){return $b.default[t]});var r=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,s){return t+s},0)+this.pixelLetters.length-1;this.size={w:r,h:b.LH},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss};this.a.floatText={duration:3e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0}}return t.prototype.draw=function(t,s){var e=this.pos.x,a=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,r=Math.floor(this.game.ss/2);t.globalAlpha=a;for(var i=0;i<this.upToIndex;i++){for(var o=this.pos.y,h=0,l=this.pixelLetters[i],$=0;$<l.length;$++){for(var n=l[$],p=0;p<n.length;p++)n[p]&&(this.shadow&&(t.fillStyle=kb.default[0],t.fillRect(e+p*this.game.ss+r,o+r,this.game.ss,this.game.ss)),t.fillStyle=this.color,t.fillRect(e+p*this.game.ss,o,this.game.ss,this.game.ss));h=Math.max(h,n.length*this.game.ss),o=this.game.ss*($+1)+this.pos.y}e+=this.game.ss+h}za.call(this,s)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=Math.floor(t.x),this.pos.y=Math.floor(t.y)},t.prototype.showUpToIndex=function(t){this.upToIndex=t},t.prototype.startFloat=function(t,s){this.a.floatText.startTime=this.game.tstamp,this.a.floatText.startPos={x:t.x,y:t.y-this.size.h},this.a.floatText.endPos={x:s.x,y:s.y},this.a.floatText.running=!0,this.move(this.a.floatText.startPos)},t.prototype.update=function(t){za.call(this,t)},t}(),Yb=Zb;function za(t){var s=this.a.floatText;if(s.running){var e=(t-s.startTime)/s.duration,a=K(s.startPos.x,s.endPos.x,e);this.words!==b.LT&&(a+=10*Math.sin(6*e*Math.PI));var r=K(s.startPos.y,s.endPos.y,e);e>=1&&(s.running=!1),this.alpha=1-e,this.move({x:a,y:r})}}B.default=Yb;var s={},Ba=s&&s.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(s,"__esModule",{value:!0});var na=Ba(e),Wb=Ba(B),Vb=function(){function t(t,i,o,s){void 0===s&&(s=na.default[8]),this.visible=!0,this.alpha=1,this.ani=!1,this.texts=[],this.startTime=null,this.game=t,this.pos=i,this.strokePos=i,this.color=s,this.updateSize(o),this.move(i)}return t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,Ga.call(this)},t.prototype.updateSize=function(t){this.size={h:t.h,w:t.w},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}},t.prototype.draw=function(t,i){var o=this,s=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha;t.globalAlpha=s,t.fillStyle=this.color,this.color&&t.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),t.strokeStyle=na.default[1],t.fillStyle=na.default[1],t.lineWidth=this.game.ss,t.strokeRect(this.strokePos.x,this.strokePos.y,this.dSize.w,this.dSize.h);var e=new Array(this.texts.length).fill(0);if(this.startTime){var r=this.texts.reduce(function(t,i){return t+i.words.length},0),a=Math.min(Math.floor((i-this.startTime)/50),r);r===a&&(this.ani=!1),e=this.texts.map(function(t,i){var s=o.texts.slice(0,i).reduce(function(t,i){return i.words.length+t},0);return Math.min(a-s,t.words.length)})}this.texts.forEach(function(o,s){o.showUpToIndex(e[s]),o.draw(t,i)})},t.prototype.setWords=function(t){var i=this;this.texts=t.map(function(t){return new Wb.default(i.game,t)}),Ga.call(this)},t.prototype.aniText=function(t){this.startTime=t,this.ani=!0},t}(),Tb=Vb;function Ga(){var t=this;if(this.texts.length){var i=b.LS*this.game.ss,o=b.LH*this.game.ss,s=this.texts.length,e=s*o+(s-2)*i;this.texts.forEach(function(o,s){var r=t.pos.x+t.game.ss*(t.size.w-o.size.w)/2,a=t.pos.y+(t.dSize.h-e)/2+i*s;o.move({x:r,y:a})})}}s.default=Tb;var H={},va=H&&H.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(H,"__esModule",{value:!0});var Nb=va(s),$=va(e),Lb=va(B),Ib=function(){function e(e,t,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.a={},this.game=e,this.energyText=new Lb.default(this.game,i,$.default[1]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.dSize={h:(this.size.h+2)*this.game.ss,w:(this.size.w+2)*this.game.ss};var r={h:this.size.h+2,w:this.size.w+2};this.box=new Nb.default(e,t,r,null);this.a.level={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.a).map(function(t){return e.a[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:e.x+this.game.ss/2+2.5,y:e.y+this.game.ss/2+2.5})},e.prototype.draw=function(e,t){Eb.call(this,t),e.globalAlpha=this.game.inTr()?this.game.nextAlpha:1,e.fillStyle=$.default[10],e.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),e.fillStyle=$.default[7],e.fillRect(Math.ceil(this.pos.x+1),Math.ceil(this.pos.y+1),Math.floor(Math.max(this.dSize.w*this.percentFull-2,0)),Math.floor(this.dSize.h-2)),this.box.draw(e,t),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.a.level.startTime=this.game.tstamp,this.a.level.startLevel=this.percentFull,this.a.level.endLevel=e,this.a.level.running=!0},e}(),Hb=Ib;function Eb(e){if(this.a.level.running){var t=(e-this.a.level.startTime)/this.a.level.duration,i=K(this.a.level.startLevel,this.a.level.endLevel,t);t>=1&&(i=this.a.level.endLevel,this.a.level.running=!1),this.percentFull=i}}H.default=Hb;var z={},Db=z&&z.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,a){$.__proto__=a}||function($,a){for(var e in a)a.hasOwnProperty(e)&&($[e]=a[e])};return function(a,e){function r(){this.constructor=a}$(a,e),a.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),Q=z&&z.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(z,"__esModule",{value:!0});var f,Ta,h,t,S,T,p,m,x,Cb=Q(C),Ab=Q(s),I=Q(e),cb=Q(H),R=Q(B),ub=4,qb=2,gb=3,Z=.5,mb=.35,jb=0,y=0,V=!1,tc=1,Ad=null,ob=null,pb=null,sa=[],rb=function($){function a(a){var e=$.call(this,a)||this;e.bgColor=I.default[9],e.tileTypeMap=["green","flowers","sky","tree"],p=new cb.default(e.game,{x:e.game.ss,y:e.game.ss},"ENERGY"),t=new cb.default(e.game,{x:e.game.ss,y:e.game.ss},"CONVO"),f=new Ab.default(e.game,{x:0,y:0},{h:0,w:0}),x=new R.default(e.game,"^"),T=new R.default(e.game,"_");var r=_(e.handleInput.bind(e),b.TT);return e.handleInput=r,x.touched=function(){return e.handleInput("ArrowUp")},T.touched=function(){return e.handleInput("ArrowDown")},e}return Db(a,$),Object.defineProperty(a.prototype,"boxPosY",{get:function(){return f.pos.y/this.game.ss-this.game.p.size.h-ub},enumerable:!0,configurable:!0}),a.prototype.handleInput=function($){switch($){case"ArrowUp":ra.call(this,1);break;case"ArrowDown":ra.call(this,-1);break;case"Enter":xb.call(this);}},a.prototype.handleTouch=function($){var a=Kb.call(this,$);a&&a.touched()},a.prototype.setBuddy=function($){(h=$).setConvoMode(!0,"left")},a.prototype.levelWillStart=function(){var $=this;V=!1,this.game.p.setConvoMode(!0,"right"),S=0,this.usedTopics=[],Ad=null,Ta=[this.game.p,h],h.skills.length>2&&(tc=mb),(m=this.game.p.skills.map(function(a){return new R.default($.game,a)})).forEach(function(a){return a.touched=function(){m[y]===a&&$.handleInput("Enter")}})},a.prototype.levelStarted=function(){t.animateToLevel(S),p.animateToLevel(this.game.p.energy)},a.prototype.resize=function(){this.configViz()},a.prototype.update=function(a){if($.prototype.update.call(this,a),this.game.c.move({x:jb,y:0}),Na.call(this),Jb.call(this),V=ba(this.odables).length>0||this.game.inTr()||!!pb||!!ob,tb(this.odables))if(S>=1){var e=1===this.game.p.skills.length?"post-listen":"post-convo";e=h.skills.length>2?"win":e,this.game.qLevel(this.game.levels.world,e)}else this.game.p.energy<=0&&this.game.qLevel(this.game.levels.world,"nap")},a.prototype.configViz=function(){$.prototype.configViz.call(this),sa=[];var a=this.game.sizeInTiles();jb=-a.w*b.TS*this.game.ss/2,a.w*=2,a.h*=2,Gb.call(this),Na.call(this),Fb.call(this),ra.call(this,0),this.generateTileIndexes(a),this.generateTiles(),this.addDables(this.tiles,0),this.addDables(Ta,1),this.addOdables([f,x,T,p,t].concat(m)),sa.push.apply(sa,[x,T].concat(m)),this.configClouds(this.size.w,this.game.p.pos.y-b.TS,.6),this.addDables(this.clouds,0)},a.prototype.generateTileIndexes=function($){var a=Math.min(this.game.p.tileIndex.y+1,$.h);this.tileIndexes=new Array($.h).fill(null).map(function(){return new Array($.w).fill(null).map(function(){return J([0,1])})});for(var e=0;e<a;e++)this.tileIndexes[e]=this.tileIndexes[e].map(function(){return 2});var r=this.tileIndexes[a-1];r&&(this.tileIndexes[a-1]=r.map(function(){return 3}))},a}(Cb.default),sb=rb;function tb($){return!t.animating&&0===ba($).length}function ra($){if(!V){var a=m[y+$]||m[y];y=m.indexOf(a),m.forEach(function($){return $.alpha=Z})}}function vb($){S=la(Math.round(100*(S+$))/100,0,1)}function wb($,a){$.energy=la(Math.round(100*($.energy+a))/100,0,1)}function xb(){var $=this;if(!V){V=!0;var a=y;Oa.call(this,this.game.p,a),ob=setTimeout(function(){return yb.call($,a)},2e3);var e=h.skills.indexOf(b.LT);1!==this.game.p.skills.length&&(e=J(h.skills)),pb=setTimeout(function(){return Oa.call($,h,e)},4500)}}function yb($){var a=this.game.p.skills[$];ob=null,1===this.game.p.skills.length?oa.call(this,-.1,.5):a===b.LT&&2===this.game.p.skills.length?oa.call(this,-.1,.5):a===b.LT?W.call(this,-.1,.25):Ad===a?zb.call(this,-.15,.5):h.skills.includes(a)?oa.call(this,-.1,.34):Bb.call(this,-.2),t.animateToLevel(S),p.animateToLevel(this.game.p.energy)}function zb($,a){var e=this,r=function(){return X.call(e,h,"totally!",I.default[2])};r(),window.setTimeout(r,500),window.setTimeout(r,1e3),W.call(this,$,a)}function oa($,a){X.call(this,h,"cool!",I.default[2]),W.call(this,$,a)}function Bb($){X.call(this,h,"oh...",I.default[10]),W.call(this,$,0),this.game.c.shakeScreen()}function W($,a){wb(this.game.p,$),vb(a*tc)}function X($,a,e){var r=new R.default(this.game,a,e);r.buddy=$;var t=this.boxPosY*this.game.ss+this.game.p.dSize.h/2,o={x:f.pos.x+this.game.p.dSize.w/2,y:t},i={x:this.game.canvas.width,y:-b.LH};$!==this.game.p&&(o.x+=f.dSize.w-r.dSize.w-this.game.p.dSize.w,i.x=0),a===b.LT&&(i.x=o.x),r.startFloat(o,i),this.addOdables([r]),this.addUables([r])}function Oa($,a){if($===h&&(pb=null),!(S>=1||this.game.p.energy<=0)){var e=$.skills[a],r=e===b.LT?I.default[9]:I.default[1];X.call(this,$,e,r),$===h&&(Ad=e,this.usedTopics.includes(e)||this.usedTopics.push(e))}}function Fb(){var $=this.game.boxPos().x/this.game.ss-h.size.w/2-jb/this.game.ss,a=$+f.dSize.w/this.game.ss-h.size.w/2,e={x:$+this.game.p.size.w/2,y:this.boxPosY};this.game.p.move(e),h.move({x:a,y:e.y})}function Gb(){var $=this.game.canvas.height-this.game.boxSize().h*this.game.ss-2*this.game.ss;f.move({x:this.game.boxPos().x,y:$}),f.updateSize(this.game.boxSize());var a=p.dSize.w+t.dSize.w+gb*this.game.ss,e=(this.game.canvas.width-a)/2;p.move({x:e,y:p.pos.y});var r=p.pos.x+p.dSize.w+gb*this.game.ss;t.move({x:r,y:t.pos.y})}function Na(){var $=this,a=qb*this.game.ss,e=f.pos.x+f.dSize.w-x.dSize.w-a,r=f.pos.y+f.dSize.h/2-x.dSize.h/2,t=f.pos.x+a,o=r;x.move({x:e,y:r}),T.move({x:t,y:o}),T.alpha=0===y||V?Z:1,x.alpha=y===m.length-1||V?Z:1,m.forEach(function(a,e){var r=y-e;a.alpha=0!==r||V?Z:1;var t=f.pos.x+f.dSize.w/2-a.dSize.w/2,o=f.pos.y+f.dSize.h/2-a.dSize.h/2+r*b.LS*$.game.ss;a.move({x:t,y:o}),a.visible=!(Math.abs(r)>1)})}function ba($){return $.filter(function($){return $ instanceof R.default&&$.buddy})}function Jb(){var $=ba(this.odables);Ta.forEach(function(a){return a.talking=!!$.find(function($){return $.words!==b.LT&&$.buddy===a})});for(var a=$.length-1;a>=0;a--){var e=$[a];if(!e)break;e.a.floatText.running||(ca(e,this.odables),this.uables.splice(a,1))}}function Kb($){var a=this,e=20*this.game.sf,r=sa.find(function(r){var t=Object.assign({},r.dSize),o=Object.assign({},r.pos);return t.w*=a.game.sf,t.h*=a.game.sf,o.x*=a.game.sf,o.y*=a.game.sf,$.clientX+e>=o.x&&$.clientX-e<=o.x+t.w&&$.clientY+e>=o.y&&$.clientY-e<=o.y+t.h});if(r&&r.visible)return r}z.default=sb;var A={},Mb=A&&A.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),Ja=A&&A.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(A,"__esModule",{value:!0});var Ob=Ja(s),Pb=Ja(C),Qb=1,Rb=function(t){function e(e){var o=t.call(this,e)||this;return o.tileTypeMap=["green","flowers","grass","tree"],o.box=new Ob.default(o.game,{x:0,y:0},{h:0,w:0}),o.box.setWords(["CONVO IRL","","TAP TO PLAY"]),o}return Mb(e,t),e.prototype.resize=function(){this.configViz()},e.prototype.update=function(e){t.prototype.update.call(this,e),this.game.c.pos.x-=.05*Qb,this.game.c.pos.x<-this.game.canvas.width&&(Qb=-1),this.game.c.pos.x>0&&(Qb=1)},e.prototype.configViz=function(){t.prototype.configViz.call(this);var e=this.game.sizeInTiles();e.w*=2,e.h*=2,this.generateTileIndexes(e),this.generateTiles(),this.box.move(this.game.boxPos()),this.box.updateSize(this.game.boxSize()),this.addDables(this.tiles,0),this.addOdables([this.box]),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3)},e.prototype.levelStarted=function(){var t=this;window.setTimeout(function(){return t.box.aniText(t.game.tstamp)},200)},e.prototype.handleInput=function(){this.game.inTr()||this.box.ani||this.game.qLevel(this.game.levels.world)},e.prototype.handleTouch=function(){this.handleInput()},e}(Pb.default),Sb=Rb;A.default=Sb;var w={},Ub=w&&w.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,a){$.__proto__=a}||function($,a){for(var e in a)a.hasOwnProperty(e)&&($[e]=a[e])};return function(a,e){function r(){this.constructor=a}$(a,e),a.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),L=w&&w.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(w,"__esModule",{value:!0});var Da,Xb,ya,xa,c,k,E,aa,v,dc=L(e),ec=L(C),fc=L(s),u=L(G),hc=L(H),ic=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],jc=[["keep at it","and make","new friends!"],["if you are","low on energy","take a nap!"]],Wa=[["well done!","you made a","new friend!"],["maybe you","will become","best buds!"],["be kind to","your friends","because"],["every quest","is better","with friends!"]],ka={x:18*b.TS,y:7*b.TS},da={x:4*b.TS,y:5*b.TS},g=["BAKING","FRANCE","SPORTS","ANIME","BOOKS","MATH","CATS"],Ha=g.slice(),ua={x:4*b.TS,y:6*b.TS},hb={pressedAt:0,key:null},rc=0,sc=function($){function a(a){var e=$.call(this,a)||this;e.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],e.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,3,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,3,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,3,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,3,,2,,3,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],Da=function(){return pa.call(e,ic)},Xb=function(){return pa.call(e,jc)},ya=function(){return pa.call(e,Wa)},e.state="intro";var r=_(e.handleTouch.bind(e),b.TT),t=_(e.handleInput.bind(e),b.TT);return e.handleTouch=r,e.handleInput=t,e.generateTiles(),v=new hc.default(e.game,{x:0,y:a.ss},"ENERGY"),c=new fc.default(e.game,e.game.boxPos(),e.game.boxSize()),Ec.call(e),e}return Ub(a,$),a.prototype.handleInput=function($){this.game.inTr()||db.call(this)||(hb={pressedAt:this.game.tstamp,key:$})},a.prototype.handleTouch=function($){if(!this.game.inTr()&&!this.game.p.walking&&!db.call(this)){var a=this.game.c,e=a.size,r=e.h,t=e.w,o=a.offset,s=$.clientX*t/window.innerWidth-o.x,i=$.clientY*r/window.innerHeight-o.y,y=s-this.game.p.pos.x*this.game.ss,n=i-this.game.p.pos.y*this.game.ss,v=Math.abs(y),l=Math.abs(n),P=this.game.ss*b.TS/2;v<P&&l<P||(v>l?Cc.call(this,y):Bc.call(this,n))}},a.prototype.resize=function(){var $=(this.game.canvas.width-v.dSize.w)/2;v.move({x:$,y:v.pos.y}),yc.call(this)},a.prototype.update=function(a){$.prototype.update.call(this,a),Fc.call(this),ab.call(this,this.game.p.tileIndex),this.game.c.moveToPlayer(this.game.p),k.pos.x<=ka.x-5*b.TS&&(k.autoWalkDirection="right"),k.pos.x>=ka.x+5*b.TS&&(k.autoWalkDirection="left")},a.prototype.configViz=function(){$.prototype.configViz.call(this),this.addDables(this.tiles,0),this.addDables(this.game.p.dusts,1),this.addDables(k.dusts,1),this.addDables([this.game.p],2),this.addDables(xa,2),this.addOdables([v,c]),this.addIables(xa),this.addUables(this.game.p.dusts.concat([this.game.p,k],k.dusts,[E])),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3),this.resize()},a.prototype.levelStarted=function(){switch(v.animateToLevel(this.game.p.energy),k.move(ka),this.game.p.move(ua),this.game.p.stop(),this.game.p.setConvoMode(!1),this.state){case"intro":Da();break;case"nap":this.game.p.move(da),$a.call(this);break;case"win":this.game.p.energy=1,ya();break;case"post-listen":case"post-convo":xc.call(this),this.game.p.lastConvo=this.game.tstamp;}},a}(ec.default),lb=sc;function eb(){c.visible=!1}function db(){if("play"===this.state)return!1;switch(this.state){case"sleeping":eb.call(this),this.state="play",this.handleInput("ArrowDown");break;case"post-convo":eb.call(this),this.state="play",this.currentBuddy.lastConvo=this.game.tstamp;break;case"post-listen":Xb()&&(this.state="play",E.walk("right"),E.look("left"));break;case"intro":Da()&&(this.state="play");break;case"win":ya(),0===Wa.length&&(this.state="game-over",rc=this.game.tstamp,Y.game=this.game,Y.size=Object.assign({},this.size),Y.dSize=Object.assign({},this.dSize),this.addDables([Y],3),v.animateToLevel(1));}return!0}function pa($){var a=$[0];return a?(c.visible=!0,c.setWords(a),c.aniText(this.game.tstamp),$.shift(),!1):(c.visible=!1,!0)}function xc(){var $=this;if(this.currentBuddy){var a=this.game.levels.convo.usedTopics.filter(function(a){return!$.game.p.skills.includes(a)}),e=a.length>0?a[J(a)]:null;c.visible=!0,e?(c.setWords(["nice convo!","you learned",e+"!"]),this.game.p.skills.push(e)):c.setWords(["nice convo!","that was a","good time!"]),c.aniText(this.game.tstamp)}}function yc(){c.move(this.game.boxPos()),c.updateSize(this.game.boxSize())}function ab($){var a=this.iables.find(function(a){return a.tileIndex.x===$.x&&a.tileIndex.y===$.y});return a&&this.game.tstamp-a.lastConvo>1e3&&!c.visible?(this.currentBuddy=a,ua.x=this.game.p.pos.x,ua.y=this.game.p.pos.y,this.game.qLevel(this.game.levels.convo),!0):!!a}function $a(){this.game.p.energy=1,v.animateToLevel(this.game.p.energy),c.setWords(["","zzzzzz...",""]),c.aniText(this.game.tstamp),c.visible=!0,this.state="sleeping"}function Bc($){$<0&&this.handleInput("ArrowUp"),$>0&&this.handleInput("ArrowDown")}function Cc($){$>0&&this.handleInput("ArrowRight"),$<0&&this.handleInput("ArrowLeft")}function D($){var a=Ha.find(function(a){return a!==$});return ca(a,Ha),a}function Ec(){var $;(E=new u.default(this.game)).move({x:7*b.TS,y:10*b.TS}),E.skills.push(b.LT,g[6]),E.look("up");var a=new u.default(this.game);a.move({x:8*b.TS,y:1*b.TS}),a.skills.push(g[0],D(g[0]));var e=new u.default(this.game);e.move({x:18*b.TS,y:3*b.TS}),e.skills.push(g[1],D(g[1]));var r=new u.default(this.game);r.move({x:25*b.TS,y:2*b.TS}),r.skills.push(g[2],D(g[2]));var t=new u.default(this.game);t.move({x:15*b.TS,y:18*b.TS}),t.skills.push(g[3],D(g[3])),t.look("up");var o=new u.default(this.game);o.move({x:26*b.TS,y:8*b.TS}),o.skills.push(g[4],D(g[4])),o.look("left"),(k=new u.default(this.game)).autoWalkDirection="left",k.skills.push(g[5],D(g[5])),k.a.walking.duration=600,(aa=new u.default(this.game)).move({x:23*b.TS,y:18*b.TS}),aa.look("left"),($=aa.skills).push.apply($,g),xa=[E,a,e,r,aa,t,o,k]}function Fc(){if(this.game.tstamp-hb.pressedAt>30)return!1;if(this.game.p.walking)return!1;var $=Object.assign({},this.game.p.tileIndex),a=null;switch(hb.key){case"ArrowUp":a="up",$.y-=1;break;case"ArrowDown":a="down",$.y+=1;break;case"ArrowLeft":a="left",$.x-=1;break;case"ArrowRight":a="right",$.x+=1;break;default:return;}if(!ab.call(this,$)){$.x===da.x/b.TS&&$.y===da.y/b.TS&&$a.call(this);this.game.p.walk(a);return!0}}w.default=lb;var Y={alpha:0,dSize:{w:0,h:0},draw:function($){$.fillStyle=dc.default[0],$.globalAlpha=Math.min((this.game.tstamp-rc)/2e3,.8),$.fillRect(0,0,this.dSize.w,this.dSize.h)},game:null,pos:{x:0,y:0},size:{w:0,h:0},visible:!0};var ta,N={};!function(t,e){"function"==typeof ta&&ta.amd?ta(["exports"],e):"object"==typeof N&&"string"!=typeof N.nodeName?e(N):e(t.TinyMusic={})}(N,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),s=/^[0-9.]+$/,i=/\s+/,o=/(\d+)/,n={};function r(t){var e=t.split(i);this.frequency=r.getFrequency(e[0])||0,this.duration=r.getDuration(e[1])||0}function c(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),r.getFrequency=function(t){var s=t.split(o),i=n[s[0]],r=(s[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,r)},r.getDuration=function(t){return s.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,s){(s=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",s.frequency.value=e[1],t.connect(t=s)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof r?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},c.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},c.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sequence=c});var P={},F=P&&P.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(P,"__esModule",{value:!0});var Lc,Mc,d,Oc=F(G),Pc=F(ja),Qc=F(z),Rc=F(A),Sc=F(w),Tc=F(N),La=5,Fa=16*b.TS*La,Wc=window.AudioContext||webkitAudioContext,Xc=new Wc,Yc=120,j={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},$c=!1,Ca=null,Aa=null,bd=function(){function $($){this.tstamp=0,this.ss=La,this.sf=1,this.nextAlpha=1,this.p=new Oc.default(this),this.p.skills.push("WEATHER"),this.canvas=$,Xa.call(this),(d=$.getContext("2d",{alpha:!1})).mozImageSmoothingEnabled=!1,d.webkitImageSmoothingEnabled=!1,this.levels={convo:new Qc.default(this),startScreen:new Rc.default(this),world:new Sc.default(this)},this.c=new Pc.default(this)}return $.prototype.boxPos=function(){return{x:(this.canvas.width-this.boxSize().w*this.ss)/2,y:(this.canvas.height-this.boxSize().h*this.ss)/2}},$.prototype.boxSize=function(){return{h:3*b.LH+2*b.LS,w:12*b.LH}},$.prototype.inTr=function(){return j.running},$.prototype.update=function($){$c||(this.tstamp=$,Pa.call(this,this.levels.startScreen),this.resize(),$c=!0),this.tstamp=$,this.cl.update($),this.inTr()&&Ra.call(this,$)},$.prototype.draw=function($){d&&this.c&&(this.c.updateShake($),kd.call(this),hd.call(this,$),jd.call(this,$),this.inTr()&&Ra.call(this,$))},$.prototype.resize=function(){var $=window.innerWidth/window.innerHeight;$>=1?Mc=(Lc=Fa)/$:Lc=(Mc=Fa)*$,this.canvas.width=Lc,this.canvas.height=Mc,this.c.size={w:this.canvas.width,h:this.canvas.height},Xa.call(this),this.cl&&this.cl.resize()},$.prototype.pa=function($,t){void 0===t&&(t=1);[].map(function($){return new Tc.default.Sequence(Xc,Yc,$)})},$.prototype.qLevel=function($,t){if($===this.levels.convo){var a=this.levels,e=a.convo,r=a.world;e.setBuddy(r.currentBuddy.copy())}Ca=$,t&&(Ca.state=t),dd.call(this)},$.prototype.handleInput=function($){this.cl.handleInput($.key)},$.prototype.handleTouch=function($){this.cl.handleTouch($)},$.prototype.sizeInTiles=function(){return{w:Math.ceil(this.canvas.width/this.ss/b.TS),h:Math.ceil(this.canvas.height/this.ss/b.TS)}},$}(),cd=bd;function dd(){j.startTime=this.tstamp,j.running=!0,(Aa=new Image).src=this.canvas.toDataURL("png"),Pa.call(this,Ca)}function Xa(){this.sf=window.innerWidth/this.canvas.width}function Ra($){var t=($-j.startTime)/j.duration;j.prevLevelScale=q(1,5,1,5,t),j.prevLevelAlpha=q(1,0,0,1,t),j.nextLevelAlpha=q(0,1,0,1,t),this.nextAlpha=j.nextLevelAlpha,t>=1&&(j.running=!1,Aa=null)}function Pa($){this.cl=$,this.cl.levelWillStart(),this.cl.configViz(),this.cl.levelStarted()}function hd($){var t=this,a=this.c.offset;if(this.cl.dables.forEach(function(e){e.forEach(function(e){if(e&&e.visible){var r=e.pos.x*t.ss+a.x,i=e.pos.y*t.ss+a.y;id.call(t,r,i,e.dSize)||(d.translate(r+.5|0,i+.5|0),d.globalAlpha=t.inTr()?j.nextLevelAlpha:1,e.draw(d,$),d.setTransform(1,0,0,1,0,0))}})}),d.globalAlpha=1,Aa){d.globalAlpha=j.prevLevelAlpha;var e=j.prevLevelScale,r=(this.canvas.width*e-this.canvas.width)/2,i=(this.canvas.height*e-this.canvas.height)/2;d.drawImage(Aa,-r,-i,this.canvas.width*e,this.canvas.height*e),d.globalAlpha=1}}function id($,t,a){return $+a.w<0||$>this.canvas.width||t+a.h<0||t>this.canvas.height}function jd($){this.inTr()&&(d.globalAlpha=j.nextLevelAlpha),this.cl.odables.forEach(function(t){t.visible&&t.draw(d,$)}),d.globalAlpha=1}function kd(){this.inTr()&&(d.globalAlpha=j.nextLevelAlpha),d.fillStyle=this.cl.bgColor,d.fillRect(0,0,this.canvas.width,this.canvas.height)}P.default=cd;var ga={};Object.defineProperty(ga,"__esModule",{value:!0});function md(t,$,e){var r=0,u=0;return function(a){for(r+=Math.min(a-u,10*b.MS),u=a;r>=t;)$.call(e,a),r-=t}}var nd=md;ga.default=nd;var U={},Ua=U&&U.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(U,"__esModule",{value:!0});var qd=Ua(P),rd=Ua(ga),sd=document.getElementById("game"),o=new qd.default(sd),ud=rd.default(b.MS,o.update,o),Qa=null,wd=!1;function Ia($){Qa&&wd&&o.handleTouch(Qa),ud($),o.draw($),requestAnimationFrame(Ia)}function bb($){qa($),wd=!0}function qa($){$.preventDefault();var a=$;$.touches&&(a=$.changedTouches[0]),Qa=a}function Va(){Qa=null,wd=!1}requestAnimationFrame(Ia),window.onresize=o.resize.bind(o),window.onkeydown=o.handleInput.bind(o),window.onmousedown=bb,window.ontouchstart=bb,window.onmouseup=Va,window.ontouchend=Va,window.addEventListener("onmousemove",qa,{passive:!1}),window.addEventListener("touchmove",qa,{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=U}else if(typeof define==="function"&&define.amd){define(function(){return U})}})();</script>