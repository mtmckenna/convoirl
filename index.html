<!doctype html><title>Convo IRL</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><style>*{width:100%;height:100%;margin:0;padding:0;image-rendering:pixelated;image-rendering:optimizeSpeed;overflow:hidden}</style><canvas id="game"></canvas><script>(function () {var b={};Object.defineProperty(b,"__esModule",{value:!0});var lb=8;b.TS=lb;var od=1/60;b.MS=od;var jd=8;b.LS=jd;var Uc=120;b.TT=Uc;var Kc=5;b.LH=Kc;var Hc="*LISTEN*";b.LT=Hc;var p={};function Wa(e,$,r){return(1-r)*e+r*$}Object.defineProperty(p,"__esModule",{value:!0});var H=Wa;function Ua(e,$,r){return Math.max(Math.min(e,r),$)}p.lerp=H;var oa=Ua;function fc(e,$,r,t,o){return Ua(Wa(e,$,o),r,t)}p.clamp=oa;var o=fc;function bc(e){return[].concat.apply([],e)}p.clerp=o;var ka=bc;function $b(e){return Math.floor(Math.random()*e.length)}p.flatten=ka;var J=$b;function Zb(e,$){var r=$.indexOf(e);return r>-1&&($.splice(r,1),!0)}p.randomIndex=J;var ja=Zb;function Sb(e,$){var r;return function(){var t=arguments;r||(e.apply(this,t),r=!0,setTimeout(function(){return r=!1},$))}}p.removeElement=ja;var Y=Sb;p.throttle=Y;var e={};Object.defineProperty(e,"__esModule",{value:!0});var kb=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];e.default=kb;var S={},gd=S&&S.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(S,"__esModule",{value:!0});var ad=gd(e),Wc=function(){function t(t){this.size={w:1,h:1},this.pos={x:0,y:0},this.color=ad.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=o(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=o(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.dSize.w*e/2,-this.dSize.h*e/2,this.dSize.w*e,this.dSize.h*e)},t}(),Tc=Wc;S.default=Tc;var E={},Rc=E&&E.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(E,"__esModule",{value:!0});var Qc=Rc(S),Gc=2,Fc=1,Cc=4,yc=1,vc=4,tc=6,Ga=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],Kb=function(){function t(t){var i=this;this.pos={x:0,y:0},this.size={h:b.TS,w:b.TS},this.visible=!0,this.skills=[],this.a={},this.tileIndex={x:0,y:0},this.energy=1,this.talking=!1,this.lastConvo=0,this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.game=t;this.a.blinking={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},this.a.lookAway={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},this.stop(),this.color=Ga[J(Ga)],this.dusts=Array.from(Array(50).keys()).map(function(){return new Qc.default(i.game)}),this.dSize={h:b.TS*this.game.ss,w:b.TS*this.game.ss},this.squareSize=this.game.ss,this.rando=100*Math.random()}return Object.defineProperty(t.prototype,"walking",{get:function(){return this.a.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i.skills=this.skills,i},t.prototype.setConvoMode=function(t,i){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.ss,this.size.w=b.TS,this.size.h=b.TS,this.dSize.w=this.size.w*this.game.ss,this.dSize.h=this.size.h*this.game.ss,t?(this.squareSize*=2,this.size.w*=2,this.size.h*=2,this.dSize.w*=2,this.dSize.h*=2,this.a.walking.tw=0):this.talking=!1,this.convoLookRight="right"===i},t.prototype.stop=function(){this.a.walking={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:-1,y:-1},startTime:0,t:0,tw:0}},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.round(this.pos.x/b.TS),this.tileIndex.y=Math.round(this.pos.y/b.TS)},t.prototype.look=function(t){this.walk(t,!0)},t.prototype.walk=function(t,i){void 0===i&&(i=!1);var a=this.pos,s=a.x,e=a.y;switch(t){case"left":this.rot=-Math.PI/2,s-=b.TS;break;case"right":this.rot=Math.PI/2,s+=b.TS;break;case"down":this.rot=Math.PI,e+=b.TS;break;case"up":this.rot=0,e-=b.TS;}if(!i&&!this.walking){var n={x:this.pos.x,y:this.pos.y},r={x:s,y:e};return!!Cb.call(this,r)&&(this.configureWalkingAnimation(n,r),!0)}},t.prototype.configureWalkingAnimation=function(t,i){var a=this.a.walking;a.startTime=this.game.tstamp,a.endPos=i,a.startPos=t,a.running=!0,a.t=0},t.prototype.update=function(t){if(this.autoWalkDirection&&this.walk(this.autoWalkDirection),-1!==this.a.walking.startPos.x){var i=(t-this.a.walking.startTime)/this.a.walking.duration,a=H(this.a.walking.startPos.x,this.a.walking.endPos.x,i),s=H(this.a.walking.startPos.y,this.a.walking.endPos.y,i);this.a.walking.t=i,i>=1?(a=this.a.walking.endPos.x,s=this.a.walking.endPos.y,this.a.walking.running=!1,this.a.walking.t=0,this.a.walking.tw=Math.max(this.a.walking.tw-100*b.MS,0)):this.a.walking.tw=Math.min(this.a.walking.tw+100*b.MS,this.a.walking.duration),this.move({x:a,y:s})}},t.prototype.draw=function(t,i){t.translate(this.dSize.w/2,this.dSize.h/2),t.rotate(this.rot),t.translate(-this.dSize.w/2,-this.dSize.h/2),t.fillStyle=this.color,t.fillRect(0,0,this.dSize.w,this.dSize.h);var a=this.a.walking.tw/this.a.walking.duration,s=t.createLinearGradient(0,this.dSize.h,0,1.5*this.dSize.h);if(s.addColorStop(0,this.color),s.addColorStop(a,"rgba(150, 192, 131, 0)"),t.fillStyle=s,t.fillRect(0,0,this.dSize.w,1.5*this.dSize.h),ac.call(this,i),db.call(this,t,"left",this.a.blinking.openness,this.a.lookAway.offset),db.call(this,t,"right",this.a.blinking.openness,this.a.lookAway.offset),this.talking){t.fillStyle="#000";var e=Math.sin(i/80+this.rando)+1;t.fillRect((this.convoLookRight?1:5)*this.squareSize,this.squareSize+e/4,2*this.squareSize+e,2*this.squareSize*e/2)}if(this.walking&&i-this.lastDustAt>30){var n=this.dusts.find(function(t){return!t.visible});if(n){var r=this.size.w/2*Math.random()+this.size.w/4,o=this.size.h/2*Math.random()+this.size.h/4,$=this.pos.x+r,h=this.pos.y+o;n.reJuice(i,$,h),this.lastDustAt=i}}},t}(),zb=Kb;function ac(t){var i=this.a,a=i.blinking,s=i.lookAway;za(a,t)&&(a.running=!0,a.startTime=t),za(s,t)&&(s.running=!0,s.startTime=t),Bb.call(this,a,t),Mb.call(this,s)}function Mb(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)}function Bb(t,i){var a=(i-t.startTime)/t.duration;t.openness=jc(a,0,1,!0),a>=1&&(t.running=!1)}function db(t,i,a,s){var e="left"===i?0:Cc*this.squareSize;t.fillStyle="#000";var n=yc,r=0;this.inConvoMode&&(n=vc),this.inConvoMode&&this.convoLookRight&&(r=tc*this.squareSize);var o=n*this.squareSize,$=Gc*this.squareSize,h=Fc*this.squareSize;t.fillRect(o+e-r,o,$,$*a),t.fillStyle="#fff",t.fillRect(o+e+s*this.squareSize-r,o,h,h*a)}function Cb(t){var i=this.game.cl,a=t.x>=0&&t.x<=i.size.w-this.size.w&&t.y>=0&&t.y<i.size.h,s=t.x,e=t.y;return s/=b.TS,e/=b.TS,a&&i.tilesGrid[e][s].wable}function za(t,i){if(t.running)return!1;var a=i-t.startTime>t.minTimeDelta,s=t.percentChance>Math.random();return a&&s}function jc(t,i,a,s){void 0===s&&(s=!1);var e=a,n=i;if(s&&(e=i,n=a),t>=.5){var r=(t-.5)/.5;return o(e,n,i,a,r)}r=t/.5;return o(n,e,i,a,r)}E.default=zb;var m,j,ia={};Object.defineProperty(ia,"__esModule",{value:!0});var zc=function(){function e(e){this.pos={x:0,y:0},this.size={w:0,h:0},m=e,this.size={w:m.canvas.width,h:m.canvas.height},j={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:j.pos.x+this.pos.x,y:j.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y},e.prototype.moveToPlayer=function(e){this.pos.x=m.canvas.width/2-e.pos.x*m.ss-e.dSize.w/2,this.pos.y=m.canvas.height/2-e.pos.y*m.ss-e.dSize.h/2;var $=-1*(m.cl.dSize.w-this.size.w),a=-1*(m.cl.dSize.h-this.size.h);this.pos.x>0&&(this.pos.x=0),this.pos.x<$&&(this.pos.x=$),this.pos.y>0&&(this.pos.y=0),this.pos.y<a&&(this.pos.y=a)},e.prototype.shakeScreen=function(){j.pos={x:0,y:0},j.amplitude=10*m.ss,j.dir.x=Ba(),j.dir.y=Ba()},e.prototype.updateShake=function(e){j.amplitude*=.9;var $=j.amplitude,a=j.dir;Math.abs($)<=.01?(j.pos.x=0,j.pos.y=0):(j.pos.x=Math.sin(e/50)*$*a.x,j.pos.y=Math.sin(e/50)*$*a.y)},e}(),jb=zc;function Ba(){return 2*Math.round(Math.random())-1}ia.default=jb;var ga={};Object.defineProperty(ga,"__esModule",{value:!0});var a=null,td={cloud:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,1,1,a,a,a],[a,a,1,1,1,1,a,a],[a,a,1,1,1,1,1,a],[a,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],canvas:null},door:{cMatrix:ea(0),canvas:null,interactable:!0},flowers:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},grass:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},green:{cMatrix:ea(2),canvas:null},house:{cMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],canvas:null,tileLength:3*b.TS},sky:{cMatrix:ea(9),canvas:null},tree:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],canvas:null,wable:!1},unwalkable:{canvas:null,visible:!1,wable:!1}};function ea($){return new Array(b.TS).fill(null).map(function(){return new Array(b.TS).fill($)})}ga.default=td;var R={},Ha=R&&R.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(R,"__esModule",{value:!0});var Ib=Ha(e),l=Ha(ga),Ub=function(){function e(e,t,i,$){this.dSize={w:b.TS,h:b.TS},this.pos={x:0,y:0},this.size={w:b.TS,h:b.TS},this.wable=!0,this.visible=!0,this.alpha=1,this.tileLength=b.TS,this.game=e,this.pos={x:i*b.TS,y:$*b.TS},this.tileIndex={x:i,y:$},this.name=t,this.cMatrix=l.default[t].cMatrix,this.wable=l.default[t].hasOwnProperty("wable")?l.default[t].wable:this.wable,this.visible=l.default[t].hasOwnProperty("visible")?l.default[t].visible:this.visible,this.tileLength=l.default[t].hasOwnProperty("tileLength")?l.default[t].tileLength:this.tileLength,this.dSize={h:this.tileLength*this.game.ss,w:this.tileLength*this.game.ss},this.cacheOffscreenContext()}return e.prototype.draw=function(e){e.globalAlpha=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,e.drawImage(l.default[this.name].canvas,0,0)},e.prototype.moveleft=function(){this.pos.x=this.pos.x+this.size.w<0?this.lWidth:this.pos.x-.008*this.speed},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.dSize.w,t.height=this.dSize.h;var i=t.getContext("2d");ka(this.cMatrix).map(function(e){return Ib.default[e]}).forEach(function(t,$){if(t){i.fillStyle=t;var a=e.game.ss*($%e.tileLength),s=e.game.ss*Math.floor($/e.tileLength);i.fillRect(a,s,e.game.ss,e.game.ss)}}),l.default[this.name].canvas=t},e}(),_b=Ub;R.default=_b;var C={},Ja=C&&C.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(C,"__esModule",{value:!0});var lc=Ja(e),Ra=Ja(R),bd=function(){function e(e){this.tilesGrid=[],this.bgColor=lc.default[2],this.clouds=[],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.uables.forEach(function(t){return t.update(e)}),this.clouds.forEach(function(e){return e.moveleft()})},e.prototype.configViz=function(){this.clearDables(),this.clearOdables(),this.clearUables(),this.clearIables(),this.clearTables()},e.prototype.configClouds=function(e,t,r){this.clouds=[];for(var a=0;a<20;a++){var l=new Ra.default(this.game,"cloud",0,0);l.pos.x=fa(0,e),l.pos.y=fa(0,t),l.speed=fa(.2,1),l.alpha=r,l.lWidth=e,this.clouds.push(l)}},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*b.TS,t=this.tileIndexes.length*b.TS;this.size={w:e,h:t},this.dSize={w:e*this.game.ss,h:t*this.game.ss};for(var r=0;r<this.tileIndexes.length;r++){this.tilesGrid.push(new Array(this.tileIndexes[r].length));for(var a=0;a<this.tileIndexes[r].length;a++){var l=this.tileTypeMap[this.tileIndexes[r][a]||0];this.tilesGrid[r][a]=new Ra.default(this.game,l,a,r)}}this.tiles=ka(this.tilesGrid)},e.prototype.addDables=function(e,t){var r;(r=this.dables[t]).push.apply(r,e)},e.prototype.addOdables=function(e){var t;(t=this.odables).push.apply(t,e)},e.prototype.addUables=function(e){var t;(t=this.uables).push.apply(t,e)},e.prototype.addTables=function(e){var t;(t=this.tables).push.apply(t,e)},e.prototype.addIables=function(e){var t;(t=this.iables).push.apply(t,e)},e.prototype.clearDables=function(){this.dables=new Array(4).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOdables=function(){this.odables=[]},e.prototype.clearUables=function(){this.uables=[]},e.prototype.clearIables=function(){this.iables=[]},e.prototype.clearTables=function(){this.tables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.h).fill(null).map(function(){return new Array(e.w).fill(null).map(function(){return J(t.tileTypeMap)})})},e}(),sd=bd;function fa(e,t){return Math.random()*(t-e)+e}C.default=sd;var ha={};Object.defineProperty(ha,"__esModule",{value:!0});var tb={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]],"*":[[,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1]]};ha.default=tb;var w={},ua=w&&w.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(w,"__esModule",{value:!0});var va=ua(e),Db=ua(ha),Gb=function(){function t(t,s,e,a){void 0===s&&(s=""),void 0===e&&(e=va.default[1]),void 0===a&&(a={x:0,y:0}),this.words="",this.dSize={w:0,h:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.buddy=null,this.a={},this.upToIndex=null,this.game=t,this.words=s.toUpperCase(),this.upToIndex=this.words.length,this.color=e,this.move(a),this.pixelLetters=this.words.split("").map(function(t){return Db.default[t]});var r=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,s){return t+s},0)+this.pixelLetters.length-1;this.size={w:r,h:b.LH},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss};this.a.floatText={duration:3e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0}}return t.prototype.draw=function(t,s){var e=this.pos.x,a=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,r=Math.floor(this.game.ss/2);t.globalAlpha=a;for(var i=0;i<this.upToIndex;i++){for(var o=this.pos.y,h=0,l=this.pixelLetters[i],$=0;$<l.length;$++){for(var n=l[$],p=0;p<n.length;p++)n[p]&&(this.shadow&&(t.fillStyle=va.default[0],t.fillRect(e+p*this.game.ss+r,o+r,this.game.ss,this.game.ss)),t.fillStyle=this.color,t.fillRect(e+p*this.game.ss,o,this.game.ss,this.game.ss));h=Math.max(h,n.length*this.game.ss),o=this.game.ss*($+1)+this.pos.y}e+=this.game.ss+h}ya.call(this,s)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=Math.floor(t.x),this.pos.y=Math.floor(t.y)},t.prototype.showUpToIndex=function(t){this.upToIndex=t},t.prototype.startFloat=function(t,s){this.a.floatText.startTime=this.game.tstamp,this.a.floatText.startPos={x:t.x,y:t.y-this.size.h},this.a.floatText.endPos={x:s.x,y:s.y},this.a.floatText.running=!0,this.move(this.a.floatText.startPos)},t.prototype.update=function(t){ya.call(this,t)},t}(),Hb=Gb;function ya(t){var s=this.a.floatText;if(s.running){var e=(t-s.startTime)/s.duration,a=H(s.startPos.x,s.endPos.x,e);this.words!==b.LT&&(a+=10*Math.sin(6*e*Math.PI));var r=H(s.startPos.y,s.endPos.y,e);e>=1&&(s.running=!1),this.alpha=1-e,this.move({x:a,y:r})}}w.default=Hb;var r={},Aa=r&&r.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});var ra=Aa(e),Vb=Aa(w),Xb=function(){function t(t,i,o,s){void 0===s&&(s=ra.default[8]),this.visible=!0,this.alpha=1,this.ani=!1,this.texts=[],this.startTime=null,this.game=t,this.pos=i,this.strokePos=i,this.color=s,this.updateSize(o),this.move(i)}return t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,Ca.call(this)},t.prototype.updateSize=function(t){this.size={h:t.h,w:t.w},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}},t.prototype.draw=function(t,i){var o=this,s=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha;t.globalAlpha=s,t.fillStyle=this.color,this.color&&t.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),t.strokeStyle=ra.default[1],t.fillStyle=ra.default[1],t.lineWidth=this.game.ss,t.strokeRect(this.strokePos.x,this.strokePos.y,this.dSize.w,this.dSize.h);var e=new Array(this.texts.length).fill(0);if(this.startTime){var r=this.texts.reduce(function(t,i){return t+i.words.length},0),a=Math.min(Math.floor((i-this.startTime)/50),r);r===a&&(this.ani=!1),e=this.texts.map(function(t,i){var s=o.texts.slice(0,i).reduce(function(t,i){return i.words.length+t},0);return Math.min(a-s,t.words.length)})}this.texts.forEach(function(o,s){o.showUpToIndex(e[s]),o.draw(t,i)})},t.prototype.setWords=function(t){var i=this;this.texts=t.map(function(t){return new Vb.default(i.game,t)}),Ca.call(this)},t.prototype.aniText=function(t){this.startTime=t,this.ani=!0},t}(),Yb=Xb;function Ca(){var t=this;if(this.texts.length){var i=b.LS*this.game.ss,o=b.LH*this.game.ss,s=this.texts.length,e=s*o+(s-2)*i;this.texts.forEach(function(o,s){var r=t.pos.x+t.game.ss*(t.size.w-o.size.w)/2,a=t.pos.y+(t.dSize.h-e)/2+i*s;o.move({x:r,y:a})})}}r.default=Yb;var D={},$=D&&D.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(D,"__esModule",{value:!0});var kc=$(r),aa=$(e),mc=$(w),nc=function(){function e(e,t,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.a={},this.game=e,this.energyText=new mc.default(this.game,i,aa.default[1]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.dSize={h:(this.size.h+2)*this.game.ss,w:(this.size.w+2)*this.game.ss};var r={h:this.size.h+2,w:this.size.w+2};this.box=new kc.default(e,t,r,null);this.a.level={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.a).map(function(t){return e.a[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:e.x+this.game.ss/2+2.5,y:e.y+this.game.ss/2+2.5})},e.prototype.draw=function(e,t){pc.call(this,t),e.globalAlpha=this.game.inTr()?this.game.nextAlpha:1,e.fillStyle=aa.default[10],e.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),e.fillStyle=aa.default[7],e.fillRect(Math.ceil(this.pos.x+1),Math.ceil(this.pos.y+1),Math.floor(Math.max(this.dSize.w*this.percentFull-2,0)),Math.floor(this.dSize.h-2)),this.box.draw(e,t),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.a.level.startTime=this.game.tstamp,this.a.level.startLevel=this.percentFull,this.a.level.endLevel=e,this.a.level.running=!0},e}(),oc=nc;function pc(e){if(this.a.level.running){var t=(e-this.a.level.startTime)/this.a.level.duration,i=H(this.a.level.startLevel,this.a.level.endLevel,t);t>=1&&(i=this.a.level.endLevel,this.a.level.running=!1),this.percentFull=i}}D.default=oc;var B={},uc=B&&B.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,e){$.__proto__=e}||function($,e){for(var a in e)e.hasOwnProperty(a)&&($[a]=e[a])};return function(e,a){function r(){this.constructor=e}$(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),K=B&&B.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(B,"__esModule",{value:!0});var f,Ka,h,y,Q,P,s,n,v,Xc=K(C),_c=K(r),F=K(e),La=K(D),T=K(w),kd=4,qd=2,Na=3,V=.5,ib=.35,Va=0,x=0,L=!1,mb=1,nb=null,ob=null,pb=null,qb=function($){function e(e){var a=$.call(this,e)||this;a.bgColor=F.default[9],a.tileTypeMap=["green","flowers","sky","tree"],s=new La.default(a.game,{x:a.game.ss,y:a.game.ss},"ENERGY"),y=new La.default(a.game,{x:a.game.ss,y:a.game.ss},"CONVO"),f=new _c.default(a.game,{x:0,y:0},{h:0,w:0}),v=new T.default(a.game,"^"),P=new T.default(a.game,"_");var r=Y(a.handleInput.bind(a),b.TT);return a.handleInput=r,v.touched=function(){return a.handleInput("ArrowUp")},P.touched=function(){return a.handleInput("ArrowDown")},a}return uc(e,$),Object.defineProperty(e.prototype,"boxPosY",{get:function(){return f.pos.y/this.game.ss-this.game.p.size.h-kd},enumerable:!0,configurable:!0}),e.prototype.handleInput=function($){switch($){case"ArrowUp":ca.call(this,1);break;case"ArrowDown":ca.call(this,-1);break;case"Enter":wb.call(this);}},e.prototype.handleTouch=function($){var e=Jb.call(this,$);e&&e.touched()},e.prototype.setBuddy=function($){(h=$).setConvoMode(!0,"left")},e.prototype.levelWillStart=function(){var $=this;L=!1,this.game.p.setConvoMode(!0,"right"),Q=0,this.usedTopics=[],nb=null,Ka=[this.game.p,h],h.skills.length>2&&(mb=ib),(n=this.game.p.skills.map(function(e){return new T.default($.game,e)})).forEach(function(e){return e.touched=function(){n[x]===e&&$.handleInput("Enter")}})},e.prototype.levelStarted=function(){y.animateToLevel(Q),s.animateToLevel(this.game.p.energy)},e.prototype.resize=function(){this.configViz()},e.prototype.update=function(e){if($.prototype.update.call(this,e),this.game.c.move({x:Va,y:0}),xa.call(this),ud.call(this),L=_(this.odables).length>0||this.game.inTr()||!!pb||!!ob,sb(this.odables))if(Q>=1){var a=1===this.game.p.skills.length?"post-listen":"post-convo";a=h.skills.length>2?"win":a,this.game.qLevel(this.game.levels.world,a)}else this.game.p.energy<=0&&this.game.qLevel(this.game.levels.world,"nap")},e.prototype.configViz=function(){$.prototype.configViz.call(this);var e=this.game.sizeInTiles();Va=-e.w*b.TS*this.game.ss/2,e.w*=2,e.h*=2,Fb.call(this),xa.call(this),Eb.call(this),ca.call(this,0),this.generateTileIndexes(e),this.generateTiles(),this.addDables(this.tiles,0),this.addDables(Ka,1),this.addOdables([f,v,P,s,y].concat(n)),this.addTables([v,P].concat(n)),this.configClouds(this.size.w,this.game.p.pos.y-b.TS,.6),this.addDables(this.clouds,0)},e.prototype.generateTileIndexes=function($){var e=Math.min(this.game.p.tileIndex.y+1,$.h);this.tileIndexes=new Array($.h).fill(null).map(function(){return new Array($.w).fill(null).map(function(){return J([0,1])})});for(var a=0;a<e;a++)this.tileIndexes[a]=this.tileIndexes[a].map(function(){return 2});var r=this.tileIndexes[e-1];r&&(this.tileIndexes[e-1]=r.map(function(){return 3}))},e}(Xc.default),rb=qb;function sb($){return!y.animating&&0===_($).length}function ca($){if(!L){var e=n[x+$]||n[x];x=n.indexOf(e),n.forEach(function($){return $.alpha=V})}}function ub($){Q=oa(Math.round(100*(Q+$))/100,0,1)}function vb($,e){$.energy=oa(Math.round(100*($.energy+e))/100,0,1)}function wb(){var $=this;if(!L){L=!0;var e=x;wa.call(this,this.game.p,e),ob=setTimeout(function(){return xb.call($,e)},2e3);var a=h.skills.indexOf(b.LT);1!==this.game.p.skills.length&&(a=J(h.skills)),pb=setTimeout(function(){return wa.call($,h,a)},4500)}}function xb($){var e=this.game.p.skills[$];ob=null,1===this.game.p.skills.length?da.call(this,-.1,.5):e===b.LT&&2===this.game.p.skills.length?da.call(this,-.1,.5):e===b.LT?W.call(this,-.1,.25):nb===e?yb.call(this,-.15,.5):h.skills.includes(e)?da.call(this,-.1,.34):Ab.call(this,-.2),y.animateToLevel(Q),s.animateToLevel(this.game.p.energy)}function yb($,e){var a=this,r=function(){return X.call(a,h,"totally!",F.default[2])};r(),window.setTimeout(r,500),window.setTimeout(r,1e3),W.call(this,$,e)}function da($,e){X.call(this,h,"cool!",F.default[2]),W.call(this,$,e)}function Ab($){X.call(this,h,"oh...",F.default[10]),W.call(this,$,0),this.game.c.shakeScreen()}function W($,e){vb(this.game.p,$),ub(e*mb)}function X($,e,a){var r=new T.default(this.game,e,a);r.buddy=$;var t=this.boxPosY*this.game.ss+this.game.p.dSize.h/2,o={x:f.pos.x+this.game.p.dSize.w/2,y:t},i={x:this.game.canvas.width,y:-b.LH};$!==this.game.p&&(o.x+=f.dSize.w-r.dSize.w-this.game.p.dSize.w,i.x=0),e===b.LT&&(i.x=o.x),r.startFloat(o,i),this.addOdables([r]),this.addUables([r])}function wa($,e){if($===h&&(pb=null),!(Q>=1||this.game.p.energy<=0)){var a=$.skills[e],r=a===b.LT?F.default[9]:F.default[1];X.call(this,$,a,r),$===h&&(nb=a,this.usedTopics.includes(a)||this.usedTopics.push(a))}}function Eb(){var $=this.game.boxPos().x/this.game.ss-h.size.w/2-Va/this.game.ss,e=$+f.dSize.w/this.game.ss-h.size.w/2,a={x:$+this.game.p.size.w/2,y:this.boxPosY};this.game.p.move(a),h.move({x:e,y:a.y})}function Fb(){var $=this.game.canvas.height-this.game.boxSize().h*this.game.ss-2*this.game.ss;f.move({x:this.game.boxPos().x,y:$}),f.updateSize(this.game.boxSize());var e=s.dSize.w+y.dSize.w+Na*this.game.ss,a=(this.game.canvas.width-e)/2;s.move({x:a,y:s.pos.y});var r=s.pos.x+s.dSize.w+Na*this.game.ss;y.move({x:r,y:y.pos.y})}function xa(){var $=this,e=qd*this.game.ss,a=f.pos.x+f.dSize.w-v.dSize.w-e,r=f.pos.y+f.dSize.h/2-v.dSize.h/2,t=f.pos.x+e,o=r;v.move({x:a,y:r}),P.move({x:t,y:o}),P.alpha=0===x||L?V:1,v.alpha=x===n.length-1||L?V:1,n.forEach(function(e,a){var r=x-a;e.alpha=0!==r||L?V:1;var t=f.pos.x+f.dSize.w/2-e.dSize.w/2,o=f.pos.y+f.dSize.h/2-e.dSize.h/2+r*b.LS*$.game.ss;e.move({x:t,y:o}),e.visible=!(Math.abs(r)>1)})}function _($){return $.filter(function($){return $ instanceof T.default&&$.buddy})}function ud(){var $=_(this.odables);Ka.forEach(function(e){return e.talking=!!$.find(function($){return $.words!==b.LT&&$.buddy===e})});for(var e=$.length-1;e>=0;e--){var a=$[e];if(!a)break;a.a.floatText.running||(ja(a,this.odables),this.uables.splice(e,1))}}function Jb($){var e=this,a=20*this.game.sf,r=this.tables.find(function(r){var t=Object.assign({},r.dSize),o=Object.assign({},r.pos);return t.w*=e.game.sf,t.h*=e.game.sf,o.x*=e.game.sf,o.y*=e.game.sf,$.clientX+a>=o.x&&$.clientX-a<=o.x+t.w&&$.clientY+a>=o.y&&$.clientY-a<=o.y+t.h});if(r&&r.visible)return r}B.default=rb;var A={},Lb=A&&A.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),ta=A&&A.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(A,"__esModule",{value:!0});var Nb=ta(r),Ob=ta(C),Pb=1,Qb=function(t){function e(e){var o=t.call(this,e)||this;return o.tileTypeMap=["green","flowers","grass","tree"],o.box=new Nb.default(o.game,{x:0,y:0},{h:0,w:0}),o.box.setWords(["CONVO IRL","","TAP TO PLAY"]),o}return Lb(e,t),e.prototype.resize=function(){this.configViz()},e.prototype.update=function(e){t.prototype.update.call(this,e),this.game.c.pos.x-=.05*Pb,this.game.c.pos.x<-this.game.canvas.width&&(Pb=-1),this.game.c.pos.x>0&&(Pb=1)},e.prototype.configViz=function(){t.prototype.configViz.call(this);var e=this.game.sizeInTiles();e.w*=2,e.h*=2,this.generateTileIndexes(e),this.generateTiles(),this.box.move(this.game.boxPos()),this.box.updateSize(this.game.boxSize()),this.addDables(this.tiles,0),this.addOdables([this.box]),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3)},e.prototype.levelStarted=function(){var t=this;window.setTimeout(function(){return t.box.aniText(t.game.tstamp)},200)},e.prototype.handleInput=function(){this.game.inTr()||this.box.ani||this.game.qLevel(this.game.levels.world)},e.prototype.handleTouch=function(){this.handleInput()},e}(Ob.default),Rb=Qb;A.default=Rb;var z={},Tb=z&&z.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,a){$.__proto__=a}||function($,a){for(var e in a)a.hasOwnProperty(e)&&($[e]=a[e])};return function(a,e){function r(){this.constructor=a}$(a,e),a.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),U=z&&z.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(z,"__esModule",{value:!0});var Da,Wb,Ea,Fa,c,k,I,la,t,cc=U(e),dc=U(C),ec=U(r),u=U(E),gc=U(D),hc=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],ic=[["keep at it","and make","new friends!"],["if you are","low on energy","take a nap!"]],Ia=[["well done!","you made a","new friend!"],["maybe you","will become","best buds!"],["be kind to","your friends","because"],["every quest","is better","with friends!"]],ma={x:18*b.TS,y:7*b.TS},na={x:4*b.TS,y:5*b.TS},i=["BAKING","FRANCE","SPORTS","ANIME","BOOKS","MATH","CATS"],Ma=i.slice(),pa={x:4*b.TS,y:6*b.TS},Oa={pressedAt:0,key:null},qc=0,rc=function($){function a(a){var e=$.call(this,a)||this;e.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],e.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,3,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,3,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,3,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,3,,2,,3,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],Da=function(){return qa.call(e,hc)},Wb=function(){return qa.call(e,ic)},Ea=function(){return qa.call(e,Ia)},e.state="intro";var r=Y(e.handleTouch.bind(e),b.TT),t=Y(e.handleInput.bind(e),b.TT);return e.handleTouch=r,e.handleInput=t,e.generateTiles(),t=new gc.default(e.game,{x:0,y:a.ss},"ENERGY"),c=new ec.default(e.game,e.game.boxPos(),e.game.boxSize()),Dc.call(e),e}return Tb(a,$),a.prototype.handleInput=function($){this.game.inTr()||Qa.call(this)||(Oa={pressedAt:this.game.tstamp,key:$})},a.prototype.handleTouch=function($){if(!this.game.inTr()&&!this.game.p.walking&&!Qa.call(this)){var a=this.game.c,e=a.size,r=e.h,t=e.w,o=a.offset,s=$.clientX*t/window.innerWidth-o.x,i=$.clientY*r/window.innerHeight-o.y,y=s-this.game.p.pos.x*this.game.ss,n=i-this.game.p.pos.y*this.game.ss,v=Math.abs(y),l=Math.abs(n),P=this.game.ss*b.TS/2;v<P&&l<P||(v>l?Bc.call(this,y):Ac.call(this,n))}},a.prototype.resize=function(){var $=(this.game.canvas.width-t.dSize.w)/2;t.move({x:$,y:t.pos.y}),xc.call(this)},a.prototype.update=function(a){$.prototype.update.call(this,a),Ec.call(this),Sa.call(this,this.game.p.tileIndex),this.game.c.moveToPlayer(this.game.p),k.pos.x<=ma.x-5*b.TS&&(k.autoWalkDirection="right"),k.pos.x>=ma.x+5*b.TS&&(k.autoWalkDirection="left")},a.prototype.configViz=function(){$.prototype.configViz.call(this),this.addDables(this.tiles,0),this.addDables(this.game.p.dusts,1),this.addDables(k.dusts,1),this.addDables([this.game.p],2),this.addDables(Fa,2),this.addOdables([t,c]),this.addIables(Fa),this.addUables(this.game.p.dusts.concat([this.game.p,k],k.dusts,[I])),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3),this.resize()},a.prototype.levelStarted=function(){switch(t.animateToLevel(this.game.p.energy),k.move(ma),this.game.p.move(pa),this.game.p.stop(),this.game.p.setConvoMode(!1),this.state){case"intro":Da();break;case"nap":this.game.p.move(na),Ta.call(this);break;case"win":this.game.p.energy=1,Ea();break;case"post-listen":case"post-convo":wc.call(this),this.game.p.lastConvo=this.game.tstamp;}},a}(dc.default),sc=rc;function Pa(){c.visible=!1}function Qa(){if("play"===this.state)return!1;if(c.ani)return!0;switch(this.state){case"sleeping":Pa.call(this),this.state="play",this.handleInput("ArrowDown");break;case"post-convo":Pa.call(this),this.state="play",this.currentBuddy.lastConvo=this.game.tstamp;break;case"post-listen":Wb()&&(this.state="play",I.walk("right"),I.look("left"));break;case"intro":Da()&&(this.state="play");break;case"win":Ea(),0===Ia.length&&(this.state="game-over",qc=this.game.tstamp,Z.game=this.game,Z.size=Object.assign({},this.size),Z.dSize=Object.assign({},this.dSize),this.addDables([Z],3),t.animateToLevel(1));}return!0}function qa($){var a=$[0];return a?(c.visible=!0,c.setWords(a),c.aniText(this.game.tstamp),$.shift(),!1):(c.visible=!1,!0)}function wc(){var $=this;if(this.currentBuddy){var a=this.game.levels.convo.usedTopics.filter(function(a){return!$.game.p.skills.includes(a)}),e=a.length>0?a[J(a)]:null;c.visible=!0,e?(c.setWords(["nice convo!","you learned",e+"!"]),this.game.p.skills.push(e)):c.setWords(["nice convo!","that was a","good time!"]),c.aniText(this.game.tstamp)}}function xc(){c.move(this.game.boxPos()),c.updateSize(this.game.boxSize())}function Sa($){var a=this.iables.find(function(a){return a.tileIndex.x===$.x&&a.tileIndex.y===$.y});return a&&this.game.tstamp-a.lastConvo>1e3&&!c.visible?(this.currentBuddy=a,pa.x=this.game.p.pos.x,pa.y=this.game.p.pos.y,this.game.qLevel(this.game.levels.convo),!0):!!a}function Ta(){this.game.p.energy=1,t.animateToLevel(this.game.p.energy),c.setWords(["","zzzzzz...",""]),c.aniText(this.game.tstamp),c.visible=!0,this.state="sleeping"}function Ac($){$<0&&this.handleInput("ArrowUp"),$>0&&this.handleInput("ArrowDown")}function Bc($){$>0&&this.handleInput("ArrowRight"),$<0&&this.handleInput("ArrowLeft")}function G($){var a=Ma.find(function(a){return a!==$});return ja(a,Ma),a}function Dc(){var $;(I=new u.default(this.game)).move({x:7*b.TS,y:10*b.TS}),I.skills.push(b.LT,i[6]),I.look("up");var a=new u.default(this.game);a.move({x:8*b.TS,y:1*b.TS}),a.skills.push(i[0],G(i[0]));var e=new u.default(this.game);e.move({x:18*b.TS,y:3*b.TS}),e.skills.push(i[1],G(i[1]));var r=new u.default(this.game);r.move({x:25*b.TS,y:2*b.TS}),r.skills.push(i[2],G(i[2]));var t=new u.default(this.game);t.move({x:15*b.TS,y:18*b.TS}),t.skills.push(i[3],G(i[3])),t.look("up");var o=new u.default(this.game);o.move({x:26*b.TS,y:8*b.TS}),o.skills.push(i[4],G(i[4])),o.look("left"),(k=new u.default(this.game)).autoWalkDirection="left",k.skills.push(i[5],G(i[5])),k.a.walking.duration=600,(la=new u.default(this.game)).move({x:23*b.TS,y:18*b.TS}),la.look("left"),($=la.skills).push.apply($,i),Fa=[I,a,e,r,la,t,o,k]}function Ec(){if(this.game.tstamp-Oa.pressedAt>30)return!1;if(this.game.p.walking)return!1;var $=Object.assign({},this.game.p.tileIndex),a=null;switch(Oa.key){case"ArrowUp":a="up",$.y-=1;break;case"ArrowDown":a="down",$.y+=1;break;case"ArrowLeft":a="left",$.x-=1;break;case"ArrowRight":a="right",$.x+=1;break;default:return;}if(!Sa.call(this,$)){$.x===na.x/b.TS&&$.y===na.y/b.TS&&Ta.call(this);this.game.p.walk(a);return!0}}z.default=sc;var Z={alpha:0,dSize:{w:0,h:0},draw:function($){$.fillStyle=cc.default[0],$.globalAlpha=Math.min((this.game.tstamp-qc)/2e3,.8),$.fillRect(0,0,this.dSize.w,this.dSize.h)},game:null,pos:{x:0,y:0},size:{w:0,h:0},visible:!0};var M={},O=M&&M.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(M,"__esModule",{value:!0});var Ic,Jc,d,Lc=O(E),Mc=O(ia),Nc=O(B),Oc=O(A),Pc=O(z),Xa=5,Ya=16*b.TS*Xa,Sc=window.AudioContext||webkitAudioContext,vd=new Sc,g={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},Vc=!1,$a=null,_a=null,Yc=function(){function t(t){this.tstamp=0,this.ss=Xa,this.sf=1,this.nextAlpha=1,this.p=new Lc.default(this),this.p.skills.push("WEATHER"),this.canvas=t,ab.call(this),(d=t.getContext("2d",{alpha:!1})).mozImageSmoothingEnabled=!1,d.webkitImageSmoothingEnabled=!1,this.levels={convo:new Nc.default(this),startScreen:new Oc.default(this),world:new Pc.default(this)},this.c=new Mc.default(this)}return t.prototype.boxPos=function(){return{x:(this.canvas.width-this.boxSize().w*this.ss)/2,y:(this.canvas.height-this.boxSize().h*this.ss)/2}},t.prototype.boxSize=function(){return{h:3*b.LH+2*b.LS,w:12*b.LH}},t.prototype.inTr=function(){return g.running},t.prototype.update=function(t){Vc||(this.tstamp=t,cb.call(this,this.levels.startScreen),this.resize(),Vc=!0),this.tstamp=t,this.cl.update(t),this.inTr()&&bb.call(this,t)},t.prototype.draw=function(t){d&&this.c&&(this.c.updateShake(t),fd.call(this),cd.call(this,t),ed.call(this,t),this.inTr()&&bb.call(this,t))},t.prototype.resize=function(){var t=window.innerWidth/window.innerHeight;t>=1?Jc=(Ic=Ya)/t:Ic=(Jc=Ya)*t,this.canvas.width=Ic,this.canvas.height=Jc,this.c.size={w:this.canvas.width,h:this.canvas.height},ab.call(this),this.cl&&this.cl.resize()},t.prototype.pa=function(t,$){void 0===$&&($=1)},t.prototype.qLevel=function(t,$){if(t===this.levels.convo){var a=this.levels,e=a.convo,r=a.world;e.setBuddy(r.currentBuddy.copy())}$a=t,$&&($a.state=$),$c.call(this)},t.prototype.handleInput=function(t){this.cl.handleInput(t.key)},t.prototype.handleTouch=function(t){this.cl.handleTouch(t)},t.prototype.sizeInTiles=function(){return{w:Math.ceil(this.canvas.width/this.ss/b.TS),h:Math.ceil(this.canvas.height/this.ss/b.TS)}},t}(),Zc=Yc;function $c(){g.startTime=this.tstamp,g.running=!0,(_a=new Image).src=this.canvas.toDataURL("png"),cb.call(this,$a)}function ab(){this.sf=window.innerWidth/this.canvas.width}function bb(t){var $=(t-g.startTime)/g.duration;g.prevLevelScale=o(1,5,1,5,$),g.prevLevelAlpha=o(1,0,0,1,$),g.nextLevelAlpha=o(0,1,0,1,$),this.nextAlpha=g.nextLevelAlpha,$>=1&&(g.running=!1,_a=null)}function cb(t){this.cl=t,this.cl.levelWillStart(),this.cl.configViz(),this.cl.levelStarted()}function cd(t){var $=this,a=this.c.offset;if(this.cl.dables.forEach(function(e){e.forEach(function(e){if(e&&e.visible){var r=e.pos.x*$.ss+a.x,i=e.pos.y*$.ss+a.y;dd.call($,r,i,e.dSize)||(d.translate(r+.5|0,i+.5|0),d.globalAlpha=$.inTr()?g.nextLevelAlpha:1,e.draw(d,t),d.setTransform(1,0,0,1,0,0))}})}),d.globalAlpha=1,_a){d.globalAlpha=g.prevLevelAlpha;var e=g.prevLevelScale,r=(this.canvas.width*e-this.canvas.width)/2,i=(this.canvas.height*e-this.canvas.height)/2;d.drawImage(_a,-r,-i,this.canvas.width*e,this.canvas.height*e),d.globalAlpha=1}}function dd(t,$,a){return t+a.w<0||t>this.canvas.width||$+a.h<0||$>this.canvas.height}function ed(t){this.inTr()&&(d.globalAlpha=g.nextLevelAlpha),this.cl.odables.forEach(function($){$.visible&&$.draw(d,t)}),d.globalAlpha=1}function fd(){this.inTr()&&(d.globalAlpha=g.nextLevelAlpha),d.fillStyle=this.cl.bgColor,d.fillRect(0,0,this.canvas.width,this.canvas.height)}M.default=Zc;var ba={};Object.defineProperty(ba,"__esModule",{value:!0});function hd(t,$,e){var r=0,u=0;return function(a){for(r+=Math.min(a-u,10*b.MS),u=a;r>=t;)$.call(e,a),r-=t}}var id=hd;ba.default=id;var N={},eb=N&&N.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(N,"__esModule",{value:!0});var ld=eb(M),md=eb(ba),nd=document.getElementById("game"),q=new ld.default(nd),pd=md.default(b.MS,q.update,q),fb=null,rd=!1;function gb($){fb&&rd&&q.handleTouch(fb),pd($),q.draw($),requestAnimationFrame(gb)}function hb($){sa($),rd=!0}function sa($){$.preventDefault();var a=$;$.touches&&(a=$.changedTouches[0]),fb=a}function Za(){fb=null,rd=!1}requestAnimationFrame(gb),window.onresize=q.resize.bind(q),window.onkeydown=q.handleInput.bind(q),window.onmousedown=hb,window.ontouchstart=hb,window.onmouseup=Za,window.ontouchend=Za,window.addEventListener("onmousemove",sa,{passive:!1}),window.addEventListener("touchmove",sa,{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=N}else if(typeof define==="function"&&define.amd){define(function(){return N})}})();</script>