<html> <title>Convo IRL</title> <head> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"> </head> <body> <canvas id="game"></canvas> <style>*{height:100%;image-rendering:pixelated;image-rendering:optimizeSpeed;margin:0;padding:0;width:100%}</style> <script>parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {var b={};Object.defineProperty(b,"__esModule",{value:!0});var $a=8;b.TS=$a;var Wc=1/60;b.MS_PER=Wc;var Vc=8;b.L_SPACE=Vc;var Uc=120;b.T_TIME=Uc;var Sc=5;b.L_HEIGHT=Sc;var Qc="*LISTEN*";b.LISTEN=Qc;var e={};Object.defineProperty(e,"__esModule",{value:!0});function Mc(e,r){if(e.running)return!1;var $=r-e.startTime>e.minTimeDelta,o=e.percentChance>Math.random();return $&&o}var ea=Mc;function Ka(e,r,$){return(1-$)*e+$*r}e.shouldDoAnimation=ea;var A=Ka;function Lc(e,r,$){return Math.max(Math.min(e,$),r)}function aa(e,r,$,o,t){return Lc(Ka(e,r,t),$,o)}e.lerp=A;var D=aa;function Ic(){return 2*Math.round(Math.random())-1}e.clerp=D;var S=Ic;function Dc(e){return[].concat.apply([],e)}e.oneOrMinusOne=S;var R=Dc;function Cc(e){return Math.floor(Math.random()*e.length)}e.flatten=R;var w=Cc;function Bc(e,r){var $=r.indexOf(e);return $>-1&&(r.splice($,1),!0)}e.randomIndexFromArray=w;var ca=Bc;function xc(e,r,$,o){void 0===o&&(o=!1);var t=$,n=r;return o&&(t=r,n=$),e>=.5?aa(t,n,r,$,(e-.5)/.5):aa(n,t,r,$,e/.5)}e.removeElementFromArray=ca;var xa=xc;function wc(e){return new Array(b.TS).fill(null).map(function(){return new Array(b.TS).fill(e)})}e.twoPhaseClerp=xa;var Q=wc;function uc(e,r){var $;return function(){var o=arguments;$||(e.apply(this,o),$=!0,setTimeout(function(){return $=!1},r))}}e.singleColorTileArray=Q;var P=uc;e.throttle=P;var i={};Object.defineProperty(i,"__esModule",{value:!0});var tc=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];i.default=tc;var J={},sc=J&&J.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(J,"__esModule",{value:!0});var mc=sc(i),jc=function(){function t(t){this.size={width:1,height:1},this.pos={x:0,y:0},this.color=mc.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.drawingSize={height:this.size.height*this.game.ss,width:this.size.width*this.game.ss}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=D(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=D(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.drawingSize.width*e/2,-this.drawingSize.height*e/2,this.drawingSize.width*e,this.drawingSize.height*e)},t}(),ic=jc;J.default=ic;var v={},fc=v&&v.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(v,"__esModule",{value:!0});var bc=fc(J),$b=2,Yb=1,Xb=4,Ub=1,Tb=4,Sb=6,Ba=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],Rb=function(){function t(t){var i=this;this.pos={x:0,y:0},this.size={height:b.TS,width:b.TS},this.visible=!0,this.skills=[],this.a={},this.tileIndex={x:0,y:0},this.energy=1,this.talking=!1,this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.game=t;this.a.blinking={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},this.a.lookAway={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},this.a.walking={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:-1,y:-1},startTime:0,t:0},this.color=Ba[w(Ba)],this.dusts=Array.from(Array(50).keys()).map(function(){return new bc.default(i.game)}),this.drawingSize={height:b.TS*this.game.ss,width:b.TS*this.game.ss},this.squareSize=this.game.ss,this.rando=100*Math.random()}return Object.defineProperty(t.prototype,"walking",{get:function(){return this.a.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i.skills=this.skills,i},t.prototype.setConvoMode=function(t,i){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.ss,this.size.width=b.TS,this.size.height=b.TS,this.drawingSize.width=this.size.width*this.game.ss,this.drawingSize.height=this.size.height*this.game.ss,t?(this.squareSize*=2,this.size.width*=2,this.size.height*=2,this.drawingSize.width*=2,this.drawingSize.height*=2):this.talking=!1,this.convoLookRight="right"===i},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.floor(this.pos.x/b.TS),this.tileIndex.y=Math.floor(this.pos.y/b.TS)},t.prototype.look=function(t){this.walk(t,!0)},t.prototype.walk=function(t,i){void 0===i&&(i=!1);var a=this.pos,s=a.x,e=a.y;switch(t){case"left":this.rot=-Math.PI/2,s-=b.TS;break;case"right":this.rot=Math.PI/2,s+=b.TS;break;case"down":this.rot=Math.PI,e+=b.TS;break;case"up":this.rot=0,e-=b.TS;}if(!i&&!this.walking){var r={x:this.pos.x,y:this.pos.y},n={x:s,y:e};Hb.call(this,n)&&this.configureWalkingAnimation(r,n)}},t.prototype.configureWalkingAnimation=function(t,i){var a=this.a.walking;a.startTime=this.game.timestamp,a.endPos=i,a.startPos=t,a.running=!0,a.t=0},t.prototype.update=function(t){if(this.autoWalkDirection&&this.walk(this.autoWalkDirection),-1!==this.a.walking.startPos.x){var i=(t-this.a.walking.startTime)/this.a.walking.duration,a=A(this.a.walking.startPos.x,this.a.walking.endPos.x,i),s=A(this.a.walking.startPos.y,this.a.walking.endPos.y,i);this.a.walking.t=i,i>=1&&(a=this.a.walking.endPos.x,s=this.a.walking.endPos.y,this.a.walking.running=!1,this.a.walking.t=0),this.move({x:a,y:s})}},t.prototype.draw=function(t,i){var a=this.a.walking.t;t.translate(this.drawingSize.width/2,this.drawingSize.height/2),t.rotate(this.rot),t.translate(-this.drawingSize.width/2,-this.drawingSize.height/2),t.fillStyle=this.color;var s=a;if(a>.5&&(s=1-a),t.fillRect(0,0,this.drawingSize.width,this.drawingSize.height+this.drawingSize.height*s),Nb.call(this,i),Ja.call(this,t,"left",this.a.blinking.openness,this.a.lookAway.offset),Ja.call(this,t,"right",this.a.blinking.openness,this.a.lookAway.offset),this.talking){t.fillStyle="#000";var e=Math.sin(i/80+this.rando)+1;t.fillRect((this.convoLookRight?1:5)*this.squareSize,this.squareSize+e/4,2*this.squareSize+e,2*this.squareSize*e/2)}if(this.walking&&i-this.lastDustAt>30){var r=this.dusts.find(function(t){return!t.visible});if(r){var n=this.size.width/2*Math.random()+this.size.width/4,o=this.size.height/2*Math.random()+this.size.height/4,h=this.pos.x+n,$=this.pos.y+o;r.reJuice(i,h,$),this.lastDustAt=i}}},t}(),Qb=Rb;function Nb(t){var i=this.a,a=i.blinking,s=i.lookAway;ea(a,t)&&(a.running=!0,a.startTime=t),ea(s,t)&&(s.running=!0,s.startTime=t),Ib.call(this,a,t),Kb.call(this,s)}function Kb(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)}function Ib(t,i){var a=(i-t.startTime)/t.duration;t.openness=xa(a,0,1,!0),a>=1&&(t.running=!1)}function Ja(t,i,a,s){var e="left"===i?0:Xb*this.squareSize;t.fillStyle="#000";var r=Ub,n=0;this.inConvoMode&&(r=Tb),this.inConvoMode&&this.convoLookRight&&(n=Sb*this.squareSize);var o=r*this.squareSize,h=$b*this.squareSize,$=Yb*this.squareSize;t.fillRect(o+e-n,o,h,h*a),t.fillStyle="#fff",t.fillRect(o+e+s*this.squareSize-n,o,$,$*a)}function Hb(t){var i=this.game.currentLevel,a=t.x>=0&&t.x<=i.size.width-this.size.width&&t.y>=0&&t.y<i.size.height,s=t.x,e=t.y;return s/=b.TS,e/=b.TS,a&&i.tilesGrid[e][s].walkable}v.default=Qb;var ga={};Object.defineProperty(ga,"__esModule",{value:!0});var Gb=function(){function e(e){this.pos={x:0,y:0},this.size={width:0,height:0},this.game=e,this.size={width:e.canvas.width,height:e.canvas.height},this.shake={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:this.shake.pos.x+this.pos.x,y:this.shake.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y},e.prototype.moveToPlayer=function(e){this.pos.x=this.game.canvas.width/2-e.pos.x*this.game.ss-e.drawingSize.width/2,this.pos.y=this.game.canvas.height/2-e.pos.y*this.game.ss-e.drawingSize.height/2;var s=-1*(this.game.currentLevel.drawingSize.width-this.size.width),t=-1*(this.game.currentLevel.drawingSize.height-this.size.height);this.pos.x>0&&(this.pos.x=0),this.pos.x<s&&(this.pos.x=s),this.pos.y>0&&(this.pos.y=0),this.pos.y<t&&(this.pos.y=t)},e.prototype.shakeScreen=function(){this.shake.pos={x:0,y:0},this.shake.amplitude=10*this.game.ss,this.shake.dir.x=S(),this.shake.dir.y=S()},e.prototype.updateScreenShake=function(e){this.shake.amplitude*=.9;var s=this.shake,t=s.amplitude,i=s.dir;Math.abs(t)<=.01?(this.shake.pos.x=0,this.shake.pos.y=0):(this.shake.pos.x=Math.sin(e/50)*t*i.x,this.shake.pos.y=Math.sin(e/50)*t*i.y)},e}(),Bb=Gb;ga.default=Bb;var V={};Object.defineProperty(V,"__esModule",{value:!0});var a=null,zb={door:{canvas:null,colorMatrix:Q(0),interactable:!0},flowers:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},grass:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},green:{canvas:null,colorMatrix:Q(2)},house:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],tileLength:3*b.TS},sky:{canvas:null,colorMatrix:Q(9)},tree:{canvas:null,colorMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],walkable:!1},unwalkable:{canvas:null,visible:!1,walkable:!1}};V.default=zb;var I={},Ta=I&&I.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(I,"__esModule",{value:!0});var xb=Ta(i),g=Ta(V),wb=function(){function e(e,t,a,i){this.drawingSize={width:b.TS,height:b.TS},this.pos={x:0,y:0},this.size={width:b.TS,height:b.TS},this.walkable=!0,this.visible=!0,this.interactable=!1,this.tileLength=b.TS,this.game=e,this.pos={x:a*b.TS,y:i*b.TS},this.tileIndex={x:a,y:i},this.name=t,this.colorMatrix=g.default[t].colorMatrix,this.walkable=g.default[t].hasOwnProperty("walkable")?g.default[t].walkable:this.walkable,this.visible=g.default[t].hasOwnProperty("visible")?g.default[t].visible:this.visible,this.interactable=g.default[t].hasOwnProperty("interactable")?g.default[t].interactable:this.interactable,this.tileLength=g.default[t].hasOwnProperty("tileLength")?g.default[t].tileLength:this.tileLength,this.drawingSize={height:this.tileLength*this.game.ss,width:this.tileLength*this.game.ss},this.cacheOffscreenContext()}return Object.defineProperty(e.prototype,"offscreenCanvas",{get:function(){return g.default[this.name].canvas},enumerable:!0,configurable:!0}),e.prototype.draw=function(e){e.drawImage(this.offscreenCanvas,0,0)},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.drawingSize.width,t.height=this.drawingSize.height;var a=t.getContext("2d");R(this.colorMatrix).map(function(e){return xb.default[e]}).forEach(function(t,i){if(t){a.fillStyle=t;var r=e.game.ss*(i%e.tileLength),$=e.game.ss*Math.floor(i/e.tileLength);a.fillRect(r,$,e.game.ss,e.game.ss)}}),g.default[this.name].canvas=t},e}(),tb=wb;I.default=tb;var o={},ma=o&&o.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});var sb=ma(i),qb=ma(I),mb=function(){function e(e){this.tilesGrid=[],this.backgroundColor=sb.default[2],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.updateables.forEach(function(t){return t.update(e)})},e.prototype.configureDrawablesAndUpdateables=function(){this.clearDrawables(),this.clearOverlayDrawables(),this.clearUpdateables(),this.clearInteractables(),this.clearTouchables()},e.prototype.tileAtIndex=function(e){return this.tilesGrid[e.y][e.x]},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*b.TS,t=this.tileIndexes.length*b.TS;this.size={width:e,height:t},this.drawingSize={width:e*this.game.ss,height:t*this.game.ss};for(var a=0;a<this.tileIndexes.length;a++){this.tilesGrid.push(new Array(this.tileIndexes[a].length));for(var r=0;r<this.tileIndexes[a].length;r++){var i=this.tileTypeMap[this.tileIndexes[a][r]||0];this.tilesGrid[a][r]=new qb.default(this.game,i,r,a)}}this.tiles=R(this.tilesGrid)},e.prototype.addDrawables=function(e,t){var a;(a=this.drawables[t]).push.apply(a,e)},e.prototype.addOverlayDrawables=function(e){var t;(t=this.overlayDrawables).push.apply(t,e)},e.prototype.addUpdateables=function(e){var t;(t=this.updateables).push.apply(t,e)},e.prototype.addTouchables=function(e){var t;(t=this.touchables).push.apply(t,e)},e.prototype.addInteractables=function(e){var t;(t=this.interactables).push.apply(t,e)},e.prototype.clearDrawables=function(){this.drawables=new Array(3).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOverlayDrawables=function(){this.overlayDrawables=[]},e.prototype.clearUpdateables=function(){this.updateables=[]},e.prototype.clearInteractables=function(){this.interactables=[]},e.prototype.clearTouchables=function(){this.touchables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return w(t.tileTypeMap)})})},e.prototype.touchedTouchable=function(e){var t=this,a=20*this.game.scaleFactor,r=this.touchables.find(function(r){var i=Object.assign({},r.drawingSize),l=Object.assign({},r.pos);return i.width*=t.game.scaleFactor,i.height*=t.game.scaleFactor,l.x*=t.game.scaleFactor,l.y*=t.game.scaleFactor,e.clientX+a>=l.x&&e.clientX-a<=l.x+i.width&&e.clientY+a>=l.y&&e.clientY-a<=l.y+i.height});if(r&&r.visible)return r},e}(),jb=mb;o.default=jb;var $={};Object.defineProperty($,"__esModule",{value:!0});var ib={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]],"*":[[,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1]]};$.default=ib;var t={},ua=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var va=ua(i),hb=ua($),gb=function(){function t(t,e,s,i){void 0===s&&(s=va.default[1]),void 0===i&&(i={x:0,y:0}),this.words="",this.drawingSize={width:0,height:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.buddy=null,this.animations={},this.upToIndex=null,this.game=t,this.words=e.toUpperCase(),this.upToIndex=this.words.length,this.color=s,this.move(i),this.pixelLetters=this.words.split("").map(function(t){return hb.default[t]}),this.updateSize();this.animations.floatText={duration:3e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0}}return t.prototype.draw=function(t,e){var s=this.pos.x,i=this.game.transitioning()?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha,a=Math.floor(this.game.ss/2);t.globalAlpha=i;for(var o=0;o<this.upToIndex;o++){for(var r=this.pos.y,h=0,n=this.pixelLetters[o],l=0;l<n.length;l++){for(var p=n[l],$=0;$<p.length;$++)p[$]&&(this.shadow&&(t.fillStyle=va.default[0],t.fillRect(s+$*this.game.ss+a,r+a,this.game.ss,this.game.ss)),t.fillStyle=this.color,t.fillRect(s+$*this.game.ss,r,this.game.ss,this.game.ss));h=Math.max(h,p.length*this.game.ss),r=this.game.ss*(l+1)+this.pos.y}s+=this.game.ss+h}this.updateFloat(e)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=Math.floor(t.x),this.pos.y=Math.floor(t.y)},t.prototype.showUpToIndex=function(t){this.upToIndex=t},t.prototype.startFloat=function(t,e){this.animations.floatText.startTime=this.game.timestamp,this.animations.floatText.startPos={x:t.x,y:t.y-this.size.height},this.animations.floatText.endPos={x:e.x,y:e.y},this.animations.floatText.running=!0,this.move(this.animations.floatText.startPos)},t.prototype.update=function(t){this.updateFloat(t)},t.prototype.updateFloat=function(t){var e=this.animations.floatText;if(e.running){var s=(t-e.startTime)/e.duration,i=A(e.startPos.x,e.endPos.x,s);this.words!==b.LISTEN&&(i+=10*Math.sin(6*s*Math.PI));var a=A(e.startPos.y,e.endPos.y,s);s>=1&&(e.running=!1),this.alpha=1-s,this.move({x:i,y:a})}},t.prototype.updateSize=function(){var t=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,e){return t+e},0)+this.pixelLetters.length-1;this.size={width:t,height:b.L_HEIGHT},this.drawingSize={height:this.size.height*this.game.ss,width:this.size.width*this.game.ss}},t}(),fb=gb;t.default=fb;var n={},Aa=n&&n.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var T=Aa(i),cb=Aa(t),bb=function(){function t(t,i,e,o){void 0===o&&(o=T.default[8]),this.visible=!0,this.alpha=1,this.texts=[],this.startTime=null,this.game=t,this.pos=i,this.strokePos=i,this.color=o,this.updateSize(e),this.move(i)}return Object.defineProperty(t.prototype,"textLength",{get:function(){return this.texts.reduce(function(t,i){return t+i.words.length},0)},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,Fa.call(this)},t.prototype.updateSize=function(t){this.size={height:t.height,width:t.width},this.drawingSize={height:this.size.height*this.game.ss,width:this.size.width*this.game.ss}},t.prototype.draw=function(t,i){var e=this,o=this.game.transitioning()?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=o,t.fillStyle=this.color,t.fillRect(this.pos.x,this.pos.y,this.drawingSize.width,this.drawingSize.height),t.strokeStyle=T.default[1],t.fillStyle=T.default[1],t.lineWidth=this.game.ss,t.strokeRect(this.strokePos.x,this.strokePos.y,this.drawingSize.width,this.drawingSize.height);var s=new Array(this.texts.length).fill(0);if(this.startTime){var r=Math.min(Math.floor((i-this.startTime)/50),this.textLength);s=this.texts.map(function(t,i){var o=e.texts.slice(0,i).reduce(function(t,i){return i.words.length+t},0);return Math.min(r-o,t.words.length)})}this.texts.forEach(function(e,o){e.showUpToIndex(s[o]),e.draw(t,i)})},t.prototype.setWords=function(t){var i=this;this.texts=t.map(function(t){return new cb.default(i.game,t)}),Fa.call(this)},t.prototype.animateTextIn=function(t){this.startTime=t},t}(),ab=bb;function Fa(){var t=this;if(this.texts.length){var i=b.L_SPACE*this.game.ss,e=b.L_HEIGHT*this.game.ss,o=this.texts.length,s=o*e+(o-2)*i;this.texts.forEach(function(e,o){var r=Math.floor(t.pos.x+t.game.ss*(t.size.width-e.size.width)/2),h=Math.floor(t.pos.y+(t.drawingSize.height-s)/2+i*o);e.move({x:r,y:h})})}}n.default=ab;var E={},X=E&&E.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(E,"__esModule",{value:!0});var Ya=X(n),Z=X(i),Xa=X(t),Wa=function(){function e(e,t,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.animations={},this.game=e,this.energyText=new Xa.default(this.game,i,Z.default[7]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.drawingSize={height:(this.size.height+1)*this.game.ss,width:(this.size.width+1)*this.game.ss};var s={height:this.size.height+1,width:this.size.width+1};this.box=new Ya.default(e,t,s,Z.default[7]);this.animations.level={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.animations).map(function(t){return e.animations[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:Math.floor(e.x+this.game.ss/2+.5),y:Math.floor(e.y+this.game.ss/2+.5)})},e.prototype.draw=function(e,t){this.updateLevel(t),this.box.draw(e,t),e.fillStyle=Z.default[1],e.fillRect(this.pos.x,this.pos.y,this.drawingSize.width*this.percentFull,this.drawingSize.height),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.animations.level.startTime=this.game.timestamp,this.animations.level.startLevel=this.percentFull,this.animations.level.endLevel=e,this.animations.level.running=!0},e.prototype.updateLevel=function(e){if(this.animations.level.running){var t=(e-this.animations.level.startTime)/this.animations.level.duration,i=A(this.animations.level.startLevel,this.animations.level.endLevel,t);t>=1&&(i=this.animations.level.endLevel,this.animations.level.running=!1),this.percentFull=i}},e}(),Wb=Wa;E.default=Wb;var q={},Va=q&&q.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,a){$.__proto__=a}||function($,a){for(var r in a)a.hasOwnProperty(r)&&($[r]=a[r])};return function(a,r){function e(){this.constructor=a}$(a,r),a.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}}(),z=q&&q.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(q,"__esModule",{value:!0});var c,Ra,f,s,p,C,k,h,j,Za=z(o),Xc=z(n),_a=z(v),H=z(i),Da=z(E),N=z(t),db=4,eb=2,ya=3,O=.5,wa=0,x=0,qa=!1,kb=function($){function a(a){var r=$.call(this,a)||this;r.backgroundColor=H.default[9],r.tileTypeMap=["green","flowers","sky","tree"],k=new Da.default(r.game,{x:r.game.ss,y:r.game.ss},"ENERGY"),s=new Da.default(r.game,{x:r.game.ss,y:r.game.ss},"CONVO"),c=new Xc.default(r.game,{x:0,y:0},{height:0,width:0}),j=new N.default(r.game,"^"),C=new N.default(r.game,"_");var e=P(r.handleInput.bind(r),b.T_TIME);return r.handleInput=e,j.touched=function(){return r.handleInput("ArrowUp")},C.touched=function(){return r.handleInput("ArrowDown")},r}return Va(a,$),Object.defineProperty(a.prototype,"boxPosY",{get:function(){return c.pos.y/this.game.ss-this.game.player.size.height-db},enumerable:!0,configurable:!0}),a.prototype.handleInput=function($){switch($){case"ArrowUp":ba.call(this,1);break;case"ArrowDown":ba.call(this,-1);break;case"Enter":nb.call(this);}},a.prototype.handleTouch=function($){var a=this.touchedTouchable($);a&&a.touched()},a.prototype.setBuddy=function($){(f=$).setConvoMode(!0,"left")},a.prototype.levelWillStart=function(){var $=this;f||(this.setBuddy(new _a.default(this.game)),f.skills.push(b.LISTEN)),qa=!1,this.clearTouchables(),this.game.player.setConvoMode(!0,"right"),p=0,Ra=[this.game.player,f],(h=this.game.player.skills.map(function(a){return new N.default($.game,a)})).forEach(function(a){return a.touched=function(){h[x]===a&&$.handleInput("Enter")}})},a.prototype.levelStarted=function(){s.animateToLevel(p),k.animateToLevel(this.game.player.energy)},a.prototype.resize=function(){this.configureDrawablesAndUpdateables()},a.prototype.update=function(a){if($.prototype.update.call(this,a),this.game.camera.move({x:wa,y:0}),ja.call(this),yb.call(this),p>=1&&!s.animating&&0===ha(this.overlayDrawables).length){var r=1===f.skills.length?"post-listen":"post-convo";this.game.queueNextLevel(this.game.levels.world,r)}},a.prototype.configureDrawablesAndUpdateables=function(){$.prototype.configureDrawablesAndUpdateables.call(this);var a=this.game.sizeInTiles();wa=-a.width*b.TS*this.game.ss/2,a.width*=2,a.height*=2,vb.call(this),ja.call(this),ub.call(this),ba.call(this,0),this.generateTileIndexes(a),this.generateTiles(),this.addDrawables(this.tiles,0),this.addDrawables(Ra,1),this.addOverlayDrawables([c,j,C,k,s].concat(h)),this.addTouchables([j,C].concat(h))},a.prototype.generateTileIndexes=function($){var a=Math.min(this.game.player.tileIndex.y+1,$.height);this.tileIndexes=new Array($.height).fill(null).map(function(){return new Array($.width).fill(null).map(function(){return w([0,1])})});for(var r=0;r<a;r++)this.tileIndexes[r]=this.tileIndexes[r].map(function(){return 2});var e=this.tileIndexes[a-1];e&&(this.tileIndexes[a-1]=e.map(function(){return 3}))},a}(Za.default),lb=kb;function ba($){var a=h[x+$]||h[x];x=h.indexOf(a),C.alpha=1,j.alpha=1,h.forEach(function($){return $.alpha=O}),0===x&&(C.alpha=O),x===h.length-1&&(j.alpha=O)}function nb(){var $=this;if(!qa&&!(this.game.player.energy<=0||p>=1)){var a=x;ka.call(this,this.game.player,a),qa=!0,setTimeout(function(){return ob.call($,a)},2e3);var r=w(f.skills);1===this.game.player.skills.length&&(r=f.skills.indexOf(b.LISTEN)),setTimeout(function(){ka.call($,f,r)},4500)}}function ob($){if(!(p>=1)){var a=this.game.player.skills[$];"WEATHER"===a&&1===this.game.player.skills.length?(p+=.4,oa.call(this)):a===b.LISTEN?pb.call(this):f.skills.includes(a)?oa.call(this):rb.call(this),s.animateToLevel(p),k.animateToLevel(this.game.player.energy)}}function pb(){this.game.player.energy=Math.max(this.game.player.energy-.15,0)}function oa(){_.call(this,f,"cool!",H.default[2]),this.game.player.energy=Math.max(this.game.player.energy-.1,0),p=Math.min(p+.2,1)}function rb(){_.call(this,f,"oh...",H.default[10]),this.game.player.energy=Math.max(this.game.player.energy-.2,0),this.game.camera.shakeScreen()}function _($,a,r){var e=new N.default(this.game,a,r);e.buddy=$;var t=this.boxPosY*this.game.ss+this.game.player.drawingSize.height/2,o={x:c.pos.x+this.game.player.drawingSize.width/2,y:t},i={x:this.game.canvas.width,y:-b.L_HEIGHT};$!==this.game.player&&(o.x+=c.drawingSize.width-e.drawingSize.width-this.game.player.drawingSize.width,i.x=0),a===b.LISTEN&&(i.x=o.x),e.startFloat(o,i),this.addOverlayDrawables([e]),this.addUpdateables([e])}function ka($,a){if(!(p>=1)){var r=$.skills[a],e=r===b.LISTEN?H.default[9]:H.default[1];_.call(this,$,r,e),$===f&&(qa=!1)}}function ub(){var $=this.game.boxPos().x/this.game.ss-f.size.width/2-wa/this.game.ss,a=$+c.drawingSize.width/this.game.ss-f.size.width/2,r={x:$+this.game.player.size.width/2,y:this.boxPosY};f.move({x:a,y:r.y}),this.game.player.move(r)}function vb(){var $=this.game.canvas.height-this.game.boxSize().height*this.game.ss-2*this.game.ss;c.move({x:this.game.boxPos().x,y:$}),c.updateSize(this.game.boxSize());var a=k.drawingSize.width+s.drawingSize.width+ya*this.game.ss,r=(this.game.canvas.width-a)/2;k.move({x:Math.floor(r),y:Math.floor(k.pos.y)});var e=k.pos.x+k.drawingSize.width+ya*this.game.ss;s.move({x:Math.floor(e),y:Math.floor(s.pos.y)})}function ja(){var $=this,a=eb*this.game.ss,r=Math.floor(c.pos.x+c.drawingSize.width-j.drawingSize.width-a),e=Math.floor(c.pos.y+c.drawingSize.height/2-j.drawingSize.height/2),t=Math.floor(c.pos.x+a),o=Math.floor(e);j.move({x:r,y:e}),C.move({x:t,y:o}),h.forEach(function(a,r){var e=x-r;a.alpha=0!==e||qa?O:1;var t=Math.floor(c.pos.x+c.drawingSize.width/2-a.drawingSize.width/2),o=Math.floor(c.pos.y+c.drawingSize.height/2-a.drawingSize.height/2+e*b.L_SPACE*$.game.ss);a.move({x:t,y:o}),a.visible=!(Math.abs(e)>1)})}function ha($){return $.filter(function($){return $ instanceof N.default&&$.buddy})}function yb(){var $=ha(this.overlayDrawables);Ra.forEach(function(a){return a.talking=!!$.find(function($){return $.words!==b.LISTEN&&$.buddy===a})});for(var a=$.length-1;a>=0;a--){var r=$[a];if(!r)break;r.animations.floatText.running||(ca(r,this.overlayDrawables),this.updateables.splice(a,1))}}q.default=lb;var r={},Ab=r&&r.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),Na=r&&r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var Cb=Na(n),Db=Na(o),Eb=function(e){function t(t){var r=e.call(this,t)||this;return r.panDirection=1,r.tileTypeMap=["green","flowers","grass","tree"],r.box=new Cb.default(r.game,{x:0,y:0},{height:0,width:0}),r.box.setWords(["CONVO IRL","","TAP TO PLAY"]),r}return Ab(t,e),t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.game.camera.pos.x-=.05*this.panDirection,this.game.camera.pos.x<-this.game.canvas.width&&(this.panDirection=-1),this.game.camera.pos.x>0&&(this.panDirection=1)},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this);var t=this.game.sizeInTiles();t.width*=2,t.height*=2,this.generateTileIndexes(t),this.generateTiles(),this.moveText(),this.addDrawables(this.tiles,0),this.box.animateTextIn(this.game.timestamp),this.addOverlayDrawables([this.box])},t.prototype.handleInput=function(){this.game.transitioning()||this.game.queueNextLevel(this.game.levels.world)},t.prototype.handleTouch=function(){this.handleInput()},t.prototype.moveText=function(){this.box.move(this.game.boxPos()),this.box.updateSize(this.game.boxSize())},t}(Db.default),Fb=Eb;r.default=Fb;var U,L={};!function(t,e){"function"==typeof U&&U.amd?U(["exports"],e):"object"==typeof L&&"string"!=typeof L.nodeName?e(L):e(t.TinyMusic={})}(L,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),s=/^[0-9.]+$/,i=/\s+/,o=/(\d+)/,n={};function r(t){var e=t.split(i);this.frequency=r.getFrequency(e[0])||0,this.duration=r.getDuration(e[1])||0}function c(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),r.getFrequency=function(t){var s=t.split(o),i=n[s[0]],r=(s[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,r)},r.getDuration=function(t){return s.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,s){(s=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",s.frequency.value=e[1],t.connect(t=s)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof r?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},c.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},c.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sequence=c});var u={},Jb=u&&u.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),G=u&&u.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(u,"__esModule",{value:!0});var Lb=G(o),Mb=G(n),m=G(v),Ob=G(E),Pb=G(L),Ea=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],Ca=[["keep at it","to make","new friends!"],["and if you are","low on energy","take a nap!"]],da={x:18*b.TS,y:7*b.TS},l=["PASTRIES","FRANCE","SPORTS","ANIME","BOOKS","MATH"],W=l.slice(),Vb=function(e){function t(t){var a=e.call(this,t)||this;a.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],a.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,3,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,3,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,3,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,3,,2,,3,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],a.playerSpawnPosition={x:4*b.TS,y:6*b.TS},a.inputBuffer={pressedAt:0,key:null},a.state="intro";var r=P(a.handleTouch.bind(a),b.T_TIME),i=P(a.handleInput.bind(a),b.T_TIME);return a.handleTouch=r,a.handleInput=i,a.generateTiles(),a.energyBar=new Ob.default(a.game,{x:0,y:t.ss},"ENERGY"),a.box=new Mb.default(a.game,a.game.boxPos(),a.game.boxSize()),gc.call(a),a}return Jb(t,e),t.prototype.handleInput=function(e){this.game.transitioning()||ra.call(this)||(this.inputBuffer={pressedAt:this.game.timestamp,key:e})},t.prototype.handleTouch=function(e){if(!this.game.transitioning()&&!this.game.player.walking&&!ra.call(this)){var t=this.game.camera,a=t.size,r=a.height,i=a.width,$=t.offset,s=e.clientX*i/window.innerWidth-$.x,o=e.clientY*r/window.innerHeight-$.y,n=s-this.game.player.pos.x*this.game.ss,y=o-this.game.player.pos.y*this.game.ss,l=Math.abs(n),h=Math.abs(y),d=this.game.ss*b.TS/2;l<d&&h<d||(l>h?ec.call(this,n):dc.call(this,y))}},t.prototype.resize=function(){var e=Math.floor((this.game.canvas.width-this.energyBar.drawingSize.width)/2);this.energyBar.move({x:e,y:this.energyBar.pos.y}),ac.call(this)},t.prototype.update=function(t){e.prototype.update.call(this,t),hc.call(this),na.call(this,this.game.player.tileIndex),this.game.camera.moveToPlayer(this.game.player),this.walkingBuddy.pos.x<=da.x-5*b.TS&&(this.walkingBuddy.autoWalkDirection="right"),this.walkingBuddy.pos.x>=da.x+5*b.TS&&(this.walkingBuddy.autoWalkDirection="left")},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.addDrawables(this.tiles,0),this.addDrawables(this.game.player.dusts,1),this.addDrawables(this.walkingBuddy.dusts,1),this.addDrawables([this.game.player],2),this.addDrawables(this.buddies,2),this.addOverlayDrawables([this.energyBar,this.box]),this.addInteractables(this.buddies),this.addUpdateables(this.game.player.dusts.concat([this.game.player,this.walkingBuddy],this.walkingBuddy.dusts,[this.listenBuddy])),this.resize()},t.prototype.levelStarted=function(){this.energyBar.animateToLevel(this.game.player.energy),this.walkingBuddy.move(da),this.game.player.move(this.playerSpawnPosition),this.game.player.setConvoMode(!1),pa.call(this),_b.call(this);var e=new(window.AudioContext||webkitAudioContext);new Pb.default.Sequence(e,120,["G2 q","G3 q","G4 q"]).loop=!1},t}(Lb.default),Ua=Vb;function sa(){this.box.visible=!1}function ra(){if("play"===this.state)return!1;switch(this.state){case"sleeping":sa.call(this),this.state="play",this.handleInput("ArrowDown");break;case"post-convo":sa.call(this),this.state="play";break;case"post-listen":Zb.call(this);break;case"intro":pa.call(this);}return!0}function Zb(){var e=Ca[0];if(!e)return this.state="play",this.box.visible=!1,this.listenBuddy.walk("right"),void this.listenBuddy.look("left");this.box.visible=!0,this.box.setWords(e),this.box.animateTextIn(this.game.timestamp),Ca.shift()}function pa(){if("intro"===this.state){var e=Ea[0];if(!e)return this.state="play",void(this.box.visible=!1);this.box.visible=!0,this.box.setWords(e),this.box.animateTextIn(this.game.timestamp),Ea.shift()}}function _b(){if(this.currentBuddy){var e=this.currentBuddy.skills[w(this.currentBuddy.skills)];this.box.visible=!0,this.game.player.skills.includes(e)?this.box.setWords(["nice convo!","that was a","good time"]):(this.box.setWords(["nice convo!","you learned",e+"!"]),this.game.player.skills.push(e)),this.box.animateTextIn(this.game.timestamp)}}function ac(){this.box.move(this.game.boxPos()),this.box.updateSize(this.game.boxSize())}function na(e){var t=this.interactables.find(function(t){return t.tileIndex.x===e.x&&t.tileIndex.y===e.y});return!!t&&(this.currentBuddy=t,this.playerSpawnPosition.x=this.game.player.pos.x,this.playerSpawnPosition.y=this.game.player.pos.y,this.game.queueNextLevel(this.game.levels.convo),!0)}function cc(){this.game.player.energy=1,this.energyBar.animateToLevel(this.game.player.energy),this.box.setWords(["","zzzzzz...",""]),this.box.animateTextIn(this.game.timestamp),this.box.visible=!0,this.state="sleeping"}function dc(e){e<0&&this.handleInput("ArrowUp"),e>0&&this.handleInput("ArrowDown")}function ec(e){e>0&&this.handleInput("ArrowRight"),e<0&&this.handleInput("ArrowLeft")}function F(){var e=W[w(W)];return ca(e,W),e}function gc(){var e;this.listenBuddy=new m.default(this.game),this.listenBuddy.move({x:7*b.TS,y:10*b.TS}),this.listenBuddy.skills.push(b.LISTEN),this.listenBuddy.look("up");var t=new m.default(this.game);t.move({x:8*b.TS,y:1*b.TS}),t.skills.push(l[0],F());var a=new m.default(this.game);a.move({x:18*b.TS,y:3*b.TS}),a.skills.push(l[1],F());var r=new m.default(this.game);r.move({x:25*b.TS,y:2*b.TS}),r.skills.push(l[2],F());var i=new m.default(this.game);i.move({x:15*b.TS,y:18*b.TS}),i.skills.push(l[3],F()),i.look("up");var $=new m.default(this.game);$.move({x:26*b.TS,y:8*b.TS}),$.skills.push(l[4],F()),$.look("left"),this.walkingBuddy=new m.default(this.game),this.walkingBuddy.autoWalkDirection="left",this.walkingBuddy.skills.push(l[5],F()),this.walkingBuddy.a.walking.duration=600,this.specialBuddy=new m.default(this.game),this.specialBuddy.move({x:23*b.TS,y:18*b.TS}),this.specialBuddy.look("left"),(e=this.specialBuddy.skills).push.apply(e,l),this.buddies=[this.listenBuddy,t,a,r,this.specialBuddy,i,$,this.walkingBuddy]}function hc(){if(this.game.timestamp-this.inputBuffer.pressedAt>50)return!1;if(this.game.player.walking)return!1;var e=Object.assign({},this.game.player.tileIndex),t=null;switch(this.inputBuffer.key){case"ArrowUp":t="up",e.y-=1;break;case"ArrowDown":t="down",e.y+=1;break;case"ArrowLeft":t="left",e.x-=1;break;case"ArrowRight":t="right",e.x+=1;}return na.call(this,e)?void 0:(this.tileAtIndex(e).interactable&&cc.call(this),this.game.player.walk(t),!0)}u.default=Ua;var M={},K=M&&M.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(M,"__esModule",{value:!0});var kc,lc,d,nc=K(v),oc=K(ga),pc=K(q),qc=K(r),rc=K(u),Oa=5,La=16*b.TS*Oa,Ha={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},vc=!1,za=null,ta=null,yc=function(){function t(t){this.timestamp=0,this.ss=Oa,this.scaleFactor=1,this.player=new nc.default(this),this.player.skills.push("WEATHER"),this.canvas=t,ia.call(this),(d=t.getContext("2d",{alpha:!1})).mozImageSmoothingEnabled=!1,d.webkitImageSmoothingEnabled=!1,this.levels={convo:new pc.default(this),startScreen:new qc.default(this),world:new rc.default(this)},this.transition=Object.assign({},Ha),this.camera=new oc.default(this)}return t.prototype.boxPos=function(){return{x:(this.canvas.width-this.boxSize().width*this.ss)/2,y:(this.canvas.height-this.boxSize().height*this.ss)/2}},t.prototype.boxSize=function(){return{height:3*b.L_HEIGHT+2*b.L_SPACE,width:12*b.L_HEIGHT}},t.prototype.transitioning=function(){return this.transition.running},t.prototype.boot=function(t){this.timestamp=t,Ma.call(this,this.levels.startScreen)},t.prototype.update=function(t){vc||(this.boot(t),this.resize(),vc=!0),this.timestamp=t,this.currentLevel.update(t),this.transitioning()&&Qa.call(this,t)},t.prototype.draw=function(t){d&&this.camera&&(this.camera.updateScreenShake(t),Hc.call(this),Ec.call(this,t),Gc.call(this,t),this.transitioning()&&Qa.call(this,t))},t.prototype.resize=function(){var t=window.innerWidth/window.innerHeight;t>=1?lc=(kc=La)/t:kc=(lc=La)*t,this.canvas.width=kc,this.canvas.height=lc,this.camera.size={width:this.canvas.width,height:this.canvas.height},ia.call(this),this.currentLevel&&this.currentLevel.resize()},t.prototype.queueNextLevel=function(t,e){if(t===this.levels.convo){var a=this.levels,r=a.convo,$=a.world;r.setBuddy($.currentBuddy.copy())}za=t,e&&(za.state=e),Ac.call(this)},t.prototype.handleInput=function(t){this.currentLevel.handleInput(t)},t.prototype.handleTouch=function(t){this.currentLevel.handleTouch(t)},t.prototype.sizeInTiles=function(){return{width:Math.ceil(this.canvas.width/this.ss/b.TS),height:Math.ceil(this.canvas.height/this.ss/b.TS)}},t}(),zc=yc;function Ac(){this.transition.startTime=this.timestamp,this.transition.running=!0,(ta=new Image).src=this.canvas.toDataURL("png"),Ma.call(this,za)}function ia(){this.scaleFactor=window.innerWidth/this.canvas.width}function Qa(t){var e=(t-this.transition.startTime)/this.transition.duration;this.transition.prevLevelScale=D(1,5,1,5,e),this.transition.prevLevelAlpha=D(1,0,0,1,e),this.transition.nextLevelAlpha=D(0,1,0,1,e),e>=1&&(this.transition=Object.assign({},Ha),ta=null)}function Ma(t){this.currentLevel=t,this.currentLevel.levelWillStart(),this.currentLevel.configureDrawablesAndUpdateables(),this.currentLevel.levelStarted()}function Ec(t){var e=this,a=this.camera.offset;if(this.currentLevel.drawables.forEach(function(r){r.forEach(function(r){if(r&&r.visible){var $=r.pos.x*e.ss+a.x,i=r.pos.y*e.ss+a.y;Fc.call(e,$,i,r.drawingSize)||(d.translate($+.5|0,i+.5|0),d.globalAlpha=e.transitioning()?e.transition.nextLevelAlpha:1,r.draw(d,t),d.setTransform(1,0,0,1,0,0))}})}),d.globalAlpha=1,ta){d.globalAlpha=this.transition.prevLevelAlpha;var r=this.transition.prevLevelScale,$=(this.canvas.width*r-this.canvas.width)/2,i=(this.canvas.height*r-this.canvas.height)/2;d.drawImage(ta,-$,-i,this.canvas.width*r,this.canvas.height*r),d.globalAlpha=1}}function Fc(t,e,a){return t+a.width<0||t>this.canvas.width||e+a.height<0||e>this.canvas.height}function Gc(t){this.transitioning()&&(d.globalAlpha=this.transition.nextLevelAlpha),this.currentLevel.overlayDrawables.forEach(function(e){e.visible&&e.draw(d,t)}),d.globalAlpha=1}function Hc(){this.transitioning()&&(d.globalAlpha=this.transition.nextLevelAlpha),d.fillStyle=this.currentLevel.backgroundColor,d.fillRect(0,0,this.canvas.width,this.canvas.height)}M.default=zc;var Y={};Object.defineProperty(Y,"__esModule",{value:!0});function Jc(t,$,e){var r=0,u=0;return function(a){for(r+=Math.min(a-u,10*b.MS_PER),u=a;r>=t;)$.call(e,a),r-=t}}var Kc=Jc;Y.default=Kc;var B={},Ga=B&&B.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(B,"__esModule",{value:!0});var Nc=Ga(M),Oc=Ga(Y),Pc=document.getElementById("game"),y=new Nc.default(Pc),Rc=Oc.default(b.MS_PER,y.update,y),Pa=null,Tc=!1;function Ia($){Pa&&Tc&&y.handleTouch(Pa),Rc($),y.draw($),requestAnimationFrame(Ia)}function la($){fa($),Tc=!0}function fa($){var e=$;$.touches&&(e=$.changedTouches[0]),Pa=e}function Sa(){Pa=null,Tc=!1}requestAnimationFrame(Ia),window.addEventListener("resize",function(){return y.resize()}),window.addEventListener("keydown",function($){return y.handleInput($.key)}),window.addEventListener("mousedown",la,!1),window.addEventListener("touchstart",la,!1),window.addEventListener("mouseup",Sa,!1),window.addEventListener("touchend",Sa,!1),window.addEventListener("mousemove",fa,!1),window.addEventListener("touchmove",fa,!1),document.body.addEventListener("touchmove",function($){return $.preventDefault()},{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=B}else if(typeof define==="function"&&define.amd){define(function(){return B})}return{"9B6d":B};});</script> </body> </html>