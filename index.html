<html> <title>Convo IRL</title> <head> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"> </head> <body> <canvas id="game"></canvas> <style>body,html{margin:0;padding:0}#game,body,html{height:100%;width:100%}#game{image-rendering:pixelated;image-rendering:optimizeSpeed;z-index:2}</style> <script>parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {var b={};Object.defineProperty(b,"__esModule",{value:!0});var Ua=8;b.TILE_SIZE=Ua;var Lc=b.TILE_SIZE/2;b.HALF_TILE_SIZE=Lc;var Kc=5;b.SQUARE_SIZE=Kc;var Jc=1/60;b.MS_PER_UPDATE=Jc;var Hc=16;b.NUM_TILES_ON_LONG_SIDE=Hc;var Gc=750;b.BLINK_DURATION=Gc;var Ec=8;b.LINE_HEIGHT=Ec;var Bc=.5;b.DISABLED_ALPHA=Bc;var Ac=120;b.THROTTLE_TIME=Ac;var zc=5;b.LETTER_HEIGHT=zc;var d={};Object.defineProperty(d,"__esModule",{value:!0});function yc(e,r,$){var o=r.x>=0&&r.x<=$.size.width-e.size.width&&r.y>=0&&r.y<$.size.height,n=r.x,t=r.y;n/=b.TILE_SIZE,t/=b.TILE_SIZE;var a=$.tilesGrid[t][n].walkable;return o&&a}var U=yc;function sc(e,r){if(e.running)return!1;var $=r-e.startTime>e.minTimeDelta,o=e.percentChance>Math.random();return $&&o}d.canThingMoveToPosition=U;var R=sc;function Z(e,r,$){return(1-$)*e+$*r}d.shouldDoAnimation=R;var v=Z;function rc(e,r,$){return Math.max(Math.min(e,$),r)}function Q(e,r,$,o,n){return rc(Z(e,r,n),$,o)}d.lerp=v;var s=Q;function nc(){return 2*Math.round(Math.random())-1}d.clerp=s;var N=nc;function kc(e){return[].concat.apply([],e)}d.oneOrMinusOne=N;var K=kc;function fc(e){return e[Math.floor(Math.random()*e.length)]}d.flatten=K;var fa=fc;function ec(e){return Math.floor(Math.random()*e.length)}d.randomElementFromArray=fa;var I=ec;function _b(e,r,$,o){void 0===o&&(o=!1);var n=$,t=r;return o&&(n=r,t=$),e>=.5?Q(n,t,r,$,(e-.5)/.5):Q(t,n,r,$,e/.5)}d.randomIndexFromArray=I;var oa=_b;function $b(e){return new Array(b.TILE_SIZE).fill(null).map(function(){return new Array(b.TILE_SIZE).fill(e)})}d.twoPhaseClerp=oa;var B=$b;function Zb(e,r){var $;return function(){var o=arguments;$||(e.apply(this,o),$=!0,setTimeout(function(){return $=!1},r))}}d.singleColorTileArray=B;var A=Zb;d.throttle=A;var M={};Object.defineProperty(M,"__esModule",{value:!0});var Rb=.9,Pb=10,Ob=.01,Nb=function(){function e(e){this.pos={x:0,y:0},this.size={width:0,height:0},this.game=e,this.player=e.player,this.size={width:e.canvas.width,height:e.canvas.height},this.shake={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:this.shake.pos.x+this.pos.x,y:this.shake.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=this.game.canvas.width/2-e.pos.x*this.game.squareSize-e.drawingSize.width/2,this.pos.y=this.game.canvas.height/2-e.pos.y*this.game.squareSize-e.drawingSize.height/2;var s=-1*(this.game.currentLevel.drawingSize.width-this.size.width),t=-1*(this.game.currentLevel.drawingSize.height-this.size.height);this.pos.x>0&&(this.pos.x=0),this.pos.x<s&&(this.pos.x=s),this.pos.y>0&&(this.pos.y=0),this.pos.y<t&&(this.pos.y=t)},e.prototype.shakeScreen=function(){this.shake.pos={x:0,y:0},this.shake.amplitude=Pb*this.game.squareSize,this.shake.dir.x=N(),this.shake.dir.y=N()},e.prototype.updateScreenShake=function(e){this.shake.amplitude*=Rb;var s=this.shake,t=s.amplitude,i=s.dir;Math.abs(t)<=Ob?(this.shake.pos.x=0,this.shake.pos.y=0):(this.shake.pos.x=Math.sin(e/50)*t*i.x,this.shake.pos.y=Math.sin(e/50)*t*i.y)},e}(),Ca=Nb;M.default=Ca;var k={};Object.defineProperty(k,"__esModule",{value:!0});var Fb={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},sa=Fb;k.blinking=sa;var Cb={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},va=Cb;k.lookAway=va;var Bb={duration:200,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0},ya=Bb;k.walking=ya;var zb={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},Ba=zb;k.animateEnergy=Ba;var xb={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},W=xb;k.transition=W;var wb={duration:1500,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0},_=wb;k.floatText=_;var e={};Object.defineProperty(e,"__esModule",{value:!0});var vb=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff"];e.default=vb;var u={},rb=u&&u.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(u,"__esModule",{value:!0});var pb=rb(e),kb=1400,ga=1,ha=3,ia=.3,ib=function(){function t(t){this.size={width:1,height:1},this.pos={x:0,y:0},this.color=pb.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize}}return t.prototype.reJuice=function(t,e,r){this.pos.x=e,this.pos.y=r,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/kb,this.visible=!(this.percentGrown>=1),this.alpha=s(ia,0,0,ia,this.percentGrown))},t.prototype.draw=function(t,e){var r=s(ga,ha,ga,ha,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.drawingSize.width*r/2,-this.drawingSize.height*r/2,this.drawingSize.width*r,this.drawingSize.height*r)},t}(),hb=ib;u.default=hb;var l={},db=l&&l.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(l,"__esModule",{value:!0});var cb=db(u),bb=2,$a=1,Xa="rgb(255, 255, 255)",Wa="rgb(0, 0, 0)",Va=4,Ta=1,Na=4,Ma=6,Ja=50,Ha=30,Ga=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],za="left",Ea="right",Hb=function(){function t(t){var i=this;this.drawingSize={width:b.TILE_SIZE,height:b.TILE_SIZE},this.pos={x:b.TILE_SIZE,y:b.TILE_SIZE},this.size={width:b.TILE_SIZE,height:b.TILE_SIZE},this.visible=!0,this.skills=["weather","sports","pastries","france","cats"],this.tileIndex={x:0,y:0},this.interactableType="buddy",this.energy=1,this.animations={},this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.squareSize=b.SQUARE_SIZE,this.game=t,this.animations.blinking=Object.assign({},sa),this.animations.walking=Object.assign({},ya,{endPos:this.pos}),this.animations.lookAway=Object.assign({},va),this.color=fa(Ga),this.dusts=Array.from(Array(Ja).keys()).map(function(){return new cb.default(i.game)}),this.drawingSize.width=b.TILE_SIZE*this.game.squareSize,this.drawingSize.height=b.TILE_SIZE*this.game.squareSize,this.squareSize=this.game.squareSize}return Object.defineProperty(t.prototype,"blinking",{get:function(){return this.animations.blinking.running},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"walking",{get:function(){return this.animations.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i},t.prototype.setConvoMode=function(t){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.squareSize,this.size.width=b.TILE_SIZE,this.size.height=b.TILE_SIZE,this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize,t&&(this.squareSize*=2,this.size.width*=2,this.size.height*=2,this.drawingSize.width*=2,this.drawingSize.height*=2)},t.prototype.convoLook=function(t){"right"===t?this.convoLookRight=!0:"left"===t&&(this.convoLookRight=!1)},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.ceil(this.pos.x/b.TILE_SIZE),this.tileIndex.y=Math.ceil(this.pos.y/b.TILE_SIZE)},t.prototype.walk=function(t){var i=this.pos,a=i.x,n=i.y;"left"===t?(this.rot=-Math.PI/2,a-=this.game.tileSize):"right"===t?(this.rot=Math.PI/2,a+=this.game.tileSize):"down"===t?(this.rot=Math.PI,n+=this.game.tileSize):"up"===t&&(this.rot=0,n-=this.game.tileSize);var e={x:this.pos.x,y:this.pos.y},s={x:a,y:n};U(this,s,this.game.currentLevel)&&this.configureWalkingAnimation(e,s)},t.prototype.configureWalkingAnimation=function(t,i){this.animations.walking.startTime=this.game.timestamp,this.animations.walking.endPos=i,this.animations.walking.startPos=t,this.animations.walking.running=!0},t.prototype.updateWalkingPosition=function(t){if(this.walking){var i=(t-this.animations.walking.startTime)/this.animations.walking.duration,a=v(this.animations.walking.startPos.x,this.animations.walking.endPos.x,i),n=v(this.animations.walking.startPos.y,this.animations.walking.endPos.y,i);i>=1&&(a=this.animations.walking.endPos.x,n=this.animations.walking.endPos.y,this.animations.walking.running=!1),this.move({x:a,y:n})}},t.prototype.draw=function(t,i){if(this.updateWalkingPosition(i),t.translate(this.drawingSize.width/2,this.drawingSize.height/2),t.rotate(this.rot),t.translate(-this.drawingSize.width/2,-this.drawingSize.height/2),t.fillStyle=this.color,t.fillRect(0,0,this.drawingSize.width,this.drawingSize.height),this.maybeDoEyeAnimations(i),this.drawEye(t,za,this.animations.blinking.openness,this.animations.lookAway.offset),this.drawEye(t,Ea,this.animations.blinking.openness,this.animations.lookAway.offset),this.walking&&i-this.lastDustAt>Ha){var a=this.dusts.find(function(t){return!t.visible});if(a){var n=this.size.width/2*Math.random()+this.size.width/4,e=this.size.height/2*Math.random()+this.size.height/4,s=this.pos.x+n,o=this.pos.y+e;a.reJuice(i,s,o),this.lastDustAt=i}}t.setTransform(1,0,0,1,0,0)},t.prototype.maybeDoEyeAnimations=function(t){var i=this.animations,a=i.blinking,n=i.lookAway;R(a,t)&&(a.running=!0,a.startTime=t),R(n,t)&&(n.running=!0,n.startTime=t),this.runBlinkingAnimation(a,t),this.runLookAwayAnimation(n)},t.prototype.runLookAwayAnimation=function(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)},t.prototype.runBlinkingAnimation=function(t,i){var a=(i-t.startTime)/t.duration;t.openness=oa(a,0,1,!0),a>=1&&(t.running=!1)},t.prototype.drawEye=function(t,i,a,n){var e=i===za?0:Va*this.squareSize;t.fillStyle=Wa;var s=Ta,o=0;this.inConvoMode&&(s=Na),this.inConvoMode&&this.convoLookRight&&(o=Ma*this.squareSize);var r=s*this.squareSize,$=bb*this.squareSize,h=$a*this.squareSize;t.fillRect(r+e-o,r,$,$*a),t.fillStyle=Xa,t.fillRect(r+e+n*this.squareSize-o,r,h,h*a)},t}(),Da=Hb;l.default=Da;var X={};Object.defineProperty(X,"__esModule",{value:!0});var a=null,Fa={door:{canvas:null,colorMatrix:B(0),interactable:!0},flowers:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},grass:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},green:{canvas:null,colorMatrix:B(2)},house:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],tileLength:3*b.TILE_SIZE},sky:{canvas:null,colorMatrix:B(9)},tree:{canvas:null,colorMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],walkable:!1},unwalkable:{canvas:null,visible:!1,walkable:!1}};X.default=Fa;var w={},xa=w&&w.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0});var Ia=xa(e),f=xa(X),Ka=function(){function e(e,t,a,i){this.drawingSize={width:b.TILE_SIZE,height:b.TILE_SIZE},this.pos={x:0,y:0},this.alpha=1,this.size={width:b.TILE_SIZE,height:b.TILE_SIZE},this.walkable=!0,this.visible=!0,this.interactable=!1,this.interactableType="Tile",this.tileLength=b.TILE_SIZE,this.colorMatrix=[[]],this.game=e,this.pos={x:a*b.TILE_SIZE,y:i*b.TILE_SIZE},this.tileIndex={x:a,y:i},this.name=t,this.colorMatrix=f.default[t].colorMatrix,this.walkable=f.default[t].hasOwnProperty("walkable")?f.default[t].walkable:this.walkable,this.visible=f.default[t].hasOwnProperty("visible")?f.default[t].visible:this.visible,this.interactable=f.default[t].hasOwnProperty("interactable")?f.default[t].interactable:this.interactable,this.tileLength=f.default[t].hasOwnProperty("tileLength")?f.default[t].tileLength:this.tileLength,this.drawingSize={height:this.tileLength*this.game.squareSize,width:this.tileLength*this.game.squareSize},this.cacheOffscreenContext()}return Object.defineProperty(e.prototype,"offscreenCanvas",{get:function(){return f.default[this.name].canvas},enumerable:!0,configurable:!0}),e.prototype.draw=function(e){e.drawImage(this.offscreenCanvas,0,0)},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.drawingSize.width,t.height=this.drawingSize.height;var a=t.getContext("2d");K(this.colorMatrix).map(function(e){return Ia.default[e]}).forEach(function(t,i){if(t){a.fillStyle=t;var r=e.game.squareSize*(i%e.tileLength),$=e.game.squareSize*Math.floor(i/e.tileLength);a.fillRect(r,$,e.game.squareSize,e.game.squareSize)}}),f.default[this.name].canvas=t},e}(),La=Ka;w.default=La;var o={},ua=o&&o.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});var Oa=ua(e),Pa=ua(w),Qa=5,Ra=function(){function e(e){this.overlayDrawables=[],this.updateables=[],this.interactables=[],this.touchables=[],this.backgroundColor=Oa.default[2],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.updateables.forEach(function(t){return t.update(e)})},e.prototype.configureDrawablesAndUpdateables=function(){this.clearDrawables(),this.clearOverlayDrawables(),this.clearUpdateables(),this.clearInteractables(),this.clearTouchables()},e.prototype.tileAtIndex=function(e){return this.tilesGrid[e.y][e.x]},e.prototype.generateTiles=function(){var e=this,t=this.tileIndexes[0].length*b.TILE_SIZE,a=this.tileIndexes.length*b.TILE_SIZE;this.size={width:t,height:a},this.drawingSize={width:t*this.game.squareSize,height:a*this.game.squareSize},this.tilesGrid=this.tileIndexes.map(function(t,a){return t.map(function(t,r){return new Pa.default(e.game,e.tileTypeMap[t],r,a)})}),this.tiles=K(this.tilesGrid)},e.prototype.addDrawables=function(e,t){var a;(a=this.drawables[t]).push.apply(a,e)},e.prototype.addOverlayDrawables=function(e){var t;(t=this.overlayDrawables).push.apply(t,e)},e.prototype.addUpdateables=function(e){var t;(t=this.updateables).push.apply(t,e)},e.prototype.addTouchables=function(e){var t;(t=this.touchables).push.apply(t,e)},e.prototype.addInteractables=function(e){var t;(t=this.interactables).push.apply(t,e)},e.prototype.clearDrawables=function(){this.drawables=new Array(Qa).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOverlayDrawables=function(){this.overlayDrawables=[]},e.prototype.clearUpdateables=function(){this.updateables=[]},e.prototype.clearInteractables=function(){this.interactables=[]},e.prototype.clearTouchables=function(){this.touchables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return I(t.tileTypeMap)})})},e.prototype.touchedTouchable=function(e){var t=this,a=20*this.game.scaleFactor,r=this.touchables.find(function(r){var i=Object.assign({},r.drawingSize),l=Object.assign({},r.pos);return i.width*=t.game.scaleFactor,i.height*=t.game.scaleFactor,l.x*=t.game.scaleFactor,l.y*=t.game.scaleFactor,e.clientX+a>=l.x&&e.clientX-a<=l.x+i.width&&e.clientY+a>=l.y&&e.clientY-a<=l.y+i.height});if(r&&r.visible)return r},e}(),Sa=Ra;o.default=Sa;var S={};Object.defineProperty(S,"__esModule",{value:!0});var Mc={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[0,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]]};S.default=Mc;var n={},ra=n&&n.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var qa=ra(e),Ya=ra(S),Za=qa.default[0],pa=2,_a=function(){function t(t,e,i,a){void 0===i&&(i=qa.default[1]),void 0===a&&(a={x:0,y:0}),this.words="",this.drawingSize={width:0,height:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.animations={},this.game=t,this.words=e.toUpperCase(),this.color=i,this.move(a),this.pixelLetters=this.words.split("").map(function(t){return Ya.default[t]}),this.updateSize(),this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize},this.animations.floatText=Object.assign({},_)}return t.prototype.draw=function(t,e){var i=this,a=this.pos.x,s=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=s,this.pixelLetters.forEach(function(e){for(var s=i.pos.y,r=0,o=0;o<e.length;o++){for(var h=e[o],n=0;n<h.length;n++)h[n]&&(i.shadow&&(t.fillStyle=Za,t.fillRect(a+n*i.game.squareSize+pa,s+pa,i.game.squareSize,i.game.squareSize)),t.fillStyle=i.color,t.fillRect(a+n*i.game.squareSize,s,i.game.squareSize,i.game.squareSize));r=Math.max(r,h.length*i.game.squareSize),s=i.game.squareSize*(o+1)+i.pos.y}a+=i.game.squareSize+r}),this.updateFloat(e)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y},t.prototype.startFloat=function(t){this.move(t),this.animations.floatText.startTime=this.game.timestamp,this.animations.floatText.startPos=Object.assign({},t),this.animations.floatText.endPos={x:t.x,y:-10},this.animations.floatText.running=!0},t.prototype.resize=function(){this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize},t.prototype.updateFloat=function(t){var e=this.animations.floatText;if(e.running){var i=(t-e.startTime)/e.duration,a=Object.assign({},this.pos);a.x=this.pos.x+i*Math.sin(6*i*Math.PI),a.y=v(e.startPos.y,e.endPos.y,i),i>=1&&(e.running=!1),this.alpha=1-i,this.move(a)}},t.prototype.updateSize=function(){var t=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,e){return t+e},0)+this.pixelLetters.length-1;this.size={width:t,height:this.game.squareSize}},t}(),ab=_a;n.default=ab;var h={},na=h&&h.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(h,"__esModule",{value:!0});var P=na(e),eb=na(n),fb=function(){function t(t,i,e,o){void 0===o&&(o=P.default[8]),this.pos={x:0,y:0},this.size={height:b.SQUARE_SIZE,width:b.SQUARE_SIZE},this.visible=!0,this.alpha=1,this.strokePos={x:0,y:0},this.texts=[],this.game=t,this.pos=i,this.size=e,this.color=o,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize},this.move(i)}return t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,this.moveTexts()},t.prototype.updateSize=function(t){this.size.height=t.height,this.size.width=t.width,this.drawingSize.height=this.size.height*this.game.squareSize,this.drawingSize.width=this.size.width*this.game.squareSize},t.prototype.draw=function(t,i){var e=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=e,t.fillStyle=this.color,t.fillRect(this.pos.x,this.pos.y,this.drawingSize.width,this.drawingSize.height),t.strokeStyle=P.default[1],t.fillStyle=P.default[1],t.lineWidth=this.game.squareSize,t.strokeRect(this.strokePos.x,this.strokePos.y,this.drawingSize.width,this.drawingSize.height),this.texts.forEach(function(e){return e.draw(t,i)})},t.prototype.setWords=function(t){var i=this;this.texts=t.map(function(t){return new eb.default(i.game,t)}),this.moveTexts()},t.prototype.touched=function(){},t.prototype.moveTexts=function(){var t=this;if(this.texts.length){var i=b.LINE_HEIGHT*this.game.squareSize,e=b.LETTER_HEIGHT*this.game.squareSize,o=this.texts.length,s=o*e+(o-2)*i;this.texts.forEach(function(e,o){var h=Math.floor(t.pos.x+t.game.squareSize*(t.size.width-e.size.width)/2),r=Math.floor(t.pos.y+(t.drawingSize.height-s)/2+i*o);e.move({x:h,y:r})})}},t}(),gb=fb;h.default=gb;var r={},G=r&&r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var jb=G(h),L=G(e),lb=G(n),mb=.2,nb=function(){function e(e,t,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=1,this.lastBlinkAt=0,this.alpha=1,this.animations={},this.game=e,this.energyText=new lb.default(this.game,i,L.default[7]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.drawingSize=Object.assign({},this.energyText.drawingSize),this.drawingSize.width=(this.size.width+1)*this.game.squareSize,this.drawingSize.height=(this.size.height+1)*this.game.squareSize;var a={height:this.size.height+1,width:this.size.width+1};this.box=new jb.default(e,t,a,L.default[7]),this.animations.level=Object.assign({},Ba),this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.animations).map(function(t){return e.animations[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:e.x+b.SQUARE_SIZE/2+.5,y:e.y+b.SQUARE_SIZE/2+.5})},e.prototype.draw=function(e,t){this.updateLevel(t),this.box.draw(e,t),e.fillStyle=L.default[1],e.fillRect(this.pos.x,this.pos.y,this.drawingSize.width*this.percentFull,this.drawingSize.height),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.animations.level.startTime=this.game.timestamp,this.animations.level.startLevel=this.percentFull,this.animations.level.endLevel=e,this.animations.level.running=!0},e.prototype.update=function(e){this.percentFull>mb?this.visible=!0:e-this.lastBlinkAt>b.BLINK_DURATION&&(this.visible=!this.visible,this.lastBlinkAt=e)},e.prototype.updateLevel=function(e){if(this.animations.level.running){var t=(e-this.animations.level.startTime)/this.animations.level.duration,i=v(this.animations.level.startLevel,this.animations.level.endLevel,t);t>=1&&(i=this.animations.level.endLevel,this.animations.level.running=!1),this.percentFull=i}},e}(),ob=nb;r.default=ob;var i={},qb=i&&i.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),q=i&&i.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var sb=q(o),tb=q(h),ub=q(l),ba=q(e),$=q(r),C=q(n),yb=4,Aa=4*b.TILE_SIZE,Ab=2,wa=3,ta=2,Db=function(e){function t(t){var r=e.call(this,t)||this;r.backgroundColor=ba.default[9],r.tileTypeMap=["green","flowers","sky","tree"],r.tileIndexes=[[]],r.currentSkillIndex=0,r.convoLevel=0,r.convoPerTurn=.25,r.energyBar=new $.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"ENERGY"),r.convoBar=new $.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"CONVO"),r.box=new tb.default(r.game,{x:0,y:0},{height:0,width:0}),r.upArrow=new C.default(r.game,"^"),r.downArrow=new C.default(r.game,"_");var a=A(r.handleInput.bind(r),b.THROTTLE_TIME);return r.handleInput=a,r.upArrow.touched=function(){return r.handleInput("ArrowUp")},r.downArrow.touched=function(){return r.handleInput("ArrowDown")},r}return qb(t,e),t.prototype.handleInput=function(e){switch(e){case"ArrowUp":this.moveSkillCursor(1);break;case"ArrowDown":this.moveSkillCursor(-1);break;case"Enter":this.useSelectedSkill();break;case"q":this.game.queueNextLevel(this.game.levels.world);}},t.prototype.handleTouch=function(e){var t=this.touchedTouchable(e);t?t.touched():this.handleInput(null)},t.prototype.setBuddy=function(e){this.buddy=e,this.buddy.setConvoMode(!0),this.buddy.convoLook("left")},t.prototype.levelWillStart=function(){var e=this;this.buddy||this.setBuddy(new ub.default(this.game)),this.clearTouchables(),this.game.player.setConvoMode(!0),this.game.player.convoLook("right"),this.energyBar.animateToLevel(this.game.player.energy),this.convoLevel=0,this.convoBar.animateToLevel(this.convoLevel),this.buddies=[this.game.player,this.buddy],this.skills=this.game.player.skills.map(function(t){return new C.default(e.game,t)}),this.skills.forEach(function(t){return t.touched=function(){e.skills[e.currentSkillIndex]===t&&e.handleInput("Enter")}})},t.prototype.levelStarted=function(){this.moveBuddies()},t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.updateText(),this.updateFloatyText(),this.convoLevel>=1&&!this.convoBar.animating&&this.game.queueNextLevel(this.game.levels.world)},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.updateBoxes(),this.updateText(),this.moveSkillCursor(0),this.moveBuddies(),this.generateTileIndexes(),this.generateTiles(),this.addDrawables(this.tiles,0),this.addDrawables(this.buddies,1),this.addOverlayDrawables([this.box,this.upArrow,this.downArrow,this.energyBar,this.convoBar].concat(this.skills)),this.addTouchables([this.upArrow,this.downArrow].concat(this.skills))},t.prototype.generateTileIndexes=function(){var e=this.game.sizeInTiles(),t=this.game.player.tileIndex.y;this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return I([0,1])})});for(var r=0;r<t;r++)this.tileIndexes[r]=this.tileIndexes[r].map(function(){return 2});var a=this.tileIndexes[t-1];a&&(this.tileIndexes[t-1]=a.map(function(){return 3}))},t.prototype.moveSkillCursor=function(e){var t=this.currentSkillIndex+e,r=this.skills[t];this.downArrow.alpha=1,this.upArrow.alpha=1,this.skills.forEach(function(e){return e.alpha=b.DISABLED_ALPHA}),r?(r.alpha=1,this.currentSkillIndex=t):this.skills[this.currentSkillIndex].alpha=1,0===this.currentSkillIndex&&(this.downArrow.alpha=b.DISABLED_ALPHA),this.currentSkillIndex===this.skills.length-1&&(this.upArrow.alpha=b.DISABLED_ALPHA)},t.prototype.useSelectedSkill=function(){if(!(this.game.player.energy<=0||this.convoLevel>=1)){var e=this.skills[this.currentSkillIndex],t=new C.default(this.game,e.words,ba.default[9]),r={x:this.game.player.pos.x,y:this.game.player.pos.y};t.startFloat(r),this.addDrawables([t],ta),this.convoLevel+=this.convoPerTurn,this.convoBar.animateToLevel(this.convoLevel)}},t.prototype.moveBuddies=function(){var e=this.buddies[1],t=this.box.pos.x/this.game.squareSize,r=this.box.pos.y/this.game.squareSize-this.game.player.size.height-yb,a=this.game.gameSizeFromDrawingSize(this.box.drawingSize),i=this.game.player.size.width+Aa+e.size.width,o={x:t+(a.width-i)/2,y:r},s=Object.assign({},o);s.x+=Aa+this.game.player.size.width,this.game.player.move(o),e.move(s)},t.prototype.updateBoxes=function(){var e=this.game.canvas.height-this.game.boxSize.height*this.game.squareSize-2*this.game.squareSize;this.box.move({x:this.game.boxPos.x,y:e}),this.box.updateSize(this.game.boxSize);var t=this.energyBar.drawingSize.width+this.convoBar.drawingSize.width+wa*this.game.squareSize,r=(this.game.canvas.width-t)/2;this.energyBar.move({x:Math.floor(r),y:Math.floor(this.energyBar.pos.y)});var a=this.energyBar.pos.x+this.energyBar.drawingSize.width+wa*this.game.squareSize;this.convoBar.move({x:Math.floor(a),y:Math.floor(this.convoBar.pos.y)})},t.prototype.updateText=function(){var e=this,t=Ab*this.game.squareSize,r=Math.floor(this.box.pos.x+this.box.drawingSize.width-this.upArrow.drawingSize.width-t),a=Math.floor(this.box.pos.y+this.box.drawingSize.height/2-this.upArrow.drawingSize.height/2),i=Math.floor(this.box.pos.x+t),o=Math.floor(a);this.upArrow.move({x:r,y:a}),this.downArrow.move({x:i,y:o}),this.skills.forEach(function(t,r){var a=e.currentSkillIndex-r,i=Math.floor(e.box.pos.x+e.box.drawingSize.width/2-t.drawingSize.width/2),o=Math.floor(e.box.pos.y+e.box.drawingSize.height/2-t.drawingSize.height/2+a*b.LINE_HEIGHT*e.game.squareSize);t.move({x:i,y:o}),t.visible=!(Math.abs(a)>1)})},t.prototype.updateFloatyText=function(){for(var e=this.drawables[ta],t=e.length-1;t>=0;t--){e[t].pos.y<0&&e.splice(t,1)}},t}(sb.default),Eb=Db;i.default=Eb;var m={},Gb=m&&m.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),la=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var Ib=la(h),Jb=la(o),Kb=["CONVO IRL","","TAP TO PLAY"],Lb=function(e){function t(t){var r=e.call(this,t)||this;return r.panDirection=1,r.tileTypeMap=["green","flowers","grass","tree"],r.tileIndexes=[[]],r.lastBlinkAt=0,r.box=new Ib.default(r.game,{x:0,y:0},{height:0,width:0}),r.box.touched=function(){return r.handleInput()},r.box.setWords(Kb),r}return Gb(t,e),t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this);var t=this.game.sizeInTiles();t.width*=2,t.height*=2,this.generateTileIndexes(t),this.generateTiles(),this.moveText(),this.addTouchables([this.box]),this.addDrawables(this.tiles,0),this.addOverlayDrawables([this.box])},t.prototype.handleInput=function(){this.game.transitioning||this.game.queueNextLevel(this.game.levels.world)},t.prototype.handleTouch=function(){this.handleInput()},t.prototype.moveText=function(){this.box.move(this.game.boxPos),this.box.updateSize(this.game.boxSize)},t}(Jb.default),Mb=Lb;m.default=Mb;var J,y={};!function(t,e){"function"==typeof J&&J.amd?J(["exports"],e):"object"==typeof y&&"string"!=typeof y.nodeName?e(y):e(t.TinyMusic={})}(y,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),s=/^[0-9.]+$/,i=/\s+/,o=/(\d+)/,n={};function r(t){var e=t.split(i);this.frequency=r.getFrequency(e[0])||0,this.duration=r.getDuration(e[1])||0}function c(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),r.getFrequency=function(t){var s=t.split(o),i=n[s[0]],r=(s[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,r)},r.getDuration=function(t){return s.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,s){(s=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",s.frequency.value=e[1],t.connect(t=s)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof r?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},c.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},c.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sequence=c});var p={},Qb=p&&p.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),x=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});var Sb=x(o),Tb=x(h),Ub=x(l),Vb=x(r),Wb=x(y),Xb=50,Yb={x:4*b.TILE_SIZE,y:7*b.TILE_SIZE},aa="sleeping",Y="intro",H="play",ac=[["great news!","a new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up","by chatting with","your neighbors!"],["people like","talking about","their interests!"]],bc=["","zzzzzz...",""],cc=function(e){function t(t){var a=e.call(this,t)||this;a.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],a.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,0,0,0,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,0,0,3,3,3,3,0,1,0,0,0,0,3,3,3,3,0,0,3,3],[3,3,3,4,5,5,3,0,0,2,0,3,3,3,0,0,0,0,0,0,3,3,3,0,0,0,3,3],[3,3,3,5,5,5,3,0,1,0,0,3,3,2,0,0,0,2,0,0,0,3,0,0,0,3,3,3],[3,3,3,5,6,5,3,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3],[3,3,3,1,1,1,1,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,1,1,1,1,3,3,3,3,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3],[3,3,3,3,0,0,0,0,3,3,3,3,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,2,3,0,0,2,0,0,3,3,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,3],[3,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3],[3,0,0,2,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3],[3,1,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,3,0,0,0,0,3],[3,0,0,3,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,2,3,0,0,0,3],[3,0,0,3,3,0,0,0,2,0,0,0,0,0,0,0,0,0,0,3,3,0,0,2,3,3,3,3],[3,0,0,3,0,0,0,0,0,0,1,3,3,0,0,0,0,0,0,0,3,3,0,0,4,5,5,3],[3,0,0,0,0,0,0,0,3,3,3,3,0,1,0,0,0,0,0,0,3,3,0,0,5,5,5,3],[3,0,0,3,3,3,0,3,3,3,3,0,0,0,0,0,3,3,3,3,3,3,0,0,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,0,0,0,0,0,3,3,3,3,3,0,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],a.playerSpawnPosition=Yb,a.inputBuffer={pressedAt:0,key:null},a.textIntros=ac,a.state=Y;var r=A(a.handleTouch.bind(a),b.THROTTLE_TIME),i=A(a.handleInput.bind(a),b.THROTTLE_TIME);a.handleTouch=r,a.handleInput=i,a.generateTiles(),a.energyBar=new Vb.default(a.game,{x:0,y:t.squareSize},"ENERGY"),a.game.player.energy=.6;var o=new Ub.default(t);return o.move({x:10*b.TILE_SIZE,y:10*b.TILE_SIZE}),a.buddies=[o],a.box=new Tb.default(a.game,a.game.boxPos,a.game.boxSize),a.showNextIntroBox(),a}return Qb(t,e),t.prototype.handleInput=function(e){this.game.transitioning||this.handleBoxInput()||(this.inputBuffer={pressedAt:this.game.timestamp,key:e})},t.prototype.handleTouch=function(e){if(!this.game.transitioning&&!this.game.player.walking&&!this.handleBoxInput()){var t=this.game.camera,a=t.size,r=a.height,i=a.width,o=t.offset,s=e.clientX*i/window.innerWidth-o.x,n=e.clientY*r/window.innerHeight-o.y,$=s-this.game.player.pos.x*this.game.squareSize,l=n-this.game.player.pos.y*this.game.squareSize,y=Math.abs($),h=Math.abs(l),p=this.game.squareSize*b.HALF_TILE_SIZE;if(!(y<p&&h<p))if(y>h)this.movePlayerHorizontally($)||this.movePlayerVertically(l);else this.movePlayerVertically(l)||this.movePlayerHorizontally($)}},t.prototype.resize=function(){var e=Math.floor((this.game.canvas.width-this.energyBar.drawingSize.width)/2);this.energyBar.move({x:e,y:this.energyBar.pos.y}),this.updateBox()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.processInput()},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.addDrawables(this.tiles,0),this.addDrawables(this.game.player.dusts,1),this.addDrawables([this.game.player],2),this.addDrawables(this.buddies,2),this.addOverlayDrawables([this.energyBar,this.box]),this.addInteractables(this.buddies),this.addTouchables([this.box]),this.addUpdateables(this.game.player.dusts.concat([this.energyBar])),this.resize()},t.prototype.levelStarted=function(){this.energyBar.animateToLevel(this.game.player.energy),this.game.player.move(this.playerSpawnPosition),this.game.player.setConvoMode(!1);var e=new(window.AudioContext||webkitAudioContext),t=new Wb.default.Sequence(e,120,["G2 q","G3 q","G4 q"]);t.loop=!1,t.play()},t.prototype.handleBoxInput=function(){return this.state!==H&&(this.state===aa&&(this.state=H,this.box.visible=!1,this.walk("down")),this.state===Y&&this.showNextIntroBox(),!0)},t.prototype.showNextIntroBox=function(){var e=this.textIntros[0];if(!e)return this.state=H,void(this.box.visible=!1);this.box.setWords(e),this.textIntros.shift()},t.prototype.updateBox=function(){this.box.move(this.game.boxPos),this.box.updateSize(this.game.boxSize)},t.prototype.processInput=function(){if(!(this.game.timestamp-this.inputBuffer.pressedAt>Xb))switch(this.inputBuffer.key){case"ArrowUp":this.walk("up");break;case"ArrowDown":this.walk("down");break;case"ArrowRight":this.walk("right");break;case"ArrowLeft":this.walk("left");}},t.prototype.walk=function(e){if(!this.game.player.walking){var t=Object.assign({},this.game.player.tileIndex);switch(e){case"up":t.y-=1;break;case"down":t.y+=1;break;case"left":t.x-=1;break;case"right":t.x+=1;}var a=null,r=this.interactables.find(function(e){return e.tileIndex.x===t.x&&e.tileIndex.y===t.y});if(r&&(this.currentBuddy=r,a=this.game.levels.convo),this.tileAtIndex(t).interactable&&this.sleep(),a)return this.playerSpawnPosition.x=this.game.player.pos.x,this.playerSpawnPosition.y=this.game.player.pos.y,void this.game.queueNextLevel(a);this.game.player.walk(e)}},t.prototype.sleep=function(){this.game.player.energy=1,this.energyBar.animateToLevel(this.game.player.energy),this.box.setWords(bc),this.box.visible=!0,this.state=aa},t.prototype.movePlayerVertically=function(e){return e<0&&this.canThingMoveInDirection(this.game.player,"up")?(this.handleInput("ArrowUp"),!0):!!(e>0&&this.canThingMoveInDirection(this.game.player,"down"))&&(this.handleInput("ArrowDown"),!0)},t.prototype.movePlayerHorizontally=function(e){return e>0&&this.canThingMoveInDirection(this.game.player,"right")?(this.handleInput("ArrowRight"),!0):!!(e<0&&this.canThingMoveInDirection(this.game.player,"left"))&&(this.handleInput("ArrowLeft"),!0)},t.prototype.canThingMoveInDirection=function(e,t){var a=Object.assign({},e.pos);switch(t){case"up":a.y-=this.game.tileSize;break;case"down":a.y+=this.game.tileSize;break;case"left":a.x-=this.game.tileSize;break;case"right":a.x+=this.game.tileSize;}return a.x=a.x-a.x%this.game.tileSize,a.y=a.y-a.y%this.game.tileSize,U(e,a,this)},t}(Sb.default),dc=cc;p.default=dc;var t={},D=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(t,"__esModule",{value:!0});var gc=D(l),hc=D(i),ic=D(m),jc=D(p),ca=5,lc=function(){function t(t){this.timestamp=0,this.tileSize=b.TILE_SIZE,this.squareSize=b.SQUARE_SIZE,this.scaleFactor=1,this.nextLevel=null,this.imageOfPreviousLevel=null,this.player=new gc.default(this),this.canvas=t,this.setSize(),this.context=t.getContext("2d",{alpha:!1}),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.levels={convo:new hc.default(this),startScreen:new ic.default(this),world:new jc.default(this)},this.transition=Object.assign({},W),this.switchLevel(this.levels.startScreen)}return Object.defineProperty(t.prototype,"boxPos",{get:function(){return{x:(this.canvas.width-this.boxSize.width*this.squareSize)/2,y:(this.canvas.height-this.boxSize.height*this.squareSize)/2}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxSize",{get:function(){return{height:3*b.LETTER_HEIGHT+2*b.LINE_HEIGHT,width:13*b.LETTER_HEIGHT}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitioning",{get:function(){return this.transition.running},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this.timestamp=t,this.currentLevel.update(t),this.transitioning&&this.updateTransition(t)},t.prototype.draw=function(t){this.context&&this.camera&&(this.camera.updateScreenShake(t),this.clearCanvasContext(),this.drawDrawables(t),this.drawOverlayDrawables(t),this.transitioning&&this.updateTransition(t))},t.prototype.resize=function(){this.setSize(),this.currentLevel.resize()},t.prototype.queueNextLevel=function(t){if(t===this.levels.convo){var e=this.levels,i=e.convo,a=e.world;i.setBuddy(a.currentBuddy.copy())}this.nextLevel=t,this.startTransition()},t.prototype.handleInput=function(t){this.currentLevel.handleInput(t)},t.prototype.handleTouch=function(t){this.currentLevel.handleTouch(t)},t.prototype.gameCoordsFromDrawingCoords=function(t){var e=Object.assign({},t);return e.x=Math.floor(e.x/this.squareSize),e.y=Math.floor(e.y/this.squareSize),e},t.prototype.gameSizeFromDrawingSize=function(t){var e=Object.assign({},t);return e.width=Math.floor(e.width/this.squareSize),e.height=Math.floor(e.height/this.squareSize),e},t.prototype.sizeInTiles=function(){return{width:Math.ceil(this.canvas.width/this.squareSize/b.TILE_SIZE),height:Math.ceil(this.canvas.height/this.squareSize/b.TILE_SIZE)}},t.prototype.startTransition=function(){this.transition.startTime=this.timestamp,this.transition.running=!0,this.imageOfPreviousLevel=new Image,this.imageOfPreviousLevel.src=this.canvas.toDataURL("png"),this.switchLevel(this.nextLevel)},t.prototype.setSize=function(){this.size={height:this.canvas.height/this.squareSize,width:this.canvas.width/this.squareSize},this.drawingSize={height:this.canvas.height,width:this.canvas.width},this.scaleFactor=window.innerWidth/this.canvas.width},t.prototype.updateTransition=function(t){var e=(t-this.transition.startTime)/this.transition.duration;this.transition.prevLevelScale=s(1,ca,1,ca,e),this.transition.prevLevelAlpha=s(1,0,0,1,e),this.transition.nextLevelAlpha=s(0,1,0,1,e),e>=1&&(this.transition=Object.assign({},W),this.imageOfPreviousLevel=null)},t.prototype.switchLevel=function(t){this.currentLevel=t,t.levelWillStart(),t.configureDrawablesAndUpdateables(),t.levelStarted()},t.prototype.drawDrawables=function(t){var e=this,i=this.camera.offset;if(this.currentLevel.drawables.forEach(function(a){a.forEach(function(a){if(a.visible){var r=a.pos.x*e.squareSize+i.x,n=a.pos.y*e.squareSize+i.y;e.isOffScreen(r,n,a.drawingSize)||(e.context.translate(r+.5|0,n+.5|0),e.context.globalAlpha=e.transitioning?e.transition.nextLevelAlpha:1,a.draw(e.context,t),e.context.setTransform(1,0,0,1,0,0))}})}),this.context.globalAlpha=1,this.imageOfPreviousLevel){this.context.globalAlpha=this.transition.prevLevelAlpha;var a=this.transition.prevLevelScale,r=(this.canvas.width*a-this.canvas.width)/2,n=(this.canvas.height*a-this.canvas.height)/2;this.context.drawImage(this.imageOfPreviousLevel,-r,-n,this.canvas.width*a,this.canvas.height*a),this.context.globalAlpha=1}},t.prototype.isOffScreen=function(t,e,i){return t+i.width<0||t>this.canvas.width||e+i.height<0||e>this.canvas.height},t.prototype.drawOverlayDrawables=function(t){var e=this;this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.currentLevel.overlayDrawables.forEach(function(i){i.visible&&i.draw(e.context,t)}),this.context.globalAlpha=1},t.prototype.clearCanvasContext=function(){this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.context.fillStyle=this.currentLevel.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t}(),mc=lc;t.default=mc;var O={};Object.defineProperty(O,"__esModule",{value:!0});var oc=10*b.MS_PER_UPDATE;function pc($,t,r){var u=0,e=0;return function(a){for(u+=Math.min(a-e,oc),e=a;u>=$;)t.call(r,a),u-=$}}var qc=pc;O.default=qc;var j={},T=j&&j.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(j,"__esModule",{value:!0});var tc=T(M),uc=T(t),vc=T(O),wc=.05,xc=vc.default(b.MS_PER_UPDATE,Ic,j),z=document.getElementById("game"),c=new uc.default(z),g=new tc.default(c),E=b.NUM_TILES_ON_LONG_SIDE*b.TILE_SIZE*b.SQUARE_SIZE,Cc=E,Dc=E,ea=null,Fc=!1;c.camera=g;var F={s:g.shakeScreen.bind(g),t:function(){return c.queueNextLevel(c.levels.world)}};function ma(){var $=window.innerWidth/window.innerHeight;$>=1?Dc=(Cc=E)/$:Cc=(Dc=E)*$,z.width=Cc,z.height=Dc,g.size={width:z.width,height:z.height},c.resize()}function Ic($){if(c.update($),c.currentLevel===c.levels.startScreen){var a=c.levels.startScreen;g.pos.x-=a.panDirection*wc,g.pos.x<-c.canvas.width&&(a.panDirection=-1),g.pos.x>0&&(a.panDirection=1)}else g.move(c.player)}function ka($){ea&&Fc&&c.handleTouch(ea),xc($),c.draw($),requestAnimationFrame(ka)}function ja($){V($),Fc=!0}function V($){var a=$;$.touches&&(a=$.changedTouches[0]),ea=a}function da(){ea=null,Fc=!1}ma(),requestAnimationFrame(ka),window.addEventListener("resize",function(){return ma()}),window.addEventListener("keydown",function($){var a=$.key;F[a]?F[a]():c.handleInput(a)}),window.addEventListener("keyup",function($){var a=$.key;F[a]?F[a]():c.handleInput(a)}),window.addEventListener("mousedown",ja,!1),window.addEventListener("touchstart",ja,!1),window.addEventListener("mouseup",da,!1),window.addEventListener("touchend",da,!1),window.addEventListener("mousemove",V,!1),window.addEventListener("touchmove",V,!1),document.body.addEventListener("touchmove",function($){return $.preventDefault()},{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=j}else if(typeof define==="function"&&define.amd){define(function(){return j})}return{"9B6d":j};});</script> </body> </html>