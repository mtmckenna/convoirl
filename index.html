<html> <title>Convo IRL</title> <head> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"> </head> <body> <canvas id="game"></canvas> <style>*{height:100%;image-rendering:pixelated;image-rendering:optimizeSpeed;margin:0;padding:0;width:100%}</style> <script>parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {var b={};Object.defineProperty(b,"__esModule",{value:!0});var Ea=8;b.TS=Ea;var ec=5;b.SQUARE_SIZE=ec;var dc=1/60;b.MS_PER=dc;var cc=8;b.LINE_HEIGHT=cc;var ac=120;b.T_TIME=ac;var Zb=5;b.LETTER_HEIGHT=Zb;var Wb="*listen*";b.LISTEN=Wb;var e={};Object.defineProperty(e,"__esModule",{value:!0});function Vb(e,r){if(e.running)return!1;var $=r-e.startTime>e.minTimeDelta,o=e.percentChance>Math.random();return $&&o}var T=Vb;function ja(e,r,$){return(1-$)*e+$*r}e.shouldDoAnimation=T;var r=ja;function Ub(e,r,$){return Math.max(Math.min(e,$),r)}function M(e,r,$,o,t){return Ub(ja(e,r,t),$,o)}e.lerp=r;var v=M;function Tb(){return 2*Math.round(Math.random())-1}e.clerp=v;var O=Tb;function Ob(e){return[].concat.apply([],e)}e.oneOrMinusOne=O;var L=Ob;function Nb(e){return Math.floor(Math.random()*e.length)}e.flatten=L;var u=Nb;function Kb(e,r,$,o){void 0===o&&(o=!1);var t=$,n=r;return o&&(t=r,n=$),e>=.5?M(t,n,r,$,(e-.5)/.5):M(n,t,r,$,e/.5)}e.randomIndexFromArray=u;var ea=Kb;function Db(e){return new Array(b.TS).fill(null).map(function(){return new Array(b.TS).fill(e)})}e.twoPhaseClerp=ea;var H=Db;function Cb(e,r){var $;return function(){var o=arguments;$||(e.apply(this,o),$=!0,setTimeout(function(){return $=!1},r))}}e.singleColorTileArray=H;var G=Cb;e.throttle=G;var R={};Object.defineProperty(R,"__esModule",{value:!0});var zb=function(){function e(e){this.pos={x:0,y:0},this.size={width:0,height:0},this.game=e,this.player=e.player,this.size={width:e.canvas.width,height:e.canvas.height},this.shake={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:this.shake.pos.x+this.pos.x,y:this.shake.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=this.game.canvas.width/2-e.pos.x*this.game.squareSize-e.drawingSize.width/2,this.pos.y=this.game.canvas.height/2-e.pos.y*this.game.squareSize-e.drawingSize.height/2;var s=-1*(this.game.currentLevel.drawingSize.width-this.size.width),t=-1*(this.game.currentLevel.drawingSize.height-this.size.height);this.pos.x>0&&(this.pos.x=0),this.pos.x<s&&(this.pos.x=s),this.pos.y>0&&(this.pos.y=0),this.pos.y<t&&(this.pos.y=t)},e.prototype.shakeScreen=function(){this.shake.pos={x:0,y:0},this.shake.amplitude=10*this.game.squareSize,this.shake.dir.x=O(),this.shake.dir.y=O()},e.prototype.updateScreenShake=function(e){this.shake.amplitude*=.9;var s=this.shake,t=s.amplitude,i=s.dir;Math.abs(t)<=.01?(this.shake.pos.x=0,this.shake.pos.y=0):(this.shake.pos.x=Math.sin(e/50)*t*i.x,this.shake.pos.y=Math.sin(e/50)*t*i.y)},e}(),vb=zb;R.default=vb;var n={};Object.defineProperty(n,"__esModule",{value:!0});var sb={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},ma=sb;n.blinking=ma;var qb={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},Z=qb;n.lookAway=Z;var pb={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:-1,y:-1},startTime:0,t:0},_=pb;n.walking=_;var ob={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},ba=ob;n.animateEnergy=ba;var jb={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},V=jb;n.transition=V;var hb={duration:4e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0},ha=hb;n.floatText=ha;var f={};Object.defineProperty(f,"__esModule",{value:!0});var eb=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];f.default=eb;var w={},db=w&&w.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(w,"__esModule",{value:!0});var bb=db(f),_a=function(){function t(t){this.size={width:1,height:1},this.pos={x:0,y:0},this.color=bb.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=v(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=v(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.drawingSize.width*e/2,-this.drawingSize.height*e/2,this.drawingSize.width*e,this.drawingSize.height*e)},t}(),$a=_a;w.default=$a;var j={},Za=j&&j.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(j,"__esModule",{value:!0});var Va=Za(w),Ta=2,Pa=1,Na=4,Ma=1,Ia=4,Ha=6,ga=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],Ga=function(){function t(t){var i=this;this.pos={x:0,y:0},this.size={height:b.TS,width:b.TS},this.visible=!0,this.skills=[],this.animations={},this.tileIndex={x:0,y:0},this.energy=1,this.talking=!1,this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.squareSize=b.SQUARE_SIZE,this.game=t,this.animations.blinking=Object.assign({},ma),this.animations.walking=Object.assign({},_,{endPos:this.pos}),this.animations.lookAway=Object.assign({},Z),this.color=ga[u(ga)],this.dusts=Array.from(Array(50).keys()).map(function(){return new Va.default(i.game)}),this.drawingSize={height:b.TS*this.game.squareSize,width:b.TS*this.game.squareSize},this.squareSize=this.game.squareSize,this.rando=100*Math.random()}return Object.defineProperty(t.prototype,"walking",{get:function(){return this.animations.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i.skills=this.skills,i},t.prototype.setConvoMode=function(t,i){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.squareSize,this.size.width=b.TS,this.size.height=b.TS,this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize,t?(this.squareSize*=2,this.size.width*=2,this.size.height*=2,this.drawingSize.width*=2,this.drawingSize.height*=2):this.talking=!1,this.convoLookRight="right"===i},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.ceil(this.pos.x/b.TS),this.tileIndex.y=Math.ceil(this.pos.y/b.TS)},t.prototype.look=function(t){this.walk(t,!0)},t.prototype.walk=function(t,i){void 0===i&&(i=!1);var s=this.pos,a=s.x,n=s.y;switch(t){case"left":this.rot=-Math.PI/2,a-=b.TS;break;case"right":this.rot=Math.PI/2,a+=b.TS;break;case"down":this.rot=Math.PI,n+=b.TS;break;case"up":this.rot=0,n-=b.TS;}if(!i&&!this.walking){var e={x:this.pos.x,y:this.pos.y},o={x:a,y:n};this.canMoveToPosition(o)&&this.configureWalkingAnimation(e,o)}},t.prototype.configureWalkingAnimation=function(t,i){var s=this.animations.walking;s.startTime=this.game.timestamp,s.endPos=i,s.startPos=t,s.running=!0,s.t=0},t.prototype.update=function(t){this.autoWalkDirection&&this.walk(this.autoWalkDirection);var i=(t-this.animations.walking.startTime)/this.animations.walking.duration,s=r(this.animations.walking.startPos.x,this.animations.walking.endPos.x,i),a=r(this.animations.walking.startPos.y,this.animations.walking.endPos.y,i);this.animations.walking.t=i,i>=1&&(s=this.animations.walking.endPos.x,a=this.animations.walking.endPos.y,this.animations.walking.running=!1,this.animations.walking.t=0),this.move({x:s,y:a})},t.prototype.draw=function(t,i){var s=this.animations.walking.t;t.translate(this.drawingSize.width/2,this.drawingSize.height/2),t.rotate(this.rot),t.translate(-this.drawingSize.width/2,-this.drawingSize.height/2),t.fillStyle=this.color;var a=s;if(s>.5&&(a=1-s),t.fillRect(0,0,this.drawingSize.width,this.drawingSize.height+this.drawingSize.height*a),this.maybeDoEyeAnimations(i),this.drawEye(t,"left",this.animations.blinking.openness,this.animations.lookAway.offset),this.drawEye(t,"right",this.animations.blinking.openness,this.animations.lookAway.offset),this.talking){t.fillStyle="#000";var n=Math.sin(i/80+this.rando)+1;t.fillRect((this.convoLookRight?1:5)*this.squareSize,this.squareSize+n/4,2*this.squareSize+n,2*this.squareSize*n/2)}if(this.walking&&i-this.lastDustAt>30){var e=this.dusts.find(function(t){return!t.visible});if(e){var o=this.size.width/2*Math.random()+this.size.width/4,r=this.size.height/2*Math.random()+this.size.height/4,h=this.pos.x+o,$=this.pos.y+r;e.reJuice(i,h,$),this.lastDustAt=i}}},t.prototype.maybeDoEyeAnimations=function(t){var i=this.animations,s=i.blinking,a=i.lookAway;T(s,t)&&(s.running=!0,s.startTime=t),T(a,t)&&(a.running=!0,a.startTime=t),this.runBlinkingAnimation(s,t),this.runLookAwayAnimation(a)},t.prototype.runLookAwayAnimation=function(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)},t.prototype.runBlinkingAnimation=function(t,i){var s=(i-t.startTime)/t.duration;t.openness=ea(s,0,1,!0),s>=1&&(t.running=!1)},t.prototype.drawEye=function(t,i,s,a){var n="left"===i?0:Na*this.squareSize;t.fillStyle="#000";var e=Ma,o=0;this.inConvoMode&&(e=Ia),this.inConvoMode&&this.convoLookRight&&(o=Ha*this.squareSize);var r=e*this.squareSize,h=Ta*this.squareSize,$=Pa*this.squareSize;t.fillRect(r+n-o,r,h,h*s),t.fillStyle="#fff",t.fillRect(r+n+a*this.squareSize-o,r,$,$*s)},t.prototype.canMoveToPosition=function(t){var i=this.game.currentLevel,s=t.x>=0&&t.x<=i.size.width-this.size.width&&t.y>=0&&t.y<i.size.height,a=t.x,n=t.y;return a/=b.TS,n/=b.TS,s&&i.tilesGrid[n][a].walkable},t}(),Ca=Ga;j.default=Ca;var S={};Object.defineProperty(S,"__esModule",{value:!0});var a=null,Ba={door:{canvas:null,colorMatrix:H(0),interactable:!0},flowers:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},grass:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},green:{canvas:null,colorMatrix:H(2)},house:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],tileLength:3*b.TS},sky:{canvas:null,colorMatrix:H(9)},tree:{canvas:null,colorMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],walkable:!1},unwalkable:{canvas:null,visible:!1,walkable:!1}};S.default=Ba;var x={},na=x&&x.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(x,"__esModule",{value:!0});var Aa=na(f),d=na(S),ya=function(){function e(e,t,a,i){this.drawingSize={width:b.TS,height:b.TS},this.pos={x:0,y:0},this.size={width:b.TS,height:b.TS},this.walkable=!0,this.visible=!0,this.interactable=!1,this.tileLength=b.TS,this.game=e,this.pos={x:a*b.TS,y:i*b.TS},this.tileIndex={x:a,y:i},this.name=t,this.colorMatrix=d.default[t].colorMatrix,this.walkable=d.default[t].hasOwnProperty("walkable")?d.default[t].walkable:this.walkable,this.visible=d.default[t].hasOwnProperty("visible")?d.default[t].visible:this.visible,this.interactable=d.default[t].hasOwnProperty("interactable")?d.default[t].interactable:this.interactable,this.tileLength=d.default[t].hasOwnProperty("tileLength")?d.default[t].tileLength:this.tileLength,this.drawingSize={height:this.tileLength*this.game.squareSize,width:this.tileLength*this.game.squareSize},this.cacheOffscreenContext()}return Object.defineProperty(e.prototype,"offscreenCanvas",{get:function(){return d.default[this.name].canvas},enumerable:!0,configurable:!0}),e.prototype.draw=function(e){e.drawImage(this.offscreenCanvas,0,0)},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.drawingSize.width,t.height=this.drawingSize.height;var a=t.getContext("2d");L(this.colorMatrix).map(function(e){return Aa.default[e]}).forEach(function(t,i){if(t){a.fillStyle=t;var r=e.game.squareSize*(i%e.tileLength),$=e.game.squareSize*Math.floor(i/e.tileLength);a.fillRect(r,$,e.game.squareSize,e.game.squareSize)}}),d.default[this.name].canvas=t},e}(),ua=ya;x.default=ua;var p={},ra=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});var mb=ra(f),va=ra(x),wa=function(){function e(e){this.tilesGrid=[],this.backgroundColor=mb.default[2],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.updateables.forEach(function(t){return t.update(e)})},e.prototype.configureDrawablesAndUpdateables=function(){this.clearDrawables(),this.clearOverlayDrawables(),this.clearUpdateables(),this.clearInteractables(),this.clearTouchables()},e.prototype.tileAtIndex=function(e){return this.tilesGrid[e.y][e.x]},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*b.TS,t=this.tileIndexes.length*b.TS;this.size={width:e,height:t},this.drawingSize={width:e*this.game.squareSize,height:t*this.game.squareSize};for(var a=0;a<this.tileIndexes.length;a++){this.tilesGrid.push(new Array(this.tileIndexes[a].length));for(var r=0;r<this.tileIndexes[a].length;r++){var i=this.tileTypeMap[this.tileIndexes[a][r]||0];this.tilesGrid[a][r]=new va.default(this.game,i,r,a)}}this.tiles=L(this.tilesGrid)},e.prototype.addDrawables=function(e,t){var a;(a=this.drawables[t]).push.apply(a,e)},e.prototype.addOverlayDrawables=function(e){var t;(t=this.overlayDrawables).push.apply(t,e)},e.prototype.addUpdateables=function(e){var t;(t=this.updateables).push.apply(t,e)},e.prototype.addTouchables=function(e){var t;(t=this.touchables).push.apply(t,e)},e.prototype.addInteractables=function(e){var t;(t=this.interactables).push.apply(t,e)},e.prototype.clearDrawables=function(){this.drawables=new Array(3).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOverlayDrawables=function(){this.overlayDrawables=[]},e.prototype.clearUpdateables=function(){this.updateables=[]},e.prototype.clearInteractables=function(){this.interactables=[]},e.prototype.clearTouchables=function(){this.touchables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return u(t.tileTypeMap)})})},e.prototype.touchedTouchable=function(e){var t=this,a=20*this.game.scaleFactor,r=this.touchables.find(function(r){var i=Object.assign({},r.drawingSize),l=Object.assign({},r.pos);return i.width*=t.game.scaleFactor,i.height*=t.game.scaleFactor,l.x*=t.game.scaleFactor,l.y*=t.game.scaleFactor,e.clientX+a>=l.x&&e.clientX-a<=l.x+i.width&&e.clientY+a>=l.y&&e.clientY-a<=l.y+i.height});if(r&&r.visible)return r},e}(),xa=wa;p.default=xa;var X={};Object.defineProperty(X,"__esModule",{value:!0});var za={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]],"*":[[,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1]]};X.default=za;var k={},la=k&&k.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(k,"__esModule",{value:!0});var ia=la(f),Da=la(X),fc=function(){function t(t,e,i,s){void 0===i&&(i=ia.default[1]),void 0===s&&(s={x:0,y:0}),this.words="",this.drawingSize={width:0,height:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.buddy=null,this.animations={},this.upToIndex=null,this.game=t,this.words=e.toUpperCase(),this.upToIndex=this.words.length,this.color=i,this.move(s),this.pixelLetters=this.words.split("").map(function(t){return Da.default[t]}),this.updateSize(),this.animations.floatText=Object.assign({},ha)}return t.prototype.draw=function(t,e){var i=this.pos.x,s=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=s;for(var a=0;a<this.upToIndex;a++){for(var r=this.pos.y,h=0,o=this.pixelLetters[a],n=0;n<o.length;n++){for(var l=o[n],p=0;p<l.length;p++)l[p]&&(this.shadow&&(t.fillStyle=ia.default[0],t.fillRect(i+p*this.game.squareSize+2,r+2,this.game.squareSize,this.game.squareSize)),t.fillStyle=this.color,t.fillRect(i+p*this.game.squareSize,r,this.game.squareSize,this.game.squareSize));h=Math.max(h,l.length*this.game.squareSize),r=this.game.squareSize*(n+1)+this.pos.y}i+=this.game.squareSize+h}this.updateFloat(e)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y},t.prototype.showUpToIndex=function(t){this.upToIndex=t},t.prototype.startFloat=function(t,e,i){void 0===i&&(i=!1);var s=this.game.canvas.width/this.game.squareSize,a=t.x+this.size.width;"left"===e&&(s=0,a=t.x-this.size.width),i&&(s=a),this.animations.floatText.startTime=this.game.timestamp,this.animations.floatText.startPos={x:a,y:t.y-this.size.height},this.animations.floatText.endPos={x:s,y:-10},this.animations.floatText.running=!0,this.move(this.animations.floatText.startPos)},t.prototype.resize=function(){this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize},t.prototype.updateFloat=function(t){var e=this.animations.floatText;if(e.running){var i=(t-e.startTime)/e.duration,s=Object.assign({},this.pos),a=r(e.startPos.x,e.endPos.x,i);s.x=a+10*Math.sin(6*i*Math.PI),s.y=r(e.startPos.y,e.endPos.y,i),i>=1&&(e.running=!1),this.alpha=1-i,this.move(s)}},t.prototype.updateSize=function(){var t=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,e){return t+e},0)+this.pixelLetters.length-1;this.size={width:t,height:this.game.squareSize},this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize}},t}(),Fa=fc;k.default=Fa;var g={},fa=g&&g.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(g,"__esModule",{value:!0});var Q=fa(f),Ja=fa(k),Ka=function(){function t(t,i,e,o){void 0===o&&(o=Q.default[8]),this.visible=!0,this.alpha=1,this.texts=[],this.startTime=null,this.game=t,this.pos=i,this.strokePos=i,this.size=e,this.color=o,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize},this.move(i)}return Object.defineProperty(t.prototype,"textLength",{get:function(){return this.texts.reduce(function(t,i){return t+i.words.length},0)},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,this.moveTexts()},t.prototype.updateSize=function(t){this.size.height=t.height,this.size.width=t.width,this.drawingSize.height=this.size.height*this.game.squareSize,this.drawingSize.width=this.size.width*this.game.squareSize},t.prototype.draw=function(t,i){var e=this,o=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=o,t.fillStyle=this.color,t.fillRect(this.pos.x,this.pos.y,this.drawingSize.width,this.drawingSize.height),t.strokeStyle=Q.default[1],t.fillStyle=Q.default[1],t.lineWidth=this.game.squareSize,t.strokeRect(this.strokePos.x,this.strokePos.y,this.drawingSize.width,this.drawingSize.height);var s=new Array(this.texts.length).fill(0);if(this.startTime){var r=Math.min(Math.floor((i-this.startTime)/50),this.textLength);s=this.texts.map(function(t,i){var o=e.texts.slice(0,i).reduce(function(t,i){return i.words.length+t},0);return Math.min(r-o,t.words.length)})}this.texts.forEach(function(e,o){e.showUpToIndex(s[o]),e.draw(t,i)})},t.prototype.setWords=function(t){var i=this;this.texts=t.map(function(t){return new Ja.default(i.game,t)}),this.moveTexts()},t.prototype.animateTextIn=function(t){this.startTime=t},t.prototype.touched=function(){},t.prototype.moveTexts=function(){var t=this;if(this.texts.length){var i=b.LINE_HEIGHT*this.game.squareSize,e=b.LETTER_HEIGHT*this.game.squareSize,o=this.texts.length,s=o*e+(o-2)*i;this.texts.forEach(function(e,o){var r=Math.floor(t.pos.x+t.game.squareSize*(t.size.width-e.size.width)/2),h=Math.floor(t.pos.y+(t.drawingSize.height-s)/2+i*o);e.move({x:r,y:h})})}},t}(),La=Ka;g.default=La;var s={},J=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});var Oa=J(g),N=J(f),Qa=J(k),Ra=function(){function e(e,t,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.animations={},this.game=e,this.energyText=new Qa.default(this.game,i,N.default[7]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.drawingSize=Object.assign({},this.energyText.drawingSize),this.drawingSize.width=(this.size.width+1)*this.game.squareSize,this.drawingSize.height=(this.size.height+1)*this.game.squareSize;var a={height:this.size.height+1,width:this.size.width+1};this.box=new Oa.default(e,t,a,N.default[7]),this.animations.level=Object.assign({},ba),this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.animations).map(function(t){return e.animations[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:Math.floor(e.x+b.SQUARE_SIZE/2+.5),y:Math.floor(e.y+b.SQUARE_SIZE/2+.5)})},e.prototype.draw=function(e,t){this.updateLevel(t),this.box.draw(e,t),e.fillStyle=N.default[1],e.fillRect(this.pos.x,this.pos.y,this.drawingSize.width*this.percentFull,this.drawingSize.height),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.animations.level.startTime=this.game.timestamp,this.animations.level.startLevel=this.percentFull,this.animations.level.endLevel=e,this.animations.level.running=!0},e.prototype.updateLevel=function(e){if(this.animations.level.running){var t=(e-this.animations.level.startTime)/this.animations.level.duration,i=r(this.animations.level.startLevel,this.animations.level.endLevel,t);t>=1&&(i=this.animations.level.endLevel,this.animations.level.running=!1),this.percentFull=i}},e}(),Sa=Ra;s.default=Sa;var i={},Ua=i&&i.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),t=i&&i.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var Wa=t(p),Xa=t(g),Ya=t(j),z=t(f),sa=t(s),F=t(k),ab=4,pa=4*b.TS,cb=2,oa=3,D=.5,fb=function(e){function t(t){var r=e.call(this,t)||this;r.backgroundColor=z.default[9],r.tileTypeMap=["green","flowers","sky","tree"],r.currentSkillIndex=0,r.waiting=!1,r.energyBar=new sa.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"ENERGY"),r.convoBar=new sa.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"CONVO"),r.box=new Xa.default(r.game,{x:0,y:0},{height:0,width:0}),r.upArrow=new F.default(r.game,"^"),r.downArrow=new F.default(r.game,"_");var i=G(r.handleInput.bind(r),b.T_TIME);return r.handleInput=i,r.upArrow.touched=function(){return r.handleInput("ArrowUp")},r.downArrow.touched=function(){return r.handleInput("ArrowDown")},r}return Ua(t,e),t.prototype.handleInput=function(e){switch(e){case"ArrowUp":this.moveSkillCursor(1);break;case"ArrowDown":this.moveSkillCursor(-1);break;case"Enter":this.useSelectedSkill();}},t.prototype.handleTouch=function(e){var t=this.touchedTouchable(e);t?t.touched():this.handleInput(null)},t.prototype.setBuddy=function(e){this.buddy=e,this.buddy.setConvoMode(!0,"left")},t.prototype.levelWillStart=function(){var e=this;this.buddy||(this.setBuddy(new Ya.default(this.game)),this.buddy.skills.push(b.LISTEN)),this.clearTouchables(),this.game.player.setConvoMode(!0,"right"),this.convoLevel=0,this.buddies=[this.game.player,this.buddy],this.skills=this.game.player.skills.map(function(t){return new F.default(e.game,t)}),this.skills.forEach(function(t){return t.touched=function(){e.skills[e.currentSkillIndex]===t&&e.handleInput("Enter")}})},t.prototype.levelStarted=function(){this.moveBuddies(),this.convoBar.animateToLevel(this.convoLevel),this.energyBar.animateToLevel(this.game.player.energy)},t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.updateText(),this.updateFloatyText(),this.convoLevel>=1&&!this.convoBar.animating&&this.game.queueNextLevel(this.game.levels.world,"post-convo")},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.updateBoxes(),this.updateText(),this.moveSkillCursor(0),this.moveBuddies(),this.generateTileIndexes(),this.generateTiles(),this.addDrawables(this.tiles,0),this.addDrawables(this.buddies,1),this.addOverlayDrawables([this.box,this.upArrow,this.downArrow,this.energyBar,this.convoBar].concat(this.skills)),this.addTouchables([this.upArrow,this.downArrow].concat(this.skills))},t.prototype.generateTileIndexes=function(){var e=this.game.sizeInTiles(),t=this.game.player.tileIndex.y;this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return u([0,1])})});for(var r=0;r<t;r++)this.tileIndexes[r]=this.tileIndexes[r].map(function(){return 2});var i=this.tileIndexes[t-1];i&&(this.tileIndexes[t-1]=i.map(function(){return 3}))},t.prototype.moveSkillCursor=function(e){var t=this.currentSkillIndex+e,r=this.skills[t]||this.skills[this.currentSkillIndex];this.currentSkillIndex=this.skills.indexOf(r),this.downArrow.alpha=1,this.upArrow.alpha=1,this.skills.forEach(function(e){return e.alpha=D}),0===this.currentSkillIndex&&(this.downArrow.alpha=D),this.currentSkillIndex===this.skills.length-1&&(this.upArrow.alpha=D)},t.prototype.useSelectedSkill=function(){var e=this;if(!this.waiting&&!(this.game.player.energy<=0||this.convoLevel>=1)){var t=this.currentSkillIndex;this.buddyExecuteSkillIndex(this.game.player,t),this.waiting=!0,setTimeout(function(){return e.react(t)},2e3);var r=u(this.buddy.skills);1===this.game.player.skills.length&&(r=this.buddy.skills.indexOf(b.LISTEN)),setTimeout(function(){e.buddyExecuteSkillIndex(e.buddy,r)},4e3)}},t.prototype.react=function(e){var t=this.game.player.skills[e];"weather"===t&&1===this.game.player.skills.length&&(this.convoLevel+=.34,this.game.player.energy-=.15,this.buddyFloatText(this.buddy,"oh...",z.default[10]),this.game.camera.shakeScreen()),t===b.LISTEN&&(this.convoLevel+=.2,this.buddyFloatText(this.buddy,"cool!",z.default[9])),this.convoBar.animateToLevel(this.convoLevel),this.energyBar.animateToLevel(this.game.player.energy)},t.prototype.buddyFloatText=function(e,t,r,i){void 0===i&&(i=!1);var a=new F.default(this.game,t,r);a.buddy=e,a.startFloat(e.pos,e===this.buddy?"left":"right",i),this.addDrawables([a],2)},t.prototype.buddyExecuteSkillIndex=function(e,t){var r=e.skills[t],i=r===b.LISTEN?z.default[9]:z.default[1];this.buddyFloatText(e,r,i,r===b.LISTEN),e===this.buddy&&(this.waiting=!1)},t.prototype.moveBuddies=function(){var e=this.buddies[1],t=this.box.pos.x/this.game.squareSize,r=this.box.pos.y/this.game.squareSize-this.game.player.size.height-ab,i=(Math.floor(this.box.drawingSize.height/this.game.squareSize),{x:t+(Math.floor(this.box.drawingSize.width/this.game.squareSize)-(this.game.player.size.width+pa+e.size.width))/2,y:r}),a=Object.assign({},i);a.x+=pa+this.game.player.size.width,this.game.player.move(i),e.move(a)},t.prototype.updateBoxes=function(){var e=this.game.canvas.height-this.game.boxSize.height*this.game.squareSize-2*this.game.squareSize;this.box.move({x:this.game.boxPos.x,y:e}),this.box.updateSize(this.game.boxSize);var t=this.energyBar.drawingSize.width+this.convoBar.drawingSize.width+oa*this.game.squareSize,r=(this.game.canvas.width-t)/2;this.energyBar.move({x:Math.floor(r),y:Math.floor(this.energyBar.pos.y)});var i=this.energyBar.pos.x+this.energyBar.drawingSize.width+oa*this.game.squareSize;this.convoBar.move({x:Math.floor(i),y:Math.floor(this.convoBar.pos.y)})},t.prototype.updateText=function(){var e=this,t=cb*this.game.squareSize,r=Math.floor(this.box.pos.x+this.box.drawingSize.width-this.upArrow.drawingSize.width-t),i=Math.floor(this.box.pos.y+this.box.drawingSize.height/2-this.upArrow.drawingSize.height/2),a=Math.floor(this.box.pos.x+t),o=Math.floor(i);this.upArrow.move({x:r,y:i}),this.downArrow.move({x:a,y:o}),this.skills.forEach(function(t,r){var i=e.currentSkillIndex-r;t.alpha=0!==i||e.waiting?D:1;var a=Math.floor(e.box.pos.x+e.box.drawingSize.width/2-t.drawingSize.width/2),o=Math.floor(e.box.pos.y+e.box.drawingSize.height/2-t.drawingSize.height/2+i*b.LINE_HEIGHT*e.game.squareSize);t.move({x:a,y:o}),t.visible=!(Math.abs(i)>1)})},t.prototype.updateFloatyText=function(){var e=this.drawables[2];this.buddies.forEach(function(t){return t.talking=!!e.find(function(e){return e.buddy===t})});for(var t=e.length-1;t>=0;t--){var r=e[t];r.pos.y+r.size.height<0&&e.splice(t,1)}},t}(Wa.default),gb=fb;i.default=gb;var l={},ib=l&&l.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),ca=l&&l.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(l,"__esModule",{value:!0});var kb=ca(g),lb=ca(p),ta=function(e){function t(t){var r=e.call(this,t)||this;return r.panDirection=1,r.tileTypeMap=["green","flowers","grass","tree"],r.box=new kb.default(r.game,{x:0,y:0},{height:0,width:0}),r.box.touched=function(){return r.handleInput()},r.box.setWords(["CONVO IRL","","TAP TO PLAY"]),r}return ib(t,e),t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this);var t=this.game.sizeInTiles();t.width*=2,t.height*=2,this.generateTileIndexes(t),this.generateTiles(),this.moveText(),this.addTouchables([this.box]),this.addDrawables(this.tiles,0),this.box.animateTextIn(this.game.timestamp),this.addOverlayDrawables([this.box])},t.prototype.handleInput=function(){this.game.transitioning||this.game.queueNextLevel(this.game.levels.world)},t.prototype.handleTouch=function(){this.handleInput()},t.prototype.moveText=function(){this.box.move(this.game.boxPos),this.box.updateSize(this.game.boxSize)},t}(lb.default),nb=ta;l.default=nb;var U,B={};!function(t,e){"function"==typeof U&&U.amd?U(["exports"],e):"object"==typeof B&&"string"!=typeof B.nodeName?e(B):e(t.TinyMusic={})}(B,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),s=/^[0-9.]+$/,i=/\s+/,o=/(\d+)/,n={};function r(t){var e=t.split(i);this.frequency=r.getFrequency(e[0])||0,this.duration=r.getDuration(e[1])||0}function c(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),r.getFrequency=function(t){var s=t.split(o),i=n[s[0]],r=(s[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,r)},r.getDuration=function(t){return s.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,s){(s=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",s.frequency.value=e[1],t.connect(t=s)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof r?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},c.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},c.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sequence=c});var m={},rb=m&&m.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),y=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var tb=y(p),ub=y(g),h=y(j),wb=y(s),xb=y(B),yb=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],P={x:18*b.TS,y:7*b.TS},Ab=function(e){function t(t){var a=e.call(this,t)||this;a.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],a.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,3,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,3,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,3,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,3,,2,,3,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],a.playerSpawnPosition={x:4*b.TS,y:6*b.TS},a.inputBuffer={pressedAt:0,key:null},a.textIntros=yb,a.learnedListen=!1,a.state="intro";var i=G(a.handleTouch.bind(a),b.T_TIME),s=G(a.handleInput.bind(a),b.T_TIME);return a.handleTouch=i,a.handleInput=s,a.generateTiles(),a.energyBar=new wb.default(a.game,{x:0,y:t.squareSize},"ENERGY"),a.box=new ub.default(a.game,a.game.boxPos,a.game.boxSize),a.createBuddies(),a}return rb(t,e),t.prototype.handleInput=function(e){this.game.transitioning||this.handleBoxInput()||(this.inputBuffer={pressedAt:this.game.timestamp,key:e})},t.prototype.handleTouch=function(e){if(!this.game.transitioning&&!this.game.player.walking&&!this.handleBoxInput()){var t=this.game.camera,a=t.size,i=a.height,s=a.width,r=t.offset,o=e.clientX*s/window.innerWidth-r.x,n=e.clientY*i/window.innerHeight-r.y,l=o-this.game.player.pos.x*this.game.squareSize,h=n-this.game.player.pos.y*this.game.squareSize,y=Math.abs(l),$=Math.abs(h),d=this.game.squareSize*b.TS/2;y<d&&$<d||(y>$?this.movePlayerHorizontally(l):this.movePlayerVertically(h))}},t.prototype.resize=function(){var e=Math.floor((this.game.canvas.width-this.energyBar.drawingSize.width)/2);this.energyBar.move({x:e,y:this.energyBar.pos.y}),this.updateBox()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.processInput(),this.startConvo(this.game.player.tileIndex),this.walkingBuddy.pos.x<=P.x-5*b.TS&&(this.walkingBuddy.autoWalkDirection="right"),this.walkingBuddy.pos.x>=P.x+5*b.TS&&(this.walkingBuddy.autoWalkDirection="left"),this.walkingBuddy.update(t),this.listenBuddy.update(t)},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.addDrawables(this.tiles,0),this.addDrawables(this.game.player.dusts,1),this.addDrawables(this.walkingBuddy.dusts,1),this.addDrawables([this.game.player],2),this.addDrawables(this.buddies,2),this.addOverlayDrawables([this.energyBar,this.box]),this.addInteractables(this.buddies),this.addTouchables([this.box]),this.addUpdateables(this.game.player.dusts.concat([this.game.player,this.walkingBuddy],this.walkingBuddy.dusts)),this.resize()},t.prototype.levelStarted=function(){this.energyBar.animateToLevel(this.game.player.energy),this.game.player.move(this.playerSpawnPosition),this.walkingBuddy.move(P),this.game.player.setConvoMode(!1),this.showNextIntroBox(),this.learnFromConvo(),this.showListenBox();var e=new(window.AudioContext||webkitAudioContext),t=new xb.default.Sequence(e,120,["G2 q","G3 q","G4 q"]);t.loop=!1,t.play()},t.prototype.createBuddies=function(){this.listenBuddy=new h.default(this.game),this.listenBuddy.move({x:7*b.TS,y:10*b.TS}),this.listenBuddy.skills.push(b.LISTEN);var e=new h.default(this.game);e.move({x:8*b.TS,y:1*b.TS}),e.skills.push("pastries");var t=new h.default(this.game);t.move({x:18*b.TS,y:3*b.TS}),t.skills.push("france");var a=new h.default(this.game);a.move({x:25*b.TS,y:2*b.TS}),a.skills.push("sports"),this.specialBuddy=new h.default(this.game),this.specialBuddy.move({x:23*b.TS,y:18*b.TS}),this.specialBuddy.look("left"),this.specialBuddy.skills.push("anime");var i=new h.default(this.game);i.move({x:15*b.TS,y:18*b.TS}),i.skills.push("books"),i.look("up");var s=new h.default(this.game);s.move({x:26*b.TS,y:8*b.TS}),s.skills.push("math"),s.look("left"),this.walkingBuddy=new h.default(this.game),this.walkingBuddy.autoWalkDirection="left",this.walkingBuddy.skills.push("math"),this.walkingBuddy.animations.walking.duration=750,this.buddies=[this.listenBuddy,e,t,a,this.specialBuddy,i,s,this.walkingBuddy]},t.prototype.handleBoxInput=function(){return"play"!==this.state&&("sleeping"!==this.state&&"post-convo"!==this.state||(this.state="play",this.box.visible=!1),"sleeping"===this.state&&this.handleInput("ArrowDown"),"post-convo"!==this.state||this.learnedListen||(this.showListenBox(),this.learnedListen=!0),"intro"===this.state&&this.showNextIntroBox(),!0)},t.prototype.showNextIntroBox=function(){if("intro"===this.state){var e=this.textIntros[0];if(!e)return this.state="play",void(this.box.visible=!1);this.box.visible=!0,this.box.setWords(e),this.box.animateTextIn(this.game.timestamp),this.textIntros.shift()}},t.prototype.learnFromConvo=function(){if(this.currentBuddy){var e=this.currentBuddy.skills[u(this.currentBuddy.skills)];this.box.visible=!0,this.game.player.skills.includes(e)?this.box.setWords(["nice convo!","that was a","good time"]):(this.box.setWords(["nice convo!","you learned",e+"!"]),this.game.player.skills.push(e)),this.box.animateTextIn(this.game.timestamp)}},t.prototype.showListenBox=function(){this.currentBuddy===this.listenBuddy&&this.listenBuddy.walk("right")},t.prototype.updateBox=function(){this.box.move(this.game.boxPos),this.box.updateSize(this.game.boxSize)},t.prototype.processInput=function(){if(this.game.timestamp-this.inputBuffer.pressedAt>50)return!1;if(this.game.player.walking)return!1;var e=Object.assign({},this.game.player.tileIndex),t=null;switch(this.inputBuffer.key){case"ArrowUp":t="up",e.y-=1;break;case"ArrowDown":t="down",e.y+=1;break;case"ArrowLeft":t="left",e.x-=1;break;case"ArrowRight":t="right",e.x+=1;}return this.startConvo(e)?void 0:(this.tileAtIndex(e).interactable&&this.sleep(),this.game.player.walk(t),!0)},t.prototype.startConvo=function(e){var t=this.interactables.find(function(t){return t.tileIndex.x===e.x&&t.tileIndex.y===e.y});return!!t&&(this.currentBuddy=t,this.playerSpawnPosition.x=this.game.player.pos.x,this.playerSpawnPosition.y=this.game.player.pos.y,this.game.queueNextLevel(this.game.levels.convo),!0)},t.prototype.sleep=function(){this.game.player.energy=1,this.energyBar.animateToLevel(this.game.player.energy),this.box.setWords(["","zzzzzz...",""]),this.box.animateTextIn(this.game.timestamp),this.box.visible=!0,this.state="sleeping"},t.prototype.movePlayerVertically=function(e){e<0&&this.handleInput("ArrowUp"),e>0&&this.handleInput("ArrowDown")},t.prototype.movePlayerHorizontally=function(e){e>0&&this.handleInput("ArrowRight"),e<0&&this.handleInput("ArrowLeft")},t}(tb.default),Bb=Ab;m.default=Bb;var A={},E=A&&A.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(A,"__esModule",{value:!0});var Eb=E(j),Fb=E(i),Gb=E(l),Hb=E(m),Ib=function(){function t(t){this.timestamp=0,this.squareSize=b.SQUARE_SIZE,this.scaleFactor=1,this.nextLevel=null,this.imageOfPreviousLevel=null,this.player=new Eb.default(this),this.player.skills.push("weather"),this.canvas=t,this.setSize(),this.context=t.getContext("2d",{alpha:!1}),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.levels={convo:new Fb.default(this),startScreen:new Gb.default(this),world:new Hb.default(this)},this.transition=Object.assign({},V)}return Object.defineProperty(t.prototype,"boxPos",{get:function(){return{x:(this.canvas.width-this.boxSize.width*this.squareSize)/2,y:(this.canvas.height-this.boxSize.height*this.squareSize)/2}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxSize",{get:function(){return{height:3*b.LETTER_HEIGHT+2*b.LINE_HEIGHT,width:12*b.LETTER_HEIGHT}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitioning",{get:function(){return this.transition.running},enumerable:!0,configurable:!0}),t.prototype.boot=function(t){this.timestamp=t,this.switchLevel(this.levels.startScreen)},t.prototype.update=function(t){this.timestamp=t,this.currentLevel.update(t),this.transitioning&&this.updateTransition(t)},t.prototype.draw=function(t){this.context&&this.camera&&(this.camera.updateScreenShake(t),this.clearCanvasContext(),this.drawDrawables(t),this.drawOverlayDrawables(t),this.transitioning&&this.updateTransition(t))},t.prototype.resize=function(){this.setSize(),this.currentLevel&&this.currentLevel.resize()},t.prototype.queueNextLevel=function(t,e){if(t===this.levels.convo){var i=this.levels,a=i.convo,r=i.world;a.setBuddy(r.currentBuddy.copy())}this.nextLevel=t,e&&(this.nextLevel.state=e),this.startTransition()},t.prototype.handleInput=function(t){this.currentLevel.handleInput(t)},t.prototype.handleTouch=function(t){this.currentLevel.handleTouch(t)},t.prototype.sizeInTiles=function(){return{width:Math.ceil(this.canvas.width/this.squareSize/b.TS),height:Math.ceil(this.canvas.height/this.squareSize/b.TS)}},t.prototype.startTransition=function(){this.transition.startTime=this.timestamp,this.transition.running=!0,this.imageOfPreviousLevel=new Image,this.imageOfPreviousLevel.src=this.canvas.toDataURL("png"),this.switchLevel(this.nextLevel)},t.prototype.setSize=function(){this.scaleFactor=window.innerWidth/this.canvas.width},t.prototype.updateTransition=function(t){var e=(t-this.transition.startTime)/this.transition.duration;this.transition.prevLevelScale=v(1,5,1,5,e),this.transition.prevLevelAlpha=v(1,0,0,1,e),this.transition.nextLevelAlpha=v(0,1,0,1,e),e>=1&&(this.transition=Object.assign({},V),this.imageOfPreviousLevel=null)},t.prototype.switchLevel=function(t){this.currentLevel=t,t.levelWillStart(),t.configureDrawablesAndUpdateables(),t.levelStarted()},t.prototype.drawDrawables=function(t){var e=this,i=this.camera.offset;if(this.currentLevel.drawables.forEach(function(a){a.forEach(function(a){if(a&&a.visible){var r=a.pos.x*e.squareSize+i.x,n=a.pos.y*e.squareSize+i.y;e.isOffScreen(r,n,a.drawingSize)||(e.context.translate(r+.5|0,n+.5|0),e.context.globalAlpha=e.transitioning?e.transition.nextLevelAlpha:1,a.draw(e.context,t),e.context.setTransform(1,0,0,1,0,0))}})}),this.context.globalAlpha=1,this.imageOfPreviousLevel){this.context.globalAlpha=this.transition.prevLevelAlpha;var a=this.transition.prevLevelScale,r=(this.canvas.width*a-this.canvas.width)/2,n=(this.canvas.height*a-this.canvas.height)/2;this.context.drawImage(this.imageOfPreviousLevel,-r,-n,this.canvas.width*a,this.canvas.height*a),this.context.globalAlpha=1}},t.prototype.isOffScreen=function(t,e,i){return t+i.width<0||t>this.canvas.width||e+i.height<0||e>this.canvas.height},t.prototype.drawOverlayDrawables=function(t){var e=this;this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.currentLevel.overlayDrawables.forEach(function(i){i.visible&&i.draw(e.context,t)}),this.context.globalAlpha=1},t.prototype.clearCanvasContext=function(){this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.context.fillStyle=this.currentLevel.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t}(),Jb=Ib;A.default=Jb;var Y={};Object.defineProperty(Y,"__esModule",{value:!0});function Lb(t,$,e){var r=0,u=0;return function(a){for(r+=Math.min(a-u,10*b.MS_PER),u=a;r>=t;)$.call(e,a),r-=t}}var Mb=Lb;Y.default=Mb;var o={},W=o&&o.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(o,"__esModule",{value:!0});var Pb=W(R),Qb=W(A),Rb=W(Y),Sb=Rb.default(b.MS_PER,bc,o),C=document.getElementById("game"),c=new Qb.default(C),q=new Pb.default(c),I=16*b.TS*b.SQUARE_SIZE,Xb=I,Yb=I,ka=null,$b=!1,_b=!1;function da(){var $=window.innerWidth/window.innerHeight;$>=1?Yb=(Xb=I)/$:Xb=(Yb=I)*$,C.width=Xb,C.height=Yb,q.size={width:C.width,height:C.height},c.resize()}function bc($){if(_b||(c.boot($),da(),_b=!0),c.update($),c.currentLevel===c.levels.startScreen){var a=c.levels.startScreen;q.pos.x-=.05*a.panDirection,q.pos.x<-c.canvas.width&&(a.panDirection=-1),q.pos.x>0&&(a.panDirection=1)}else q.move(c.player)}function aa($){ka&&$b&&c.handleTouch(ka),Sb($),c.draw($),requestAnimationFrame(aa)}function $($){K($),$b=!0}function K($){var a=$;$.touches&&(a=$.changedTouches[0]),ka=a}function qa(){ka=null,$b=!1}c.camera=q,requestAnimationFrame(aa),window.addEventListener("resize",function(){return da()}),window.addEventListener("keydown",function($){return c.handleInput($.key)}),window.addEventListener("mousedown",$,!1),window.addEventListener("touchstart",$,!1),window.addEventListener("mouseup",qa,!1),window.addEventListener("touchend",qa,!1),window.addEventListener("mousemove",K,!1),window.addEventListener("touchmove",K,!1),document.body.addEventListener("touchmove",function($){return $.preventDefault()},{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=o}else if(typeof define==="function"&&define.amd){define(function(){return o})}return{"9B6d":o};});</script> </body> </html>