<html> <title>Convo IRL</title> <head> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"> </head> <body> <canvas id="game"></canvas> <style>*{height:100%;image-rendering:pixelated;image-rendering:optimizeSpeed;margin:0;padding:0;width:100%}</style> <script>parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {var b={};Object.defineProperty(b,"__esModule",{value:!0});var Ia=8;b.TS=Ia;var nc=b.TS/2;b.HALF_TILE_SIZE=nc;var mc=5;b.SQUARE_SIZE=mc;var lc=1/60;b.MS_PER_UPDATE=lc;var jc=16;b.NUM_TILES_ON_LONG_SIDE=jc;var ic=8;b.LINE_HEIGHT=ic;var fc=.5;b.D_ALPHA=fc;var cc=120;b.THROTTLE_TIME=cc;var bc=5;b.LETTER_HEIGHT=bc;var d={};Object.defineProperty(d,"__esModule",{value:!0});function ac(e,r,$){var o=r.x>=0&&r.x<=$.size.width-e.size.width&&r.y>=0&&r.y<$.size.height,n=r.x,t=r.y;n/=b.TS,t/=b.TS;var a=$.tilesGrid[t][n].walkable;return o&&a}var T=ac;function _b(e,r){if(e.running)return!1;var $=r-e.startTime>e.minTimeDelta,o=e.percentChance>Math.random();return $&&o}d.canThingMoveToPosition=T;var S=_b;function Z(e,r,$){return(1-$)*e+$*r}d.shouldDoAnimation=S;var u=Z;function Vb(e,r,$){return Math.max(Math.min(e,$),r)}function P(e,r,$,o,n){return Vb(Z(e,r,n),$,o)}d.lerp=u;var s=P;function Ub(){return 2*Math.round(Math.random())-1}d.clerp=s;var N=Ub;function Qb(e){return[].concat.apply([],e)}d.oneOrMinusOne=N;var J=Qb;function Nb(e){return e[Math.floor(Math.random()*e.length)]}d.flatten=J;var aa=Nb;function Ib(e){return Math.floor(Math.random()*e.length)}d.randomElementFromArray=aa;var E=Ib;function Hb(e,r,$,o){void 0===o&&(o=!1);var n=$,t=r;return o&&(n=r,t=$),e>=.5?P(n,t,r,$,(e-.5)/.5):P(t,n,r,$,e/.5)}d.randomIndexFromArray=E;var pa=Hb;function xb(e){return new Array(b.TS).fill(null).map(function(){return new Array(b.TS).fill(e)})}d.twoPhaseClerp=pa;var C=xb;function vb(e,r){var $;return function(){var o=arguments;$||(e.apply(this,o),$=!0,setTimeout(function(){return $=!1},r))}}d.singleColorTileArray=C;var A=vb;d.throttle=A;var W={};Object.defineProperty(W,"__esModule",{value:!0});var ub=function(){function e(e){this.pos={x:0,y:0},this.size={width:0,height:0},this.game=e,this.player=e.player,this.size={width:e.canvas.width,height:e.canvas.height},this.shake={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:this.shake.pos.x+this.pos.x,y:this.shake.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=this.game.canvas.width/2-e.pos.x*this.game.squareSize-e.drawingSize.width/2,this.pos.y=this.game.canvas.height/2-e.pos.y*this.game.squareSize-e.drawingSize.height/2;var s=-1*(this.game.currentLevel.drawingSize.width-this.size.width),t=-1*(this.game.currentLevel.drawingSize.height-this.size.height);this.pos.x>0&&(this.pos.x=0),this.pos.x<s&&(this.pos.x=s),this.pos.y>0&&(this.pos.y=0),this.pos.y<t&&(this.pos.y=t)},e.prototype.shakeScreen=function(){this.shake.pos={x:0,y:0},this.shake.amplitude=10*this.game.squareSize,this.shake.dir.x=N(),this.shake.dir.y=N()},e.prototype.updateScreenShake=function(e){this.shake.amplitude*=.9;var s=this.shake,t=s.amplitude,i=s.dir;Math.abs(t)<=.01?(this.shake.pos.x=0,this.shake.pos.y=0):(this.shake.pos.x=Math.sin(e/50)*t*i.x,this.shake.pos.y=Math.sin(e/50)*t*i.y)},e}(),tb=ub;W.default=tb;var j={};Object.defineProperty(j,"__esModule",{value:!0});var ob={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},ea=ob;j.blinking=ea;var mb={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},ha=mb;j.lookAway=ha;var jb={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0,t:0},ka=jb;j.walking=ka;var hb={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},na=hb;j.animateEnergy=na;var fb={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},I=fb;j.transition=I;var eb={duration:4e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0},X=eb;j.floatText=X;var e={};Object.defineProperty(e,"__esModule",{value:!0});var db=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];e.default=db;var x={},_a=x&&x.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(x,"__esModule",{value:!0});var Za=_a(e),Va=function(){function t(t){this.size={width:1,height:1},this.pos={x:0,y:0},this.color=Za.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=s(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=s(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.drawingSize.width*e/2,-this.drawingSize.height*e/2,this.drawingSize.width*e,this.drawingSize.height*e)},t}(),Ta=Va;x.default=Ta;var n={},Sa=n&&n.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var Oa=Sa(x),Na=2,Ma=1,Ha=4,Ga=1,Ea=4,za=6,ya=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],va=function(){function t(t){var i=this;this.pos={x:0,y:0},this.size={height:b.TS,width:b.TS},this.visible=!0,this.skills=["weather"],this.tileIndex={x:0,y:0},this.energy=1,this.animations={},this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.squareSize=b.SQUARE_SIZE,this.game=t,this.animations.blinking=Object.assign({},ea),this.animations.walking=Object.assign({},ka,{endPos:this.pos}),this.animations.lookAway=Object.assign({},ha),this.color=aa(ya),this.dusts=Array.from(Array(50).keys()).map(function(){return new Oa.default(i.game)}),this.drawingSize={height:b.TS*this.game.squareSize,width:b.TS*this.game.squareSize},this.squareSize=this.game.squareSize}return Object.defineProperty(t.prototype,"blinking",{get:function(){return this.animations.blinking.running},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"walking",{get:function(){return this.animations.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i},t.prototype.setConvoMode=function(t){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.squareSize,this.size.width=b.TS,this.size.height=b.TS,this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize,t&&(this.squareSize*=2,this.size.width*=2,this.size.height*=2,this.drawingSize.width*=2,this.drawingSize.height*=2)},t.prototype.convoLook=function(t){"right"===t?this.convoLookRight=!0:"left"===t&&(this.convoLookRight=!1)},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.ceil(this.pos.x/b.TS),this.tileIndex.y=Math.ceil(this.pos.y/b.TS)},t.prototype.walk=function(t){var i=this.pos,e=i.x,n=i.y;switch(t){case"left":this.rot=-Math.PI/2,e-=this.game.tileSize;break;case"right":this.rot=Math.PI/2,e+=this.game.tileSize;break;case"down":this.rot=Math.PI,n+=this.game.tileSize;break;case"up":this.rot=0,n-=this.game.tileSize;}var a={x:this.pos.x,y:this.pos.y},s={x:e,y:n};T(this,s,this.game.currentLevel)&&this.configureWalkingAnimation(a,s)},t.prototype.configureWalkingAnimation=function(t,i){var e=this.animations.walking;e.startTime=this.game.timestamp,e.endPos=i,e.startPos=t,e.running=!0,e.t=0},t.prototype.updateWalkingPosition=function(t){if(this.walking){var i=(t-this.animations.walking.startTime)/this.animations.walking.duration,e=u(this.animations.walking.startPos.x,this.animations.walking.endPos.x,i),n=u(this.animations.walking.startPos.y,this.animations.walking.endPos.y,i);this.animations.walking.t=i,i>=1&&(e=this.animations.walking.endPos.x,n=this.animations.walking.endPos.y,this.animations.walking.running=!1,this.animations.walking.t=0),this.move({x:e,y:n})}},t.prototype.draw=function(t,i){this.updateWalkingPosition(i);var e=this.animations.walking.t;t.translate(this.drawingSize.width/2,this.drawingSize.height/2),t.rotate(this.rot),t.translate(-this.drawingSize.width/2,-this.drawingSize.height/2),t.fillStyle=this.color;var n=e;if(e>.5&&(n=1-e),t.fillRect(0,0,this.drawingSize.width,this.drawingSize.height+this.drawingSize.height*n),this.maybeDoEyeAnimations(i),this.drawEye(t,"left",this.animations.blinking.openness,this.animations.lookAway.offset),this.drawEye(t,"right",this.animations.blinking.openness,this.animations.lookAway.offset),this.walking&&i-this.lastDustAt>30){var a=this.dusts.find(function(t){return!t.visible});if(a){var s=this.size.width/2*Math.random()+this.size.width/4,o=this.size.height/2*Math.random()+this.size.height/4,r=this.pos.x+s,h=this.pos.y+o;a.reJuice(i,r,h),this.lastDustAt=i}}},t.prototype.maybeDoEyeAnimations=function(t){var i=this.animations,e=i.blinking,n=i.lookAway;S(e,t)&&(e.running=!0,e.startTime=t),S(n,t)&&(n.running=!0,n.startTime=t),this.runBlinkingAnimation(e,t),this.runLookAwayAnimation(n)},t.prototype.runLookAwayAnimation=function(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)},t.prototype.runBlinkingAnimation=function(t,i){var e=(i-t.startTime)/t.duration;t.openness=pa(e,0,1,!0),e>=1&&(t.running=!1)},t.prototype.drawEye=function(t,i,e,n){var a="left"===i?0:Ha*this.squareSize;t.fillStyle="rgb(0, 0, 0)";var s=Ga,o=0;this.inConvoMode&&(s=Ea),this.inConvoMode&&this.convoLookRight&&(o=za*this.squareSize);var r=s*this.squareSize,h=Na*this.squareSize,$=Ma*this.squareSize;t.fillRect(r+a-o,r,h,h*e),t.fillStyle="rgb(255, 255, 255)",t.fillRect(r+a+n*this.squareSize-o,r,$,$*e)},t}(),qb=va;n.default=qb;var U={};Object.defineProperty(U,"__esModule",{value:!0});var a=null,ta={door:{canvas:null,colorMatrix:C(0),interactable:!0},flowers:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},grass:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]]},green:{canvas:null,colorMatrix:C(2)},house:{canvas:null,colorMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],tileLength:3*b.TS},sky:{canvas:null,colorMatrix:C(9)},tree:{canvas:null,colorMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],walkable:!1},unwalkable:{canvas:null,visible:!1,walkable:!1}};U.default=ta;var v={},oa=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});var ua=oa(e),f=oa(U),wa=function(){function e(e,t,a,i){this.drawingSize={width:b.TS,height:b.TS},this.pos={x:0,y:0},this.alpha=1,this.size={width:b.TS,height:b.TS},this.walkable=!0,this.visible=!0,this.interactable=!1,this.tileLength=b.TS,this.game=e,this.pos={x:a*b.TS,y:i*b.TS},this.tileIndex={x:a,y:i},this.name=t,this.colorMatrix=f.default[t].colorMatrix,this.walkable=f.default[t].hasOwnProperty("walkable")?f.default[t].walkable:this.walkable,this.visible=f.default[t].hasOwnProperty("visible")?f.default[t].visible:this.visible,this.interactable=f.default[t].hasOwnProperty("interactable")?f.default[t].interactable:this.interactable,this.tileLength=f.default[t].hasOwnProperty("tileLength")?f.default[t].tileLength:this.tileLength,this.drawingSize={height:this.tileLength*this.game.squareSize,width:this.tileLength*this.game.squareSize},this.cacheOffscreenContext()}return Object.defineProperty(e.prototype,"offscreenCanvas",{get:function(){return f.default[this.name].canvas},enumerable:!0,configurable:!0}),e.prototype.draw=function(e){e.drawImage(this.offscreenCanvas,0,0)},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.drawingSize.width,t.height=this.drawingSize.height;var a=t.getContext("2d");J(this.colorMatrix).map(function(e){return ua.default[e]}).forEach(function(t,i){if(t){a.fillStyle=t;var r=e.game.squareSize*(i%e.tileLength),$=e.game.squareSize*Math.floor(i/e.tileLength);a.fillRect(r,$,e.game.squareSize,e.game.squareSize)}}),f.default[this.name].canvas=t},e}(),xa=wa;v.default=xa;var k={},la=k&&k.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(k,"__esModule",{value:!0});var Aa=la(e),Ba=la(v),Ca=function(){function e(e){this.tilesGrid=[],this.backgroundColor=Aa.default[2],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.updateables.forEach(function(t){return t.update(e)})},e.prototype.configureDrawablesAndUpdateables=function(){this.clearDrawables(),this.clearOverlayDrawables(),this.clearUpdateables(),this.clearInteractables(),this.clearTouchables()},e.prototype.tileAtIndex=function(e){return this.tilesGrid[e.y][e.x]},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*b.TS,t=this.tileIndexes.length*b.TS;this.size={width:e,height:t},this.drawingSize={width:e*this.game.squareSize,height:t*this.game.squareSize};for(var a=0;a<this.tileIndexes.length;a++){this.tilesGrid.push(new Array(this.tileIndexes[a].length));for(var r=0;r<this.tileIndexes[a].length;r++){var i=this.tileTypeMap[this.tileIndexes[a][r]||0];this.tilesGrid[a][r]=new Ba.default(this.game,i,r,a)}}this.tiles=J(this.tilesGrid)},e.prototype.addDrawables=function(e,t){var a;(a=this.drawables[t]).push.apply(a,e)},e.prototype.addOverlayDrawables=function(e){var t;(t=this.overlayDrawables).push.apply(t,e)},e.prototype.addUpdateables=function(e){var t;(t=this.updateables).push.apply(t,e)},e.prototype.addTouchables=function(e){var t;(t=this.touchables).push.apply(t,e)},e.prototype.addInteractables=function(e){var t;(t=this.interactables).push.apply(t,e)},e.prototype.clearDrawables=function(){this.drawables=new Array(3).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOverlayDrawables=function(){this.overlayDrawables=[]},e.prototype.clearUpdateables=function(){this.updateables=[]},e.prototype.clearInteractables=function(){this.interactables=[]},e.prototype.clearTouchables=function(){this.touchables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return E(t.tileTypeMap)})})},e.prototype.touchedTouchable=function(e){var t=this,a=20*this.game.scaleFactor,r=this.touchables.find(function(r){var i=Object.assign({},r.drawingSize),l=Object.assign({},r.pos);return i.width*=t.game.scaleFactor,i.height*=t.game.scaleFactor,l.x*=t.game.scaleFactor,l.y*=t.game.scaleFactor,e.clientX+a>=l.x&&e.clientX-a<=l.x+i.width&&e.clientY+a>=l.y&&e.clientY-a<=l.y+i.height});if(r&&r.visible)return r},e}(),Da=Ca;k.default=Da;var R={};Object.defineProperty(R,"__esModule",{value:!0});var Fa={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]]};R.default=Fa;var i={},ia=i&&i.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});var sa=ia(e),Ja=ia(R),Ka=function(){function t(t,e,i,s){void 0===i&&(i=sa.default[1]),void 0===s&&(s={x:0,y:0}),this.words="",this.drawingSize={width:0,height:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.animations={},this.upToIndex=null,this.game=t,this.words=e.toUpperCase(),this.upToIndex=this.words.length,this.color=i,this.move(s),this.pixelLetters=this.words.split("").map(function(t){return Ja.default[t]}),this.updateSize(),this.animations.floatText=Object.assign({},X)}return t.prototype.draw=function(t,e){var i=this.pos.x,s=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=s;for(var a=0;a<this.upToIndex;a++){for(var r=this.pos.y,o=0,h=this.pixelLetters[a],n=0;n<h.length;n++){for(var l=h[n],p=0;p<l.length;p++)l[p]&&(this.shadow&&(t.fillStyle=sa.default[0],t.fillRect(i+p*this.game.squareSize+2,r+2,this.game.squareSize,this.game.squareSize)),t.fillStyle=this.color,t.fillRect(i+p*this.game.squareSize,r,this.game.squareSize,this.game.squareSize));o=Math.max(o,l.length*this.game.squareSize),r=this.game.squareSize*(n+1)+this.pos.y}i+=this.game.squareSize+o}this.updateFloat(e)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y},t.prototype.showUpToIndex=function(t){this.upToIndex=t},t.prototype.startFloat=function(t,e,i){void 0===i&&(i=!1);var s=this.game.canvas.width/this.game.squareSize,a=t.x;"left"===e&&(s=0,a=t.x-this.size.width),i&&(s=a),this.animations.floatText.startTime=this.game.timestamp,this.animations.floatText.startPos={x:a,y:t.y-this.size.height},this.animations.floatText.endPos={x:s,y:-10},this.animations.floatText.running=!0,this.move(this.animations.floatText.startPos)},t.prototype.resize=function(){this.drawingSize.width=this.size.width*this.game.squareSize,this.drawingSize.height=this.size.height*this.game.squareSize},t.prototype.updateFloat=function(t){var e=this.animations.floatText;if(e.running){var i=(t-e.startTime)/e.duration,s=Object.assign({},this.pos),a=u(e.startPos.x,e.endPos.x,i);s.x=a+10*Math.sin(6*i*Math.PI),s.y=u(e.startPos.y,e.endPos.y,i),i>=1&&(e.running=!1),this.alpha=1-i,this.move(s)}},t.prototype.updateSize=function(){var t=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,e){return t+e},0)+this.pixelLetters.length-1;this.size={width:t,height:this.game.squareSize},this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize}},t}(),La=Ka;i.default=La;var h={},ga=h&&h.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(h,"__esModule",{value:!0});var O=ga(e),Pa=ga(i),Qa=function(){function t(t,i,e,o){void 0===o&&(o=O.default[8]),this.visible=!0,this.alpha=1,this.texts=[],this.startTime=null,this.game=t,this.pos=i,this.strokePos=i,this.size=e,this.color=o,this.drawingSize={height:this.size.height*this.game.squareSize,width:this.size.width*this.game.squareSize},this.move(i)}return Object.defineProperty(t.prototype,"textLength",{get:function(){return this.texts.reduce(function(t,i){return t+i.words.length},0)},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,this.moveTexts()},t.prototype.updateSize=function(t){this.size.height=t.height,this.size.width=t.width,this.drawingSize.height=this.size.height*this.game.squareSize,this.drawingSize.width=this.size.width*this.game.squareSize},t.prototype.draw=function(t,i){var e=this,o=this.game.transitioning?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=o,t.fillStyle=this.color,t.fillRect(this.pos.x,this.pos.y,this.drawingSize.width,this.drawingSize.height),t.strokeStyle=O.default[1],t.fillStyle=O.default[1],t.lineWidth=this.game.squareSize,t.strokeRect(this.strokePos.x,this.strokePos.y,this.drawingSize.width,this.drawingSize.height);var s=new Array(this.texts.length).fill(0);if(this.startTime){var r=Math.min(Math.floor((i-this.startTime)/50),this.textLength);s=this.texts.map(function(t,i){var o=e.texts.slice(0,i).reduce(function(t,i){return i.words.length+t},0);return Math.min(r-o,t.words.length)})}this.texts.forEach(function(e,o){e.showUpToIndex(s[o]),e.draw(t,i)})},t.prototype.setWords=function(t){var i=this;this.texts=t.map(function(t){return new Pa.default(i.game,t)}),this.moveTexts()},t.prototype.animateTextIn=function(t){this.startTime=t},t.prototype.touched=function(){},t.prototype.moveTexts=function(){var t=this;if(this.texts.length){var i=b.LINE_HEIGHT*this.game.squareSize,e=b.LETTER_HEIGHT*this.game.squareSize,o=this.texts.length,s=o*e+(o-2)*i;this.texts.forEach(function(e,o){var r=Math.floor(t.pos.x+t.game.squareSize*(t.size.width-e.size.width)/2),h=Math.floor(t.pos.y+(t.drawingSize.height-s)/2+i*o);e.move({x:r,y:h})})}},t}(),Ra=Qa;h.default=Ra;var r={},H=r&&r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var Ua=H(h),K=H(e),Wa=H(i),Xa=function(){function e(e,t,i){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.alpha=1,this.animations={},this.game=e,this.energyText=new Wa.default(this.game,i,K.default[7]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.drawingSize=Object.assign({},this.energyText.drawingSize),this.drawingSize.width=(this.size.width+1)*this.game.squareSize,this.drawingSize.height=(this.size.height+1)*this.game.squareSize;var a={height:this.size.height+1,width:this.size.width+1};this.box=new Ua.default(e,t,a,K.default[7]),this.animations.level=Object.assign({},na),this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.animations).map(function(t){return e.animations[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:Math.floor(e.x+b.SQUARE_SIZE/2+.5),y:Math.floor(e.y+b.SQUARE_SIZE/2+.5)})},e.prototype.draw=function(e,t){this.updateLevel(t),this.box.draw(e,t),e.fillStyle=K.default[1],e.fillRect(this.pos.x,this.pos.y,this.drawingSize.width*this.percentFull,this.drawingSize.height),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.animations.level.startTime=this.game.timestamp,this.animations.level.startLevel=this.percentFull,this.animations.level.endLevel=e,this.animations.level.running=!0},e.prototype.updateLevel=function(e){if(this.animations.level.running){var t=(e-this.animations.level.startTime)/this.animations.level.duration,i=u(this.animations.level.startLevel,this.animations.level.endLevel,t);t>=1&&(i=this.animations.level.endLevel,this.animations.level.running=!1),this.percentFull=i}},e}(),Ya=Xa;r.default=Ya;var o={},$a=o&&o.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),q=o&&o.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});var ab=q(k),bb=q(h),cb=q(n),D=q(e),ra=q(r),B=q(i),gb=4,ma=4*b.TS,ib=2,ja=3,kb=function(e){function t(t){var r=e.call(this,t)||this;r.backgroundColor=D.default[9],r.tileTypeMap=["green","flowers","sky","tree"],r.currentSkillIndex=0,r.waiting=!1,r.energyBar=new ra.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"ENERGY"),r.convoBar=new ra.default(r.game,{x:r.game.squareSize,y:r.game.squareSize},"CONVO"),r.box=new bb.default(r.game,{x:0,y:0},{height:0,width:0}),r.upArrow=new B.default(r.game,"^"),r.downArrow=new B.default(r.game,"_");var i=A(r.handleInput.bind(r),b.THROTTLE_TIME);return r.handleInput=i,r.upArrow.touched=function(){return r.handleInput("ArrowUp")},r.downArrow.touched=function(){return r.handleInput("ArrowDown")},r}return $a(t,e),t.prototype.handleInput=function(e){switch(e){case"ArrowUp":this.moveSkillCursor(1);break;case"ArrowDown":this.moveSkillCursor(-1);break;case"Enter":this.useSelectedSkill();}},t.prototype.handleTouch=function(e){var t=this.touchedTouchable(e);t?t.touched():this.handleInput(null)},t.prototype.setBuddy=function(e){this.buddy=e,this.buddy.setConvoMode(!0),this.buddy.convoLook("left")},t.prototype.levelWillStart=function(){var e=this;this.buddy||(this.setBuddy(new cb.default(this.game)),this.buddy.skills.push("listen")),this.clearTouchables(),this.game.player.setConvoMode(!0),this.game.player.convoLook("right"),this.energyBar.animateToLevel(this.game.player.energy),this.convoLevel=0,this.buddies=[this.game.player,this.buddy],this.skills=this.game.player.skills.map(function(t){return new B.default(e.game,t)}),this.skills.forEach(function(t){return t.touched=function(){e.skills[e.currentSkillIndex]===t&&e.handleInput("Enter")}})},t.prototype.levelStarted=function(){this.moveBuddies()},t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.updateText(),this.updateFloatyText(),this.convoLevel>=1&&!this.convoBar.animating&&this.game.queueNextLevel(this.game.levels.world)},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.updateBoxes(),this.updateText(),this.moveSkillCursor(0),this.moveBuddies(),this.generateTileIndexes(),this.generateTiles(),this.addDrawables(this.tiles,0),this.addDrawables(this.buddies,1),this.addOverlayDrawables([this.box,this.upArrow,this.downArrow,this.energyBar,this.convoBar].concat(this.skills)),this.addTouchables([this.upArrow,this.downArrow].concat(this.skills))},t.prototype.generateTileIndexes=function(){var e=this.game.sizeInTiles(),t=this.game.player.tileIndex.y;this.tileIndexes=new Array(e.height).fill(null).map(function(){return new Array(e.width).fill(null).map(function(){return E([0,1])})});for(var r=0;r<t;r++)this.tileIndexes[r]=this.tileIndexes[r].map(function(){return 2});var i=this.tileIndexes[t-1];i&&(this.tileIndexes[t-1]=i.map(function(){return 3}))},t.prototype.moveSkillCursor=function(e){var t=this.currentSkillIndex+e,r=this.skills[t]||this.skills[this.currentSkillIndex];this.currentSkillIndex=this.skills.indexOf(r),this.downArrow.alpha=1,this.upArrow.alpha=1,this.skills.forEach(function(e){return e.alpha=b.D_ALPHA}),0===this.currentSkillIndex&&(this.downArrow.alpha=b.D_ALPHA),this.currentSkillIndex===this.skills.length-1&&(this.upArrow.alpha=b.D_ALPHA)},t.prototype.useSelectedSkill=function(){var e=this;if(!this.waiting&&!(this.game.player.energy<=0||this.convoLevel>=1)){var t=this.currentSkillIndex;this.buddyExecuteSkillIndex(this.game.player,t),this.waiting=!0,setTimeout(function(){return e.react(t)},2e3);var r=E(this.buddy.skills);1===this.game.player.skills.length&&(r=this.buddy.skills.indexOf("listen")),setTimeout(function(){e.buddyExecuteSkillIndex(e.buddy,r)},4e3)}},t.prototype.react=function(e){var t=this.game.player.skills[e];"weather"===t&&1===this.game.player.skills.length&&(this.convoLevel+=.34,this.game.player.energy-=.15,this.buddyFloatText(this.buddy,"yeah...",D.default[10])),"listen"===t&&(this.convoLevel+=.2,this.buddyFloatText(this.buddy,":)",D.default[9])),this.convoBar.animateToLevel(this.convoLevel),this.energyBar.animateToLevel(this.game.player.energy)},t.prototype.buddyFloatText=function(e,t,r,i){void 0===i&&(i=!1);var a=new B.default(this.game,t,r);a.startFloat(e.pos,e===this.buddy?"left":"right",i),this.addDrawables([a],2)},t.prototype.buddyExecuteSkillIndex=function(e,t){var r=e.skills[t];this.buddyFloatText(e,r,D.default[1],"listen"===r),e===this.buddy&&(this.waiting=!1)},t.prototype.moveBuddies=function(){var e=this.buddies[1],t=this.box.pos.x/this.game.squareSize,r=this.box.pos.y/this.game.squareSize-this.game.player.size.height-gb,i=(Math.floor(this.box.drawingSize.height/this.game.squareSize),{x:t+(Math.floor(this.box.drawingSize.width/this.game.squareSize)-(this.game.player.size.width+ma+e.size.width))/2,y:r}),a=Object.assign({},i);a.x+=ma+this.game.player.size.width,this.game.player.move(i),e.move(a)},t.prototype.updateBoxes=function(){var e=this.game.canvas.height-this.game.boxSize.height*this.game.squareSize-2*this.game.squareSize;this.box.move({x:this.game.boxPos.x,y:e}),this.box.updateSize(this.game.boxSize);var t=this.energyBar.drawingSize.width+this.convoBar.drawingSize.width+ja*this.game.squareSize,r=(this.game.canvas.width-t)/2;this.energyBar.move({x:Math.floor(r),y:Math.floor(this.energyBar.pos.y)});var i=this.energyBar.pos.x+this.energyBar.drawingSize.width+ja*this.game.squareSize;this.convoBar.move({x:Math.floor(i),y:Math.floor(this.convoBar.pos.y)})},t.prototype.updateText=function(){var e=this,t=ib*this.game.squareSize,r=Math.floor(this.box.pos.x+this.box.drawingSize.width-this.upArrow.drawingSize.width-t),i=Math.floor(this.box.pos.y+this.box.drawingSize.height/2-this.upArrow.drawingSize.height/2),a=Math.floor(this.box.pos.x+t),o=Math.floor(i);this.upArrow.move({x:r,y:i}),this.downArrow.move({x:a,y:o}),this.skills.forEach(function(t,r){var i=e.currentSkillIndex-r;t.alpha=0!==i||e.waiting?b.D_ALPHA:1;var a=Math.floor(e.box.pos.x+e.box.drawingSize.width/2-t.drawingSize.width/2),o=Math.floor(e.box.pos.y+e.box.drawingSize.height/2-t.drawingSize.height/2+i*b.LINE_HEIGHT*e.game.squareSize);t.move({x:a,y:o}),t.visible=!(Math.abs(i)>1)})},t.prototype.updateFloatyText=function(){for(var e=this.drawables[2],t=e.length-1;t>=0;t--){var r=e[t];r.pos.y+r.size.height<0&&e.splice(t,1)}},t}(ab.default),lb=kb;o.default=lb;var p={},nb=p&&p.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),da=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});var pb=da(h),oc=da(k),rb=function(e){function t(t){var r=e.call(this,t)||this;return r.panDirection=1,r.tileTypeMap=["green","flowers","grass","tree"],r.box=new pb.default(r.game,{x:0,y:0},{height:0,width:0}),r.box.touched=function(){return r.handleInput()},r.box.setWords(["CONVO IRL","","TAP TO PLAY"]),r}return nb(t,e),t.prototype.resize=function(){this.configureDrawablesAndUpdateables()},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this);var t=this.game.sizeInTiles();t.width*=2,t.height*=2,this.generateTileIndexes(t),this.generateTiles(),this.moveText(),this.addTouchables([this.box]),this.addDrawables(this.tiles,0),this.box.animateTextIn(this.game.timestamp),this.addOverlayDrawables([this.box])},t.prototype.handleInput=function(){this.game.transitioning||this.game.queueNextLevel(this.game.levels.world)},t.prototype.handleTouch=function(){this.handleInput()},t.prototype.moveText=function(){this.box.move(this.game.boxPos),this.box.updateSize(this.game.boxSize)},t}(oc.default),sb=rb;p.default=sb;var V,z={};!function(t,e){"function"==typeof V&&V.amd?V(["exports"],e):"object"==typeof z&&"string"!=typeof z.nodeName?e(z):e(t.TinyMusic={})}(z,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),s=/^[0-9.]+$/,i=/\s+/,o=/(\d+)/,n={};function r(t){var e=t.split(i);this.frequency=r.getFrequency(e[0])||0,this.duration=r.getDuration(e[1])||0}function c(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),r.getFrequency=function(t){var s=t.split(o),i=n[s[0]],r=(s[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,r)},r.getDuration=function(t){return s.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,s){(s=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",s.frequency.value=e[1],t.connect(t=s)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof r?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},c.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},c.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sequence=c});var m={},wb=m&&m.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),t=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});var yb=t(k),zb=t(h),Ab=t(n),Bb=t(r),Cb=t(z),Db=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],Eb=["","zzzzzz...",""],Fb=function(e){function t(t){var a=e.call(this,t)||this;a.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],a.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,,,2,,,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,,,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],a.playerSpawnPosition={x:4*b.TS,y:6*b.TS},a.inputBuffer={pressedAt:0,key:null},a.textIntros=Db,a.state="intro";var i=A(a.handleTouch.bind(a),b.THROTTLE_TIME),r=A(a.handleInput.bind(a),b.THROTTLE_TIME);return a.handleTouch=i,a.handleInput=r,a.generateTiles(),a.energyBar=new Bb.default(a.game,{x:0,y:t.squareSize},"ENERGY"),a.box=new zb.default(a.game,a.game.boxPos,a.game.boxSize),a.createBuddies(),a}return wb(t,e),t.prototype.handleInput=function(e){this.game.transitioning||this.handleBoxInput()||(this.inputBuffer={pressedAt:this.game.timestamp,key:e})},t.prototype.handleTouch=function(e){if(!this.game.transitioning&&!this.game.player.walking&&!this.handleBoxInput()){var t=this.game.camera,a=t.size,i=a.height,r=a.width,s=t.offset,o=e.clientX*r/window.innerWidth-s.x,n=e.clientY*i/window.innerHeight-s.y,l=o-this.game.player.pos.x*this.game.squareSize,h=n-this.game.player.pos.y*this.game.squareSize,y=Math.abs(l),p=Math.abs(h),$=this.game.squareSize*b.HALF_TILE_SIZE;if(!(y<$&&p<$))if(y>p)this.movePlayerHorizontally(l)||this.movePlayerVertically(h);else this.movePlayerVertically(h)||this.movePlayerHorizontally(l)}},t.prototype.resize=function(){var e=Math.floor((this.game.canvas.width-this.energyBar.drawingSize.width)/2);this.energyBar.move({x:e,y:this.energyBar.pos.y}),this.updateBox()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.processInput()},t.prototype.configureDrawablesAndUpdateables=function(){e.prototype.configureDrawablesAndUpdateables.call(this),this.addDrawables(this.tiles,0),this.addDrawables(this.game.player.dusts,1),this.addDrawables([this.game.player],2),this.addDrawables(this.buddies,2),this.addOverlayDrawables([this.energyBar,this.box]),this.addInteractables(this.buddies),this.addTouchables([this.box]),this.addUpdateables(this.game.player.dusts.slice()),this.resize()},t.prototype.levelStarted=function(){this.energyBar.animateToLevel(this.game.player.energy),this.game.player.move(this.playerSpawnPosition),this.game.player.setConvoMode(!1),this.showNextIntroBox();var e=new(window.AudioContext||webkitAudioContext),t=new Cb.default.Sequence(e,120,["G2 q","G3 q","G4 q"]);t.loop=!1,t.play()},t.prototype.createBuddies=function(){var e=new Ab.default(this.game);e.move({x:10*b.TS,y:10*b.TS}),e.skills.push("listen"),this.buddies=[e]},t.prototype.handleBoxInput=function(){return"play"!==this.state&&("sleeping"===this.state&&(this.state="play",this.box.visible=!1,this.walk("down")),"intro"===this.state&&this.showNextIntroBox(),!0)},t.prototype.showNextIntroBox=function(){var e=this.textIntros[0];if(!e)return this.state="play",void(this.box.visible=!1);this.box.setWords(e),this.box.animateTextIn(this.game.timestamp),this.textIntros.shift()},t.prototype.updateBox=function(){this.box.move(this.game.boxPos),this.box.updateSize(this.game.boxSize)},t.prototype.processInput=function(){if(!(this.game.timestamp-this.inputBuffer.pressedAt>50))switch(this.inputBuffer.key){case"ArrowUp":this.walk("up");break;case"ArrowDown":this.walk("down");break;case"ArrowRight":this.walk("right");break;case"ArrowLeft":this.walk("left");}},t.prototype.walk=function(e){if(!this.game.player.walking){var t=Object.assign({},this.game.player.tileIndex);switch(e){case"up":t.y-=1;break;case"down":t.y+=1;break;case"left":t.x-=1;break;case"right":t.x+=1;}var a=null,i=this.interactables.find(function(e){return e.tileIndex.x===t.x&&e.tileIndex.y===t.y});if(i&&(this.currentBuddy=i,a=this.game.levels.convo),this.tileAtIndex(t).interactable&&this.sleep(),a)return this.playerSpawnPosition.x=this.game.player.pos.x,this.playerSpawnPosition.y=this.game.player.pos.y,void this.game.queueNextLevel(a);this.game.player.walk(e)}},t.prototype.sleep=function(){this.game.player.energy=1,this.energyBar.animateToLevel(this.game.player.energy),this.box.setWords(Eb),this.box.animateTextIn(this.game.timestamp),this.box.visible=!0,this.state="sleeping"},t.prototype.movePlayerVertically=function(e){return e<0&&this.canThingMoveInDirection(this.game.player,"up")?(this.handleInput("ArrowUp"),!0):!!(e>0&&this.canThingMoveInDirection(this.game.player,"down"))&&(this.handleInput("ArrowDown"),!0)},t.prototype.movePlayerHorizontally=function(e){return e>0&&this.canThingMoveInDirection(this.game.player,"right")?(this.handleInput("ArrowRight"),!0):!!(e<0&&this.canThingMoveInDirection(this.game.player,"left"))&&(this.handleInput("ArrowLeft"),!0)},t.prototype.canThingMoveInDirection=function(e,t){var a=Object.assign({},e.pos);switch(t){case"up":a.y-=this.game.tileSize;break;case"down":a.y+=this.game.tileSize;break;case"left":a.x-=this.game.tileSize;break;case"right":a.x+=this.game.tileSize;}return a.x=a.x-a.x%this.game.tileSize,a.y=a.y-a.y%this.game.tileSize,T(e,a,this)},t}(yb.default),Gb=Fb;m.default=Gb;var y={},F=y&&y.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(y,"__esModule",{value:!0});var Jb=F(n),Kb=F(o),Lb=F(p),Mb=F(m),_=5,Ob=function(){function t(t){this.timestamp=0,this.tileSize=b.TS,this.squareSize=b.SQUARE_SIZE,this.scaleFactor=1,this.nextLevel=null,this.imageOfPreviousLevel=null,this.player=new Jb.default(this),this.canvas=t,this.setSize(),this.context=t.getContext("2d",{alpha:!1}),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.levels={convo:new Kb.default(this),startScreen:new Lb.default(this),world:new Mb.default(this)},this.transition=Object.assign({},I)}return Object.defineProperty(t.prototype,"boxPos",{get:function(){return{x:(this.canvas.width-this.boxSize.width*this.squareSize)/2,y:(this.canvas.height-this.boxSize.height*this.squareSize)/2}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxSize",{get:function(){return{height:3*b.LETTER_HEIGHT+2*b.LINE_HEIGHT,width:12*b.LETTER_HEIGHT}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transitioning",{get:function(){return this.transition.running},enumerable:!0,configurable:!0}),t.prototype.boot=function(t){this.timestamp=t,this.switchLevel(this.levels.startScreen)},t.prototype.update=function(t){this.timestamp=t,this.currentLevel.update(t),this.transitioning&&this.updateTransition(t)},t.prototype.draw=function(t){this.context&&this.camera&&(this.camera.updateScreenShake(t),this.clearCanvasContext(),this.drawDrawables(t),this.drawOverlayDrawables(t),this.transitioning&&this.updateTransition(t))},t.prototype.resize=function(){this.setSize(),this.currentLevel&&this.currentLevel.resize()},t.prototype.queueNextLevel=function(t){if(t===this.levels.convo){var e=this.levels,i=e.convo,a=e.world;i.setBuddy(a.currentBuddy.copy())}this.nextLevel=t,this.startTransition()},t.prototype.handleInput=function(t){this.currentLevel.handleInput(t)},t.prototype.handleTouch=function(t){this.currentLevel.handleTouch(t)},t.prototype.sizeInTiles=function(){return{width:Math.ceil(this.canvas.width/this.squareSize/b.TS),height:Math.ceil(this.canvas.height/this.squareSize/b.TS)}},t.prototype.startTransition=function(){this.transition.startTime=this.timestamp,this.transition.running=!0,this.imageOfPreviousLevel=new Image,this.imageOfPreviousLevel.src=this.canvas.toDataURL("png"),this.switchLevel(this.nextLevel)},t.prototype.setSize=function(){this.size={height:this.canvas.height/this.squareSize,width:this.canvas.width/this.squareSize},this.drawingSize={height:this.canvas.height,width:this.canvas.width},this.scaleFactor=window.innerWidth/this.canvas.width},t.prototype.updateTransition=function(t){var e=(t-this.transition.startTime)/this.transition.duration;this.transition.prevLevelScale=s(1,_,1,_,e),this.transition.prevLevelAlpha=s(1,0,0,1,e),this.transition.nextLevelAlpha=s(0,1,0,1,e),e>=1&&(this.transition=Object.assign({},I),this.imageOfPreviousLevel=null)},t.prototype.switchLevel=function(t){this.currentLevel=t,t.levelWillStart(),t.configureDrawablesAndUpdateables(),t.levelStarted()},t.prototype.drawDrawables=function(t){var e=this,i=this.camera.offset;if(this.currentLevel.drawables.forEach(function(a){a.forEach(function(a){if(a&&a.visible){var r=a.pos.x*e.squareSize+i.x,n=a.pos.y*e.squareSize+i.y;e.isOffScreen(r,n,a.drawingSize)||(e.context.translate(r+.5|0,n+.5|0),e.context.globalAlpha=e.transitioning?e.transition.nextLevelAlpha:1,a.draw(e.context,t),e.context.setTransform(1,0,0,1,0,0))}})}),this.context.globalAlpha=1,this.imageOfPreviousLevel){this.context.globalAlpha=this.transition.prevLevelAlpha;var a=this.transition.prevLevelScale,r=(this.canvas.width*a-this.canvas.width)/2,n=(this.canvas.height*a-this.canvas.height)/2;this.context.drawImage(this.imageOfPreviousLevel,-r,-n,this.canvas.width*a,this.canvas.height*a),this.context.globalAlpha=1}},t.prototype.isOffScreen=function(t,e,i){return t+i.width<0||t>this.canvas.width||e+i.height<0||e>this.canvas.height},t.prototype.drawOverlayDrawables=function(t){var e=this;this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.currentLevel.overlayDrawables.forEach(function(i){i.visible&&i.draw(e.context,t)}),this.context.globalAlpha=1},t.prototype.clearCanvasContext=function(){this.transitioning&&(this.context.globalAlpha=this.transition.nextLevelAlpha),this.context.fillStyle=this.currentLevel.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t}(),Pb=Ob;y.default=Pb;var M={};Object.defineProperty(M,"__esModule",{value:!0});var Rb=10*b.MS_PER_UPDATE;function Sb($,t,r){var u=0,e=0;return function(a){for(u+=Math.min(a-e,Rb),e=a;u>=$;)t.call(r,a),u-=$}}var Tb=Sb;M.default=Tb;var l={},Q=l&&l.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(l,"__esModule",{value:!0});var Wb=Q(W),Xb=Q(y),Yb=Q(M),Zb=.05,$b=Yb.default(b.MS_PER_UPDATE,kc,l),w=document.getElementById("game"),c=new Xb.default(w),g=new Wb.default(c),G=b.NUM_TILES_ON_LONG_SIDE*b.TS*b.SQUARE_SIZE,dc=G,ec=G,qa=null,gc=!1,hc=!1;c.camera=g;var fa={s:g.shakeScreen.bind(g)};function ca(){var $=window.innerWidth/window.innerHeight;$>=1?ec=(dc=G)/$:dc=(ec=G)*$,w.width=dc,w.height=ec,g.size={width:w.width,height:w.height},c.resize()}function kc($){if(hc||(c.boot($),ca(),hc=!0),c.update($),c.currentLevel===c.levels.startScreen){var a=c.levels.startScreen;g.pos.x-=a.panDirection*Zb,g.pos.x<-c.canvas.width&&(a.panDirection=-1),g.pos.x>0&&(a.panDirection=1)}else g.move(c.player)}function ba($){qa&&gc&&c.handleTouch(qa),$b($),c.draw($),requestAnimationFrame(ba)}function $($){L($),gc=!0}function L($){var a=$;$.touches&&(a=$.changedTouches[0]),qa=a}function Y(){qa=null,gc=!1}requestAnimationFrame(ba),window.addEventListener("resize",function(){return ca()}),window.addEventListener("keydown",function($){var a=$.key;fa[a]?fa[a]():c.handleInput(a)}),window.addEventListener("mousedown",$,!1),window.addEventListener("touchstart",$,!1),window.addEventListener("mouseup",Y,!1),window.addEventListener("touchend",Y,!1),window.addEventListener("mousemove",L,!1),window.addEventListener("touchmove",L,!1),document.body.addEventListener("touchmove",function($){return $.preventDefault()},{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=l}else if(typeof define==="function"&&define.amd){define(function(){return l})}return{"9B6d":l};});</script> </body> </html>