<html> <title>Convo IRL</title> <head> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"> </head> <body> <canvas id="game"></canvas> <style>*{height:100%;image-rendering:pixelated;image-rendering:optimizeSpeed;margin:0;padding:0;width:100%}</style> <script>parcelRequire=function(e){var r="function"==typeof parcelRequire&&parcelRequire,n="function"==typeof require&&require,i={};function u(e,u){if(e in i)return i[e];var t="function"==typeof parcelRequire&&parcelRequire;if(!u&&t)return t(e,!0);if(r)return r(e,!0);if(n&&"string"==typeof e)return n(e);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return u.register=function(e,r){i[e]=r},i=e(u),u.modules=i,u}(function (require) {var b={};Object.defineProperty(b,"__esModule",{value:!0});var fb=8;b.TS=fb;var gd=1/60;b.MS_PER=gd;var fd=8;b.L_SPACE=fd;var ed=120;b.T_TIME=ed;var cd=5;b.L_HEIGHT=cd;var ad="*LISTEN*";b.LISTEN=ad;var q={};function Ta(e,$,r){return(1-r)*e+r*$}Object.defineProperty(q,"__esModule",{value:!0});var F=Ta;function Xa(e,$,r){return Math.max(Math.min(e,r),$)}q.lerp=F;var la=Xa;function Yc(e,$,r,t,o){return Xa(Ta(e,$,o),r,t)}q.clamp=la;var u=Yc;function Xc(e){return[].concat.apply([],e)}q.clerp=u;var ja=Xc;function Uc(e){return Math.floor(Math.random()*e.length)}q.flatten=ja;var J=Uc;function Pc(e,$){var r=$.indexOf(e);return r>-1&&($.splice(r,1),!0)}q.randomIndex=J;var ha=Pc;function Oc(e,$){var r;return function(){var t=arguments;r||(e.apply(this,t),r=!0,setTimeout(function(){return r=!1},$))}}q.removeElement=ha;var U=Oc;q.throttle=U;var e={};Object.defineProperty(e,"__esModule",{value:!0});var Nc=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];e.default=Nc;var N={},Jc=N&&N.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(N,"__esModule",{value:!0});var Ic=Jc(e),Gc=function(){function t(t){this.size={w:1,h:1},this.pos={x:0,y:0},this.color=Ic.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=u(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=u(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.dSize.w*e/2,-this.dSize.h*e/2,this.dSize.w*e,this.dSize.h*e)},t}(),Fc=Gc;N.default=Fc;var G={},Ec=G&&G.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(G,"__esModule",{value:!0});var yc=Ec(N),vc=2,uc=1,rc=4,oc=1,nc=4,kc=6,qa=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],ic=function(){function t(t){var i=this;this.pos={x:0,y:0},this.size={h:b.TS,w:b.TS},this.visible=!0,this.skills=[],this.a={},this.tileIndex={x:0,y:0},this.energy=1,this.talking=!1,this.lastConvo=0,this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.game=t;this.a.blinking={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},this.a.lookAway={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},this.stop(),this.color=qa[J(qa)],this.dusts=Array.from(Array(50).keys()).map(function(){return new yc.default(i.game)}),this.dSize={h:b.TS*this.game.ss,w:b.TS*this.game.ss},this.squareSize=this.game.ss,this.rando=100*Math.random()}return Object.defineProperty(t.prototype,"walking",{get:function(){return this.a.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i.skills=this.skills,i},t.prototype.setConvoMode=function(t,i){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.ss,this.size.w=b.TS,this.size.h=b.TS,this.dSize.w=this.size.w*this.game.ss,this.dSize.h=this.size.h*this.game.ss,t?(this.squareSize*=2,this.size.w*=2,this.size.h*=2,this.dSize.w*=2,this.dSize.h*=2,this.a.walking.tw=0):this.talking=!1,this.convoLookRight="right"===i},t.prototype.stop=function(){this.a.walking={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:-1,y:-1},startTime:0,t:0,tw:0}},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.round(this.pos.x/b.TS),this.tileIndex.y=Math.round(this.pos.y/b.TS)},t.prototype.look=function(t){this.walk(t,!0)},t.prototype.walk=function(t,i){void 0===i&&(i=!1);var a=this.pos,s=a.x,e=a.y;switch(t){case"left":this.rot=-Math.PI/2,s-=b.TS;break;case"right":this.rot=Math.PI/2,s+=b.TS;break;case"down":this.rot=Math.PI,e+=b.TS;break;case"up":this.rot=0,e-=b.TS;}if(!i&&!this.walking){var n={x:this.pos.x,y:this.pos.y},r={x:s,y:e};bc.call(this,r)&&this.configureWalkingAnimation(n,r)}},t.prototype.configureWalkingAnimation=function(t,i){var a=this.a.walking;a.startTime=this.game.timestamp,a.endPos=i,a.startPos=t,a.running=!0,a.t=0},t.prototype.update=function(t){if(this.autoWalkDirection&&this.walk(this.autoWalkDirection),-1!==this.a.walking.startPos.x){var i=(t-this.a.walking.startTime)/this.a.walking.duration,a=F(this.a.walking.startPos.x,this.a.walking.endPos.x,i),s=F(this.a.walking.startPos.y,this.a.walking.endPos.y,i);this.a.walking.t=i,i>=1?(a=this.a.walking.endPos.x,s=this.a.walking.endPos.y,this.a.walking.running=!1,this.a.walking.t=0,this.a.walking.tw=Math.max(this.a.walking.tw-100*b.MS_PER,0)):this.a.walking.tw=Math.min(this.a.walking.tw+100*b.MS_PER,this.a.walking.duration),this.move({x:a,y:s})}},t.prototype.draw=function(t,i){t.translate(this.dSize.w/2,this.dSize.h/2),t.rotate(this.rot),t.translate(-this.dSize.w/2,-this.dSize.h/2),t.fillStyle=this.color,t.fillRect(0,0,this.dSize.w,this.dSize.h);var a=this.a.walking.tw/this.a.walking.duration,s=t.createLinearGradient(0,this.dSize.h,0,1.5*this.dSize.h);if(s.addColorStop(0,this.color),s.addColorStop(a,"rgba(150, 192, 131, 0)"),t.fillStyle=s,t.fillRect(0,0,this.dSize.w,1.5*this.dSize.h),ec.call(this,i),Aa.call(this,t,"left",this.a.blinking.openness,this.a.lookAway.offset),Aa.call(this,t,"right",this.a.blinking.openness,this.a.lookAway.offset),this.talking){t.fillStyle="#000";var e=Math.sin(i/80+this.rando)+1;t.fillRect((this.convoLookRight?1:5)*this.squareSize,this.squareSize+e/4,2*this.squareSize+e,2*this.squareSize*e/2)}if(this.walking&&i-this.lastDustAt>30){var n=this.dusts.find(function(t){return!t.visible});if(n){var r=this.size.w/2*Math.random()+this.size.w/4,o=this.size.h/2*Math.random()+this.size.h/4,$=this.pos.x+r,h=this.pos.y+o;n.reJuice(i,$,h),this.lastDustAt=i}}},t}(),hc=ic;function ec(t){var i=this.a,a=i.blinking,s=i.lookAway;Fa(a,t)&&(a.running=!0,a.startTime=t),Fa(s,t)&&(s.running=!0,s.startTime=t),cc.call(this,a,t),dc.call(this,s)}function dc(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)}function cc(t,i){var a=(i-t.startTime)/t.duration;t.openness=_b(a,0,1,!0),a>=1&&(t.running=!1)}function Aa(t,i,a,s){var e="left"===i?0:rc*this.squareSize;t.fillStyle="#000";var n=oc,r=0;this.inConvoMode&&(n=nc),this.inConvoMode&&this.convoLookRight&&(r=kc*this.squareSize);var o=n*this.squareSize,$=vc*this.squareSize,h=uc*this.squareSize;t.fillRect(o+e-r,o,$,$*a),t.fillStyle="#fff",t.fillRect(o+e+s*this.squareSize-r,o,h,h*a)}function bc(t){var i=this.game.currentLevel,a=t.x>=0&&t.x<=i.size.w-this.size.w&&t.y>=0&&t.y<i.size.h,s=t.x,e=t.y;return s/=b.TS,e/=b.TS,a&&i.tilesGrid[e][s].walkable}function Fa(t,i){if(t.running)return!1;var a=i-t.startTime>t.minTimeDelta,s=t.percentChance>Math.random();return a&&s}function _b(t,i,a,s){void 0===s&&(s=!1);var e=a,n=i;if(s&&(e=i,n=a),t>=.5){var r=(t-.5)/.5;return u(e,n,i,a,r)}r=t/.5;return u(n,e,i,a,r)}G.default=hc;var m,h,ka={};Object.defineProperty(ka,"__esModule",{value:!0});var $b=function(){function e(e){this.pos={x:0,y:0},this.size={w:0,h:0},m=e,this.size={w:m.canvas.width,h:m.canvas.height},h={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:h.pos.x+this.pos.x,y:h.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y},e.prototype.moveToPlayer=function(e){this.pos.x=m.canvas.width/2-e.pos.x*m.ss-e.dSize.w/2,this.pos.y=m.canvas.height/2-e.pos.y*m.ss-e.dSize.h/2;var $=-1*(m.currentLevel.dSize.w-this.size.w),a=-1*(m.currentLevel.dSize.h-this.size.h);this.pos.x>0&&(this.pos.x=0),this.pos.x<$&&(this.pos.x=$),this.pos.y>0&&(this.pos.y=0),this.pos.y<a&&(this.pos.y=a)},e.prototype.shakeScreen=function(){h.pos={x:0,y:0},h.amplitude=10*m.ss,h.dir.x=Oa(),h.dir.y=Oa()},e.prototype.updateScreenShake=function(e){h.amplitude*=.9;var $=h.amplitude,a=h.dir;Math.abs($)<=.01?(h.pos.x=0,h.pos.y=0):(h.pos.x=Math.sin(e/50)*$*a.x,h.pos.y=Math.sin(e/50)*$*a.y)},e}(),Zb=$b;function Oa(){return 2*Math.round(Math.random())-1}ka.default=Zb;var ea={};Object.defineProperty(ea,"__esModule",{value:!0});var a=null,Xb={cloud:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,1,1,a,a,a],[a,a,1,1,1,1,a,a],[a,a,1,1,1,1,1,a],[a,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],canvas:null},door:{cMatrix:$(0),canvas:null,interactable:!0},flowers:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},grass:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},green:{cMatrix:$(2),canvas:null},house:{cMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],canvas:null,tileLength:3*b.TS},sky:{cMatrix:$(9),canvas:null},tree:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],canvas:null,walkable:!1},unwalkable:{canvas:null,visible:!1,walkable:!1}};function $($){return new Array(b.TS).fill(null).map(function(){return new Array(b.TS).fill($)})}ea.default=Xb;var Q={},Va=Q&&Q.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Q,"__esModule",{value:!0});var Ub=Va(e),k=Va(ea),Tb=function(){function e(e,t,a,i){this.dSize={w:b.TS,h:b.TS},this.pos={x:0,y:0},this.size={w:b.TS,h:b.TS},this.walkable=!0,this.visible=!0,this.interactable=!1,this.alpha=1,this.tileLength=b.TS,this.game=e,this.pos={x:a*b.TS,y:i*b.TS},this.tileIndex={x:a,y:i},this.name=t,this.cMatrix=k.default[t].cMatrix,this.walkable=k.default[t].hasOwnProperty("walkable")?k.default[t].walkable:this.walkable,this.visible=k.default[t].hasOwnProperty("visible")?k.default[t].visible:this.visible,this.interactable=k.default[t].hasOwnProperty("interactable")?k.default[t].interactable:this.interactable,this.tileLength=k.default[t].hasOwnProperty("tileLength")?k.default[t].tileLength:this.tileLength,this.dSize={h:this.tileLength*this.game.ss,w:this.tileLength*this.game.ss},this.cacheOffscreenContext()}return e.prototype.draw=function(e){e.globalAlpha=this.alpha,e.drawImage(k.default[this.name].canvas,0,0)},e.prototype.moveleft=function(){this.pos.x=this.pos.x+this.size.w<0?this.lWidth:this.pos.x-.008*this.speed},e.prototype.cacheOffscreenContext=function(){var e=this,t=document.createElement("canvas");t.width=this.dSize.w,t.height=this.dSize.h;var a=t.getContext("2d");ja(this.cMatrix).map(function(e){return Ub.default[e]}).forEach(function(t,i){if(t){a.fillStyle=t;var $=e.game.ss*(i%e.tileLength),s=e.game.ss*Math.floor(i/e.tileLength);a.fillRect($,s,e.game.ss,e.game.ss)}}),k.default[this.name].canvas=t},e}(),Sb=Tb;Q.default=Sb;var A={},ab=A&&A.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(A,"__esModule",{value:!0});var Rb=ab(e),na=ab(Q),Qb=function(){function e(e){this.tilesGrid=[],this.bgColor=Rb.default[2],this.clouds=[],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.uables.forEach(function(t){return t.update(e)}),this.clouds.forEach(function(e){return e.moveleft()})},e.prototype.configViz=function(){this.clearDrawables(),this.clearOverlayDrawables(),this.clearUpdateables(),this.clearInteractables(),this.clearTouchables()},e.prototype.tileAtIndex=function(e){return this.tilesGrid[e.y][e.x]},e.prototype.configClouds=function(e,t,r){this.clouds=[];for(var a=0;a<20;a++){var l=new na.default(this.game,"cloud",0,0);l.pos.x=ga(0,e),l.pos.y=ga(0,t),l.speed=ga(.2,1),l.alpha=r,l.lWidth=e,this.clouds.push(l)}},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*b.TS,t=this.tileIndexes.length*b.TS;this.size={w:e,h:t},this.dSize={w:e*this.game.ss,h:t*this.game.ss};for(var r=0;r<this.tileIndexes.length;r++){this.tilesGrid.push(new Array(this.tileIndexes[r].length));for(var a=0;a<this.tileIndexes[r].length;a++){var l=this.tileTypeMap[this.tileIndexes[r][a]||0];this.tilesGrid[r][a]=new na.default(this.game,l,a,r)}}this.tiles=ja(this.tilesGrid)},e.prototype.addDrawables=function(e,t){var r;(r=this.dables[t]).push.apply(r,e)},e.prototype.addOverlayDrawables=function(e){var t;(t=this.odables).push.apply(t,e)},e.prototype.addUpdateables=function(e){var t;(t=this.uables).push.apply(t,e)},e.prototype.addTouchables=function(e){var t;(t=this.tables).push.apply(t,e)},e.prototype.addInteractables=function(e){var t;(t=this.iables).push.apply(t,e)},e.prototype.clearDrawables=function(){this.dables=new Array(4).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOverlayDrawables=function(){this.odables=[]},e.prototype.clearUpdateables=function(){this.uables=[]},e.prototype.clearInteractables=function(){this.iables=[]},e.prototype.clearTouchables=function(){this.tables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.h).fill(null).map(function(){return new Array(e.w).fill(null).map(function(){return J(t.tileTypeMap)})})},e.prototype.touchedTouchable=function(e){var t=this,r=20*this.game.sf,a=this.tables.find(function(a){var l=Object.assign({},a.dSize),i=Object.assign({},a.pos);return l.w*=t.game.sf,l.h*=t.game.sf,i.x*=t.game.sf,i.y*=t.game.sf,e.clientX+r>=i.x&&e.clientX-r<=i.x+l.w&&e.clientY+r>=i.y&&e.clientY-r<=i.y+l.h});if(a&&a.visible)return a},e}(),Pb=Qb;function ga(e,t){return Math.random()*(t-e)+e}A.default=Pb;var X={};Object.defineProperty(X,"__esModule",{value:!0});var Nb={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]],"*":[[,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1]]};X.default=Nb;var v={},ua=v&&v.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(v,"__esModule",{value:!0});var va=ua(e),Ib=ua(X),Gb=function(){function t(t,s,e,a){void 0===s&&(s=""),void 0===e&&(e=va.default[1]),void 0===a&&(a={x:0,y:0}),this.words="",this.dSize={w:0,h:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.buddy=null,this.a={},this.upToIndex=null,this.game=t,this.words=s.toUpperCase(),this.upToIndex=this.words.length,this.color=e,this.move(a),this.pixelLetters=this.words.split("").map(function(t){return Ib.default[t]});var i=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,s){return t+s},0)+this.pixelLetters.length-1;this.size={w:i,h:b.L_HEIGHT},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss};this.a.floatText={duration:3e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0}}return t.prototype.draw=function(t,s){var e=this.pos.x,a=this.game.transitioning()?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha,i=Math.floor(this.game.ss/2);t.globalAlpha=a;for(var o=0;o<this.upToIndex;o++){for(var r=this.pos.y,h=0,l=this.pixelLetters[o],$=0;$<l.length;$++){for(var n=l[$],p=0;p<n.length;p++)n[p]&&(this.shadow&&(t.fillStyle=va.default[0],t.fillRect(e+p*this.game.ss+i,r+i,this.game.ss,this.game.ss)),t.fillStyle=this.color,t.fillRect(e+p*this.game.ss,r,this.game.ss,this.game.ss));h=Math.max(h,n.length*this.game.ss),r=this.game.ss*($+1)+this.pos.y}e+=this.game.ss+h}za.call(this,s)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=Math.floor(t.x),this.pos.y=Math.floor(t.y)},t.prototype.showUpToIndex=function(t){this.upToIndex=t},t.prototype.startFloat=function(t,s){this.a.floatText.startTime=this.game.timestamp,this.a.floatText.startPos={x:t.x,y:t.y-this.size.h},this.a.floatText.endPos={x:s.x,y:s.y},this.a.floatText.running=!0,this.move(this.a.floatText.startPos)},t.prototype.update=function(t){za.call(this,t)},t}(),Eb=Gb;function za(t){var s=this.a.floatText;if(s.running){var e=(t-s.startTime)/s.duration,a=F(s.startPos.x,s.endPos.x,e);this.words!==b.LISTEN&&(a+=10*Math.sin(6*e*Math.PI));var i=F(s.startPos.y,s.endPos.y,e);e>=1&&(s.running=!1),this.alpha=1-e,this.move({x:a,y:i})}}v.default=Eb;var r={},Ba=r&&r.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});var fa=Ba(e),Db=Ba(v),Ab=function(){function t(t,e,i,o){void 0===o&&(o=fa.default[8]),this.visible=!0,this.alpha=1,this.texts=[],this.startTime=null,this.game=t,this.pos=e,this.strokePos=e,this.color=o,this.updateSize(i),this.move(e)}return Object.defineProperty(t.prototype,"textLength",{get:function(){return this.texts.reduce(function(t,e){return t+e.words.length},0)},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,Ga.call(this)},t.prototype.updateSize=function(t){this.size={h:t.h,w:t.w},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}},t.prototype.draw=function(t,e){var i=this,o=this.game.transitioning()?Math.min(this.alpha,this.game.transition.nextLevelAlpha):this.alpha;t.globalAlpha=o,t.fillStyle=this.color,t.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),t.strokeStyle=fa.default[1],t.fillStyle=fa.default[1],t.lineWidth=this.game.ss,t.strokeRect(this.strokePos.x,this.strokePos.y,this.dSize.w,this.dSize.h);var s=new Array(this.texts.length).fill(0);if(this.startTime){var r=Math.min(Math.floor((e-this.startTime)/50),this.textLength);s=this.texts.map(function(t,e){var o=i.texts.slice(0,e).reduce(function(t,e){return e.words.length+t},0);return Math.min(r-o,t.words.length)})}this.texts.forEach(function(i,o){i.showUpToIndex(s[o]),i.draw(t,e)})},t.prototype.setWords=function(t){var e=this;this.texts=t.map(function(t){return new Db.default(e.game,t)}),Ga.call(this)},t.prototype.animateTextIn=function(t){this.startTime=t},t}(),zb=Ab;function Ga(){var t=this;if(this.texts.length){var e=b.L_SPACE*this.game.ss,i=b.L_HEIGHT*this.game.ss,o=this.texts.length,s=o*i+(o-2)*e;this.texts.forEach(function(i,o){var r=t.pos.x+t.game.ss*(t.size.w-i.size.w)/2,a=t.pos.y+(t.dSize.h-s)/2+e*o;i.move({x:r,y:a})})}}r.default=zb;var I={},W=I&&I.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(I,"__esModule",{value:!0});var yb=W(r),Y=W(e),wb=W(v),qb=function(){function e(e,t,r){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.a={},this.game=e,this.energyText=new wb.default(this.game,r,Y.default[7]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.dSize={h:(this.size.h+1)*this.game.ss,w:(this.size.w+1)*this.game.ss};var i={h:this.size.h+1,w:this.size.w+1};this.box=new yb.default(e,t,i,Y.default[7]);this.a.level={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.a).map(function(t){return e.a[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:e.x+this.game.ss/2+.5,y:e.y+this.game.ss/2+.5})},e.prototype.draw=function(e,t){this.updateLevel(t),this.box.draw(e,t),e.fillStyle=Y.default[1],e.fillRect(this.pos.x,this.pos.y,this.dSize.w*this.percentFull,this.dSize.h),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.a.level.startTime=this.game.timestamp,this.a.level.startLevel=this.percentFull,this.a.level.endLevel=e,this.a.level.running=!0},e.prototype.updateLevel=function(e){if(this.a.level.running){var t=(e-this.a.level.startTime)/this.a.level.duration,r=F(this.a.level.startLevel,this.a.level.endLevel,t);t>=1&&(r=this.a.level.endLevel,this.a.level.running=!1),this.percentFull=r}},e}(),kb=qb;I.default=kb;var x={},jb=x&&x.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,a){$.__proto__=a}||function($,a){for(var e in a)a.hasOwnProperty(e)&&($[e]=a[e])};return function(a,e){function r(){this.constructor=a}$(a,e),a.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),P=x&&x.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(x,"__esModule",{value:!0});var d,Sa,i,z,M,D,o,l,p,ib=P(A),gb=P(r),H=P(e),bb=P(I),L=P(v),gc=4,hd=2,db=3,V=.5,hb=.2,$a=0,y=0,Na=!1,lb=1,mb=null,nb=function($){function a(a){var e=$.call(this,a)||this;e.bgColor=H.default[9],e.tileTypeMap=["green","flowers","sky","tree"],o=new bb.default(e.game,{x:e.game.ss,y:e.game.ss},"ENERGY"),z=new bb.default(e.game,{x:e.game.ss,y:e.game.ss},"CONVO"),d=new gb.default(e.game,{x:0,y:0},{h:0,w:0}),p=new L.default(e.game,"^"),D=new L.default(e.game,"_");var r=U(e.handleInput.bind(e),b.T_TIME);return e.handleInput=r,p.touched=function(){return e.handleInput("ArrowUp")},D.touched=function(){return e.handleInput("ArrowDown")},e}return jb(a,$),Object.defineProperty(a.prototype,"boxPosY",{get:function(){return d.pos.y/this.game.ss-this.game.p.size.h-gc},enumerable:!0,configurable:!0}),a.prototype.handleInput=function($){switch($){case"ArrowUp":_.call(this,1);break;case"ArrowDown":_.call(this,-1);break;case"Enter":tb.call(this);}},a.prototype.handleTouch=function($){var a=this.touchedTouchable($);a&&a.touched()},a.prototype.setBuddy=function($){(i=$).setConvoMode(!0,"left")},a.prototype.levelWillStart=function(){var $=this;Na=!1,this.game.p.setConvoMode(!0,"right"),M=0,this.usedTopics=[],mb=null,Sa=[this.game.p,i],i.skills.length>2&&(lb=hb),(l=this.game.p.skills.map(function(a){return new L.default($.game,a)})).forEach(function(a){return a.touched=function(){l[y]===a&&$.handleInput("Enter")}})},a.prototype.levelStarted=function(){z.animateToLevel(M),o.animateToLevel(this.game.p.energy)},a.prototype.resize=function(){this.configViz()},a.prototype.update=function(a){if($.prototype.update.call(this,a),this.game.camera.move({x:$a,y:0}),Da.call(this),Fb.call(this),Na=da(this.odables).length>0||this.game.transitioning(),pb(this.odables))if(M>=1){var e=1===this.game.p.skills.length?"post-listen":"post-convo";this.game.queueNextLevel(this.game.levels.world,e)}else this.game.p.energy<=0&&this.game.queueNextLevel(this.game.levels.world,"nap")},a.prototype.configViz=function(){$.prototype.configViz.call(this);var a=this.game.sizeInTiles();$a=-a.w*b.TS*this.game.ss/2,a.w*=2,a.h*=2,Cb.call(this),Da.call(this),Bb.call(this),_.call(this,0),this.generateTileIndexes(a),this.generateTiles(),this.addDrawables(this.tiles,0),this.addDrawables(Sa,1),this.addOverlayDrawables([d,p,D,o,z].concat(l)),this.addTouchables([p,D].concat(l)),this.configClouds(this.tilesGrid[0].length*b.TS,this.game.p.pos.y-b.TS,.6),this.addDrawables(this.clouds,0)},a.prototype.generateTileIndexes=function($){var a=Math.min(this.game.p.tileIndex.y+1,$.h);this.tileIndexes=new Array($.h).fill(null).map(function(){return new Array($.w).fill(null).map(function(){return J([0,1])})});for(var e=0;e<a;e++)this.tileIndexes[e]=this.tileIndexes[e].map(function(){return 2});var r=this.tileIndexes[a-1];r&&(this.tileIndexes[a-1]=r.map(function(){return 3}))},a}(ib.default),ob=nb;function pb($){return!z.animating&&0===da($).length}function _($){var a=l[y+$]||l[y];y=l.indexOf(a),D.alpha=1,p.alpha=1,l.forEach(function($){return $.alpha=V}),0===y&&(D.alpha=V),y===l.length-1&&(p.alpha=V)}function rb($){M=la(Math.round(100*(M+$))/100,0,1)}function sb($,a){$.energy=la(Math.round(100*($.energy+a))/100,0,1)}function tb(){var $=this;if(!Na){Na=!0;var a=y;Ea.call(this,this.game.p,a),setTimeout(function(){return ub.call($,a)},2e3);var e=i.skills.indexOf(b.LISTEN);1!==this.game.p.skills.length&&(e=J(i.skills)),setTimeout(function(){return Ea.call($,i,e)},4500)}}function ub($){var a=this.game.p.skills[$];1===this.game.p.skills.length?ma.call(this,-.1,.5):a===b.LISTEN&&2===this.game.p.skills.length?ma.call(this,-.1,.5):a===b.LISTEN?S.call(this,-.1,.25):mb===a?vb.call(this,-.15,.5):i.skills.includes(a)?ma.call(this,-.1,.34):xb.call(this,-.2),z.animateToLevel(M),o.animateToLevel(this.game.p.energy)}function vb($,a){var e=this,r=function(){return T.call(e,i,"totally!",H.default[2])};r(),window.setTimeout(r,500),window.setTimeout(r,1e3),S.call(this,$,a)}function ma($,a){T.call(this,i,"cool!",H.default[2]),S.call(this,$,a)}function xb($){T.call(this,i,"oh...",H.default[10]),S.call(this,$,0),this.game.camera.shakeScreen()}function S($,a){sb(this.game.p,$),rb(a*lb)}function T($,a,e){var r=new L.default(this.game,a,e);r.buddy=$;var t=this.boxPosY*this.game.ss+this.game.p.dSize.h/2,o={x:d.pos.x+this.game.p.dSize.w/2,y:t},i={x:this.game.canvas.width,y:-b.L_HEIGHT};$!==this.game.p&&(o.x+=d.dSize.w-r.dSize.w-this.game.p.dSize.w,i.x=0),a===b.LISTEN&&(i.x=o.x),r.startFloat(o,i),this.addOverlayDrawables([r]),this.addUpdateables([r])}function Ea($,a){if(!(M>=1||this.game.p.energy<=0)){var e=$.skills[a],r=e===b.LISTEN?H.default[9]:H.default[1];T.call(this,$,e,r),$===i&&(mb=e,this.usedTopics.includes(e)||this.usedTopics.push(e))}}function Bb(){var $=this.game.boxPos().x/this.game.ss-i.size.w/2-$a/this.game.ss,a=$+d.dSize.w/this.game.ss-i.size.w/2,e={x:$+this.game.p.size.w/2,y:this.boxPosY};this.game.p.move(e),i.move({x:a,y:e.y})}function Cb(){var $=this.game.canvas.height-this.game.boxSize().h*this.game.ss-2*this.game.ss;d.move({x:this.game.boxPos().x,y:$}),d.updateSize(this.game.boxSize());var a=o.dSize.w+z.dSize.w+db*this.game.ss,e=(this.game.canvas.width-a)/2;o.move({x:e,y:o.pos.y});var r=o.pos.x+o.dSize.w+db*this.game.ss;z.move({x:r,y:z.pos.y})}function Da(){var $=this,a=hd*this.game.ss,e=d.pos.x+d.dSize.w-p.dSize.w-a,r=d.pos.y+d.dSize.h/2-p.dSize.h/2,t=d.pos.x+a,o=r;p.move({x:e,y:r}),D.move({x:t,y:o}),l.forEach(function(a,e){var r=y-e;a.alpha=0!==r||Na?V:1;var t=d.pos.x+d.dSize.w/2-a.dSize.w/2,o=d.pos.y+d.dSize.h/2-a.dSize.h/2+r*b.L_SPACE*$.game.ss;a.move({x:t,y:o}),a.visible=!(Math.abs(r)>1)})}function da($){return $.filter(function($){return $ instanceof L.default&&$.buddy})}function Fb(){var $=da(this.odables);Sa.forEach(function(a){return a.talking=!!$.find(function($){return $.words!==b.LISTEN&&$.buddy===a})});for(var a=$.length-1;a>=0;a--){var e=$[a];if(!e)break;e.a.floatText.running||(ha(e,this.odables),this.uables.splice(a,1))}}x.default=ob;var t={},Hb=t&&t.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),wa=t&&t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var Jb=wa(r),Kb=wa(A),Lb=function(e){function t(t){var o=e.call(this,t)||this;return o.panDirection=1,o.tileTypeMap=["green","flowers","grass","tree"],o.box=new Jb.default(o.game,{x:0,y:0},{h:0,w:0}),o.box.setWords(["CONVO IRL","","TAP TO PLAY"]),o}return Hb(t,e),t.prototype.resize=function(){this.configViz()},t.prototype.update=function(t){e.prototype.update.call(this,t),this.game.camera.pos.x-=.05*this.panDirection,this.game.camera.pos.x<-this.game.canvas.width&&(this.panDirection=-1),this.game.camera.pos.x>0&&(this.panDirection=1)},t.prototype.configViz=function(){e.prototype.configViz.call(this);var t=this.game.sizeInTiles();t.w*=2,t.h*=2,this.generateTileIndexes(t),this.generateTiles(),this.moveText(),this.addDrawables(this.tiles,0),this.addOverlayDrawables([this.box]),this.configClouds(this.tilesGrid[0].length*b.TS,this.tilesGrid.length*b.TS,.3),this.addDrawables(this.clouds,3)},t.prototype.levelStarted=function(){var e=this;window.setTimeout(function(){return e.box.animateTextIn(e.game.timestamp)},200)},t.prototype.handleInput=function(){this.game.transitioning()||this.game.queueNextLevel(this.game.levels.world)},t.prototype.handleTouch=function(){this.handleInput()},t.prototype.moveText=function(){this.box.move(this.game.boxPos()),this.box.updateSize(this.game.boxSize())},t}(Kb.default),Mb=Lb;t.default=Mb;var w={},Ob=w&&w.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,a){$.__proto__=a}||function($,a){for(var e in a)a.hasOwnProperty(e)&&($[e]=a[e])};return function(a,e){function t(){this.constructor=a}$(a,e),a.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}(),R=w&&w.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(w,"__esModule",{value:!0});var oa,c,j,B,Z,Vb=R(A),Wb=R(r),s=R(G),Yb=R(I),Ma=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],La=[["keep at it","and make","new friends!"],["if you are","low on energy","take a nap!"]],aa={x:18*b.TS,y:7*b.TS},ac={x:4*b.TS,y:5*b.TS},g=["PASTRIES","FRANCE","SPORTS","ANIME","BOOKS","MATH","CATS"],ya=g.slice(),ba={x:4*b.TS,y:6*b.TS},ta={pressedAt:0,key:null},fc=function($){function a(a){var e=$.call(this,a)||this;e.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],e.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,3,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,3,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,3,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,3,,2,,3,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],e.state="intro";var t=U(e.handleTouch.bind(e),b.T_TIME),r=U(e.handleInput.bind(e),b.T_TIME);return e.handleTouch=t,e.handleInput=r,e.generateTiles(),e.energyBar=new Yb.default(e.game,{x:0,y:a.ss},"ENERGY"),c=new Wb.default(e.game,e.game.boxPos(),e.game.boxSize()),sc.call(e),e}return Ob(a,$),a.prototype.handleInput=function($){this.game.transitioning()||ra.call(this)||(ta={pressedAt:this.game.timestamp,key:$})},a.prototype.handleTouch=function($){if(!this.game.transitioning()&&!this.game.p.walking&&!ra.call(this)){var a=this.game.camera,e=a.size,t=e.h,r=e.w,o=a.offset,i=$.clientX*r/window.innerWidth-o.x,s=$.clientY*t/window.innerHeight-o.y,n=i-this.game.p.pos.x*this.game.ss,y=s-this.game.p.pos.y*this.game.ss,l=Math.abs(n),v=Math.abs(y),P=this.game.ss*b.TS/2;l<P&&v<P||(l>v?qc.call(this,n):pc.call(this,y))}},a.prototype.resize=function(){var $=(this.game.canvas.width-this.energyBar.dSize.w)/2;this.energyBar.move({x:$,y:this.energyBar.pos.y}),mc.call(this)},a.prototype.update=function(a){$.prototype.update.call(this,a),tc.call(this),cb.call(this,this.game.p.tileIndex),this.game.camera.moveToPlayer(this.game.p),j.pos.x<=aa.x-5*b.TS&&(j.autoWalkDirection="right"),j.pos.x>=aa.x+5*b.TS&&(j.autoWalkDirection="left")},a.prototype.configViz=function(){$.prototype.configViz.call(this),this.addDrawables(this.tiles,0),this.addDrawables(this.game.p.dusts,1),this.addDrawables(j.dusts,1),this.addDrawables([this.game.p],2),this.addDrawables(oa,2),this.addOverlayDrawables([this.energyBar,c]),this.addInteractables(oa),this.addUpdateables(this.game.p.dusts.concat([this.game.p,j],j.dusts,[B])),this.configClouds(this.tilesGrid[0].length*b.TS,this.tilesGrid.length*b.TS,.3),this.addDrawables(this.clouds,3),this.resize()},a.prototype.levelStarted=function(){switch(this.energyBar.animateToLevel(this.game.p.energy),j.move(aa),this.game.p.move(ba),this.game.p.stop(),this.game.p.setConvoMode(!1),this.state){case"intro":pa.call(this);break;case"nap":this.game.p.move(ac),_a.call(this);break;case"post-listen":case"post-convo":lc.call(this),this.currentBuddy.lastConvo=this.game.timestamp,this.game.p.lastConvo=this.game.timestamp;}},a}(Vb.default),eb=fc;function sa(){c.visible=!1}function ra(){if("play"===this.state)return!1;switch(this.state){case"sleeping":sa.call(this),this.state="play",this.handleInput("ArrowDown");break;case"post-convo":sa.call(this),this.state="play";break;case"post-listen":jc.call(this);break;case"intro":pa.call(this);}return!0}function jc(){var $=La[0];if(!$)return this.state="play",c.visible=!1,B.walk("right"),void B.look("left");c.visible=!0,c.setWords($),c.animateTextIn(this.game.timestamp),La.shift()}function pa(){var $=Ma[0];if(!$)return this.state="play",void(c.visible=!1);c.visible=!0,c.setWords($),c.animateTextIn(this.game.timestamp),Ma.shift()}function lc(){var $=this;if(this.currentBuddy){var a=this.game.levels.convo.usedTopics.filter(function(a){return!$.game.p.skills.includes(a)}),e=a.length>0?a[J(a)]:null;c.visible=!0,e?(c.setWords(["nice convo!","you learned",e+"!"]),this.game.p.skills.push(e)):c.setWords(["nice convo!","that was a","good time!"]),c.animateTextIn(this.game.timestamp)}}function mc(){c.move(this.game.boxPos()),c.updateSize(this.game.boxSize())}function cb($){var a=this.iables.find(function(a){return a.tileIndex.x===$.x&&a.tileIndex.y===$.y});return!!(a&&this.game.timestamp-a.lastConvo>1e3)&&(this.currentBuddy=a,ba.x=this.game.p.pos.x,ba.y=this.game.p.pos.y,this.game.queueNextLevel(this.game.levels.convo),!0)}function _a(){this.game.p.energy=1,this.energyBar.animateToLevel(this.game.p.energy),c.setWords(["","zzzzzz...",""]),c.animateTextIn(this.game.timestamp),c.visible=!0,this.state="sleeping"}function pc($){$<0&&this.handleInput("ArrowUp"),$>0&&this.handleInput("ArrowDown")}function qc($){$>0&&this.handleInput("ArrowRight"),$<0&&this.handleInput("ArrowLeft")}function C($){var a=ya.find(function(a){return a!==$});return ha(a,ya),a}function sc(){var $;(B=new s.default(this.game)).move({x:7*b.TS,y:10*b.TS}),B.skills.push(b.LISTEN,g[6]),B.look("up");var a=new s.default(this.game);a.move({x:8*b.TS,y:1*b.TS}),a.skills.push(g[0],C(g[0]));var e=new s.default(this.game);e.move({x:18*b.TS,y:3*b.TS}),e.skills.push(g[1],C(g[1]));var t=new s.default(this.game);t.move({x:25*b.TS,y:2*b.TS}),t.skills.push(g[2],C(g[2]));var r=new s.default(this.game);r.move({x:15*b.TS,y:18*b.TS}),r.skills.push(g[3],C(g[3])),r.look("up");var o=new s.default(this.game);o.move({x:26*b.TS,y:8*b.TS}),o.skills.push(g[4],C(g[4])),o.look("left"),(j=new s.default(this.game)).autoWalkDirection="left",j.skills.push(g[5],C(g[5])),j.a.walking.duration=600,(Z=new s.default(this.game)).move({x:23*b.TS,y:18*b.TS}),Z.look("left"),($=Z.skills).push.apply($,g),oa=[B,a,e,t,Z,r,o,j]}function tc(){if(this.game.timestamp-ta.pressedAt>30)return!1;if(this.game.p.walking)return!1;var $=Object.assign({},this.game.p.tileIndex),a=null;switch(ta.key){case"ArrowUp":a="up",$.y-=1;break;case"ArrowDown":a="down",$.y+=1;break;case"ArrowLeft":a="left",$.x-=1;break;case"ArrowRight":a="right",$.x+=1;break;default:return;}return cb.call(this,$)?void 0:(this.tileAtIndex($).interactable&&_a.call(this),this.game.p.walk(a),!0)}w.default=eb;var K={},O=K&&K.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(K,"__esModule",{value:!0});var wc,xc,f,zc=O(G),Ac=O(ka),Bc=O(x),Cc=O(t),Dc=O(w),Ua=5,Ra=16*b.TS*Ua,Qa={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},Hc=!1,Pa=null,Ka=null,Kc=function(){function t(t){this.timestamp=0,this.ss=Ua,this.sf=1,this.p=new zc.default(this),this.p.skills.push("WEATHER"),this.canvas=t,Ia.call(this),(f=t.getContext("2d",{alpha:!1})).mozImageSmoothingEnabled=!1,f.webkitImageSmoothingEnabled=!1,this.levels={convo:new Bc.default(this),startScreen:new Cc.default(this),world:new Dc.default(this)},this.transition=Object.assign({},Qa),this.camera=new Ac.default(this)}return t.prototype.boxPos=function(){return{x:(this.canvas.width-this.boxSize().w*this.ss)/2,y:(this.canvas.height-this.boxSize().h*this.ss)/2}},t.prototype.boxSize=function(){return{h:3*b.L_HEIGHT+2*b.L_SPACE,w:12*b.L_HEIGHT}},t.prototype.transitioning=function(){return this.transition.running},t.prototype.update=function(t){Hc||(this.timestamp=t,Ya.call(this,this.levels.startScreen),this.resize(),Hc=!0),this.timestamp=t,this.currentLevel.update(t),this.transitioning()&&xa.call(this,t)},t.prototype.draw=function(t){f&&this.camera&&(this.camera.updateScreenShake(t),Tc.call(this),Qc.call(this,t),Sc.call(this,t),this.transitioning()&&xa.call(this,t))},t.prototype.resize=function(){var t=window.innerWidth/window.innerHeight;t>=1?xc=(wc=Ra)/t:wc=(xc=Ra)*t,this.canvas.width=wc,this.canvas.height=xc,this.camera.size={w:this.canvas.width,h:this.canvas.height},Ia.call(this),this.currentLevel&&this.currentLevel.resize()},t.prototype.queueNextLevel=function(t,e){if(t===this.levels.convo){var a=this.levels,$=a.convo,r=a.world;$.setBuddy(r.currentBuddy.copy())}Pa=t,e&&(Pa.state=e),Mc.call(this)},t.prototype.handleInput=function(t){this.currentLevel.handleInput(t.key)},t.prototype.handleTouch=function(t){this.currentLevel.handleTouch(t)},t.prototype.sizeInTiles=function(){return{w:Math.ceil(this.canvas.width/this.ss/b.TS),h:Math.ceil(this.canvas.height/this.ss/b.TS)}},t}(),Lc=Kc;function Mc(){this.transition.startTime=this.timestamp,this.transition.running=!0,(Ka=new Image).src=this.canvas.toDataURL("png"),Ya.call(this,Pa)}function Ia(){this.sf=window.innerWidth/this.canvas.width}function xa(t){var e=(t-this.transition.startTime)/this.transition.duration;this.transition.prevLevelScale=u(1,5,1,5,e),this.transition.prevLevelAlpha=u(1,0,0,1,e),this.transition.nextLevelAlpha=u(0,1,0,1,e),e>=1&&(this.transition=Object.assign({},Qa),Ka=null)}function Ya(t){this.currentLevel=t,this.currentLevel.levelWillStart(),this.currentLevel.configViz(),this.currentLevel.levelStarted()}function Qc(t){var e=this,a=this.camera.offset;if(this.currentLevel.dables.forEach(function($){$.forEach(function($){if($&&$.visible){var r=$.pos.x*e.ss+a.x,i=$.pos.y*e.ss+a.y;Rc.call(e,r,i,$.dSize)||(f.translate(r+.5|0,i+.5|0),f.globalAlpha=e.transitioning()?e.transition.nextLevelAlpha:1,$.draw(f,t),f.setTransform(1,0,0,1,0,0))}})}),f.globalAlpha=1,Ka){f.globalAlpha=this.transition.prevLevelAlpha;var $=this.transition.prevLevelScale,r=(this.canvas.width*$-this.canvas.width)/2,i=(this.canvas.height*$-this.canvas.height)/2;f.drawImage(Ka,-r,-i,this.canvas.width*$,this.canvas.height*$),f.globalAlpha=1}}function Rc(t,e,a){return t+a.w<0||t>this.canvas.width||e+a.h<0||e>this.canvas.height}function Sc(t){this.transitioning()&&(f.globalAlpha=this.transition.nextLevelAlpha),this.currentLevel.odables.forEach(function(e){e.visible&&e.draw(f,t)}),f.globalAlpha=1}function Tc(){this.transitioning()&&(f.globalAlpha=this.transition.nextLevelAlpha),f.fillStyle=this.currentLevel.bgColor,f.fillRect(0,0,this.canvas.width,this.canvas.height)}K.default=Lc;var ia={};Object.defineProperty(ia,"__esModule",{value:!0});function Vc(t,$,e){var r=0,u=0;return function(a){for(r+=Math.min(a-u,10*b.MS_PER),u=a;r>=t;)$.call(e,a),r-=t}}var Wc=Vc;ia.default=Wc;var E={},Ca=E&&E.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(E,"__esModule",{value:!0});var Zc=Ca(K),$c=Ca(ia),_c=document.getElementById("game"),n=new Zc.default(_c),bd=$c.default(b.MS_PER,n.update,n),Za=null,dd=!1;function Wa($){Za&&dd&&n.handleTouch(Za),bd($),n.draw($),requestAnimationFrame(Wa)}function Ja($){ca($),dd=!0}function ca($){$.preventDefault();var a=$;$.touches&&(a=$.changedTouches[0]),Za=a}function Ha(){Za=null,dd=!1}requestAnimationFrame(Wa),window.onresize=n.resize.bind(n),window.onkeydown=n.handleInput.bind(n),window.onmousedown=Ja,window.ontouchstart=Ja,window.onmouseup=Ha,window.ontouchend=Ha,window.onmousemove=ca,window.addEventListener("touchmove",ca,{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=E}else if(typeof define==="function"&&define.amd){define(function(){return E})}return{"9B6d":E};});</script> </body> </html>