<!doctype html><title>Convo IRL</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><style>*{width:100%;height:100%;margin:0;padding:0;image-rendering:pixelated;image-rendering:optimizeSpeed;overflow:hidden}</style><canvas id="game"></canvas><script>(function () {var b={};Object.defineProperty(b,"__esModule",{value:!0});var lb=8;b.TS=lb;var vd=1/60;b.MS=vd;var ud=8;b.LS=ud;var td=120;b.TT=td;var rd=5;b.LH=rd;var pd="*LISTEN*";b.LT=pd;var p={};function Ha(e,$,r){return(1-r)*e+r*$}Object.defineProperty(p,"__esModule",{value:!0});var E=Ha;function Pa(e,$,r){return Math.max(Math.min(e,r),$)}p.lerp=E;var ra=Pa;function ld(e,$,r,t,o){return Pa(Ha(e,$,o),r,t)}p.clamp=ra;var v=ld;function kd(e){return[].concat.apply([],e)}p.clerp=v;var qa=kd;function hd(e){return Math.floor(Math.random()*e.length)}p.flatten=qa;var C=hd;function cd(e,$){var r=$.indexOf(e);return r>-1&&($.splice(r,1),!0)}p.randomIndex=C;var ma=cd;function bd(e,$){var r;return function(){var t=arguments;r||(e.apply(this,t),r=!0,setTimeout(function(){return r=!1},$))}}p.removeElement=ma;var V=bd;p.throttle=V;var e={};Object.defineProperty(e,"__esModule",{value:!0});var ad=["#3e2d2e","#eeeec7","#96c083","#5fa367","#eeeec7","#dec26d","#6e4c49","#3e625e","#4c547a","#66ccff","#ac4136"];e.default=ad;var R={},Yc=R&&R.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(R,"__esModule",{value:!0});var Xc=Yc(e),Vc=function(){function t(t){this.size={w:1,h:1},this.pos={x:0,y:0},this.color=Xc.default[1],this.visible=!1,this.alpha=1,this.percentGrown=0,this.game=t,this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}}return t.prototype.reJuice=function(t,e,i){this.pos.x=e,this.pos.y=i,this.percentGrown=0,this.startTime=t,this.visible=!0},t.prototype.update=function(t){this.visible&&(this.percentGrown=(t-this.startTime)/1500,this.visible=!(this.percentGrown>=1),this.alpha=v(.3,0,0,.3,this.percentGrown))},t.prototype.draw=function(t){var e=v(1,3,1,3,this.percentGrown);t.globalAlpha=this.alpha,t.fillStyle=this.color,t.fillRect(-this.dSize.w*e/2,-this.dSize.h*e/2,this.dSize.w*e,this.dSize.h*e)},t}(),Uc=Vc;R.default=Uc;var J={},Tc=J&&J.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(J,"__esModule",{value:!0});var Nc=Tc(R),Kc=2,Jc=1,Ic=4,Fc=1,Cc=4,Bc=6,Ya=["#94725d","#bfa17a","#eeeec7","#5a444e","#cd9957","#3e2d2e"],yc=function(){function t(t){var i=this;this.pos={x:0,y:0},this.size={h:b.TS,w:b.TS},this.visible=!0,this.skills=[],this.a={},this.tileIndex={x:0,y:0},this.energy=1,this.talking=!1,this.lastConvo=0,this.rot=Math.PI,this.lastDustAt=0,this.inConvoMode=!1,this.convoLookRight=!1,this.game=t;this.a.blinking={duration:300,minTimeDelta:3e3,openness:1,percentChance:.5,running:!1,startTime:0},this.a.lookAway={duration:0,minTimeDelta:1e3,offset:0,percentChance:.008,running:!1,startTime:0},this.stop(),this.color=Ya[C(Ya)],this.dusts=Array.from(Array(50).keys()).map(function(){return new Nc.default(i.game)}),this.dSize={h:b.TS*this.game.ss,w:b.TS*this.game.ss},this.squareSize=this.game.ss,this.rando=100*Math.random()}return Object.defineProperty(t.prototype,"walking",{get:function(){return this.a.walking.running},enumerable:!0,configurable:!0}),t.prototype.copy=function(){var i=new t(this.game);return i.move(this.pos),i.color=this.color,i.skills=this.skills,i},t.prototype.setConvoMode=function(t,i){this.inConvoMode=t,this.rot=Math.PI,this.squareSize=this.game.ss,this.size.w=b.TS,this.size.h=b.TS,this.dSize.w=this.size.w*this.game.ss,this.dSize.h=this.size.h*this.game.ss,t?(this.squareSize*=2,this.size.w*=2,this.size.h*=2,this.dSize.w*=2,this.dSize.h*=2,this.a.walking.tw=0):this.talking=!1,this.convoLookRight="right"===i},t.prototype.stop=function(){this.a.walking={duration:250,endPos:{x:0,y:0},running:!1,startPos:{x:-1,y:-1},startTime:0,t:0,tw:0}},t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.tileIndex.x=Math.round(this.pos.x/b.TS),this.tileIndex.y=Math.round(this.pos.y/b.TS)},t.prototype.look=function(t){this.walk(t,!0)},t.prototype.walk=function(t,i){void 0===i&&(i=!1);var a=this.pos,s=a.x,e=a.y;switch(t){case"left":this.rot=-Math.PI/2,s-=b.TS;break;case"right":this.rot=Math.PI/2,s+=b.TS;break;case"down":this.rot=Math.PI,e+=b.TS;break;case"up":this.rot=0,e-=b.TS;}if(!i&&!this.walking){var n={x:this.pos.x,y:this.pos.y},o={x:s,y:e};qc.call(this,o)&&this.configureWalkingAnimation(n,o)}},t.prototype.configureWalkingAnimation=function(t,i){var a=this.a.walking;a.startTime=this.game.tstamp,a.endPos=i,a.startPos=t,a.running=!0,a.t=0},t.prototype.update=function(t){if(this.autoWalkDirection&&this.walk(this.autoWalkDirection),-1!==this.a.walking.startPos.x){var i=(t-this.a.walking.startTime)/this.a.walking.duration,a=E(this.a.walking.startPos.x,this.a.walking.endPos.x,i),s=E(this.a.walking.startPos.y,this.a.walking.endPos.y,i);this.a.walking.t=i,i>=1?(a=this.a.walking.endPos.x,s=this.a.walking.endPos.y,this.a.walking.running=!1,this.a.walking.t=0,this.a.walking.tw=Math.max(this.a.walking.tw-100*b.MS,0)):this.a.walking.tw=Math.min(this.a.walking.tw+100*b.MS,this.a.walking.duration),this.move({x:a,y:s})}},t.prototype.draw=function(t,i){t.translate(this.dSize.w/2,this.dSize.h/2),t.rotate(this.rot),t.translate(-this.dSize.w/2,-this.dSize.h/2),t.fillStyle=this.color,t.fillRect(0,0,this.dSize.w,this.dSize.h);var a=this.a.walking.tw/this.a.walking.duration,s=t.createLinearGradient(0,this.dSize.h,0,1.5*this.dSize.h);if(s.addColorStop(0,this.color),s.addColorStop(a,"rgba(150, 192, 131, 0)"),t.fillStyle=s,t.fillRect(0,0,this.dSize.w,1.5*this.dSize.h),wc.call(this,i),xa.call(this,t,"left",this.a.blinking.openness,this.a.lookAway.offset),xa.call(this,t,"right",this.a.blinking.openness,this.a.lookAway.offset),this.talking){t.fillStyle="#000";var e=Math.sin(i/80+this.rando)+1;t.fillRect((this.convoLookRight?1:5)*this.squareSize,this.squareSize+e/4,2*this.squareSize+e,2*this.squareSize*e/2)}if(this.walking&&i-this.lastDustAt>30){var n=this.dusts.find(function(t){return!t.visible});if(n){var o=this.size.w/2*Math.random()+this.size.w/4,r=this.size.h/2*Math.random()+this.size.h/4,$=this.pos.x+o,h=this.pos.y+r;n.reJuice(i,$,h),this.lastDustAt=i}}},t}(),xc=yc;function wc(t){var i=this.a,a=i.blinking,s=i.lookAway;Aa(a,t)&&(a.running=!0,a.startTime=t),Aa(s,t)&&(s.running=!0,s.startTime=t),rc.call(this,a,t),sc.call(this,s)}function sc(t){t.running&&(t.offset=0===t.offset?1:0,t.running=!1)}function rc(t,i){var a=(i-t.startTime)/t.duration;t.openness=wd(a,0,1,!0),a>=1&&(t.running=!1)}function xa(t,i,a,s){var e="left"===i?0:Ic*this.squareSize;t.fillStyle="#000";var n=Fc,o=0;this.inConvoMode&&(n=Cc),this.inConvoMode&&this.convoLookRight&&(o=Bc*this.squareSize);var r=n*this.squareSize,$=Kc*this.squareSize,h=Jc*this.squareSize;t.fillRect(r+e-o,r,$,$*a),t.fillStyle="#fff",t.fillRect(r+e+s*this.squareSize-o,r,h,h*a)}function qc(t){var i=this.game.cl,a=t.x>=0&&t.x<=i.size.w-this.size.w&&t.y>=0&&t.y<i.size.h,s=t.x,e=t.y;return s/=b.TS,e/=b.TS,a&&i.tilesGrid[e][s].walkable}function Aa(t,i){if(t.running)return!1;var a=i-t.startTime>t.minTimeDelta,s=t.percentChance>Math.random();return a&&s}function wd(t,i,a,s){void 0===s&&(s=!1);var e=a,n=i;if(s&&(e=i,n=a),t>=.5){var o=(t-.5)/.5;return v(e,n,i,a,o)}o=t/.5;return v(n,e,i,a,o)}J.default=xc;var n,i,ja={};Object.defineProperty(ja,"__esModule",{value:!0});var nc=function(){function e(e){this.pos={x:0,y:0},this.size={w:0,h:0},n=e,this.size={w:n.canvas.width,h:n.canvas.height},i={amplitude:0,dir:{x:1,y:1},pos:{x:0,y:0}}}return Object.defineProperty(e.prototype,"offset",{get:function(){return{x:i.pos.x+this.pos.x,y:i.pos.y+this.pos.y}},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y},e.prototype.moveToPlayer=function(e){this.pos.x=n.canvas.width/2-e.pos.x*n.ss-e.dSize.w/2,this.pos.y=n.canvas.height/2-e.pos.y*n.ss-e.dSize.h/2;var $=-1*(n.cl.dSize.w-this.size.w),a=-1*(n.cl.dSize.h-this.size.h);this.pos.x>0&&(this.pos.x=0),this.pos.x<$&&(this.pos.x=$),this.pos.y>0&&(this.pos.y=0),this.pos.y<a&&(this.pos.y=a)},e.prototype.shakeScreen=function(){i.pos={x:0,y:0},i.amplitude=10*n.ss,i.dir.x=Ka(),i.dir.y=Ka()},e.prototype.updateShake=function(e){i.amplitude*=.9;var $=i.amplitude,a=i.dir;Math.abs($)<=.01?(i.pos.x=0,i.pos.y=0):(i.pos.x=Math.sin(e/50)*$*a.x,i.pos.y=Math.sin(e/50)*$*a.y)},e}(),mc=nc;function Ka(){return 2*Math.round(Math.random())-1}ja.default=mc;var ha={};Object.defineProperty(ha,"__esModule",{value:!0});var a=null,hc={cloud:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a],[a,a,a,1,1,a,a,a],[a,a,1,1,1,1,a,a],[a,a,1,1,1,1,1,a],[a,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],canvas:null},door:{cMatrix:ga(0),canvas:null,interactable:!0},flowers:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,5,2,2,2,3,2],[2,5,4,5,2,2,2,2],[2,2,5,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},grass:{cMatrix:[[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,2],[2,2,2,2,2,2,2,2],[2,2,3,2,2,2,2,2],[2,2,2,2,2,2,2,2]],canvas:null},green:{cMatrix:ga(2),canvas:null},house:{cMatrix:[[2,2,2,2,2,2,2,2,2,2,2,6,6,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,2,6,6,6,6,2,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,2,6,6,6,6,6,6,2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2,2],[2,2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2,2],[2,2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2,2],[2,2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2,2],[2,2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2,2],[2,2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2,2],[2,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,2],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6],[6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6]],canvas:null,tileLength:3*b.TS},sky:{cMatrix:ga(9),canvas:null},tree:{cMatrix:[[a,a,a,a,a,a,a,a],[a,a,7,7,7,7,a,a],[a,7,7,7,7,7,7,a],[a,7,7,7,7,7,7,a],[a,a,7,7,7,7,a,a],[a,a,a,6,6,a,a,a],[a,a,a,6,6,a,a,a],[a,a,6,6,6,6,a,a]],canvas:null,walkable:!1},unwalkable:{canvas:null,visible:!1,walkable:!1}};function ga($){return new Array(b.TS).fill(null).map(function(){return new Array(b.TS).fill($)})}ha.default=hc;var T={},Sa=T&&T.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(T,"__esModule",{value:!0});var dc=Sa(e),l=Sa(ha),cc=function(){function t(t,e,a,i){this.dSize={w:b.TS,h:b.TS},this.pos={x:0,y:0},this.size={w:b.TS,h:b.TS},this.walkable=!0,this.visible=!0,this.interactable=!1,this.alpha=1,this.tileLength=b.TS,this.game=t,this.pos={x:a*b.TS,y:i*b.TS},this.tileIndex={x:a,y:i},this.name=e,this.cMatrix=l.default[e].cMatrix,this.walkable=l.default[e].hasOwnProperty("walkable")?l.default[e].walkable:this.walkable,this.visible=l.default[e].hasOwnProperty("visible")?l.default[e].visible:this.visible,this.interactable=l.default[e].hasOwnProperty("interactable")?l.default[e].interactable:this.interactable,this.tileLength=l.default[e].hasOwnProperty("tileLength")?l.default[e].tileLength:this.tileLength,this.dSize={h:this.tileLength*this.game.ss,w:this.tileLength*this.game.ss},this.cacheOffscreenContext()}return t.prototype.draw=function(t){t.globalAlpha=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,t.drawImage(l.default[this.name].canvas,0,0)},t.prototype.moveleft=function(){this.pos.x=this.pos.x+this.size.w<0?this.lWidth:this.pos.x-.008*this.speed},t.prototype.cacheOffscreenContext=function(){var t=this,e=document.createElement("canvas");e.width=this.dSize.w,e.height=this.dSize.h;var a=e.getContext("2d");qa(this.cMatrix).map(function(t){return dc.default[t]}).forEach(function(e,i){if(e){a.fillStyle=e;var $=t.game.ss*(i%t.tileLength),s=t.game.ss*Math.floor(i/t.tileLength);a.fillRect($,s,t.game.ss,t.game.ss)}}),l.default[this.name].canvas=e},t}(),bc=cc;T.default=bc;var x={},Za=x&&x.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(x,"__esModule",{value:!0});var ac=Za(e),_a=Za(T),_b=function(){function e(e){this.tilesGrid=[],this.bgColor=ac.default[2],this.clouds=[],this.game=e}return e.prototype.levelWillStart=function(){},e.prototype.levelStarted=function(){},e.prototype.update=function(e){this.uables.forEach(function(t){return t.update(e)}),this.clouds.forEach(function(e){return e.moveleft()})},e.prototype.configViz=function(){this.clearDables(),this.clearOdables(),this.clearUables(),this.clearIables(),this.clearTables()},e.prototype.tileAtIndex=function(e){return this.tilesGrid[e.y][e.x]},e.prototype.configClouds=function(e,t,r){this.clouds=[];for(var a=0;a<20;a++){var l=new _a.default(this.game,"cloud",0,0);l.pos.x=ea(0,e),l.pos.y=ea(0,t),l.speed=ea(.2,1),l.alpha=r,l.lWidth=e,this.clouds.push(l)}},e.prototype.generateTiles=function(){var e=this.tileIndexes[0].length*b.TS,t=this.tileIndexes.length*b.TS;this.size={w:e,h:t},this.dSize={w:e*this.game.ss,h:t*this.game.ss};for(var r=0;r<this.tileIndexes.length;r++){this.tilesGrid.push(new Array(this.tileIndexes[r].length));for(var a=0;a<this.tileIndexes[r].length;a++){var l=this.tileTypeMap[this.tileIndexes[r][a]||0];this.tilesGrid[r][a]=new _a.default(this.game,l,a,r)}}this.tiles=qa(this.tilesGrid)},e.prototype.addDables=function(e,t){var r;(r=this.dables[t]).push.apply(r,e)},e.prototype.addOdables=function(e){var t;(t=this.odables).push.apply(t,e)},e.prototype.addUables=function(e){var t;(t=this.uables).push.apply(t,e)},e.prototype.addTables=function(e){var t;(t=this.tables).push.apply(t,e)},e.prototype.addIables=function(e){var t;(t=this.iables).push.apply(t,e)},e.prototype.clearDables=function(){this.dables=new Array(4).fill(null).map(function(){return new Array().fill(null)})},e.prototype.clearOdables=function(){this.odables=[]},e.prototype.clearUables=function(){this.uables=[]},e.prototype.clearIables=function(){this.iables=[]},e.prototype.clearTables=function(){this.tables=[]},e.prototype.generateTileIndexes=function(e){var t=this;e=e||this.game.sizeInTiles(),this.tileIndexes=new Array(e.h).fill(null).map(function(){return new Array(e.w).fill(null).map(function(){return C(t.tileTypeMap)})})},e}(),$b=_b;function ea(e,t){return Math.random()*(t-e)+e}x.default=$b;var da={};Object.defineProperty(da,"__esModule",{value:!0});var Zb={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]]," ":[[,],[,],[,],[,],[,]],".":[[,,],[,,],[,,],[1,1],[1,1]],"!":[[1,,],[1,,],[1,,],[,,],[1,,]],"^":[[,,,,],[,,1,,],[,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],_:[[,,,,],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1],[,,1,,]],"*":[[,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[,1,1,1]]};da.default=Zb;var B={},ua=B&&B.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(B,"__esModule",{value:!0});var va=ua(e),Xb=ua(da),Wb=function(){function t(t,s,e,a){void 0===s&&(s=""),void 0===e&&(e=va.default[1]),void 0===a&&(a={x:0,y:0}),this.words="",this.dSize={w:0,h:0},this.pos={x:0,y:0},this.visible=!0,this.shadow=!0,this.alpha=1,this.buddy=null,this.a={},this.upToIndex=null,this.game=t,this.words=s.toUpperCase(),this.upToIndex=this.words.length,this.color=e,this.move(a),this.pixelLetters=this.words.split("").map(function(t){return Xb.default[t]});var r=this.pixelLetters.map(function(t){return Math.max.apply(Math,t.map(function(t){return t.length}))}).reduce(function(t,s){return t+s},0)+this.pixelLetters.length-1;this.size={w:r,h:b.LH},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss};this.a.floatText={duration:3e3,endPos:{x:0,y:0},running:!1,startPos:{x:0,y:0},startTime:0}}return t.prototype.draw=function(t,s){var e=this.pos.x,a=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha,r=Math.floor(this.game.ss/2);t.globalAlpha=a;for(var i=0;i<this.upToIndex;i++){for(var o=this.pos.y,h=0,l=this.pixelLetters[i],$=0;$<l.length;$++){for(var n=l[$],p=0;p<n.length;p++)n[p]&&(this.shadow&&(t.fillStyle=va.default[0],t.fillRect(e+p*this.game.ss+r,o+r,this.game.ss,this.game.ss)),t.fillStyle=this.color,t.fillRect(e+p*this.game.ss,o,this.game.ss,this.game.ss));h=Math.max(h,n.length*this.game.ss),o=this.game.ss*($+1)+this.pos.y}e+=this.game.ss+h}za.call(this,s)},t.prototype.touched=function(){},t.prototype.move=function(t){this.pos.x=Math.floor(t.x),this.pos.y=Math.floor(t.y)},t.prototype.showUpToIndex=function(t){this.upToIndex=t},t.prototype.startFloat=function(t,s){this.a.floatText.startTime=this.game.tstamp,this.a.floatText.startPos={x:t.x,y:t.y-this.size.h},this.a.floatText.endPos={x:s.x,y:s.y},this.a.floatText.running=!0,this.move(this.a.floatText.startPos)},t.prototype.update=function(t){za.call(this,t)},t}(),Ub=Wb;function za(t){var s=this.a.floatText;if(s.running){var e=(t-s.startTime)/s.duration,a=E(s.startPos.x,s.endPos.x,e);this.words!==b.LT&&(a+=10*Math.sin(6*e*Math.PI));var r=E(s.startPos.y,s.endPos.y,e);e>=1&&(s.running=!1),this.alpha=1-e,this.move({x:a,y:r})}}B.default=Ub;var r={},Ba=r&&r.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});var ca=Ba(e),Tb=Ba(B),Sb=function(){function t(t,i,o,s){void 0===s&&(s=ca.default[8]),this.visible=!0,this.alpha=1,this.ani=!1,this.texts=[],this.startTime=null,this.game=t,this.pos=i,this.strokePos=i,this.color=s,this.updateSize(o),this.move(i)}return t.prototype.move=function(t){this.pos.x=t.x,this.pos.y=t.y,this.strokePos.x=Math.floor(this.pos.x)+.5,this.strokePos.y=Math.floor(this.pos.y)+.5,Ga.call(this)},t.prototype.updateSize=function(t){this.size={h:t.h,w:t.w},this.dSize={h:this.size.h*this.game.ss,w:this.size.w*this.game.ss}},t.prototype.draw=function(t,i){var o=this,s=this.game.inTr()?Math.min(this.alpha,this.game.nextAlpha):this.alpha;t.globalAlpha=s,t.fillStyle=this.color,t.fillRect(this.pos.x,this.pos.y,this.dSize.w,this.dSize.h),t.strokeStyle=ca.default[1],t.fillStyle=ca.default[1],t.lineWidth=this.game.ss,t.strokeRect(this.strokePos.x,this.strokePos.y,this.dSize.w,this.dSize.h);var e=new Array(this.texts.length).fill(0);if(this.startTime){var r=this.texts.reduce(function(t,i){return t+i.words.length},0),a=Math.min(Math.floor((i-this.startTime)/50),r);r===a&&(this.ani=!1),e=this.texts.map(function(t,i){var s=o.texts.slice(0,i).reduce(function(t,i){return i.words.length+t},0);return Math.min(a-s,t.words.length)})}this.texts.forEach(function(o,s){o.showUpToIndex(e[s]),o.draw(t,i)})},t.prototype.setWords=function(t){var i=this;this.texts=t.map(function(t){return new Tb.default(i.game,t)}),Ga.call(this)},t.prototype.aniText=function(t){this.startTime=t,this.ani=!0},t}(),Mb=Sb;function Ga(){var t=this;if(this.texts.length){var i=b.LS*this.game.ss,o=b.LH*this.game.ss,s=this.texts.length,e=s*o+(s-2)*i;this.texts.forEach(function(o,s){var r=t.pos.x+t.game.ss*(t.size.w-o.size.w)/2,a=t.pos.y+(t.dSize.h-e)/2+i*s;o.move({x:r,y:a})})}}r.default=Mb;var L={},$=L&&L.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(L,"__esModule",{value:!0});var Kb=$(r),ia=$(e),Hb=$(B),Gb=function(){function e(e,t,r){this.pos={x:0,y:0},this.visible=!0,this.percentFull=0,this.a={},this.game=e,this.energyText=new Hb.default(this.game,r,ia.default[7]),this.energyText.shadow=!1,this.size=Object.assign({},this.energyText.size),this.dSize={h:(this.size.h+1)*this.game.ss,w:(this.size.w+1)*this.game.ss};var i={h:this.size.h+1,w:this.size.w+1};this.box=new Kb.default(e,t,i,ia.default[7]);this.a.level={duration:1e3,endLevel:0,running:!1,startLevel:0,startTime:0},this.move(t)}return Object.defineProperty(e.prototype,"animating",{get:function(){var e=this;return!!Object.keys(this.a).map(function(t){return e.a[t]}).find(function(e){return e.running})},enumerable:!0,configurable:!0}),e.prototype.move=function(e){this.pos.x=e.x,this.pos.y=e.y,this.box.move(this.pos),this.energyText.move({x:e.x+this.game.ss/2+.5,y:e.y+this.game.ss/2+.5})},e.prototype.draw=function(e,t){Cb.call(this,t),this.box.draw(e,t),e.fillStyle=ia.default[1],e.fillRect(this.pos.x,this.pos.y,this.dSize.w*this.percentFull,this.dSize.h),this.energyText.draw(e,t)},e.prototype.animateToLevel=function(e){this.a.level.startTime=this.game.tstamp,this.a.level.startLevel=this.percentFull,this.a.level.endLevel=e,this.a.level.running=!0},e}(),Db=Gb;function Cb(e){if(this.a.level.running){var t=(e-this.a.level.startTime)/this.a.level.duration,r=E(this.a.level.startLevel,this.a.level.endLevel,t);t>=1&&(r=this.a.level.endLevel,this.a.level.running=!1),this.percentFull=r}}L.default=Db;var t={},Bb=t&&t.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,e){$.__proto__=e}||function($,e){for(var a in e)e.hasOwnProperty(a)&&($[a]=e[a])};return function(e,a){function r(){this.constructor=e}$(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),M=t&&t.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(t,"__esModule",{value:!0});var d,Ta,g,A,O,H,o,m,u,zb=M(x),tb=M(r),K=M(e),cb=M(L),N=M(B),kb=4,pc=2,gb=3,W=.5,jb=.2,fb=0,y=0,ib=!1,mb=1,nb=null,ob=null,pb=null,qb=function($){function e(e){var a=$.call(this,e)||this;a.bgColor=K.default[9],a.tileTypeMap=["green","flowers","sky","tree"],o=new cb.default(a.game,{x:a.game.ss,y:a.game.ss},"ENERGY"),A=new cb.default(a.game,{x:a.game.ss,y:a.game.ss},"CONVO"),d=new tb.default(a.game,{x:0,y:0},{h:0,w:0}),u=new N.default(a.game,"^"),H=new N.default(a.game,"_");var r=V(a.handleInput.bind(a),b.TT);return a.handleInput=r,u.touched=function(){return a.handleInput("ArrowUp")},H.touched=function(){return a.handleInput("ArrowDown")},a}return Bb(e,$),Object.defineProperty(e.prototype,"boxPosY",{get:function(){return d.pos.y/this.game.ss-this.game.p.size.h-kb},enumerable:!0,configurable:!0}),e.prototype.handleInput=function($){switch($){case"ArrowUp":oa.call(this,1);break;case"ArrowDown":oa.call(this,-1);break;case"Enter":wb.call(this);}},e.prototype.handleTouch=function($){var e=Jb.call(this,$);e&&e.touched()},e.prototype.setBuddy=function($){(g=$).setConvoMode(!0,"left")},e.prototype.levelWillStart=function(){var $=this;ib=!1,this.game.p.setConvoMode(!0,"right"),O=0,this.usedTopics=[],nb=null,Ta=[this.game.p,g],g.skills.length>2&&(mb=jb),(m=this.game.p.skills.map(function(e){return new N.default($.game,e)})).forEach(function(e){return e.touched=function(){m[y]===e&&$.handleInput("Enter")}})},e.prototype.levelStarted=function(){A.animateToLevel(O),o.animateToLevel(this.game.p.energy)},e.prototype.resize=function(){this.configViz()},e.prototype.update=function(e){if($.prototype.update.call(this,e),this.game.c.move({x:fb,y:0}),Ma.call(this),Ib.call(this),ib=aa(this.odables).length>0||this.game.inTr()||!!pb||!!ob,sb(this.odables))if(O>=1){var a=1===this.game.p.skills.length?"post-listen":"post-convo";a=g.skills.length>2?"win":a,this.game.qLevel(this.game.levels.world,a)}else this.game.p.energy<=0&&this.game.qLevel(this.game.levels.world,"nap")},e.prototype.configViz=function(){$.prototype.configViz.call(this);var e=this.game.sizeInTiles();fb=-e.w*b.TS*this.game.ss/2,e.w*=2,e.h*=2,Fb.call(this),Ma.call(this),Eb.call(this),oa.call(this,0),this.generateTileIndexes(e),this.generateTiles(),this.addDables(this.tiles,0),this.addDables(Ta,1),this.addOdables([d,u,H,o,A].concat(m)),this.addTables([u,H].concat(m)),this.configClouds(this.size.w,this.game.p.pos.y-b.TS,.6),this.addDables(this.clouds,0)},e.prototype.generateTileIndexes=function($){var e=Math.min(this.game.p.tileIndex.y+1,$.h);this.tileIndexes=new Array($.h).fill(null).map(function(){return new Array($.w).fill(null).map(function(){return C([0,1])})});for(var a=0;a<e;a++)this.tileIndexes[a]=this.tileIndexes[a].map(function(){return 2});var r=this.tileIndexes[e-1];r&&(this.tileIndexes[e-1]=r.map(function(){return 3}))},e}(zb.default),rb=qb;function sb($){return!A.animating&&0===aa($).length}function oa($){var e=m[y+$]||m[y];y=m.indexOf(e),H.alpha=1,u.alpha=1,m.forEach(function($){return $.alpha=W}),0===y&&(H.alpha=W),y===m.length-1&&(u.alpha=W)}function ub($){O=ra(Math.round(100*(O+$))/100,0,1)}function vb($,e){$.energy=ra(Math.round(100*($.energy+e))/100,0,1)}function wb(){var $=this;if(!ib){ib=!0;var e=y;Na.call(this,this.game.p,e),ob=setTimeout(function(){return xb.call($,e)},2e3);var a=g.skills.indexOf(b.LT);1!==this.game.p.skills.length&&(a=C(g.skills)),pb=setTimeout(function(){return Na.call($,g,a)},4500)}}function xb($){var e=this.game.p.skills[$];ob=null,1===this.game.p.skills.length?na.call(this,-.1,.5):e===b.LT&&2===this.game.p.skills.length?na.call(this,-.1,.5):e===b.LT?Z.call(this,-.1,.25):nb===e?yb.call(this,-.15,.5):g.skills.includes(e)?na.call(this,-.1,.34):Ab.call(this,-.2),A.animateToLevel(O),o.animateToLevel(this.game.p.energy)}function yb($,e){var a=this,r=function(){return X.call(a,g,"totally!",K.default[2])};r(),window.setTimeout(r,500),window.setTimeout(r,1e3),Z.call(this,$,e)}function na($,e){X.call(this,g,"cool!",K.default[2]),Z.call(this,$,e)}function Ab($){X.call(this,g,"oh...",K.default[10]),Z.call(this,$,0),this.game.c.shakeScreen()}function Z($,e){vb(this.game.p,$),ub(e*mb)}function X($,e,a){var r=new N.default(this.game,e,a);r.buddy=$;var t=this.boxPosY*this.game.ss+this.game.p.dSize.h/2,o={x:d.pos.x+this.game.p.dSize.w/2,y:t},i={x:this.game.canvas.width,y:-b.LH};$!==this.game.p&&(o.x+=d.dSize.w-r.dSize.w-this.game.p.dSize.w,i.x=0),e===b.LT&&(i.x=o.x),r.startFloat(o,i),this.addOdables([r]),this.addUables([r])}function Na($,e){if($===g&&(pb=null),!(O>=1||this.game.p.energy<=0)){var a=$.skills[e],r=a===b.LT?K.default[9]:K.default[1];X.call(this,$,a,r),$===g&&(nb=a,this.usedTopics.includes(a)||this.usedTopics.push(a))}}function Eb(){var $=this.game.boxPos().x/this.game.ss-g.size.w/2-fb/this.game.ss,e=$+d.dSize.w/this.game.ss-g.size.w/2,a={x:$+this.game.p.size.w/2,y:this.boxPosY};this.game.p.move(a),g.move({x:e,y:a.y})}function Fb(){var $=this.game.canvas.height-this.game.boxSize().h*this.game.ss-2*this.game.ss;d.move({x:this.game.boxPos().x,y:$}),d.updateSize(this.game.boxSize());var e=o.dSize.w+A.dSize.w+gb*this.game.ss,a=(this.game.canvas.width-e)/2;o.move({x:a,y:o.pos.y});var r=o.pos.x+o.dSize.w+gb*this.game.ss;A.move({x:r,y:A.pos.y})}function Ma(){var $=this,e=pc*this.game.ss,a=d.pos.x+d.dSize.w-u.dSize.w-e,r=d.pos.y+d.dSize.h/2-u.dSize.h/2,t=d.pos.x+e,o=r;u.move({x:a,y:r}),H.move({x:t,y:o}),m.forEach(function(e,a){var r=y-a;e.alpha=0!==r||ib?W:1;var t=d.pos.x+d.dSize.w/2-e.dSize.w/2,o=d.pos.y+d.dSize.h/2-e.dSize.h/2+r*b.LS*$.game.ss;e.move({x:t,y:o}),e.visible=!(Math.abs(r)>1)})}function aa($){return $.filter(function($){return $ instanceof N.default&&$.buddy})}function Ib(){var $=aa(this.odables);Ta.forEach(function(e){return e.talking=!!$.find(function($){return $.words!==b.LT&&$.buddy===e})});for(var e=$.length-1;e>=0;e--){var a=$[e];if(!a)break;a.a.floatText.running||(ma(a,this.odables),this.uables.splice(e,1))}}function Jb($){var e=this,a=20*this.game.sf,r=this.tables.find(function(r){var t=Object.assign({},r.dSize),o=Object.assign({},r.pos);return t.w*=e.game.sf,t.h*=e.game.sf,o.x*=e.game.sf,o.y*=e.game.sf,$.clientX+a>=o.x&&$.clientX-a<=o.x+t.w&&$.clientY+a>=o.y&&$.clientY-a<=o.y+t.h});if(r&&r.visible)return r}t.default=rb;var w={},Lb=w&&w.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),Fa=w&&w.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(w,"__esModule",{value:!0});var Nb=Fa(r),Ob=Fa(x),Pb=1,Qb=function(t){function e(e){var o=t.call(this,e)||this;return o.tileTypeMap=["green","flowers","grass","tree"],o.box=new Nb.default(o.game,{x:0,y:0},{h:0,w:0}),o.box.setWords(["CONVO IRL","","TAP TO PLAY"]),o}return Lb(e,t),e.prototype.resize=function(){this.configViz()},e.prototype.update=function(e){t.prototype.update.call(this,e),this.game.c.pos.x-=.05*Pb,this.game.c.pos.x<-this.game.canvas.width&&(Pb=-1),this.game.c.pos.x>0&&(Pb=1)},e.prototype.configViz=function(){t.prototype.configViz.call(this);var e=this.game.sizeInTiles();e.w*=2,e.h*=2,this.generateTileIndexes(e),this.generateTiles(),this.box.move(this.game.boxPos()),this.box.updateSize(this.game.boxSize()),this.addDables(this.tiles,0),this.addOdables([this.box]),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3)},e.prototype.levelStarted=function(){var t=this;window.setTimeout(function(){return t.box.aniText(t.game.tstamp)},200)},e.prototype.handleInput=function(){this.game.inTr()||this.box.ani||this.game.qLevel(this.game.levels.world)},e.prototype.handleTouch=function(){this.handleInput()},e}(Ob.default),Rb=Qb;w.default=Rb;var ba,S={};!function(t,e){"function"==typeof ba&&ba.amd?ba(["exports"],e):"object"==typeof S&&"string"!=typeof S.nodeName?e(S):e(t.TinyMusic={})}(S,function(t){var e=440*Math.pow(Math.pow(2,1/12),-9),s=/^[0-9.]+$/,i=/\s+/,o=/(\d+)/,n={};function r(t){var e=t.split(i);this.frequency=r.getFrequency(e[0])||0,this.duration=r.getDuration(e[1])||0}function c(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(t,e){t.split("-").forEach(function(t){n[t]=e})}),r.getFrequency=function(t){var s=t.split(o),i=n[s[0]],r=(s[1]||4)-4;return e*Math.pow(Math.pow(2,1/12),i)*Math.pow(2,r)},r.getDuration=function(t){return s.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},c.prototype.createFxNodes=function(){var t=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(e,s){(s=this[e[0]]=this.ac.createBiquadFilter()).type="peaking",s.frequency.value=e[1],t.connect(t=s)}.bind(this)),t.connect(this.ac.destination),this},c.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof r?t:new r(t))}.bind(this)),this},c.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},c.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},c.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},c.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},c.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},c.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},c.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},c.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},c.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},c.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=r,t.Sequence=c});var z={},Vb=z&&z.__extends||function(){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function($,e){$.__proto__=e}||function($,e){for(var a in e)e.hasOwnProperty(a)&&($[a]=e[a])};return function(e,a){function r(){this.constructor=e}$(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),I=z&&z.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(z,"__esModule",{value:!0});var wa,Yb,hb,bb,c,k,F,sa,D,ec=I(e),fc=I(x),gc=I(r),q=I(J),ic=I(L),jc=I(S),kc=[["great news! a","new kid moved","into the woods!"],["become friends","by having a","convo... irl!"],["first level up!","chat with","your neighbors!"],["talk to them","about their","interests!"]],lc=[["keep at it","and make","new friends!"],["if you are","low on energy","take a nap!"]],Ja=[["great job!","you made a","new friend!"],["maybe you","will become","best buds!"],["be kind to","your friends","because"],["every quest","is better","with friends!"],["","game over",""]],_={x:18*b.TS,y:7*b.TS},oc={x:4*b.TS,y:5*b.TS},h=["BAKING","FRANCE","SPORTS","ANIME","BOOKS","MATH","CATS"],ya=h.slice(),ka={x:4*b.TS,y:6*b.TS},eb={pressedAt:0,key:null},tc=0,uc=function($){function e(e){var a=$.call(this,e)||this;a.tileTypeMap=["green","flowers","grass","tree","house","unwalkable","door"],a.tileIndexes=[[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,,,,3,3,3,3,,,,,,3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,2,,,3,3,3,3,,1,,,,3,3,3,3,3,,,3,3],[3,3,3,4,5,5,3,,,2,,3,3,3,,,,,,3,3,3,3,,,,3,3],[3,3,3,5,5,5,3,,1,,,3,3,2,,,,2,,,,3,,,,3,3,3],[3,3,3,5,6,5,3,,,,1,,,,,,,,,,,,,,,3,3,3],[3,3,3,1,1,1,1,3,3,,,,,,,,,,,,,,,,,,,3],[3,3,3,1,1,1,1,3,3,3,3,,,,,,1,,,,,,,,,,,3],[3,3,3,3,,,,3,3,3,3,3,,2,,,,,,,,,,,,,,3],[3,,2,3,3,,2,,3,3,3,,,,,,,1,,,,,,,,,,3],[3,,,3,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,,,2,3,3,3,,,,,,,,,,,,,,,,,,,,,3],[3,1,,3,3,3,,,,,,,,,,,,,,1,,,3,,,,,3],[3,,,3,3,2,,,,,,,,,,,,,,3,,,2,3,,,,3],[3,,,3,3,,,,2,,,,,,,,,,,3,3,,,2,3,3,3,3],[3,,,3,,,,,,,1,3,3,,,,,,,,3,3,,,4,5,5,3],[3,,,,,,,,3,3,3,3,,1,,,,,,,3,3,,,5,5,5,3],[3,,,3,3,3,,3,3,3,3,,,,,,3,3,3,3,3,3,,,5,6,5,3],[3,3,3,3,3,3,3,3,3,3,3,2,,,,,,3,3,3,3,3,,2,1,1,1,3],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]],wa=function(){return la.call(a,kc)},Yb=function(){return la.call(a,lc)},hb=function(){return la.call(a,Ja)},a.state="intro";var r=V(a.handleTouch.bind(a),b.TT),t=V(a.handleInput.bind(a),b.TT);return a.handleTouch=r,a.handleInput=t,a.generateTiles(),D=new ic.default(a.game,{x:0,y:e.ss},"ENERGY"),c=new gc.default(a.game,a.game.boxPos(),a.game.boxSize()),Gc.call(a),a}return Vb(e,$),e.prototype.handleInput=function($){this.game.inTr()||ab.call(this)||(eb={pressedAt:this.game.tstamp,key:$})},e.prototype.handleTouch=function($){if(!this.game.inTr()&&!this.game.p.walking&&!ab.call(this)){var e=this.game.c,a=e.size,r=a.h,t=a.w,o=e.offset,i=$.clientX*t/window.innerWidth-o.x,s=$.clientY*r/window.innerHeight-o.y,y=i-this.game.p.pos.x*this.game.ss,n=s-this.game.p.pos.y*this.game.ss,v=Math.abs(y),l=Math.abs(n),P=this.game.ss*b.TS/2;v<P&&l<P||(v>l?Ec.call(this,y):Dc.call(this,n))}},e.prototype.resize=function(){var $=(this.game.canvas.width-D.dSize.w)/2;D.move({x:$,y:D.pos.y}),Ac.call(this)},e.prototype.update=function(e){$.prototype.update.call(this,e),Hc.call(this),Xa.call(this,this.game.p.tileIndex),this.game.c.moveToPlayer(this.game.p),k.pos.x<=_.x-5*b.TS&&(k.autoWalkDirection="right"),k.pos.x>=_.x+5*b.TS&&(k.autoWalkDirection="left")},e.prototype.configViz=function(){$.prototype.configViz.call(this),this.addDables(this.tiles,0),this.addDables(this.game.p.dusts,1),this.addDables(k.dusts,1),this.addDables([this.game.p],2),this.addDables(bb,2),this.addOdables([D,c]),this.addIables(bb),this.addUables(this.game.p.dusts.concat([this.game.p,k],k.dusts,[F])),this.configClouds(this.size.w,this.size.h,.3),this.addDables(this.clouds,3),this.resize()},e.prototype.levelStarted=function(){switch(D.animateToLevel(this.game.p.energy),k.move(_),this.game.p.move(ka),this.game.p.stop(),this.game.p.setConvoMode(!1),this.state){case"intro":wa();break;case"nap":this.game.p.move(oc),Wa.call(this);break;case"win":this.game.p.energy=1,hb();break;case"post-listen":case"post-convo":zc.call(this),this.currentBuddy.lastConvo=this.game.tstamp,this.game.p.lastConvo=this.game.tstamp;}var $=new(window.AudioContext||webkitAudioContext);new jc.default.Sequence($,120,["G2 q","G3 q","G4 q"]).loop=!1},e}(fc.default),vc=uc;function db(){c.visible=!1}function ab(){if("play"===this.state)return!1;if(c.ani)return!0;switch(this.state){case"sleeping":db.call(this),this.state="play",this.handleInput("ArrowDown");break;case"post-convo":db.call(this),this.state="play";break;case"post-listen":Yb()&&(this.state="play",F.walk("right"),F.look("left"));break;case"intro":wa()&&(this.state="play");break;case"win":hb(),0===Ja.length&&(this.state="game-over",tc=this.game.tstamp,Y.game=this.game,Y.size=Object.assign({},this.size),Y.dSize=Object.assign({},this.dSize),this.addDables([Y],3));}return!0}function la($){var e=$[0];return e?(c.visible=!0,c.setWords(e),c.aniText(this.game.tstamp),$.shift(),!1):(c.visible=!1,!0)}function zc(){var $=this;if(this.currentBuddy){var e=this.game.levels.convo.usedTopics.filter(function(e){return!$.game.p.skills.includes(e)}),a=e.length>0?e[C(e)]:null;c.visible=!0,a?(c.setWords(["nice convo!","you learned",a+"!"]),this.game.p.skills.push(a)):c.setWords(["nice convo!","that was a","good time!"]),c.aniText(this.game.tstamp)}}function Ac(){c.move(this.game.boxPos()),c.updateSize(this.game.boxSize())}function Xa($){var e=this.iables.find(function(e){return e.tileIndex.x===$.x&&e.tileIndex.y===$.y});return!!(e&&this.game.tstamp-e.lastConvo>1e3)&&(this.currentBuddy=e,ka.x=this.game.p.pos.x,ka.y=this.game.p.pos.y,this.game.qLevel(this.game.levels.convo),!0)}function Wa(){this.game.p.energy=1,D.animateToLevel(this.game.p.energy),c.setWords(["","zzzzzz...",""]),c.aniText(this.game.tstamp),c.visible=!0,this.state="sleeping"}function Dc($){$<0&&this.handleInput("ArrowUp"),$>0&&this.handleInput("ArrowDown")}function Ec($){$>0&&this.handleInput("ArrowRight"),$<0&&this.handleInput("ArrowLeft")}function G($){var e=ya.find(function(e){return e!==$});return ma(e,ya),e}function Gc(){var $;(F=new q.default(this.game)).move({x:7*b.TS,y:10*b.TS}),F.skills.push(b.LT,h[6]),F.look("up");var e=new q.default(this.game);e.move({x:8*b.TS,y:1*b.TS}),e.skills.push(h[0],G(h[0]));var a=new q.default(this.game);a.move({x:18*b.TS,y:3*b.TS}),a.skills.push(h[1],G(h[1]));var r=new q.default(this.game);r.move({x:25*b.TS,y:2*b.TS}),r.skills.push(h[2],G(h[2]));var t=new q.default(this.game);t.move({x:15*b.TS,y:18*b.TS}),t.skills.push(h[3],G(h[3])),t.look("up");var o=new q.default(this.game);o.move({x:26*b.TS,y:8*b.TS}),o.skills.push(h[4],G(h[4])),o.look("left"),(k=new q.default(this.game)).autoWalkDirection="left",k.skills.push(h[5],G(h[5])),k.a.walking.duration=600,(sa=new q.default(this.game)).move({x:23*b.TS,y:18*b.TS}),sa.look("left"),($=sa.skills).push.apply($,h),bb=[F,e,a,r,sa,t,o,k]}function Hc(){if(this.game.tstamp-eb.pressedAt>30)return!1;if(this.game.p.walking)return!1;var $=Object.assign({},this.game.p.tileIndex),e=null;switch(eb.key){case"ArrowUp":e="up",$.y-=1;break;case"ArrowDown":e="down",$.y+=1;break;case"ArrowLeft":e="left",$.x-=1;break;case"ArrowRight":e="right",$.x+=1;break;default:return;}return Xa.call(this,$)?void 0:(this.tileAtIndex($).interactable&&Wa.call(this),this.game.p.walk(e),!0)}z.default=vc;var Y={alpha:0,dSize:{w:0,h:0},draw:function($){$.fillStyle=ec.default[0],$.globalAlpha=Math.min((this.game.tstamp-tc)/2e3,.8),$.fillRect(0,0,this.dSize.w,this.dSize.h)},game:null,pos:{x:0,y:0},size:{w:0,h:0},visible:!0};var Q={},U=Q&&Q.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(Q,"__esModule",{value:!0});var Lc,Mc,f,Oc=U(J),Pc=U(ja),Qc=U(t),Rc=U(w),Sc=U(z),Oa=5,Ia=16*b.TS*Oa,j={duration:1e3,nextLevelAlpha:0,prevLevelAlpha:1,prevLevelScale:1,running:!1,startTime:0},Wc=!1,Ea=null,Da=null,Zc=function(){function $($){this.tstamp=0,this.ss=Oa,this.sf=1,this.nextAlpha=1,this.p=new Oc.default(this),this.p.skills.push("WEATHER"),this.canvas=$,ta.call(this),(f=$.getContext("2d",{alpha:!1})).mozImageSmoothingEnabled=!1,f.webkitImageSmoothingEnabled=!1,this.levels={convo:new Qc.default(this),startScreen:new Rc.default(this),world:new Sc.default(this)},this.c=new Pc.default(this)}return $.prototype.boxPos=function(){return{x:(this.canvas.width-this.boxSize().w*this.ss)/2,y:(this.canvas.height-this.boxSize().h*this.ss)/2}},$.prototype.boxSize=function(){return{h:3*b.LH+2*b.LS,w:12*b.LH}},$.prototype.inTr=function(){return j.running},$.prototype.update=function($){Wc||(this.tstamp=$,Qa.call(this,this.levels.startScreen),this.resize(),Wc=!0),this.tstamp=$,this.cl.update($),this.inTr()&&Ua.call(this,$)},$.prototype.draw=function($){f&&this.c&&(this.c.updateShake($),gd.call(this),dd.call(this,$),fd.call(this,$),this.inTr()&&Ua.call(this,$))},$.prototype.resize=function(){var $=window.innerWidth/window.innerHeight;$>=1?Mc=(Lc=Ia)/$:Lc=(Mc=Ia)*$,this.canvas.width=Lc,this.canvas.height=Mc,this.c.size={w:this.canvas.width,h:this.canvas.height},ta.call(this),this.cl&&this.cl.resize()},$.prototype.qLevel=function($,t){if($===this.levels.convo){var a=this.levels,e=a.convo,r=a.world;e.setBuddy(r.currentBuddy.copy())}Ea=$,t&&(Ea.state=t),_c.call(this)},$.prototype.handleInput=function($){this.cl.handleInput($.key)},$.prototype.handleTouch=function($){this.cl.handleTouch($)},$.prototype.sizeInTiles=function(){return{w:Math.ceil(this.canvas.width/this.ss/b.TS),h:Math.ceil(this.canvas.height/this.ss/b.TS)}},$}(),$c=Zc;function _c(){j.startTime=this.tstamp,j.running=!0,(Da=new Image).src=this.canvas.toDataURL("png"),Qa.call(this,Ea)}function ta(){this.sf=window.innerWidth/this.canvas.width}function Ua($){var t=($-j.startTime)/j.duration;j.prevLevelScale=v(1,5,1,5,t),j.prevLevelAlpha=v(1,0,0,1,t),j.nextLevelAlpha=v(0,1,0,1,t),this.nextAlpha=j.nextLevelAlpha,t>=1&&(j.running=!1,Da=null)}function Qa($){this.cl=$,this.cl.levelWillStart(),this.cl.configViz(),this.cl.levelStarted()}function dd($){var t=this,a=this.c.offset;if(this.cl.dables.forEach(function(e){e.forEach(function(e){if(e&&e.visible){var r=e.pos.x*t.ss+a.x,i=e.pos.y*t.ss+a.y;ed.call(t,r,i,e.dSize)||(f.translate(r+.5|0,i+.5|0),f.globalAlpha=t.inTr()?j.nextLevelAlpha:1,e.draw(f,$),f.setTransform(1,0,0,1,0,0))}})}),f.globalAlpha=1,Da){f.globalAlpha=j.prevLevelAlpha;var e=j.prevLevelScale,r=(this.canvas.width*e-this.canvas.width)/2,i=(this.canvas.height*e-this.canvas.height)/2;f.drawImage(Da,-r,-i,this.canvas.width*e,this.canvas.height*e),f.globalAlpha=1}}function ed($,t,a){return $+a.w<0||$>this.canvas.width||t+a.h<0||t>this.canvas.height}function fd($){this.inTr()&&(f.globalAlpha=j.nextLevelAlpha),this.cl.odables.forEach(function(t){t.visible&&t.draw(f,$)}),f.globalAlpha=1}function gd(){this.inTr()&&(f.globalAlpha=j.nextLevelAlpha),f.fillStyle=this.cl.bgColor,f.fillRect(0,0,this.canvas.width,this.canvas.height)}Q.default=$c;var pa={};Object.defineProperty(pa,"__esModule",{value:!0});function id(t,$,e){var r=0,u=0;return function(a){for(r+=Math.min(a-u,10*b.MS),u=a;r>=t;)$.call(e,a),r-=t}}var jd=id;pa.default=jd;var P={},Va=P&&P.__importDefault||function($){return $&&$.__esModule?$:{default:$}};Object.defineProperty(P,"__esModule",{value:!0});var md=Va(Q),nd=Va(pa),od=document.getElementById("game"),s=new md.default(od),qd=nd.default(b.MS,s.update,s),Ra=null,sd=!1;function La($){Ra&&sd&&s.handleTouch(Ra),qd($),s.draw($),requestAnimationFrame(La)}function Ca($){fa($),sd=!0}function fa($){$.preventDefault();var a=$;$.touches&&(a=$.changedTouches[0]),Ra=a}function $a(){Ra=null,sd=!1}requestAnimationFrame(La),window.onresize=s.resize.bind(s),window.onkeydown=s.handleInput.bind(s),window.onmousedown=Ca,window.ontouchstart=Ca,window.onmouseup=$a,window.ontouchend=$a,window.onmousemove=fa,window.addEventListener("touchmove",fa,{passive:!1});if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=P}else if(typeof define==="function"&&define.amd){define(function(){return P})}})();</script>